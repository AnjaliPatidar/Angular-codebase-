"use strict";

/*--------------------------Store grouped chart Values-----------------------------*/
var groupedColumnValues = {
        //  colors: ["#f86520", "#fd9220", "#fac322", "#e7f921", "#E58B19"],
        xAxisTextX: 8,
        xAxisTextY: 10,
        xAxisTextDX: ".71em",
        yAxisTextDY: "1.1em",
        yAxisTextdx: -20,
        stackedChartDuration: 300,
        groupedBarsDuration: 300,
        clipPathDuration: 400,
        legendColor: "rgb(108, 126, 136)",
        barsX: 0,
        barsY: 0,
        scalesHeight: 0,
        scalesPadding: 0.2
};
function groupedColumChart(barOptions) {
        if (barOptions.container) {
                $(barOptions.container).empty();
        }
        if (location.hash == "#!/alertDashboard" && (!barOptions.data || barOptions.data.length == 0)) {
                d3.select(barOptions.container).append("div").attr("class", "alertsDashErrorDiv").html("<span>Data Not Found</span>");
                return false;
        }
        /*--------------------------Initialize Values-----------------------------*/
        if (barOptions) {
                this.container = barOptions.container ? barOptions.container : "body";
                this.barColor = barOptions.barColor ? barOptions.barColor : "blue";
                this.readFromFile = barOptions.readFromFile !== undefined ? barOptions.readFromFile : false;
                this.dataFileLocation = barOptions.readFromFile !== undefined || barOptions.readFromFile ? barOptions.dataFileLocation : undefined;
                this.data = barOptions.data ? barOptions.data : [];
                this.showTicks = barOptions.showTicks ? barOptions.showTicks : true;
                this.ticks = barOptions.ticks ? barOptions.ticks : 'all';
                this.showLegends = barOptions.showLegends !== undefined ? barOptions.showLegends : false;
                this.xLabelRotation = barOptions.xLabelRotation ? barOptions.xLabelRotation : 0;
                this.yLabelRotation = barOptions.yLabelRotation ? barOptions.yLabelRotation : 0;
                this.margin = barOptions.margin ? {
                        top: barOptions.margin.top ? barOptions.margin.top : 20,
                        right: barOptions.margin.right ? barOptions.margin.right : 20,
                        bottom: barOptions.margin.bottom ? barOptions.margin.bottom : 30,
                        left: barOptions.margin.left ? barOptions.margin.left : 40
                } : { top: 20, right: 20, bottom: 50, left: 50 };

                this.showAxisX = barOptions.showAxisX !== undefined ? barOptions.showAxisX : true;
                this.showAxisY = barOptions.showAxisY !== undefined ? barOptions.showAxisY : true;
                this.showXaxisTicks = barOptions.showXaxisTicks !== undefined ? barOptions.showXaxisTicks : true;
                this.showYaxisTicks = barOptions.showYaxisTicks !== undefined ? barOptions.showYaxisTicks : true;
                this.groupedStacked = barOptions.groupedStacked ? barOptions.groupedStacked : "grouped";
                this.randomIdString = Math.floor(Math.random() * 10000000000);
                this.groupedColumnHeader = barOptions.header ? barOptions.header : "";
                this.height = barOptions.height ? barOptions.height : 600;
                this.ytext = barOptions.ytext ? barOptions.ytext : "Usability Rate";
                this.xtext = barOptions.xtext ? barOptions.xtext : "Vehical Model";
                this.legendColor = barOptions.legendColor ? barOptions.legendColor : false;
                this.headerOptionsExpand = barOptions.headerOptionsExpand == false ? barOptions.headerOptionsExpand : true;
                this.headerOptions = barOptions.headerOptions == false ? barOptions.headerOptions : true;
                this.isHeaer = barOptions.isHeaer == false ? barOptions.isHeaer : true;
                this.showlineaxisX = barOptions.showlineaxisX == false ? barOptions.showlineaxisX : true;
                this.showlineaxisY = barOptions.showlineaxisY == false ? barOptions.showlineaxisY : true;
                this.showgroupedstacked = barOptions.showgroupedstacked == false ? barOptions.showgroupedstacked : true;
                this.colors = barOptions.colors ? barOptions.colors : ["#f86520", "#fd9220", "#fac322", "#e7f921", "#E58B19"];
                this.islegends = barOptions.islegends ? barOptions.islegends : false;
                this.showxYTxt = barOptions.showxYTxt ? barOptions.showxYTxt : false;
        } else {
                return false;
        }
        var randomSubstring = this.randomIdString;
        var actualOptions = jQuery.extend(true, {}, barOptions);
        var _this = this;
        var h1 = this.height;
        if (!_this.showgroupedstacked) {
                var h = parseInt(h1);
        } else {
                var h = parseInt(h1) + 80;
        }
        var container = barOptions.container;
        var type = barOptions.type;
        var header = this.isHeaer ? this.groupedColumnHeader : "";

        var modalwidth = $(window).width() - 200;
        var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade group-chart-modal" tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"><form><div class="modal-content"><div class="modal-body" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';
        var chartContainerdiv = '<div class="chart-container"><div class="graph-box-wrapper" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;background:transparent;"> <div class="chart-header-wrapper">' + header + '</div><div style="text-transform:uppercase" id="groupedColumn_chart_div' + randomSubstring + '" class="chart-content-wrapper"></div></div></div>';

        $(this.container).html(chartContainerdiv);
        $(this.container).append(modal);
        var chart_container = "#groupedColumn_chart_div" + randomSubstring;

        this.width = barOptions.width ? barOptions.width : $(chart_container).width() - 10;
        var groupedStacked = this.groupedStacked;
        var margin = this.margin,
            width = this.width - margin.left - margin.right,
            height = this.height - margin.top - margin.bottom,
            barColor = this.barColor;
        if (!this.headerOptionsExpand) {
                var closebtn = '<button type="button" class="cancel" data-dismiss="modal" aria-label="Close"><span class="fa fa-remove"></span></button>';
                $(chart_container).siblings(".chart-header-wrapper").append(closebtn);
        }
        if ($(chart_container).siblings(".chart-header-wrapper").find(".bstheme_menu_button").length == 0) var header_options = '<div class="btn-bstheme-menu bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
        if (this.headerOptions) $(chart_container).siblings(".chart-header-wrapper").append(header_options);

        if (!this.headerOptionsExpand) {
                $(chart_container).siblings(".chart-header-wrapper").find(".bstheme_options").css("right", "28px");
                $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
        } else {
                $(chart_container).siblings(".chart-header-wrapper").find(".bstheme_options").css("right", "0");
        }
        if (!_this.isHeaer) {
                $(chart_container).siblings(".chart-header-wrapper").css("border-bottom", "0");
                $(chart_container).siblings(".chart-header-wrapper").find(".bstheme_menu_button").remove();
        }
        /*--  append div for switching between stack and group  --*/
        if (groupedStacked == "grouped") {
                $(chart_container).append('<div class="switch-chart-wrapper"><form><label class="custom-radio"><input type="radio" name="mode" value="grouped" checked><span><i class="fa fa-circle"></i>Grouped</span></label><label class="custom-radio"><input type="radio" name="mode" value="stacked"><span><i class="fa fa-circle"></i>Stacked</span></label></form></div>');
        } else {
                $(chart_container).append('<div class="switch-chart-wrapper"><form><label class="custom-radio"><input type="radio" name="mode" value="grouped"><span><i class="fa fa-circle"></i>Grouped</span></label><label class="custom-radio"><input type="radio" name="mode" value="stacked" checked><span><i class="fa fa-circle"></i>Stacked</span></label></form></div>');
        }
        if (!_this.showgroupedstacked) {
                $(chart_container).find('form').css('display', 'none');
        }
        /*--  APPEND legend header  --*/
        if (_this.islegends == true) {
                $(".groupedbarlegendContainerDiv").remove();
                $(chart_container).parent().find(".chart-header-wrapper").append("<div class='groupedbarlegendContainerDiv legend-container' style='max-width:60%;text-transform:uppercase' id='legendContainer-" + randomSubstring + "'></div>");
        }
        /*--  define svg  --*/
        var svg = d3.select(chart_container).append("svg").attr('height', this.height).attr('width', this.width).attr('id', 'mainSvg-' + randomSubstring);

        /*--  define tool tip  --*/
        $(".grouped-bar-tooltip").remove();
        var tool_tip = $('body').append('<div class="grouped-bar-tooltip" style="display:none;z-index: 99999;text-transform:uppercase"><span class="tooltip-text"><span class="tool-tip-x-val"></span><table><tbody><tr><td></td><td><strong>216.4 mm</strong></td></tr><tr><td>New York:</td><td><strong>91.2 mm</strong></td></tr><tr><td>London:</td><td><strong>52.4 mm</strong></td></tr><tr><td>Berlin: </td><td><strong>47.6 mm</strong></td></tr></tbody></table></span></div>');

        /*--  define  scales  --*/
        var x0 = d3.scaleBand().rangeRound([0, width]).paddingInner(0.2),
            y = d3.scaleLinear().rangeRound([height, groupedColumnValues.scalesHeight]),
            x1 = d3.scaleBand().padding(groupedColumnValues.scalesPadding);
        var colorScale = d3.scaleOrdinal().range(_this.colors);

        /*--  define main grounp  --*/
        var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr('id', 'mainGroup-' + randomSubstring);

        /*--  get bar data and check for existance  --*/
        var columnData = this.data;
        if (columnData) {
                if (columnData.length) drawColumns(columnData, this.barColor);
        } else {}

        /*------------------------------------------------------------------------------*/
        /**
         *
         * @param {array} data
         * @returns {undefined}Function to plot bars
         */
        function drawColumns(data) {
                function rectangle(x, y, width, height, radius) {
                        return "M" + (x + radius) + "," + y + "h" + (width - 2 * radius) + "a" + radius + "," + radius + " 0 0 1 " + radius + "," + radius + "v" + (height - 2 * radius) + "v" + radius + "h" + -radius + "h" + (2 * radius - width) + "h" + -radius + "v" + -radius + "v" + (2 * radius - height) + "a" + radius + "," + radius + " 0 0 1 " + radius + "," + -radius + "z";
                };
                var clip = g.append("defs").append("svg:clipPath").attr("id", "clip" + randomSubstring).append("svg:rect").attr("id", "clip-rect").attr("x", groupedColumnValues.barsX).attr("y", groupedColumnValues.barsY).attr("width", width).attr("height", height);

                /*--  get keys from object  --*/
                var keys = d3.keys(data[0]).slice(1);

                /*--  define stack for stacked bar  --*/
                var stack = d3.stack().keys(keys).offset(d3.stackOffsetNone);

                var layers = stack(data);

                /*--  defines domains  --*/
                x0.domain(data.map(function (d) {
                        return d.x;
                }));
                x1.domain(keys).rangeRound([0, x0.bandwidth()]);

                /*--  x-aixs  --*/
                if (_this.showAxisX) {
                        var x_g = g.append("g").attr("class", "axis axis--x").attr("transform", "translate(0," + height + ")").attr('id', 'xAxis-' + randomSubstring).call(d3.axisBottom(x0));
                        x_g.append("text").attr("transform", "translate(" + width / 2 + "," + 30 + ")").attr("x", groupedColumnValues.xAxisTextX).attr("y", groupedColumnValues.xAxisTextY).attr("dx", groupedColumnValues.xAxisTextDX).style("text-anchor", "middle").style("fill", "#6c7e88").text(_this.xtext).style("font-size", "14px");
                        x_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                        x_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");

                        if (_this.xLabelRotation != 0 && _this.xLabelRotation != undefined) {
                                x_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none").style("text-anchor", "end").attr("dx", "-.8em").attr("dy", ".15em").attr("transform", _this.xLabelRotation);
                        } else {
                                x_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
                        }
                }

                y.domain([0, d3.max(data, function (d) {
                        return d3.max(keys, function (key) {
                                return d[key];
                        });
                })]);

                if (!_this.showlineaxisX) {
                        $('.axis--x').find('.domain').css('display', 'none');
                        x_g.selectAll('line').remove();
                }
                /*--  y-aixs  --*/
                var y_g = g.append("g").attr("class", "axis axis--y").attr('id', 'yAxis-' + randomSubstring).call(d3.axisLeft(y).ticks(4, "s"));

                y_g.append("text").attr("transform", "rotate(-90)").attr("y", -margin.left).attr("dy", groupedColumnValues.yAxisTextDY).attr("dx", groupedColumnValues.yAxisTextdx).style("text-anchor", "end").style("fill", "#6c7e88").text(_this.ytext).style("font-size", "14px");

                y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");

                if (!_this.showlineaxisY) {
                        $('.axis--y').find('.domain').css('display', 'none');
                        y_g.selectAll('line').remove();
                }
                /*--  add groups based on data  --*/
                var groupedG = g.append("g").selectAll("g").data(data).enter().append("g").attr("class", "groupg").on("contextmenu", function () {
                        if (location.hash == "#!/alertDashboard") {
                                window.transSelectedFilter.data = type;
                                window.transSelectedFilter.id = container;
                                window.transSelectedFilter.chartType = "bar";
                                //    	           		 aplyAlertDasboardFilters(d,pieOptions.container,"pie");
                        }
                }).on("mouseover", function (d) {
                        /*--  show tooltip  --*/
                        $(this).find("path").css("fill-opacity", 0.6);
                        $(this).find(".background_rect").css("fill", "transparent");
                        $(".grouped-bar-tooltip").empty();
                        var keys = d3.keys(d).slice(1);
                        if (barOptions.showxYTxt) {
                                var text = '';
                                var keys = d3.keys(d).slice(1);
                                for (var i = 0; i < keys.length; i++) {
                                        text = text + "<div style='color:" + barOptions.colors[i] + "!important'>" + d.x + ": <span >" + d[keys[i]] + "</span></div>";
                                }
                        } else if (barOptions.txt != undefined) {
                                var tooltipData = [];
                                $.each(barOptions.txt, function (k, v) {
                                        if (d.x === v.CaseId) {
                                                tooltipData.push(v);
                                        }
                                });
                                var keys1 = d3.keys(tooltipData[0]).slice(1);

                                var text = '<table style = "color:#000; border-collapse: collapse;font-size: 12px;min-width: 50px">';
                                for (var i = 0; i < keys1.length; i++) {
                                        text += '<tr><td style="color:#7d94a5;font-size:12px" class="table-item">' + keys1[i].toUpperCase() + '</td><td style="color:#7d94a5;font-size:12px">: ' + tooltipData[0][keys1[i]] + '</td></tr>';
                                }
                                text += '</table>';
                        } else {
                                var text = '<span style="color:#7d94a5">' + d.x + '</span><table style = "color:#000; border-collapse: collapse;font-size: 12px;min-width: 50px">';
                                for (var i = 0; i < keys.length; i++) {
                                        text += '<tr><td style="color:#7d94a5;font-size:12px" class="table-item">' + keys[i].toUpperCase() + '</td><td style="color:#7d94a5;font-size:12px">' + d[keys[i]] + '</td></tr>';
                                }
                                text += '</table>';
                        }
                        $(".grouped-bar-tooltip").html(text);
                        $(".grouped-bar-tooltip").css("visibility", "visible");
                        return $(".grouped-bar-tooltip").css("display", "block");
                }).on("mousemove", function (e) {
                        var p = $(chart_container);
                        var position = p.offset();
                        var windowWidth = window.innerWidth;
                        var tooltipWidth = $(".grouped-bar-tooltip").width() + 50;
                        var cursor = d3.event.x;
                        if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                                var element = document.getElementsByClassName("grouped-bar-tooltip");
                                element[0].classList.remove("tooltip-left");
                                element[0].classList.add("tooltip-right");
                                $(".grouped-bar-tooltip").css("left", d3.event.pageX - 15 - $(".grouped-bar-tooltip").width() + "px");
                        } else {
                                var element = document.getElementsByClassName("grouped-bar-tooltip");
                                element[0].classList.remove("tooltip-right");
                                element[0].classList.add("tooltip-left");
                                $(".grouped-bar-tooltip").css("left", d3.event.pageX + 10 + "px");
                        }
                        return $(".grouped-bar-tooltip").css("top", d3.event.pageY + "px");
                }).on("mouseout", function () {
                        /*--  hide tool-tip  --*/
                        $(this).find(".background_rect").css("fill", "transparent");
                        $(this).find("path").css("fill-opacity", 1);
                        $(".grouped-bar-tooltip").css("visibility", "hidden");
                        return $(".grouped-bar-tooltip").css("display", "none");
                }).attr("transform", function (d) {
                        return "translate(" + x0(d.x) + ",0)";
                });

                /*--  append background rect for tooltip  --*/
                groupedG.append("rect").attr("class", "background_rect").attr("rx", 5).attr("ry", 5).attr("x", 0).attr("y", 0).attr("width", x0.bandwidth()).attr("height", height).attr("fill", "transparent").attr("opacity", 1);

                /*--  append bars  --*/
                var prevVal = 0;
                var rect = groupedG.selectAll(".rect_" + randomSubstring).data(function (d) {
                        prevVal = 0;
                        return keys.map(function (key, i) {
                                var curentObj = { key: key, value: d[key], value0: prevVal };
                                prevVal = prevVal + d[key];
                                return curentObj;
                        });
                }).enter().append("path").attr("class", function (d) {
                        return "rect_" + randomSubstring + " rect_" + randomSubstring + "_" + d.key;
                }).attr("clip-path", "url(#clip" + randomSubstring + ")").attr("d", function (d, i) {
                        var x, width;
                        if (x1.bandwidth() > 100) {
                                x = x1(d.key) + parseFloat(x1.bandwidth() / 3);
                                width = parseFloat(x1.bandwidth() / 3);
                        } else {
                                x = x1(d.key);
                                width = parseFloat(x1.bandwidth());
                        }
                        return rectangle(x, y(d.value), width, height - y(d.value), x1.bandwidth() / 4 > 5 ? x1.bandwidth() / 4 > 20 ? 20 : x1.bandwidth() / 4 : 5);
                })
                //                .attr("x", function (d) {
                //                    return x1(d.key);
                //                })
                //                .attr("y", height)
                //
                //                .attr("rx", (x1.bandwidth() / 4))
                //                .attr("ry", (x1.bandwidth() / 4))
                //                .attr("width", x1.bandwidth())
                //
                //                .attr("height", function (d) {
                //                    return height - y(d.value);
                //                })
                .attr("fill", function (d) {
                        return colorScale(d.key);
                }).transition().duration(groupedColumnValues.clipPathDuration).ease(d3.easeLinear).attr("y", function (d) {
                        return y(d.value);
                });
                $('input[type=radio][name=mode]').change(function () {
                        if ($(this).val() == "grouped") {
                                plotGroupedBars();
                        } else {
                                plotStackedChart();
                        }
                });

                if (groupedStacked != "grouped") {
                        plotStackedChart();
                }
                function plotGroupedBars() {

                        y.domain([0, d3.max(data, function (d) {
                                return d3.max(keys, function (key) {
                                        return d[key];
                                });
                        })]);
                        d3.selectAll('#yAxis-' + randomSubstring).call(d3.axisLeft(y).ticks(8, "s"));
                        var y_g = d3.selectAll('#yAxis-' + randomSubstring);
                        y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                        y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                        y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
                        d3.selectAll(".rect_" + randomSubstring).transition().duration(groupedColumnValues.groupedBarsDuration).delay(function (d, i) {
                                return i * 10;
                        }).attr("d", function (d, i) {
                                var x, width;
                                if (x1.bandwidth() > 100) {
                                        x = x1(d.key) + parseFloat(x1.bandwidth() / 3);
                                        width = parseFloat(x1.bandwidth() / 3);
                                } else {
                                        x = x1(d.key);
                                        width = parseFloat(x1.bandwidth());
                                }
                                return rectangle(x, y(d.value), width, height - y(d.value), x1.bandwidth() / 4 > 5 ? x1.bandwidth() / 4 > 20 ? 20 : x1.bandwidth() / 4 : 5);
                        });
                        //                    .attr("x", function (d) {
                        //                        return x1(d.key);
                        //                    })
                        //                    .attr("width", x1.bandwidth())
                        //                    .transition()
                        //                    .attr("y", function (d) {
                        //                        return y(d.value);
                        //                    })
                        //                    .attr("height", function (d) {
                        //                        return height - y(d.value);
                        //                    }).attr("rx", (x1.bandwidth() / 4))
                        //                    .attr("ry", (x1.bandwidth() / 4))
                }
                function plotStackedChart() {

                        y.domain([0, d3.max(layers[layers.length - 1], function (d) {

                                return d[0] > d[1] ? d[0] : d[1];
                        })]).nice();
                        d3.selectAll('#yAxis-' + randomSubstring).call(d3.axisLeft(y).ticks(8, "s"));
                        var y_g = d3.selectAll('#yAxis-' + randomSubstring);
                        y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                        y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                        y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
                        d3.selectAll(".rect_" + randomSubstring).transition().duration(groupedColumnValues.stackedChartDuration).delay(function (d, i) {
                                return i * 10;
                        }).attr("d", function (d, i) {
                                var x, width;
                                if (x0.bandwidth() > 100) {
                                        x = x0.bandwidth() / 2.5;
                                        width = x0.bandwidth() / 5;
                                } else {
                                        x = 0;
                                        width = x0.bandwidth();
                                }
                                return rectangle(x, y(d.value + d.value0), width, y(d.value0) - y(d.value + d.value0), 0);
                        });
                        //                    .attr("y", function (d) {
                        //                        return y(d.value + d.value0);
                        //                    })
                        //                    .attr("height", function (d) {
                        //                        return y(d.value0) - y(d.value + d.value0);
                        //                    })
                        //                    .transition()
                        //                    .attr("x", function (d, i) {
                        //                        if (x0.bandwidth() > 20) {
                        //                            return (x0.bandwidth()) / 4;
                        //                        } else {
                        //                            return 0;
                        //                        }
                        //                    })
                        //                    .attr("width", function () {
                        //                        if (x0.bandwidth() > 20) {
                        //                            return  x0.bandwidth() / 2;
                        //                        } else {
                        //                            return  x0.bandwidth();
                        //                        }
                        //                    })
                        //                    .attr("rx", 0)
                        //                    .attr("ry", 0);
                }

                /*--  call function to ender legends  --*/
                renderLegend(keys, randomSubstring);
        }

        /*--------------------------------------------------------------------------*/
        function renderLegend(labelObject) {
                var numberOfLegends = labelObject.length;

                /*--  create legends div  --*/
                var legenddiv = d3.select('#legendContainer-' + randomSubstring);

                /*--  holder for each legend  --*/
                var legendHolder = legenddiv.selectAll('.legend-holder').data(labelObject).enter().append('div').attr('class', function (d) {
                        return 'legend-holder legend_holder_div_' + randomSubstring + '_' + d;
                }).style('display', 'inline-block').style('padding', '2px').style('opacity', '1').style('cursor', 'pointer').on("click", function () {
                        var current_div_class = $(this).attr("class");
                        var rectClass = "rect_" + current_div_class.split(" ")[1].split("legend_holder_div_")[1];

                        /*--  Get  current div opacity  --*/
                        var current_opacity = $(this).css("opacity");

                        newOpacity = current_opacity == 1 ? 0.5 : 1;
                        $(this).css("opacity", newOpacity);
                        $("." + rectClass).css("opacity", newOpacity == 0.5 ? 0.2 : newOpacity);
                });

                /*--  append legend circles  --*/
                legendHolder.append('div').style('background-color', function (d, i) {
                        return colorScale(d);
                }).attr("class", "bar-legend-circles");

                /*--  append legend text  --*/
                legendHolder.append("p").text(function (d, i) {
                        return d;
                }).style('color', function (d, i) {
                        if (_this.legendColor) {
                                return colorScale(d);
                        } else {
                                return groupedColumnValues.legendColor;
                        }
                }).style('display', 'inline-block').style('margin-left', '5px');
                $('#legendContainer-' + randomSubstring).mThumbnailScroller({
                        axis: "x"
                });
        }

        /*----------------------------------------------------------------------------------*/
        /**
         * Function to handle show hide of header options
         */
        $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
                var id = $(this).attr("data-target");
                if ($(id).css("display") == "none") {
                        $(id).css("display", "inline-block");
                } else {
                        $(id).css("display", "none");
                }
        });

        /*----------------------------------------------------------------------------------*/
        /**
         * Function to handle show hide of header options
         */
        $("body").on("click", ".header_refresh_" + randomSubstring, function () {
                var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
                if ("#" + chartId == chart_container) {
                        $(chart_container).empty();
                        groupedColumChart(actualOptions);
                }
        });

        /*----------------------------------------------------------------------------------*/
        /**
         * Function to handle show hide of header options
         */
        $("body").on("click", ".header_table_" + randomSubstring, function () {
                var a = parseInt(h / 55);

                $(chart_container).empty();
                $(this).css("display", "none");
                $(".header_chart_" + randomSubstring).css("display", "inline-block");
                var tbl = "<div id ='groupedChart_table_" + randomSubstring + "'  class='grouped-chart-table' style='height:" + _this.height + "px' ><table id='groupedChart_table_1" + randomSubstring + "' class='table-striped'><thead><tr>";
                var keys = d3.keys(columnData[0]);
                $.each(keys, function (i, v) {
                        if (v == "x") {
                                tbl = tbl + "<th>" + "TYPE" + "</th>";
                        } else {
                                tbl = tbl + "<th>" + v.toUpperCase() + "</th>";
                        }
                });
                tbl = tbl + "</tr></thead><tbody>";
                $.each(columnData, function (index, value) {

                        tbl = tbl + "<tr>";
                        $.each(keys, function (i1, v1) {
                                if (typeof value[v1] == "string") {
                                        tbl = tbl + "<td>" + value[v1].toUpperCase() + "</td>";
                                } else {
                                        tbl = tbl + "<td>" + value[v1] + "</td>";
                                }
                        });

                        tbl = tbl + "</tr>";
                });
                tbl = tbl + "</tbody></table></div>";
                $(chart_container).append(tbl);
                $('#groupedChart_table_1' + randomSubstring).DataTable({
                        "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                                if (iDisplayIndex % 2 == 1) {

                                        /*--  even color  --*/
                                        $('td', nRow).css('background-color', '#32464F');
                                } else {
                                        $('td', nRow).css('background-color', '#283C45');
                                }
                        }
                });
                $("#groupedChart_table_" + randomSubstring).mCustomScrollbar({
                        axis: "y"
                });

                $("#groupedChart_table_" + randomSubstring + " tr:even").css("background-color", "#32464F");
                $("#groupedChart_table_" + randomSubstring + " tr:odd").css("background-color", "#283C45");
                $("#groupedChart_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

                var id1 = $("#groupedChart_table_" + randomSubstring).children('div').find('div').eq(0);
                var id2 = $("#groupedChart_table_" + randomSubstring).children('div').find('div').eq(1);
                var id3 = $("#groupedChart_table_" + randomSubstring).children('div').find('div').eq(2);
                var id1attr = id1.attr("id");
                var id2attr = id2.attr("id");
                var id3attr = id3.attr("id");

                $("#" + id1attr + " " + "label").css("color", "#666666");
                $("#" + id2attr + " " + "label").css("color", "#666666");
                $("#" + id3attr).css("color", "#666666");

                $(".dataTables_filter input").css({
                        "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
                        "background": "transparent",
                        "border-bottom": "1px solid #666666",
                        " border-radius": " 0",
                        "padding": " 5px 25px",
                        "color": "#ccc",
                        "height": " 30px",
                        "-webkit-box-shadow": " none",
                        "box-shadow": " none"
                });
                $(".dataTables_wrapper").css("background-color", "#374C59");
        });

        /*----------------------------------------------------------------------------------*/
        /**
         * Function to handle show hide of header options
         */
        $("body").on("click", ".header_chart_" + randomSubstring, function () {
                var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
                if ("#" + chartId == chart_container) {
                        $(this).css("display", "none");
                        $(".header_table_" + randomSubstring).css("display", "inline-block");
                        $(chart_container).empty();
                        new groupedColumChart(actualOptions);
                }
        });
        $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
                $("#modal_" + randomSubstring).modal('show');
                var options = jQuery.extend(true, {}, actualOptions);
                setTimeout(function () {
                        $("#modal_chart_container" + randomSubstring).css("width", "100%");
                        options.container = "#modal_chart_container" + randomSubstring;
                        options.headerOptionsExpand = false;
                        options.height = 450;
                        new groupedColumChart(options);
                }, 500);
        });
}
"use strict";

/*--------------------------Store time scale bubble chart Values-----------------------------*/
var timeScaleValues = {
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942", "#ffa618"],
    xAxisTextX: 8,
    xAxisTextY: 10,
    xAxisTextDX: ".71em",
    yAxisTextDY: "1.1em",
    yAxisTextdx: -20,
    bubbleDuration: 400
};
function timescalebubbleChart(timeLineOptions) {
    if (timeLineOptions.container) {
        $(timeLineOptions.container).empty();
    }
    /*--------------------------Initialize Values-----------------------------*/
    if (timeLineOptions) {
        this.container = timeLineOptions.container ? timeLineOptions.container : "body";
        this.data = timeLineOptions.data ? timeLineOptions.data : [];
        this.width = timeLineOptions.width ? timeLineOptions.width : 240;
        this.margin = timeLineOptions.margin ? {
            top: timeLineOptions.margin.top ? timeLineOptions.margin.top : 20,
            right: timeLineOptions.margin.right ? timeLineOptions.margin.right : 20,
            bottom: timeLineOptions.margin.bottom ? timeLineOptions.margin.bottom : 30,
            left: timeLineOptions.margin.left ? timeLineOptions.margin.left : 40
        } : { top: 20, right: 50, bottom: 50, left: 50 };

        this.height = timeLineOptions.height ? timeLineOptions.height : 600;
        this.xticks = timeLineOptions.xticks ? timeLineOptions.xticks : 10;
        this.yticks = timeLineOptions.yticks ? timeLineOptions.yticks : 10;
        this.xtext = timeLineOptions.xtext ? timeLineOptions.xtext : "";
        this.ytext = timeLineOptions.ytext ? timeLineOptions.ytext : "";
        this.headerOptions = timeLineOptions.headerOptions == false ? timeLineOptions.headerOptions : true;

        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.isheader = timeLineOptions.isheader == false ? timeLineOptions.isheader : true;

        timeLineOptions.show_YAxis = timeLineOptions.show_YAxis == false ? timeLineOptions.show_YAxis : true;
        timeLineOptions.show_XAxisPath = timeLineOptions.show_XAxisPath == false ? timeLineOptions.show_XAxisPath : true;
        timeLineOptions.show_XAxisTicks = timeLineOptions.show_XAxisTicks == false ? timeLineOptions.show_XAxisTicks : true;
    } else {
        return false;
    }
    var _this = this;
    var actualOptions = jQuery.extend(true, {}, timeLineOptions);
    var randomSubstring = this.randomIdString;
    var data = this.data;
    this.uri1 = timeLineOptions.uri1;
    this.uri2 = timeLineOptions.uri2;
    this.timeLineHeader = timeLineOptions.header ? timeLineOptions.header : "TIME LINE CHART";
    var h1 = this.height;
    var h = parseInt(h1) + 50;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';

    if (timeLineOptions.container != '#autodeskTimeline') {
        var chartContainerdiv = '<div class="chartContainer"  align="center" style="overflow:hidden;width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color: transparent; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.timeLineHeader + '</div><div id="timeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    } else {
        var chartContainerdiv = '<div class="chartContainer"  align="center" style="overflow:hidden;width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height: auto;max-height: ' + h + 'px;min-height: auto;margin: auto; background-color: transparent; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.timeLineHeader + '</div><div id="timeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    }

    /* var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.timeLineHeader + '</div><div id="timeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>' */
    $(this.container).html(chartContainerdiv);
    $(this.container).append(modal);
    var chart_container = "#timeLine_chart_div" + randomSubstring;

    this.width = timeLineOptions.width ? timeLineOptions.width : $(chart_container).width() - 50;
    var tool_tip = $('body').append('<div class="TimeScale_Bubble_Chart_tooltip1" style="z-index:2000;position: absolute; opacity: 1; pointer-events: none; visibility: hidden;display:none;background-color:#0cae96;padding: 10px;border-radius: 5px;border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    var current_uri1 = this.uri1;
    var current_uri2 = this.uri2;
    var timeline_header = this.timeLineHeader;
    var colorScale = d3.scaleOrdinal().range(timeScaleValues.colors);
    var containerid = this.container;
    if (!this.headerOptions) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none; min-width: 120px; margin-top: 2px; background: rgb(27, 39, 53) none repeat scroll 0% 0%; border: 1px solid rgb(51, 51, 51); border-radius: 4px;" id="opt_' + randomSubstring + '" class="collapse"><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span style="display: inline-block;float: left;text-align: center;width: 33.33%;" class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span style="display: none;float: left;text-align: center;width: 33.33%;" class="header_chart_' + randomSubstring + '" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);
    if (!this.isheader) {
        $(chart_container).siblings(".headerDiv").css("display", "none");
    }
    if (!this.headerOptions) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }
    var data = this.data,
        margin = this.margin,
        width = this.width - margin.left - margin.right,
        height = this.height - margin.top - margin.bottom;

    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    var maxSize = d3.max(data, function (d) {
        return d.size;
    });
    var svg = d3.select(chart_container).append("svg").attr('height', this.height).attr('width', this.width).attr('id', 'mainSvg-' + randomSubstring);
    /*define main group */
    var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr('id', 'mainGroup-' + randomSubstring);

    x.domain(d3.extent(data, function (d) {
        return new Date(d.date);
    }));
    var ydomain = d3.extent(data, function (d) {
        return d.size;
    });
    y.domain(ydomain).nice();
    /*    var ymin= y.invert(maxSize);
        y.domain(ymin,ydomain[1]) */
    plottimescaleBubbleChart(data);
    function plottimescaleBubbleChart(data) {

        /* Add the x Axis */
        var x_g = g.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x).ticks(_this.xticks)).attr("class", "axis");
        x_g.append("text").attr("transform", "translate(" + width / 2 + "," + 30 + ")").attr("x", timeScaleValues.xAxisTextX).attr("y", timeScaleValues.xAxisTextY).attr("dx", timeScaleValues.xAxisTextDX).style("text-anchor", "middle").style("fill", "#6c7e88").text(_this.xtext).style("font-size", "14px");

        x_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none").style("display", function () {
            return timeLineOptions.show_XAxisPath ? 'block' : 'none';
        });
        x_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none").style("display", function () {
            return timeLineOptions.show_XAxisTicks ? 'block' : 'none';
        });

        x_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");

        /* Add the y Axis */

        var y_g = g.append("g").style("display", function () {
            return timeLineOptions.show_YAxis ? 'block' : 'none';
        }).call(d3.axisLeft(y).ticks(_this.yticks)).attr("class", "axis").style("stroke", "#6c7e88");
        y_g.append("text").attr("transform", "rotate(-90)").attr("y", -margin.left).attr("dy", timeScaleValues.yAxisTextDY).attr("dx", timeScaleValues.yAxisTextdx).style("text-anchor", "end").style("fill", "#6c7e88").text(_this.ytext).style("font-size", "14px");
        y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
        y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
        y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");

        var circleColor = '#49D2D9';
        var circleOpacity = '0.4';
        if (timeLineOptions.container == '#autodeskTimeline') {
            var colorsArray = ['#5E4A91', '#5E883E', '#843F90', '#A69636', '#C03A77', '#4866AA', '#BF4541', '#64C068'];
            var colorScale = d3.scaleOrdinal().range(colorsArray);
        }

        g.selectAll("circle").data(data).enter().insert("circle").attr("fill", function (d) {
            if (timeLineOptions.container == '#autodeskTimeline') {
                circleOpacity = '0.6';
                return colorScale(d.entityName);
            } else {
                return circleColor;
            }
        }).style("opacity", circleOpacity).style("pointer-events", "all").style("cursor", function (d) {
            if (timeLineOptions.container == '#autodeskTimeline') {
                return "pointer";
            }
        }).on('click', function (d) {
            if (timeLineOptions.container == '#autodeskTimeline') {
                window.pushFilters(d.entityName, false, 'attackType', 'notLocation', 'selectedAttackType', 'locationMultipleEnd');
                /* hide tool-tip */
                $(".TimeScale_Bubble_Chart_tooltip1").css("display", "none");
                return $(".TimeScale_Bubble_Chart_tooltip1").css("visibility", "hidden");
            }
        }).on("mouseover", function (d) {
            $(this).css("opacity", 1);

            var date = new Date(d.date);
            if (timeLineOptions.container == '#autodeskTimeline') {
                $(".TimeScale_Bubble_Chart_tooltip1").html('<span><span style="color:#000;"> DATE :</span> ' + d.formattedDate + '</span>' + '<span><span style="color:#000;"> CLASSIFICATION :</span> ' + d.entityName + '</span><span><span style="color:#000;"> NUMBER OF INCIDENTS :</span> ' + d.formattedCount + '</span>');
            } else {
                var valueStr = '';
                if (d.size != undefined) {
                    valueStr = '<br><span><span style="color:#000;">SIMILARITY PERCENT :</span> ' + d.size + '</span><br><span>NAME : ' + d.entityName + '</span>';
                }
                $(".TimeScale_Bubble_Chart_tooltip1").html('<span><span style="color:#000;"> DATE :</span> ' + date.toLocaleDateString() + '</span>' + valueStr);
            }

            $(".TimeScale_Bubble_Chart_tooltip1").css("display", "block");
            return $(".TimeScale_Bubble_Chart_tooltip1").css("visibility", "visible");
        }).on("mousemove", function () {
            var p = $(chart_container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".TimeScale_Bubble_Chart_tooltip1").width() + 50;
            var cursor = d3.event.x;
            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("TimeScale_Bubble_Chart_tooltip1");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".TimeScale_Bubble_Chart_tooltip1").css("left", d3.event.pageX - 15 - $(".TimeScale_Bubble_Chart_tooltip1").width() + "px");
            } else {
                var element = document.getElementsByClassName("TimeScale_Bubble_Chart_tooltip1");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".TimeScale_Bubble_Chart_tooltip1").css("left", d3.event.pageX + 10 + "px");
            }
            //   $(".TimeScale_Bubble_Chart_tooltip1").css("left",position.left + "px");
            return $(".TimeScale_Bubble_Chart_tooltip1").css("top", d3.event.pageY + "px");
        }).on("mouseout", function () {
            if (timeLineOptions.container == '#autodeskTimeline') {
                $(this).css("opacity", 0.6);
            } else {
                $(this).css("opacity", 0.4);
            }
            /* hide tool-tip */
            $(".TimeScale_Bubble_Chart_tooltip1").css("display", "none");
            return $(".TimeScale_Bubble_Chart_tooltip1").css("visibility", "hidden");
        }).attr("cx", function (d) {
            return x(new Date(d.date));
        }).attr("r", function (d) {
            if (timeLineOptions.container == '#autodeskTimeline') {
                var domainX = timeLineOptions['domain'] ? timeLineOptions['domain']['x'] : 10;
                var domainY = timeLineOptions['domain'] ? timeLineOptions['domain']['y'] : 5000;
                var sizeScale = d3.scaleLinear().domain([domainX, domainY]).range([5, 15]);
                return sizeScale(d.size);
            } else {
                return d.size;
            }
        }).attr("cy", 0).transition().duration(timeScaleValues.bubbleDuration).ease(d3.easeLinear).attr("cy", function (d) {
            return y(d.size);
        });
    }
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            timescaleBubble(actualOptions);
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        var a = parseInt(h / 55);

        $(chart_container).empty();

        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");

        var tbl = "<div id ='timescale_table_" + randomSubstring + "' style='overflow:hidden;background-color:#374C59;padding:5px;width:100%;height:" + _this.height + "px'><table id='timescale_table1_" + randomSubstring + "' class='table table-striped' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E;' ><thead><tr><th>Date</th><th>Value</th></tr></thead><tbody>";
        $.each(data, function (index, value) {
            tbl = tbl + "<tr><td>" + value.date + "</td><td>" + value.size + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $('#timescale_table1_' + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });

        $("#timescale_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#timescale_table_" + randomSubstring + " tr:even").css("background-color", "#32464F");
        $("#timescale_table_" + randomSubstring + " tr:odd").css("background-color", "#283C45");
        $("#timescale_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

        var id1 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        $(chart_container).css("overflow", "hidden");
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new timescalebubbleChart(actualOptions);
        }
    });

    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;
            options.headerOptions = false;
            options.height = 450;
            new timescalebubbleChart(options);
        }, 500);
    });
}
"use strict";

/*--------------------------Store time scale bubble2 chart Values-----------------------------*/
var timeScale2Values = {
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942", "#ffa618"],
    xAxisTextX: 8,
    xAxisTextY: 10,
    xAxisTextDX: ".71em",
    yAxisTextDY: "1.1em",
    yAxisTextdx: -20,
    bubbleDuration: 400
};
function timescalebubbleChart2(timeLineOptions) {
    if (timeLineOptions.container) {
        $(timeLineOptions.container).empty();
    }
    /*--------------------------Initialize Values-----------------------------*/
    if (timeLineOptions) {
        this.container = timeLineOptions.container ? timeLineOptions.container : "body";
        this.data = timeLineOptions.data ? timeLineOptions.data : [];

        this.margin = timeLineOptions.margin ? {
            top: timeLineOptions.margin.top ? timeLineOptions.margin.top : 20,
            right: timeLineOptions.margin.right ? timeLineOptions.margin.right : 20,
            bottom: timeLineOptions.margin.bottom ? timeLineOptions.margin.bottom : 30,
            left: timeLineOptions.margin.left ? timeLineOptions.margin.left : 40
        } : { top: 20, right: 50, bottom: 50, left: 50 };

        this.height = timeLineOptions.height ? timeLineOptions.height : 600;
        this.xticks = timeLineOptions.xticks ? timeLineOptions.xticks : 10;
        this.yticks = timeLineOptions.yticks ? timeLineOptions.yticks : 10;
        this.xtext = timeLineOptions.xtext ? timeLineOptions.xtext : "";
        this.ytext = timeLineOptions.ytext ? timeLineOptions.ytext : "";
        this.headerOptions = timeLineOptions.headerOptions == false ? timeLineOptions.headerOptions : true;

        this.randomIdString = Math.floor(Math.random() * 10000000000);
    } else {
        return false;
    }
    var _this = this;
    var actualOptions = jQuery.extend(true, {}, timeLineOptions);
    var randomSubstring = this.randomIdString;
    var data = this.data;
    this.uri1 = timeLineOptions.uri1;
    this.uri2 = timeLineOptions.uri2;
    this.timeLineHeader = timeLineOptions.header ? timeLineOptions.header : "TIME LINE CHART";
    var h1 = this.height;
    var h = parseInt(h1) + 50;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';

    var chartContainerdiv = '<div class="chartContainer"  align="center" style="overflow:hidden;width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color:transparent; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.timeLineHeader + '</div><div id="timeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';

    /*var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.timeLineHeader + '</div><div id="timeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>' */
    $(this.container).html(chartContainerdiv);
    $(this.container).append(modal);
    var chart_container = "#timeLine_chart_div" + randomSubstring;
    this.width = timeLineOptions.width ? timeLineOptions.width : $(chart_container).width() - 50;
    var tool_tip = $('body').append('<div class="TimeScale_Bubble_Chart_tooltip"><span style=" font-size: 12px; position: absolute;display:none;visibility:hidden; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    var current_uri1 = this.uri1;
    var current_uri2 = this.uri2;
    var timeline_header = this.timeLineHeader;
    var colorScale = d3.scaleOrdinal().range(timeScale2Values.colors);
    var containerid = this.container;
    if (!this.headerOptions) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none; min-width: 120px; margin-top: 2px; background: rgb(27, 39, 53) none repeat scroll 0% 0%; border: 1px solid rgb(51, 51, 51); border-radius: 4px;" id="opt_' + randomSubstring + '" class="collapse"><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span style="display: inline-block;float: left;text-align: center;width: 33.33%;" class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span style="display: none;float: left;text-align: center;width: 33.33%;" class="header_chart_' + randomSubstring + '" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);

    if (!this.headerOptions) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }
    var data = this.data,
        margin = this.margin,
        width = this.width - margin.left - margin.right,
        height = this.height - margin.top - margin.bottom;

    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    var maxSize = d3.max(data, function (d) {
        return d.size;
    });
    var svg = d3.select(chart_container).append("svg").attr('height', this.height).attr('width', this.width).attr('id', 'mainSvg-' + randomSubstring);
    /* define main group */
    var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr('id', 'mainGroup-' + randomSubstring);

    x.domain(d3.extent(data, function (d) {
        return new Date(d.date);
    }));
    var ydomain = d3.extent(data, function (d) {
        return d.rate;
    });
    y.domain(ydomain).nice();
    /*    var ymin= y.invert(maxSize);
       y.domain(ymin,ydomain[1]) */
    plottimescaleBubbleChart(data);
    function plottimescaleBubbleChart(data) {

        /* Add the x Axis */
        var x_g = g.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x).ticks(_this.xticks)).attr("class", "axis");
        x_g.append("text").attr("transform", "translate(" + width / 2 + "," + 30 + ")").attr("x", timeScale2Values.xAxisTextX).attr("y", timeScale2Values.xAxisTextY).attr("dx", timeScale2Values.xAxisTextDX).style("text-anchor", "middle").style("fill", "#6c7e88").text(_this.xtext).style("font-size", "14px");

        x_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
        x_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
        x_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");

        /* Add the y Axis */
        var y_g = g.append("g").call(d3.axisLeft(y).ticks(_this.yticks)).attr("class", "axis").style("stroke", "#6c7e88");
        y_g.append("text").attr("transform", "rotate(-90)").attr("y", -margin.left).attr("dy", timeScale2Values.yAxisTextDY).attr("dx", timeScale2Values.yAxisTextdx).style("text-anchor", "end").style("fill", "#6c7e88").text(_this.ytext).style("font-size", "14px");
        y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
        y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
        y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
        g.selectAll("circle").data(data).enter().insert("circle").attr("fill", "#49D2D9").style("opacity", "0.4").style("pointer-events", "all").on("mouseover", function (d) {
            $(this).css("opacity", 1);
            var valueStr = '';
            if (d.rate) {
                valueStr = '<br><span><span style="color:#000;">Similarity Percent: </span>' + d.rate + '</span>';
            }
            $(".TimeScale_Bubble_Chart_tooltip").html('<span><span style="color:#000;"> Date: </span>' + d.date + '</span>' + valueStr);
            $(".TimeScale_Bubble_Chart_tooltip").css("display", "block");
            return $(".TimeScale_Bubble_Chart_tooltip").css("visibility", "visible");
        }).on("mousemove", function () {

            var p = $(chart_container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".TimeScale_Bubble_Chart_tooltip").width() + 50;
            var cursor = d3.event.x;
            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("TimeScale_Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".TimeScale_Bubble_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".TimeScale_Bubble_Chart_tooltip").width() + "px");
            } else {
                var element = document.getElementsByClassName("TimeScale_Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".TimeScale_Bubble_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
            //   $(".TimeScale_Bubble_Chart_tooltip1").css("left",position.left + "px");
            return $(".TimeScale_Bubble_Chart_tooltip").css("top", d3.event.pageY + "px");
        }).on("mouseout", function () {
            $(this).css("opacity", 0.4);
            /* hide tool-tip */
            $(".TimeScale_Bubble_Chart_tooltip").css("display", "none");
            return $(".TimeScale_Bubble_Chart_tooltip").css("visibility", "hidden");
        }).attr("cx", function (d) {
            return x(new Date(d.date));
        }).attr("r", function (d) {
            return d.size;
        }).attr("cy", 0).transition().duration(timeScale2Values.bubbleDuration).ease(d3.easeLinear).attr("cy", function (d) {
            return y(d.rate);
        });
    }
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            new timescalebubbleChart2(actualOptions);
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        var a = parseInt(h / 55);

        $(chart_container).empty();

        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");

        var tbl = "<div id ='timescale_table_" + randomSubstring + "' style='overflow:hidden;background-color:#374C59;padding:5px;width:100%;height:" + _this.height + "px'><table id='timescale_table1_" + randomSubstring + "' class='table table-striped' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E;' ><thead><tr><th>Date</th><th>Value</th></tr></thead><tbody>";
        $.each(data, function (index, value) {
            tbl = tbl + "<tr><td>" + value.date + "</td><td>" + value.rate + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $('#timescale_table1_' + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });

        $("#timescale_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#timescale_table_" + randomSubstring + " tr:even").css("background-color", "#32464F");
        $("#timescale_table_" + randomSubstring + " tr:odd").css("background-color", "#283C45");
        $("#timescale_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

        var id1 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#timescale_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        $(chart_container).css("overflow", "hidden");
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new timescalebubbleChart2(actualOptions);
        }
    });

    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;
            options.headerOptions = false;
            options.height = 450;
            new timescalebubbleChart2(options);
        }, 500);
    });
}
"use strict";

/* Bubble chart constant values */
var BubbleConst = {
    bubbleHeight: 600,
    bubbleHeader: "BUBBLE CHART",
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942", "#ffa618"],
    dy: ".35em",
    radius: 30
};
function bubbleChart(bubbleOptions) {
    if (bubbleOptions.container) {
        $(bubbleOptions.container).empty();
    }
    //--------------------------Initialize Values-----------------------------
    if (bubbleOptions) {
        this.container = bubbleOptions.container ? bubbleOptions.container : "body";
        this.data = bubbleOptions.data ? bubbleOptions.data : [];
        this.height = bubbleOptions.height ? bubbleOptions.height : BubbleConst.bubbleHeight;
        this.uri = bubbleOptions.uri;
        this.bubbleHeader = bubbleOptions.header ? bubbleOptions.header : BubbleConst.bubbleHeader;

        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.isBackground = bubbleOptions.isBackground == false ? false : true;

        this.headerOptions = bubbleOptions.headerOptions == false ? bubbleOptions.headerOptions : true;
        this.isheader = bubbleOptions.isheader == false ? bubbleOptions.isheader : true;
    } else {

        return false;
    }
    var actualOptions = jQuery.extend(true, {}, bubbleOptions);

    var randomSubstring = this.randomIdString;
    var h = this.height + 50;

    var header = this.bubbleHeader;
    var containerid = this.container;
    var _this = this;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';
    //var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:'+h+'px;max-height: '+h+'px;min-height: '+h+'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'
    // var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-family: roboto-regular;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + this.bubbleHeader + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'

    if (!bubbleOptions.isBackground) {
        var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" > <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    } else {
        var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    }
    $(containerid).html(chartContainerdiv);
    $(containerid).append(modal);
    var chart_container = "#bubble_chart_div" + randomSubstring;
    this.width = bubbleOptions.width ? bubbleOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }

    this.diameter = this.height > this.width ? this.width - 50 : this.height - 50;
    if (!this.headerOptions) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }

    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) {

        var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
        $(chart_container).siblings(".headerDiv").append(header_options);
    }
    if (!this.headerOptions) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }
    if (!this.isheader) {
        $(chart_container).siblings(".headerDiv").css("display", "none");
    }
    root = this.data;

    //  $(".graphBox").mCustomScrollbar({
    //     axis: "y",
    //    //theme: "3d"
    // });
    var data = this.data;
    var curretn_uri = this.Uri;
    var bubble_header = this.bubbleHeader;
    var tool_tip = $('body').append('<div class="Bubble_Chart_tooltip" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(BubbleConst.colors);
    var width = this.width,
        height = this.height,
        diameter = this.diameter,
        x = d3.scaleLinear().range([0, diameter]),
        y = d3.scaleLinear().range([0, diameter]),
        node,
        root;
    var pack = d3.pack().size([diameter, diameter]);

    var vis = d3.select(chart_container).append("svg:svg")
    //            .style({ "-webkit-touch-callout": "none","-webkit-user-select": "none",  "-khtml-user-select": "none","-moz-user-select": "none", "-ms-user-select": "none", "user-select": "none"})
    .attr("width", width).attr("height", height).append("svg:g").attr("transform", "translate(" + (width - diameter) / 2 + "," + (height - diameter) / 2 + ")").call(d3.zoom().scaleExtent([0.5, 40]).translateExtent([[-100, -100], [width + 90, height + 100]]).on("zoom", redraw)).append("g");

    plotBubbleChart(data);

    //Redraw for zoom
    function redraw() {
        vis.attr("transform", d3.event.transform);
    }
    function plotBubbleChart(data) {

        node = root = d3.hierarchy(data).sum(function (d) {
            return d.size;
        }).sort(function (a, b) {
            return b.value - a.value;
        });

        var nodes = pack(root).descendants();

        var g = vis.selectAll("circle").data(nodes).enter().append("svg:circle")
        //                .call(d3.zoom().on("zoom", function () {
        //                	g.attr("transform", d3.event.transform)
        //		        }))
        .attr("class", function (d) {
            return d.children ? "parent" : "child";
        }).attr("fill", function (d) {
            if (d.parent) {
                return colorScale(d.parent.data.name);
            } else {
                return "transparent";
            }
        }).style("fill-opacity", function (d) {
            if (!d.children) {
                return 0.4;
            }
        }).style("fill", function (d) {
            if (d.children) {
                return "transparent";
            }
        }).attr("opacity", function (d) {
            if (d.parent && !d.children) {
                return 0.5;
            } else {
                return 1;
            }
        }).style("stroke", function (d) {

            if (d.children && d.parent) {
                return colorScale(d.data.name);
            } else if (d.parent && !d.children) {
                return colorScale(d.parent.data.name);
            }
        }).style("stroke-width", function (d) {
            if (d.parent && !d.children) {
                return 5;
            } else {
                return 7;
            }
        }).attr("cx", function (d) {
            return d.x;
        }).attr("cy", function (d) {
            return d.y;
        }).attr("r", function (d) {
            return d.r;
        }).on("click", function (d) {

            return zoom(node == d ? root : d);
        }).on("mouseover", function (d) {
            $(this).css("opacity", 1);
            var valueStr = '';
            if (d.data.size) {
                valueStr = ': <span>' + d.data.size + '</span>';
            }
            if (d.parent) {
                $(".Bubble_Chart_tooltip").html('<span>' + d.data.name + '</span> ' + valueStr);
            } else {
                $(".Bubble_Chart_tooltip").css("visibility", "hidden");
                return $(".Bubble_Chart_tooltip").css("display", "none");
            }
            $(".Bubble_Chart_tooltip").css("visibility", "visible");
            return $(".Bubble_Chart_tooltip").css("display", "block");
        }).on("mousemove", function () {
            var p = $(chart_container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".Bubble_Chart_tooltip").width() + 50;
            var cursor = d3.event.x;
            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Bubble_Chart_tooltip").width() + "px");
            } else {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY + "px");

            //   $(".Bubble_Chart_tooltip").css("top", (d3.event.pageY - 10) + "px")
            //return  $(".Bubble_Chart_tooltip").css("left", (d3.event.pageX + 10) + "px");
        }).on("mouseout", function () {
            $(this).css("opacity", 0.4);
            //hide tool-tip
            $(".Bubble_Chart_tooltip").css("visibility", "hidden");
            return $(".Bubble_Chart_tooltip").css("display", "none");
        });

        vis.selectAll("text").data(nodes).enter().append("svg:text").attr("class", function (d) {
            return d.children ? "parent" : "child";
        }).style("pointer-events", "none").style("font-size", "11px").attr("x", function (d) {
            return d.x;
        }).attr("y", function (d) {
            return d.y;
        }).attr("dy", BubbleConst.dy).attr("text-anchor", "middle").style("opacity", function (d) {
            return d.r > BubbleConst.radius ? 1 : 0;
        }).text(function (d) {
            if (!d.children) return d.data.name;
        }).style("fill", function (d) {
            if (d.parent && !d.children) {
                return colorScale(d.parent.data.name);
            }
            //                    return d.children? "red":"white";
        });

        vis.on("click", function () {
            zoom(root);
        });
        function zoom(d, i) {
            var k = diameter / d.r / 2;
            x.domain([d.x - d.r, d.x + d.r]);
            y.domain([d.y - d.r, d.y + d.r]);

            var t = vis.transition().duration(d3.event.altKey ? 7500 : 750);

            t.selectAll("circle").attr("cx", function (d) {
                return x(d.x);
            }).attr("cy", function (d) {
                return y(d.y);
            }).attr("r", function (d) {
                return k * d.r;
            });

            t.selectAll("text").attr("x", function (d) {
                return x(d.x);
            }).attr("y", function (d) {
                return y(d.y);
            }).style("opacity", function (d) {
                return k * d.r > BubbleConst.radius ? 1 : 0;
            });

            node = d;
            d3.event.stopPropagation();
        }
    }
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {

        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();

            chartBubble(actualOptions);
        }
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */

    $("body").on("click", ".header_table_" + randomSubstring, function () {
        //   var h = $(chartContainerdiv).height()

        $(chart_container).empty();
        //        $(chart_container).css("overflow","auto");
        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");
        // var newdata=data.nodes;

        var tbl = "<div id ='bubbleChart_table_" + randomSubstring + "'  style='padding:5px;background-color: #425661;overflow:overflow:hidden;height:" + _this.height + "px'><table id ='bubbleChart_table1_" + randomSubstring + "' class='table table-striped ' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E; ' ><thead><tr><th>NAME</th><th>VALUE</th><th>GROUP</th></tr></thead><tbody>";

        $.each(data.children, function (i, v) {
            $.each(v.children, function (index, value) {
                tbl = tbl + "<tr><td>" + value.name.toUpperCase() + "</td><td>" + value.size + "</td><td>" + v.name + "</td></tr>";
            });
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $("#bubbleChart_table1_" + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    //even color
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });
        $("#bubbleChart_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#bubbleChart_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");
        var id1 = $("#bubbleChart_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#bubbleChart_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#bubbleChart_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });

    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        $(chart_container).css("overflow", "hidden");
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new bubbleChart(actualOptions);
        }
    });

    //------------------------------------------------------------------------------------------------

    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        //       $("#modal_"+randomSubstring).modal("show");
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;
            options.headerOptions = false;
            options.height = 450;
            new bubbleChart(options);
        }, 500);

        //"modal_chart_container"+randomSubstring
    });
}
'use strict';

/* Pie chart constant values */
var PieChartConst = {
    dy: ".35em",
    colors: ['#1F77B4', '#FF7F0E', "#E61874", "#1DBF6A", "#9467bd", "#d62728", "#b65663"]
};
var PietooltipdivDiscover = d3.select("body").append("div").attr("class", "toolTip_piehorizontal").style("text-transform", "uppercase").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("border-radius", "10px").style("font-size", "10px").style("display", "none");

function pieChart(pieOptions) {
    if (pieOptions.container) {
        $(pieOptions.container).empty();
    }
    /*--------------------------Initialize Values-----------------------------*/
    if (pieOptions) {
        this.container = pieOptions.container ? pieOptions.container : "body";

        this.readFromFile = pieOptions.readFromFile !== undefined ? pieOptions.readFromFile : false;
        this.dataFileLocation = pieOptions.readFromFile !== undefined || pieOptions.readFromFile ? pieOptions.dataFileLocation : undefined;
        this.data = pieOptions.data ? pieOptions.data : [];

        this.radius = pieOptions.radius ? {
            innerRadius: pieOptions.radius.innerRadius ? pieOptions.radius.innerRadius : 0,
            outerRadius: pieOptions.radius.outerRadius ? pieOptions.radius.outerRadius : 100
        } : { innerRadius: 0, outerRadius: 100 };
        this.height = pieOptions.height ? pieOptions.height : 600;

        this.pieChartHeader = pieOptions.header ? pieOptions.header : "DONUT CHART";
        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.maxLlegendHeight = pieOptions.maxLlegendHeight ? pieOptions.maxLlegendHeight : false;
        this.showtext = pieOptions.showtext == false ? false : true;
        this.txt = pieOptions.txt ? pieOptions.txt : false;
    } else {
        return false;
    }
    var actualOptions = jQuery.extend(true, {}, pieOptions);
    var containerid = this.container;
    var randomSubstring = this.randomIdString;
    /* var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-family: roboto-regular;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + pieOptions.header + '</div><div id="pie_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>' */
    var chartContainerdiv = '<div id="pie_chart_div' + randomSubstring + '" class="" style="width: 100%;"></div>';
    $(this.container).html(chartContainerdiv);
    var chart_container = "#pie_chart_div" + randomSubstring;
    var _this = this;
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);
    var data = this.data;

    var todayDate = new Date();
    todayDate = todayDate.getDate() + '/' + (todayDate.getMonth() + 1) + '/' + todayDate.getFullYear();

    /* APPEND legend header */
    $(chart_container).append("<div id='streamContainer-" + randomSubstring + "' style ='float:left;width:50%'></div>");
    $(chart_container).append("<div class='pielegendContainer' style ='text-align: left;float:right;width:50%' id='legendContainer-" + randomSubstring + "'><h4 class='text-grey'>CASE STATUSES AS ON TODAY (" + todayDate + ")</h4></div>");

    var colorScale = d3.scaleOrdinal(PieChartConst.colors);
    this.width = pieOptions.width ? pieOptions.width : $(chart_container).width() - 10;
    var width = this.width - this.width / 2,
        height = this.height;
    if (height > width) {
        height = width;
    }
    /* define scales */
    var radius = Math.min(width, height) / 2;
    if (this.maxLlegendHeight) {
        $(chart_container).find('#legendContainer-' + randomSubstring).css({ "max-height": radius, "overflow-x": "hidden", "overflow-y": "auto" });
    }
    /* define main group */
    var arc = d3.arc().outerRadius(radius - 20).innerRadius(radius - radius / 2);

    var labelArc = d3.arc().outerRadius(radius - 40).innerRadius(radius - 40);

    var pie = d3.pie().sort(null).value(function (d) {
        return d.value;
    });
    var svg = d3.select('#streamContainer-' + randomSubstring).append("svg").attr('id', 'mainSvg-' + randomSubstring).attr("width", width).attr("height", height).append("g").attr("transform", "translate(" + width / 2 + "," + (height / 2 - 20) + ")");
    if (_this.txt) {
        svg.append("text").attr("y", 6).text(_this.txt).style('text-anchor', "middle").style("fill", "silver").style("stroke", "none");
    }
    var g = svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class", "arc");

    g.append("path").attr("d", arc).style("fill", function (d) {
        return colorScale(d.data.key);
    }).on("mouseover", function (d) {
        PietooltipdivDiscover.style("visibility", "visible");
        PietooltipdivDiscover.style("display", "inline-block");
        PietooltipdivDiscover.html(d.data.key + ":" + (d.actualValue ? d.actualValue : d.value));
    }).on("mousemove", function (d) {
        PietooltipdivDiscover.style("left", d3.event.pageX + 10 + "px");
        PietooltipdivDiscover.style("top", d3.event.pageY - 25 + "px");
    }).on("mouseout", function (d) {
        PietooltipdivDiscover.style("visibility", "hidden");
        PietooltipdivDiscover.style("display", "none");
    });

    g.append("text").attr("transform", function (d) {
        return "translate(" + arc.centroid(d) + ")";
    }).attr("dy", PieChartConst.dy).text(function (d) {
        if (_this.showtext) return d.data.value;
    }).style("font-size", function () {
        if (width < 300) {
            return "10px";
        }
    });
    var pieLegendArray = [];
    $.each(data, function (i, d) {
        pieLegendArray.push(d.key);
    });
    renderPieLegend(pieLegendArray);
    /**
     * Function to render Pie chart legends
     * @param {array} data
     *
     */
    function renderPieLegend(data) {
        $.each(data, function (i, d) {
            $("#legendContainer-" + randomSubstring).append('<div class="pieLegendDiv" style = "color: #60717C"," font-size: 10px" ><div class="bar_legend_circles" style="background-color:' + colorScale(d) + ';height: 10px;width: 10px;border-radius: 6px;display: inline-block;vertical-align: middle;"></div><span style="padding:0px !important;margin:0 2px;vertical-align: middle;">' + d + '</span></div>');
        });
    }
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            ChartPie(actualOptions);
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        var hi = $(chart_container).parent().height();
        var he = $(chartContainerdiv).height();
        var h = height - 100;
        $(chart_container).empty();
        $(this).css("display", "none");

        /*  var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-family: roboto-regular;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + pieOptions.header + '</div><div id="pie_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'
                 $(this.container).html(chartContainerdiv); */

        $(".header_chart_" + randomSubstring).css("display", "inline-block");
        var tbl = "<div id ='pieChart_table_" + randomSubstring + "' style='width:100%;padding:5px;font-size: 14px !important;background-color:#283C45'><table class='table-striped' class='table table-condensed' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E;height:" + h + "px;max-height: " + h + "px;min-height: " + h + "px'><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>";

        $.each(data, function (i, v) {
            tbl = tbl + ("<tr><td>" + v.key.toUpperCase() + "</td><td>" + v.value + "</td></tr>");
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $(".table-striped").DataTable({ "bLengthChange": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });

        $("#pieChart_table_" + randomSubstring + " tr:even").css("background-color", "#32464F");
        $("#pieChart_table_" + randomSubstring + " tr:odd").css("background-color", "#283C45");
        $("#pieChart_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

        var id1 = $("#pieChart_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#pieChart_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#pieChart_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            "border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new pieChart(actualOptions);
        }
    });
}
"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

!function (t, i) {
  "object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? i(exports) : "function" == typeof define && define.amd ? define(["exports"], i) : i(t.L = t.L || {});
}(undefined, function (t) {
  "use strict";
  function i(t) {
    var i, e, n, o;for (e = 1, n = arguments.length; e < n; e++) {
      o = arguments[e];for (i in o) {
        t[i] = o[i];
      }
    }return t;
  }function e(t, i) {
    var e = Array.prototype.slice;if (t.bind) return t.bind.apply(t, e.call(arguments, 1));var n = e.call(arguments, 2);return function () {
      return t.apply(i, n.length ? n.concat(e.call(arguments)) : arguments);
    };
  }function n(t) {
    return t._leaflet_id = t._leaflet_id || ++di, t._leaflet_id;
  }function o(t, i, e) {
    var n, o, s, r;return r = function r() {
      n = !1, o && (s.apply(e, o), o = !1);
    }, s = function s() {
      n ? o = arguments : (t.apply(e, arguments), setTimeout(r, i), n = !0);
    };
  }function s(t, i, e) {
    var n = i[1],
        o = i[0],
        s = n - o;return t === n && e ? t : ((t - o) % s + s) % s + o;
  }function r() {
    return !1;
  }function a(t, i) {
    var e = Math.pow(10, i || 5);return Math.round(t * e) / e;
  }function h(t) {
    return t.trim ? t.trim() : t.replace(/^\s+|\s+$/g, "");
  }function u(t) {
    return h(t).split(/\s+/);
  }function l(t, i) {
    t.hasOwnProperty("options") || (t.options = t.options ? _i(t.options) : {});for (var e in i) {
      t.options[e] = i[e];
    }return t.options;
  }function c(t, i, e) {
    var n = [];for (var o in t) {
      n.push(encodeURIComponent(e ? o.toUpperCase() : o) + "=" + encodeURIComponent(t[o]));
    }return (i && i.indexOf("?") !== -1 ? "&" : "?") + n.join("&");
  }function _(t, i) {
    return t.replace(pi, function (t, e) {
      var n = i[e];if (void 0 === n) throw new Error("No value provided for variable " + t);return "function" == typeof n && (n = n(i)), n;
    });
  }function d(t, i) {
    for (var e = 0; e < t.length; e++) {
      if (t[e] === i) return e;
    }return -1;
  }function p(t) {
    return window["webkit" + t] || window["moz" + t] || window["ms" + t];
  }function m(t) {
    var i = +new Date(),
        e = Math.max(0, 16 - (i - gi));return gi = i + e, window.setTimeout(t, e);
  }function f(t, i, n) {
    return n && vi === m ? void t.call(i) : vi.call(window, e(t, i));
  }function g(t) {
    t && yi.call(window, t);
  }function v() {}function y(t) {
    if (L && L.Mixin) {
      t = mi(t) ? t : [t];for (var i = 0; i < t.length; i++) {
        t[i] === L.Mixin.Events && console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.", new Error().stack);
      }
    }
  }function x(t, i, e) {
    this.x = e ? Math.round(t) : t, this.y = e ? Math.round(i) : i;
  }function w(t, i, e) {
    return t instanceof x ? t : mi(t) ? new x(t[0], t[1]) : void 0 === t || null === t ? t : "object" == (typeof t === "undefined" ? "undefined" : _typeof(t)) && "x" in t && "y" in t ? new x(t.x, t.y) : new x(t, i, e);
  }function P(t, i) {
    if (t) for (var e = i ? [t, i] : t, n = 0, o = e.length; n < o; n++) {
      this.extend(e[n]);
    }
  }function b(t, i) {
    return !t || t instanceof P ? t : new P(t, i);
  }function T(t, i) {
    if (t) for (var e = i ? [t, i] : t, n = 0, o = e.length; n < o; n++) {
      this.extend(e[n]);
    }
  }function z(t, i) {
    return t instanceof T ? t : new T(t, i);
  }function M(t, i, e) {
    if (isNaN(t) || isNaN(i)) throw new Error("Invalid LatLng object: (" + t + ", " + i + ")");this.lat = +t, this.lng = +i, void 0 !== e && (this.alt = +e);
  }function C(t, i, e) {
    return t instanceof M ? t : mi(t) && "object" != _typeof(t[0]) ? 3 === t.length ? new M(t[0], t[1], t[2]) : 2 === t.length ? new M(t[0], t[1]) : null : void 0 === t || null === t ? t : "object" == (typeof t === "undefined" ? "undefined" : _typeof(t)) && "lat" in t ? new M(t.lat, "lng" in t ? t.lng : t.lon, t.alt) : void 0 === i ? null : new M(t, i, e);
  }function Z(t, i, e, n) {
    return mi(t) ? (this._a = t[0], this._b = t[1], this._c = t[2], void (this._d = t[3])) : (this._a = t, this._b = i, this._c = e, void (this._d = n));
  }function E(t, i, e, n) {
    return new Z(t, i, e, n);
  }function S(t) {
    return document.createElementNS("http://www.w3.org/2000/svg", t);
  }function k(t, i) {
    var e,
        n,
        o,
        s,
        r,
        a,
        h = "";for (e = 0, o = t.length; e < o; e++) {
      for (r = t[e], n = 0, s = r.length; n < s; n++) {
        a = r[n], h += (n ? "L" : "M") + a.x + " " + a.y;
      }h += i ? re ? "z" : "x" : "";
    }return h || "M0 0";
  }function B(t) {
    return navigator.userAgent.toLowerCase().indexOf(t) >= 0;
  }function I(t, i, e, n) {
    return "touchstart" === i ? O(t, e, n) : "touchmove" === i ? W(t, e, n) : "touchend" === i && H(t, e, n), this;
  }function A(t, i, e) {
    var n = t["_leaflet_" + i + e];return "touchstart" === i ? t.removeEventListener(ue, n, !1) : "touchmove" === i ? t.removeEventListener(le, n, !1) : "touchend" === i && (t.removeEventListener(ce, n, !1), t.removeEventListener(_e, n, !1)), this;
  }function O(t, i, n) {
    var o = e(function (t) {
      if ("mouse" !== t.pointerType && t.pointerType !== t.MSPOINTER_TYPE_MOUSE && t.pointerType !== t.MSPOINTER_TYPE_MOUSE) {
        if (!(de.indexOf(t.target.tagName) < 0)) return;$(t);
      }j(t, i);
    });t["_leaflet_touchstart" + n] = o, t.addEventListener(ue, o, !1), me || (document.documentElement.addEventListener(ue, R, !0), document.documentElement.addEventListener(le, D, !0), document.documentElement.addEventListener(ce, N, !0), document.documentElement.addEventListener(_e, N, !0), me = !0);
  }function R(t) {
    pe[t.pointerId] = t, fe++;
  }function D(t) {
    pe[t.pointerId] && (pe[t.pointerId] = t);
  }function N(t) {
    delete pe[t.pointerId], fe--;
  }function j(t, i) {
    t.touches = [];for (var e in pe) {
      t.touches.push(pe[e]);
    }t.changedTouches = [t], i(t);
  }function W(t, i, e) {
    var n = function n(t) {
      (t.pointerType !== t.MSPOINTER_TYPE_MOUSE && "mouse" !== t.pointerType || 0 !== t.buttons) && j(t, i);
    };t["_leaflet_touchmove" + e] = n, t.addEventListener(le, n, !1);
  }function H(t, i, e) {
    var n = function n(t) {
      j(t, i);
    };t["_leaflet_touchend" + e] = n, t.addEventListener(ce, n, !1), t.addEventListener(_e, n, !1);
  }function F(t, i, e) {
    function n(t) {
      var i;if (te) {
        if (!Ai || "mouse" === t.pointerType) return;i = fe;
      } else i = t.touches.length;if (!(i > 1)) {
        var e = Date.now(),
            n = e - (s || e);r = t.touches ? t.touches[0] : t, a = n > 0 && n <= h, s = e;
      }
    }function o(t) {
      if (a && !r.cancelBubble) {
        if (te) {
          if (!Ai || "mouse" === t.pointerType) return;var e,
              n,
              o = {};for (n in r) {
            e = r[n], o[n] = e && e.bind ? e.bind(r) : e;
          }r = o;
        }r.type = "dblclick", i(r), s = null;
      }
    }var s,
        r,
        a = !1,
        h = 250;return t[ye + ge + e] = n, t[ye + ve + e] = o, t[ye + "dblclick" + e] = i, t.addEventListener(ge, n, !1), t.addEventListener(ve, o, !1), t.addEventListener("dblclick", i, !1), this;
  }function U(t, i) {
    var e = t[ye + ge + i],
        n = t[ye + ve + i],
        o = t[ye + "dblclick" + i];return t.removeEventListener(ge, e, !1), t.removeEventListener(ve, n, !1), Ai || t.removeEventListener("dblclick", o, !1), this;
  }function V(t, i, e, n) {
    if ("object" == (typeof i === "undefined" ? "undefined" : _typeof(i))) for (var o in i) {
      q(t, o, i[o], e);
    } else {
      i = u(i);for (var s = 0, r = i.length; s < r; s++) {
        q(t, i[s], e, n);
      }
    }return this;
  }function G(t, i, e, n) {
    if ("object" == (typeof i === "undefined" ? "undefined" : _typeof(i))) for (var o in i) {
      K(t, o, i[o], e);
    } else if (i) {
      i = u(i);for (var s = 0, r = i.length; s < r; s++) {
        K(t, i[s], e, n);
      }
    } else {
      for (var a in t[xe]) {
        K(t, a, t[xe][a]);
      }delete t[xe];
    }
  }function q(t, i, e, o) {
    var s = i + n(e) + (o ? "_" + n(o) : "");if (t[xe] && t[xe][s]) return this;var r = function r(i) {
      return e.call(o || t, i || window.event);
    },
        a = r;te && 0 === i.indexOf("touch") ? I(t, i, r, s) : !ie || "dblclick" !== i || !F || te && ji ? "addEventListener" in t ? "mousewheel" === i ? t.addEventListener("onwheel" in t ? "wheel" : "mousewheel", r, !1) : "mouseenter" === i || "mouseleave" === i ? (r = function r(i) {
      i = i || window.event, ot(t, i) && a(i);
    }, t.addEventListener("mouseenter" === i ? "mouseover" : "mouseout", r, !1)) : ("click" === i && Ri && (r = function r(t) {
      st(t, a);
    }), t.addEventListener(i, r, !1)) : "attachEvent" in t && t.attachEvent("on" + i, r) : F(t, r, s), t[xe] = t[xe] || {}, t[xe][s] = r;
  }function K(t, i, e, o) {
    var s = i + n(e) + (o ? "_" + n(o) : ""),
        r = t[xe] && t[xe][s];return r ? (te && 0 === i.indexOf("touch") ? A(t, i, s) : ie && "dblclick" === i && U ? U(t, s) : "removeEventListener" in t ? "mousewheel" === i ? t.removeEventListener("onwheel" in t ? "wheel" : "mousewheel", r, !1) : t.removeEventListener("mouseenter" === i ? "mouseover" : "mouseleave" === i ? "mouseout" : i, r, !1) : "detachEvent" in t && t.detachEvent("on" + i, r), void (t[xe][s] = null)) : this;
  }function Y(t) {
    return t.stopPropagation ? t.stopPropagation() : t.originalEvent ? t.originalEvent._stopped = !0 : t.cancelBubble = !0, nt(t), this;
  }function X(t) {
    return q(t, "mousewheel", Y);
  }function J(t) {
    return V(t, "mousedown touchstart dblclick", Y), q(t, "click", et), this;
  }function $(t) {
    return t.preventDefault ? t.preventDefault() : t.returnValue = !1, this;
  }function Q(t) {
    return $(t), Y(t), this;
  }function tt(t, i) {
    if (!i) return new x(t.clientX, t.clientY);var e = i.getBoundingClientRect();return new x(t.clientX - e.left - i.clientLeft, t.clientY - e.top - i.clientTop);
  }function it(t) {
    return Ai ? t.wheelDeltaY / 2 : t.deltaY && 0 === t.deltaMode ? -t.deltaY / we : t.deltaY && 1 === t.deltaMode ? 20 * -t.deltaY : t.deltaY && 2 === t.deltaMode ? 60 * -t.deltaY : t.deltaX || t.deltaZ ? 0 : t.wheelDelta ? (t.wheelDeltaY || t.wheelDelta) / 2 : t.detail && Math.abs(t.detail) < 32765 ? 20 * -t.detail : t.detail ? t.detail / -32765 * 60 : 0;
  }function et(t) {
    Le[t.type] = !0;
  }function nt(t) {
    var i = Le[t.type];return Le[t.type] = !1, i;
  }function ot(t, i) {
    var e = i.relatedTarget;if (!e) return !0;try {
      for (; e && e !== t;) {
        e = e.parentNode;
      }
    } catch (t) {
      return !1;
    }return e !== t;
  }function st(t, i) {
    var e = t.timeStamp || t.originalEvent && t.originalEvent.timeStamp,
        n = zi && e - zi;return n && n > 100 && n < 500 || t.target._simulatedClick && !t._simulated ? void Q(t) : (zi = e, void i(t));
  }function rt(t) {
    return "string" == typeof t ? document.getElementById(t) : t;
  }function at(t, i) {
    var e = t.style[i] || t.currentStyle && t.currentStyle[i];if ((!e || "auto" === e) && document.defaultView) {
      var n = document.defaultView.getComputedStyle(t, null);e = n ? n[i] : null;
    }return "auto" === e ? null : e;
  }function ht(t, i, e) {
    var n = document.createElement(t);return n.className = i || "", e && e.appendChild(n), n;
  }function ut(t) {
    var i = t.parentNode;i && i.removeChild(t);
  }function lt(t) {
    for (; t.firstChild;) {
      t.removeChild(t.firstChild);
    }
  }function ct(t) {
    var i = t.parentNode;i.lastChild !== t && i.appendChild(t);
  }function _t(t) {
    var i = t.parentNode;i.firstChild !== t && i.insertBefore(t, i.firstChild);
  }function dt(t, i) {
    if (void 0 !== t.classList) return t.classList.contains(i);var e = gt(t);return e.length > 0 && new RegExp("(^|\\s)" + i + "(\\s|$)").test(e);
  }function pt(t, i) {
    if (void 0 !== t.classList) for (var e = u(i), n = 0, o = e.length; n < o; n++) {
      t.classList.add(e[n]);
    } else if (!dt(t, i)) {
      var s = gt(t);ft(t, (s ? s + " " : "") + i);
    }
  }function mt(t, i) {
    void 0 !== t.classList ? t.classList.remove(i) : ft(t, h((" " + gt(t) + " ").replace(" " + i + " ", " ")));
  }function ft(t, i) {
    void 0 === t.className.baseVal ? t.className = i : t.className.baseVal = i;
  }function gt(t) {
    return void 0 === t.className.baseVal ? t.className : t.className.baseVal;
  }function vt(t, i) {
    "opacity" in t.style ? t.style.opacity = i : "filter" in t.style && yt(t, i);
  }function yt(t, i) {
    var e = !1,
        n = "DXImageTransform.Microsoft.Alpha";try {
      e = t.filters.item(n);
    } catch (t) {
      if (1 === i) return;
    }i = Math.round(100 * i), e ? (e.Enabled = 100 !== i, e.Opacity = i) : t.style.filter += " progid:" + n + "(opacity=" + i + ")";
  }function xt(t) {
    for (var i = document.documentElement.style, e = 0; e < t.length; e++) {
      if (t[e] in i) return t[e];
    }return !1;
  }function wt(t, i, e) {
    var n = i || new x(0, 0);t.style[be] = (Gi ? "translate(" + n.x + "px," + n.y + "px)" : "translate3d(" + n.x + "px," + n.y + "px,0)") + (e ? " scale(" + e + ")" : "");
  }function Lt(t, i) {
    t._leaflet_pos = i, Yi ? wt(t, i) : (t.style.left = i.x + "px", t.style.top = i.y + "px");
  }function Pt(t) {
    return t._leaflet_pos || new x(0, 0);
  }function bt() {
    V(window, "dragstart", $);
  }function Tt() {
    G(window, "dragstart", $);
  }function zt(t) {
    for (; t.tabIndex === -1;) {
      t = t.parentNode;
    }t.style && (Mt(), Ce = t, Ze = t.style.outline, t.style.outline = "none", V(window, "keydown", Mt));
  }function Mt() {
    Ce && (Ce.style.outline = Ze, Ce = void 0, Ze = void 0, G(window, "keydown", Mt));
  }function Ct(t, i) {
    return new ke(t, i);
  }function Zt(t, i) {
    if (!i || !t.length) return t.slice();var e = i * i;return t = It(t, e), t = kt(t, e);
  }function Et(t, i, e) {
    return Math.sqrt(Nt(t, i, e, !0));
  }function St(t, i, e) {
    return Nt(t, i, e);
  }function kt(t, i) {
    var e = t.length,
        n = (typeof Uint8Array === "undefined" ? "undefined" : _typeof(Uint8Array)) != void 0 + "" ? Uint8Array : Array,
        o = new n(e);o[0] = o[e - 1] = 1, Bt(t, o, i, 0, e - 1);var s,
        r = [];for (s = 0; s < e; s++) {
      o[s] && r.push(t[s]);
    }return r;
  }function Bt(t, i, e, n, o) {
    var s,
        r,
        a,
        h = 0;for (r = n + 1; r <= o - 1; r++) {
      a = Nt(t[r], t[n], t[o], !0), a > h && (s = r, h = a);
    }h > e && (i[s] = 1, Bt(t, i, e, n, s), Bt(t, i, e, s, o));
  }function It(t, i) {
    for (var e = [t[0]], n = 1, o = 0, s = t.length; n < s; n++) {
      Dt(t[n], t[o]) > i && (e.push(t[n]), o = n);
    }return o < s - 1 && e.push(t[s - 1]), e;
  }function At(t, i, e, n, o) {
    var s,
        r,
        a,
        h = n ? Fe : Rt(t, e),
        u = Rt(i, e);for (Fe = u;;) {
      if (!(h | u)) return [t, i];if (h & u) return !1;s = h || u, r = Ot(t, i, s, e, o), a = Rt(r, e), s === h ? (t = r, h = a) : (i = r, u = a);
    }
  }function Ot(t, i, e, n, o) {
    var s,
        r,
        a = i.x - t.x,
        h = i.y - t.y,
        u = n.min,
        l = n.max;return 8 & e ? (s = t.x + a * (l.y - t.y) / h, r = l.y) : 4 & e ? (s = t.x + a * (u.y - t.y) / h, r = u.y) : 2 & e ? (s = l.x, r = t.y + h * (l.x - t.x) / a) : 1 & e && (s = u.x, r = t.y + h * (u.x - t.x) / a), new x(s, r, o);
  }function Rt(t, i) {
    var e = 0;return t.x < i.min.x ? e |= 1 : t.x > i.max.x && (e |= 2), t.y < i.min.y ? e |= 4 : t.y > i.max.y && (e |= 8), e;
  }function Dt(t, i) {
    var e = i.x - t.x,
        n = i.y - t.y;return e * e + n * n;
  }function Nt(t, i, e, n) {
    var o,
        s = i.x,
        r = i.y,
        a = e.x - s,
        h = e.y - r,
        u = a * a + h * h;return u > 0 && (o = ((t.x - s) * a + (t.y - r) * h) / u, o > 1 ? (s = e.x, r = e.y) : o > 0 && (s += a * o, r += h * o)), a = t.x - s, h = t.y - r, n ? a * a + h * h : new x(s, r);
  }function jt(t) {
    return !mi(t[0]) || "object" != _typeof(t[0][0]) && "undefined" != typeof t[0][0];
  }function Wt(t, i, e) {
    var n,
        o,
        s,
        r,
        a,
        h,
        u,
        l,
        c,
        _ = [1, 4, 2, 8];for (o = 0, u = t.length; o < u; o++) {
      t[o]._code = Rt(t[o], i);
    }for (r = 0; r < 4; r++) {
      for (l = _[r], n = [], o = 0, u = t.length, s = u - 1; o < u; s = o++) {
        a = t[o], h = t[s], a._code & l ? h._code & l || (c = Ot(h, a, l, i, e), c._code = Rt(c, i), n.push(c)) : (h._code & l && (c = Ot(h, a, l, i, e), c._code = Rt(c, i), n.push(c)), n.push(a));
      }t = n;
    }return t;
  }function Ht(t) {
    return new cn(t);
  }function Ft(t, i) {
    return new pn(t, i);
  }function Ut(t, i) {
    return new fn(t, i);
  }function Vt(t, i, e) {
    return new gn(t, i, e);
  }function Gt(t, i) {
    return new vn(t, i);
  }function qt(t, i) {
    return new yn(t, i);
  }function Kt(t, i) {
    var e,
        n,
        o,
        s,
        r = "Feature" === t.type ? t.geometry : t,
        a = r ? r.coordinates : null,
        h = [],
        u = i && i.pointToLayer,
        l = i && i.coordsToLatLng || Yt;if (!a && !r) return null;switch (r.type) {case "Point":
        return e = l(a), u ? u(t, e) : new pn(e);case "MultiPoint":
        for (o = 0, s = a.length; o < s; o++) {
          e = l(a[o]), h.push(u ? u(t, e) : new pn(e));
        }return new un(h);case "LineString":case "MultiLineString":
        return n = Xt(a, "LineString" === r.type ? 0 : 1, l), new vn(n, i);case "Polygon":case "MultiPolygon":
        return n = Xt(a, "Polygon" === r.type ? 1 : 2, l), new yn(n, i);case "GeometryCollection":
        for (o = 0, s = r.geometries.length; o < s; o++) {
          var c = Kt({ geometry: r.geometries[o], type: "Feature", properties: t.properties }, i);c && h.push(c);
        }return new un(h);default:
        throw new Error("Invalid GeoJSON object.");}
  }function Yt(t) {
    return new M(t[1], t[0], t[2]);
  }function Xt(t, i, e) {
    for (var n, o = [], s = 0, r = t.length; s < r; s++) {
      n = i ? Xt(t[s], i - 1, e) : (e || Yt)(t[s]), o.push(n);
    }return o;
  }function Jt(t, i) {
    return i = "number" == typeof i ? i : 6, void 0 !== t.alt ? [a(t.lng, i), a(t.lat, i), a(t.alt, i)] : [a(t.lng, i), a(t.lat, i)];
  }function $t(t, i, e, n) {
    for (var o = [], s = 0, r = t.length; s < r; s++) {
      o.push(i ? $t(t[s], i - 1, e, n) : Jt(t[s], n));
    }return !i && e && o.push(o[0]), o;
  }function Qt(t, e) {
    return t.feature ? i({}, t.feature, { geometry: e }) : ti(e);
  }function ti(t) {
    return "Feature" === t.type || "FeatureCollection" === t.type ? t : { type: "Feature", properties: {}, geometry: t };
  }function ii(t, i) {
    return new xn(t, i);
  }function ei(t, i, e) {
    return new Tn(t, i, e);
  }function ni(t) {
    return new Sn(t);
  }function oi(t) {
    return new kn(t);
  }function si(t, i) {
    return new Bn(t, i);
  }function ri(t, i) {
    return new In(t, i);
  }function ai(t) {
    return se ? new On(t) : null;
  }function hi(t) {
    return re || ae ? new jn(t) : null;
  }function ui(t, i) {
    return new Wn(t, i);
  }function li() {
    return window.L = Yn, this;
  }var ci = "1.1.0+HEAD.a3a7e04",
      _i = Object.create || function () {
    function t() {}return function (i) {
      return t.prototype = i, new t();
    };
  }(),
      di = 0,
      pi = /\{ *([\w_\-]+) *\}/g,
      mi = Array.isArray || function (t) {
    return "[object Array]" === Object.prototype.toString.call(t);
  },
      fi = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",
      gi = 0,
      vi = window.requestAnimationFrame || p("RequestAnimationFrame") || m,
      yi = window.cancelAnimationFrame || p("CancelAnimationFrame") || p("CancelRequestAnimationFrame") || function (t) {
    window.clearTimeout(t);
  },
      xi = (Object.freeze || Object)({ extend: i, create: _i, bind: e, lastId: di, stamp: n, throttle: o, wrapNum: s, falseFn: r, formatNum: a, trim: h, splitWords: u, setOptions: l, getParamString: c, template: _, isArray: mi, indexOf: d, emptyImageUrl: fi, requestFn: vi, cancelFn: yi, requestAnimFrame: f, cancelAnimFrame: g });v.extend = function (t) {
    var e = function e() {
      this.initialize && this.initialize.apply(this, arguments), this.callInitHooks();
    },
        n = e.__super__ = this.prototype,
        o = _i(n);o.constructor = e, e.prototype = o;for (var s in this) {
      this.hasOwnProperty(s) && "prototype" !== s && "__super__" !== s && (e[s] = this[s]);
    }return t.statics && (i(e, t.statics), delete t.statics), t.includes && (y(t.includes), i.apply(null, [o].concat(t.includes)), delete t.includes), o.options && (t.options = i(_i(o.options), t.options)), i(o, t), o._initHooks = [], o.callInitHooks = function () {
      if (!this._initHooksCalled) {
        n.callInitHooks && n.callInitHooks.call(this), this._initHooksCalled = !0;for (var t = 0, i = o._initHooks.length; t < i; t++) {
          o._initHooks[t].call(this);
        }
      }
    }, e;
  }, v.include = function (t) {
    return i(this.prototype, t), this;
  }, v.mergeOptions = function (t) {
    return i(this.prototype.options, t), this;
  }, v.addInitHook = function (t) {
    var i = Array.prototype.slice.call(arguments, 1),
        e = "function" == typeof t ? t : function () {
      this[t].apply(this, i);
    };return this.prototype._initHooks = this.prototype._initHooks || [], this.prototype._initHooks.push(e), this;
  };var wi = { on: function on(t, i, e) {
      if ("object" == (typeof t === "undefined" ? "undefined" : _typeof(t))) for (var n in t) {
        this._on(n, t[n], i);
      } else {
        t = u(t);for (var o = 0, s = t.length; o < s; o++) {
          this._on(t[o], i, e);
        }
      }return this;
    }, off: function off(t, i, e) {
      if (t) {
        if ("object" == (typeof t === "undefined" ? "undefined" : _typeof(t))) for (var n in t) {
          this._off(n, t[n], i);
        } else {
          t = u(t);for (var o = 0, s = t.length; o < s; o++) {
            this._off(t[o], i, e);
          }
        }
      } else delete this._events;return this;
    }, _on: function _on(t, i, e) {
      this._events = this._events || {};var n = this._events[t];n || (n = [], this._events[t] = n), e === this && (e = void 0);for (var o = { fn: i, ctx: e }, s = n, r = 0, a = s.length; r < a; r++) {
        if (s[r].fn === i && s[r].ctx === e) return;
      }s.push(o);
    }, _off: function _off(t, i, e) {
      var n, o, s;if (this._events && (n = this._events[t])) {
        if (!i) {
          for (o = 0, s = n.length; o < s; o++) {
            n[o].fn = r;
          }return void delete this._events[t];
        }if (e === this && (e = void 0), n) for (o = 0, s = n.length; o < s; o++) {
          var a = n[o];if (a.ctx === e && a.fn === i) return a.fn = r, this._firingCount && (this._events[t] = n = n.slice()), void n.splice(o, 1);
        }
      }
    }, fire: function fire(t, e, n) {
      if (!this.listens(t, n)) return this;var o = i({}, e, { type: t, target: this });if (this._events) {
        var s = this._events[t];if (s) {
          this._firingCount = this._firingCount + 1 || 1;for (var r = 0, a = s.length; r < a; r++) {
            var h = s[r];h.fn.call(h.ctx || this, o);
          }this._firingCount--;
        }
      }return n && this._propagateEvent(o), this;
    }, listens: function listens(t, i) {
      var e = this._events && this._events[t];if (e && e.length) return !0;if (i) for (var n in this._eventParents) {
        if (this._eventParents[n].listens(t, i)) return !0;
      }return !1;
    }, once: function once(t, i, n) {
      if ("object" == (typeof t === "undefined" ? "undefined" : _typeof(t))) {
        for (var o in t) {
          this.once(o, t[o], i);
        }return this;
      }var s = e(function () {
        this.off(t, i, n).off(t, s, n);
      }, this);return this.on(t, i, n).on(t, s, n);
    }, addEventParent: function addEventParent(t) {
      return this._eventParents = this._eventParents || {}, this._eventParents[n(t)] = t, this;
    }, removeEventParent: function removeEventParent(t) {
      return this._eventParents && delete this._eventParents[n(t)], this;
    }, _propagateEvent: function _propagateEvent(t) {
      for (var e in this._eventParents) {
        this._eventParents[e].fire(t.type, i({ layer: t.target }, t), !0);
      }
    } };wi.addEventListener = wi.on, wi.removeEventListener = wi.clearAllEventListeners = wi.off, wi.addOneTimeEventListener = wi.once, wi.fireEvent = wi.fire, wi.hasEventListeners = wi.listens;var Li = v.extend(wi);x.prototype = { clone: function clone() {
      return new x(this.x, this.y);
    }, add: function add(t) {
      return this.clone()._add(w(t));
    }, _add: function _add(t) {
      return this.x += t.x, this.y += t.y, this;
    }, subtract: function subtract(t) {
      return this.clone()._subtract(w(t));
    }, _subtract: function _subtract(t) {
      return this.x -= t.x, this.y -= t.y, this;
    }, divideBy: function divideBy(t) {
      return this.clone()._divideBy(t);
    }, _divideBy: function _divideBy(t) {
      return this.x /= t, this.y /= t, this;
    }, multiplyBy: function multiplyBy(t) {
      return this.clone()._multiplyBy(t);
    }, _multiplyBy: function _multiplyBy(t) {
      return this.x *= t, this.y *= t, this;
    }, scaleBy: function scaleBy(t) {
      return new x(this.x * t.x, this.y * t.y);
    }, unscaleBy: function unscaleBy(t) {
      return new x(this.x / t.x, this.y / t.y);
    }, round: function round() {
      return this.clone()._round();
    }, _round: function _round() {
      return this.x = Math.round(this.x), this.y = Math.round(this.y), this;
    }, floor: function floor() {
      return this.clone()._floor();
    }, _floor: function _floor() {
      return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this;
    }, ceil: function ceil() {
      return this.clone()._ceil();
    }, _ceil: function _ceil() {
      return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this;
    }, distanceTo: function distanceTo(t) {
      t = w(t);var i = t.x - this.x,
          e = t.y - this.y;return Math.sqrt(i * i + e * e);
    }, equals: function equals(t) {
      return t = w(t), t.x === this.x && t.y === this.y;
    }, contains: function contains(t) {
      return t = w(t), Math.abs(t.x) <= Math.abs(this.x) && Math.abs(t.y) <= Math.abs(this.y);
    }, toString: function toString() {
      return "Point(" + a(this.x) + ", " + a(this.y) + ")";
    } }, P.prototype = { extend: function extend(t) {
      return t = w(t), this.min || this.max ? (this.min.x = Math.min(t.x, this.min.x), this.max.x = Math.max(t.x, this.max.x), this.min.y = Math.min(t.y, this.min.y), this.max.y = Math.max(t.y, this.max.y)) : (this.min = t.clone(), this.max = t.clone()), this;
    }, getCenter: function getCenter(t) {
      return new x((this.min.x + this.max.x) / 2, (this.min.y + this.max.y) / 2, t);
    }, getBottomLeft: function getBottomLeft() {
      return new x(this.min.x, this.max.y);
    }, getTopRight: function getTopRight() {
      return new x(this.max.x, this.min.y);
    }, getTopLeft: function getTopLeft() {
      return this.min;
    }, getBottomRight: function getBottomRight() {
      return this.max;
    }, getSize: function getSize() {
      return this.max.subtract(this.min);
    }, contains: function contains(t) {
      var i, e;return t = "number" == typeof t[0] || t instanceof x ? w(t) : b(t), t instanceof P ? (i = t.min, e = t.max) : i = e = t, i.x >= this.min.x && e.x <= this.max.x && i.y >= this.min.y && e.y <= this.max.y;
    }, intersects: function intersects(t) {
      t = b(t);var i = this.min,
          e = this.max,
          n = t.min,
          o = t.max,
          s = o.x >= i.x && n.x <= e.x,
          r = o.y >= i.y && n.y <= e.y;return s && r;
    }, overlaps: function overlaps(t) {
      t = b(t);var i = this.min,
          e = this.max,
          n = t.min,
          o = t.max,
          s = o.x > i.x && n.x < e.x,
          r = o.y > i.y && n.y < e.y;return s && r;
    }, isValid: function isValid() {
      return !(!this.min || !this.max);
    } }, T.prototype = { extend: function extend(t) {
      var i,
          e,
          n = this._southWest,
          o = this._northEast;if (t instanceof M) i = t, e = t;else {
        if (!(t instanceof T)) return t ? this.extend(C(t) || z(t)) : this;if (i = t._southWest, e = t._northEast, !i || !e) return this;
      }return n || o ? (n.lat = Math.min(i.lat, n.lat), n.lng = Math.min(i.lng, n.lng), o.lat = Math.max(e.lat, o.lat), o.lng = Math.max(e.lng, o.lng)) : (this._southWest = new M(i.lat, i.lng), this._northEast = new M(e.lat, e.lng)), this;
    }, pad: function pad(t) {
      var i = this._southWest,
          e = this._northEast,
          n = Math.abs(i.lat - e.lat) * t,
          o = Math.abs(i.lng - e.lng) * t;return new T(new M(i.lat - n, i.lng - o), new M(e.lat + n, e.lng + o));
    }, getCenter: function getCenter() {
      return new M((this._southWest.lat + this._northEast.lat) / 2, (this._southWest.lng + this._northEast.lng) / 2);
    }, getSouthWest: function getSouthWest() {
      return this._southWest;
    }, getNorthEast: function getNorthEast() {
      return this._northEast;
    }, getNorthWest: function getNorthWest() {
      return new M(this.getNorth(), this.getWest());
    }, getSouthEast: function getSouthEast() {
      return new M(this.getSouth(), this.getEast());
    }, getWest: function getWest() {
      return this._southWest.lng;
    }, getSouth: function getSouth() {
      return this._southWest.lat;
    }, getEast: function getEast() {
      return this._northEast.lng;
    }, getNorth: function getNorth() {
      return this._northEast.lat;
    }, contains: function contains(t) {
      t = "number" == typeof t[0] || t instanceof M || "lat" in t ? C(t) : z(t);var i,
          e,
          n = this._southWest,
          o = this._northEast;return t instanceof T ? (i = t.getSouthWest(), e = t.getNorthEast()) : i = e = t, i.lat >= n.lat && e.lat <= o.lat && i.lng >= n.lng && e.lng <= o.lng;
    }, intersects: function intersects(t) {
      t = z(t);var i = this._southWest,
          e = this._northEast,
          n = t.getSouthWest(),
          o = t.getNorthEast(),
          s = o.lat >= i.lat && n.lat <= e.lat,
          r = o.lng >= i.lng && n.lng <= e.lng;return s && r;
    }, overlaps: function overlaps(t) {
      t = z(t);var i = this._southWest,
          e = this._northEast,
          n = t.getSouthWest(),
          o = t.getNorthEast(),
          s = o.lat > i.lat && n.lat < e.lat,
          r = o.lng > i.lng && n.lng < e.lng;return s && r;
    }, toBBoxString: function toBBoxString() {
      return [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(",");
    }, equals: function equals(t, i) {
      return !!t && (t = z(t), this._southWest.equals(t.getSouthWest(), i) && this._northEast.equals(t.getNorthEast(), i));
    }, isValid: function isValid() {
      return !(!this._southWest || !this._northEast);
    } }, M.prototype = { equals: function equals(t, i) {
      if (!t) return !1;t = C(t);var e = Math.max(Math.abs(this.lat - t.lat), Math.abs(this.lng - t.lng));return e <= (void 0 === i ? 1e-9 : i);
    }, toString: function toString(t) {
      return "LatLng(" + a(this.lat, t) + ", " + a(this.lng, t) + ")";
    }, distanceTo: function distanceTo(t) {
      return bi.distance(this, C(t));
    }, wrap: function wrap() {
      return bi.wrapLatLng(this);
    }, toBounds: function toBounds(t) {
      var i = 180 * t / 40075017,
          e = i / Math.cos(Math.PI / 180 * this.lat);return z([this.lat - i, this.lng - e], [this.lat + i, this.lng + e]);
    }, clone: function clone() {
      return new M(this.lat, this.lng, this.alt);
    } };var Pi = { latLngToPoint: function latLngToPoint(t, i) {
      var e = this.projection.project(t),
          n = this.scale(i);return this.transformation._transform(e, n);
    }, pointToLatLng: function pointToLatLng(t, i) {
      var e = this.scale(i),
          n = this.transformation.untransform(t, e);return this.projection.unproject(n);
    }, project: function project(t) {
      return this.projection.project(t);
    }, unproject: function unproject(t) {
      return this.projection.unproject(t);
    }, scale: function scale(t) {
      return 256 * Math.pow(2, t);
    }, zoom: function zoom(t) {
      return Math.log(t / 256) / Math.LN2;
    }, getProjectedBounds: function getProjectedBounds(t) {
      if (this.infinite) return null;var i = this.projection.bounds,
          e = this.scale(t),
          n = this.transformation.transform(i.min, e),
          o = this.transformation.transform(i.max, e);return new P(n, o);
    }, infinite: !1, wrapLatLng: function wrapLatLng(t) {
      var i = this.wrapLng ? s(t.lng, this.wrapLng, !0) : t.lng,
          e = this.wrapLat ? s(t.lat, this.wrapLat, !0) : t.lat,
          n = t.alt;return new M(e, i, n);
    }, wrapLatLngBounds: function wrapLatLngBounds(t) {
      var i = t.getCenter(),
          e = this.wrapLatLng(i),
          n = i.lat - e.lat,
          o = i.lng - e.lng;if (0 === n && 0 === o) return t;var s = t.getSouthWest(),
          r = t.getNorthEast(),
          a = new M(s.lat - n, s.lng - o),
          h = new M(r.lat - n, r.lng - o);return new T(a, h);
    } },
      bi = i({}, Pi, { wrapLng: [-180, 180], R: 6371e3, distance: function distance(t, i) {
      var e = Math.PI / 180,
          n = t.lat * e,
          o = i.lat * e,
          s = Math.sin(n) * Math.sin(o) + Math.cos(n) * Math.cos(o) * Math.cos((i.lng - t.lng) * e);return this.R * Math.acos(Math.min(s, 1));
    } }),
      Ti = { R: 6378137, MAX_LATITUDE: 85.0511287798, project: function project(t) {
      var i = Math.PI / 180,
          e = this.MAX_LATITUDE,
          n = Math.max(Math.min(e, t.lat), -e),
          o = Math.sin(n * i);return new x(this.R * t.lng * i, this.R * Math.log((1 + o) / (1 - o)) / 2);
    }, unproject: function unproject(t) {
      var i = 180 / Math.PI;return new M((2 * Math.atan(Math.exp(t.y / this.R)) - Math.PI / 2) * i, t.x * i / this.R);
    }, bounds: function () {
      var t = 6378137 * Math.PI;return new P([-t, -t], [t, t]);
    }() };Z.prototype = { transform: function transform(t, i) {
      return this._transform(t.clone(), i);
    }, _transform: function _transform(t, i) {
      return i = i || 1, t.x = i * (this._a * t.x + this._b), t.y = i * (this._c * t.y + this._d), t;
    }, untransform: function untransform(t, i) {
      return i = i || 1, new x((t.x / i - this._b) / this._a, (t.y / i - this._d) / this._c);
    } };var zi,
      Mi,
      Ci,
      Zi,
      Ei = i({}, bi, { code: "EPSG:3857", projection: Ti, transformation: function () {
      var t = .5 / (Math.PI * Ti.R);return E(t, .5, -t, .5);
    }() }),
      Si = i({}, Ei, { code: "EPSG:900913" }),
      ki = document.documentElement.style,
      Bi = "ActiveXObject" in window,
      Ii = Bi && !document.addEventListener,
      Ai = "msLaunchUri" in navigator && !("documentMode" in document),
      Oi = B("webkit"),
      Ri = B("android"),
      Di = B("android 2") || B("android 3"),
      Ni = !!window.opera,
      ji = B("chrome"),
      Wi = B("gecko") && !Oi && !Ni && !Bi,
      Hi = !ji && B("safari"),
      Fi = B("phantom"),
      Ui = "OTransition" in ki,
      Vi = 0 === navigator.platform.indexOf("Win"),
      Gi = Bi && "transition" in ki,
      qi = "WebKitCSSMatrix" in window && "m11" in new window.WebKitCSSMatrix() && !Di,
      Ki = "MozPerspective" in ki,
      Yi = !window.L_DISABLE_3D && (Gi || qi || Ki) && !Ui && !Fi,
      Xi = "undefined" != typeof orientation || B("mobile"),
      Ji = Xi && Oi,
      $i = Xi && qi,
      Qi = !window.PointerEvent && window.MSPointerEvent,
      te = !(!window.PointerEvent && !Qi),
      ie = !window.L_NO_TOUCH && (te || "ontouchstart" in window || window.DocumentTouch && document instanceof window.DocumentTouch),
      ee = Xi && Ni,
      ne = Xi && Wi,
      oe = (window.devicePixelRatio || window.screen.deviceXDPI / window.screen.logicalXDPI) > 1,
      se = function () {
    return !!document.createElement("canvas").getContext;
  }(),
      re = !(!document.createElementNS || !S("svg").createSVGRect),
      ae = !re && function () {
    try {
      var t = document.createElement("div");t.innerHTML = '<v:shape adj="1"/>';var i = t.firstChild;return i.style.behavior = "url(#default#VML)", i && "object" == _typeof(i.adj);
    } catch (t) {
      return !1;
    }
  }(),
      he = (Object.freeze || Object)({ ie: Bi, ielt9: Ii, edge: Ai, webkit: Oi, android: Ri, android23: Di, opera: Ni, chrome: ji, gecko: Wi, safari: Hi, phantom: Fi, opera12: Ui, win: Vi, ie3d: Gi, webkit3d: qi, gecko3d: Ki, any3d: Yi, mobile: Xi, mobileWebkit: Ji, mobileWebkit3d: $i, msPointer: Qi, pointer: te, touch: ie, mobileOpera: ee, mobileGecko: ne, retina: oe, canvas: se, svg: re, vml: ae }),
      ue = Qi ? "MSPointerDown" : "pointerdown",
      le = Qi ? "MSPointerMove" : "pointermove",
      ce = Qi ? "MSPointerUp" : "pointerup",
      _e = Qi ? "MSPointerCancel" : "pointercancel",
      de = ["INPUT", "SELECT", "OPTION"],
      pe = {},
      me = !1,
      fe = 0,
      ge = Qi ? "MSPointerDown" : te ? "pointerdown" : "touchstart",
      ve = Qi ? "MSPointerUp" : te ? "pointerup" : "touchend",
      ye = "_leaflet_",
      xe = "_leaflet_events",
      we = Vi && ji ? 2 * window.devicePixelRatio : Wi ? window.devicePixelRatio : 1,
      Le = {},
      Pe = (Object.freeze || Object)({ on: V, off: G, stopPropagation: Y, disableScrollPropagation: X, disableClickPropagation: J, preventDefault: $, stop: Q, getMousePosition: tt, getWheelDelta: it, fakeStop: et, skipped: nt, isExternalTarget: ot, addListener: V, removeListener: G }),
      be = xt(["transform", "WebkitTransform", "OTransform", "MozTransform", "msTransform"]),
      Te = xt(["webkitTransition", "transition", "OTransition", "MozTransition", "msTransition"]),
      ze = "webkitTransition" === Te || "OTransition" === Te ? Te + "End" : "transitionend";if ("onselectstart" in document) Mi = function Mi() {
    V(window, "selectstart", $);
  }, Ci = function Ci() {
    G(window, "selectstart", $);
  };else {
    var Me = xt(["userSelect", "WebkitUserSelect", "OUserSelect", "MozUserSelect", "msUserSelect"]);Mi = function Mi() {
      if (Me) {
        var t = document.documentElement.style;Zi = t[Me], t[Me] = "none";
      }
    }, Ci = function Ci() {
      Me && (document.documentElement.style[Me] = Zi, Zi = void 0);
    };
  }var Ce,
      Ze,
      Ee = (Object.freeze || Object)({ TRANSFORM: be, TRANSITION: Te, TRANSITION_END: ze, get: rt, getStyle: at, create: ht, remove: ut, empty: lt, toFront: ct, toBack: _t, hasClass: dt, addClass: pt, removeClass: mt, setClass: ft, getClass: gt, setOpacity: vt, testProp: xt, setTransform: wt, setPosition: Lt, getPosition: Pt, disableTextSelection: Mi, enableTextSelection: Ci, disableImageDrag: bt, enableImageDrag: Tt, preventOutline: zt, restoreOutline: Mt }),
      Se = Li.extend({ run: function run(t, i, e, n) {
      this.stop(), this._el = t, this._inProgress = !0, this._duration = e || .25, this._easeOutPower = 1 / Math.max(n || .5, .2), this._startPos = Pt(t), this._offset = i.subtract(this._startPos), this._startTime = +new Date(), this.fire("start"), this._animate();
    }, stop: function stop() {
      this._inProgress && (this._step(!0), this._complete());
    }, _animate: function _animate() {
      this._animId = f(this._animate, this), this._step();
    }, _step: function _step(t) {
      var i = +new Date() - this._startTime,
          e = 1e3 * this._duration;i < e ? this._runFrame(this._easeOut(i / e), t) : (this._runFrame(1), this._complete());
    }, _runFrame: function _runFrame(t, i) {
      var e = this._startPos.add(this._offset.multiplyBy(t));i && e._round(), Lt(this._el, e), this.fire("step");
    }, _complete: function _complete() {
      g(this._animId), this._inProgress = !1, this.fire("end");
    }, _easeOut: function _easeOut(t) {
      return 1 - Math.pow(1 - t, this._easeOutPower);
    } }),
      ke = Li.extend({ options: { crs: Ei, center: void 0, zoom: void 0, minZoom: void 0, maxZoom: void 0, layers: [], maxBounds: void 0, renderer: void 0, zoomAnimation: !0, zoomAnimationThreshold: 4, fadeAnimation: !0, markerZoomAnimation: !0, transform3DLimit: 8388608, zoomSnap: 1, zoomDelta: 1, trackResize: !0 }, initialize: function initialize(t, i) {
      i = l(this, i), this._initContainer(t), this._initLayout(), this._onResize = e(this._onResize, this), this._initEvents(), i.maxBounds && this.setMaxBounds(i.maxBounds), void 0 !== i.zoom && (this._zoom = this._limitZoom(i.zoom)), i.center && void 0 !== i.zoom && this.setView(C(i.center), i.zoom, { reset: !0 }), this._handlers = [], this._layers = {}, this._zoomBoundLayers = {}, this._sizeChanged = !0, this.callInitHooks(), this._zoomAnimated = Te && Yi && !ee && this.options.zoomAnimation, this._zoomAnimated && (this._createAnimProxy(), V(this._proxy, ze, this._catchTransitionEnd, this)), this._addLayers(this.options.layers);
    }, setView: function setView(t, e, n) {
      if (e = void 0 === e ? this._zoom : this._limitZoom(e), t = this._limitCenter(C(t), e, this.options.maxBounds), n = n || {}, this._stop(), this._loaded && !n.reset && n !== !0) {
        void 0 !== n.animate && (n.zoom = i({ animate: n.animate }, n.zoom), n.pan = i({ animate: n.animate, duration: n.duration }, n.pan));var o = this._zoom !== e ? this._tryAnimatedZoom && this._tryAnimatedZoom(t, e, n.zoom) : this._tryAnimatedPan(t, n.pan);if (o) return clearTimeout(this._sizeTimer), this;
      }return this._resetView(t, e), this;
    }, setZoom: function setZoom(t, i) {
      return this._loaded ? this.setView(this.getCenter(), t, { zoom: i }) : (this._zoom = t, this);
    }, zoomIn: function zoomIn(t, i) {
      return t = t || (Yi ? this.options.zoomDelta : 1), this.setZoom(this._zoom + t, i);
    }, zoomOut: function zoomOut(t, i) {
      return t = t || (Yi ? this.options.zoomDelta : 1), this.setZoom(this._zoom - t, i);
    }, setZoomAround: function setZoomAround(t, i, e) {
      var n = this.getZoomScale(i),
          o = this.getSize().divideBy(2),
          s = t instanceof x ? t : this.latLngToContainerPoint(t),
          r = s.subtract(o).multiplyBy(1 - 1 / n),
          a = this.containerPointToLatLng(o.add(r));return this.setView(a, i, { zoom: e });
    }, _getBoundsCenterZoom: function _getBoundsCenterZoom(t, i) {
      i = i || {}, t = t.getBounds ? t.getBounds() : z(t);var e = w(i.paddingTopLeft || i.padding || [0, 0]),
          n = w(i.paddingBottomRight || i.padding || [0, 0]),
          o = this.getBoundsZoom(t, !1, e.add(n));if (o = "number" == typeof i.maxZoom ? Math.min(i.maxZoom, o) : o, o === 1 / 0) return { center: t.getCenter(), zoom: o };var s = n.subtract(e).divideBy(2),
          r = this.project(t.getSouthWest(), o),
          a = this.project(t.getNorthEast(), o),
          h = this.unproject(r.add(a).divideBy(2).add(s), o);return { center: h, zoom: o };
    }, fitBounds: function fitBounds(t, i) {
      if (t = z(t), !t.isValid()) throw new Error("Bounds are not valid.");var e = this._getBoundsCenterZoom(t, i);return this.setView(e.center, e.zoom, i);
    }, fitWorld: function fitWorld(t) {
      return this.fitBounds([[-90, -180], [90, 180]], t);
    }, panTo: function panTo(t, i) {
      return this.setView(t, this._zoom, { pan: i });
    }, panBy: function panBy(t, i) {
      if (t = w(t).round(), i = i || {}, !t.x && !t.y) return this.fire("moveend");if (i.animate !== !0 && !this.getSize().contains(t)) return this._resetView(this.unproject(this.project(this.getCenter()).add(t)), this.getZoom()), this;if (this._panAnim || (this._panAnim = new Se(), this._panAnim.on({ step: this._onPanTransitionStep, end: this._onPanTransitionEnd }, this)), i.noMoveStart || this.fire("movestart"), i.animate !== !1) {
        pt(this._mapPane, "leaflet-pan-anim");var e = this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane, e, i.duration || .25, i.easeLinearity);
      } else this._rawPanBy(t), this.fire("move").fire("moveend");return this;
    }, flyTo: function flyTo(t, i, e) {
      function n(t) {
        var i = t ? -1 : 1,
            e = t ? g : m,
            n = g * g - m * m + i * x * x * v * v,
            o = 2 * e * x * v,
            s = n / o,
            r = Math.sqrt(s * s + 1) - s,
            a = r < 1e-9 ? -18 : Math.log(r);return a;
      }function o(t) {
        return (Math.exp(t) - Math.exp(-t)) / 2;
      }function s(t) {
        return (Math.exp(t) + Math.exp(-t)) / 2;
      }function r(t) {
        return o(t) / s(t);
      }function a(t) {
        return m * (s(w) / s(w + y * t));
      }function h(t) {
        return m * (s(w) * r(w + y * t) - o(w)) / x;
      }function u(t) {
        return 1 - Math.pow(1 - t, 1.5);
      }function l() {
        var e = (Date.now() - L) / b,
            n = u(e) * P;e <= 1 ? (this._flyToFrame = f(l, this), this._move(this.unproject(c.add(_.subtract(c).multiplyBy(h(n) / v)), p), this.getScaleZoom(m / a(n), p), { flyTo: !0 })) : this._move(t, i)._moveEnd(!0);
      }if (e = e || {}, e.animate === !1 || !Yi) return this.setView(t, i, e);this._stop();var c = this.project(this.getCenter()),
          _ = this.project(t),
          d = this.getSize(),
          p = this._zoom;t = C(t), i = void 0 === i ? p : i;var m = Math.max(d.x, d.y),
          g = m * this.getZoomScale(p, i),
          v = _.distanceTo(c) || 1,
          y = 1.42,
          x = y * y,
          w = n(0),
          L = Date.now(),
          P = (n(1) - w) / y,
          b = e.duration ? 1e3 * e.duration : 1e3 * P * .8;return this._moveStart(!0), l.call(this), this;
    }, flyToBounds: function flyToBounds(t, i) {
      var e = this._getBoundsCenterZoom(t, i);return this.flyTo(e.center, e.zoom, i);
    }, setMaxBounds: function setMaxBounds(t) {
      return t = z(t), t.isValid() ? (this.options.maxBounds && this.off("moveend", this._panInsideMaxBounds), this.options.maxBounds = t, this._loaded && this._panInsideMaxBounds(), this.on("moveend", this._panInsideMaxBounds)) : (this.options.maxBounds = null, this.off("moveend", this._panInsideMaxBounds));
    }, setMinZoom: function setMinZoom(t) {
      return this.options.minZoom = t, this._loaded && this.getZoom() < this.options.minZoom ? this.setZoom(t) : this;
    }, setMaxZoom: function setMaxZoom(t) {
      return this.options.maxZoom = t, this._loaded && this.getZoom() > this.options.maxZoom ? this.setZoom(t) : this;
    }, panInsideBounds: function panInsideBounds(t, i) {
      this._enforcingBounds = !0;var e = this.getCenter(),
          n = this._limitCenter(e, this._zoom, z(t));return e.equals(n) || this.panTo(n, i), this._enforcingBounds = !1, this;
    }, invalidateSize: function invalidateSize(t) {
      if (!this._loaded) return this;t = i({ animate: !1, pan: !0 }, t === !0 ? { animate: !0 } : t);var n = this.getSize();this._sizeChanged = !0, this._lastCenter = null;var o = this.getSize(),
          s = n.divideBy(2).round(),
          r = o.divideBy(2).round(),
          a = s.subtract(r);return a.x || a.y ? (t.animate && t.pan ? this.panBy(a) : (t.pan && this._rawPanBy(a), this.fire("move"), t.debounceMoveend ? (clearTimeout(this._sizeTimer), this._sizeTimer = setTimeout(e(this.fire, this, "moveend"), 200)) : this.fire("moveend")), this.fire("resize", { oldSize: n, newSize: o })) : this;
    }, stop: function stop() {
      return this.setZoom(this._limitZoom(this._zoom)), this.options.zoomSnap || this.fire("viewreset"), this._stop();
    }, locate: function locate(t) {
      if (t = this._locateOptions = i({ timeout: 1e4, watch: !1 }, t), !("geolocation" in navigator)) return this._handleGeolocationError({ code: 0, message: "Geolocation not supported." }), this;var n = e(this._handleGeolocationResponse, this),
          o = e(this._handleGeolocationError, this);return t.watch ? this._locationWatchId = navigator.geolocation.watchPosition(n, o, t) : navigator.geolocation.getCurrentPosition(n, o, t), this;
    }, stopLocate: function stopLocate() {
      return navigator.geolocation && navigator.geolocation.clearWatch && navigator.geolocation.clearWatch(this._locationWatchId), this._locateOptions && (this._locateOptions.setView = !1), this;
    }, _handleGeolocationError: function _handleGeolocationError(t) {
      var i = t.code,
          e = t.message || (1 === i ? "permission denied" : 2 === i ? "position unavailable" : "timeout");this._locateOptions.setView && !this._loaded && this.fitWorld(), this.fire("locationerror", { code: i, message: "Geolocation error: " + e + "." });
    }, _handleGeolocationResponse: function _handleGeolocationResponse(t) {
      var i = t.coords.latitude,
          e = t.coords.longitude,
          n = new M(i, e),
          o = n.toBounds(t.coords.accuracy),
          s = this._locateOptions;if (s.setView) {
        var r = this.getBoundsZoom(o);this.setView(n, s.maxZoom ? Math.min(r, s.maxZoom) : r);
      }var a = { latlng: n, bounds: o, timestamp: t.timestamp };for (var h in t.coords) {
        "number" == typeof t.coords[h] && (a[h] = t.coords[h]);
      }this.fire("locationfound", a);
    }, addHandler: function addHandler(t, i) {
      if (!i) return this;var e = this[t] = new i(this);return this._handlers.push(e), this.options[t] && e.enable(), this;
    }, remove: function remove() {
      if (this._initEvents(!0), this._containerId !== this._container._leaflet_id) throw new Error("Map container is being reused by another instance");try {
        delete this._container._leaflet_id, delete this._containerId;
      } catch (t) {
        this._container._leaflet_id = void 0, this._containerId = void 0;
      }ut(this._mapPane), this._clearControlPos && this._clearControlPos(), this._clearHandlers(), this._loaded && this.fire("unload");var t;for (t in this._layers) {
        this._layers[t].remove();
      }for (t in this._panes) {
        ut(this._panes[t]);
      }return this._layers = [], this._panes = [], delete this._mapPane, delete this._renderer, this;
    }, createPane: function createPane(t, i) {
      var e = "leaflet-pane" + (t ? " leaflet-" + t.replace("Pane", "") + "-pane" : ""),
          n = ht("div", e, i || this._mapPane);return t && (this._panes[t] = n), n;
    }, getCenter: function getCenter() {
      return this._checkIfLoaded(), this._lastCenter && !this._moved() ? this._lastCenter : this.layerPointToLatLng(this._getCenterLayerPoint());
    }, getZoom: function getZoom() {
      return this._zoom;
    }, getBounds: function getBounds() {
      var t = this.getPixelBounds(),
          i = this.unproject(t.getBottomLeft()),
          e = this.unproject(t.getTopRight());return new T(i, e);
    }, getMinZoom: function getMinZoom() {
      return void 0 === this.options.minZoom ? this._layersMinZoom || 0 : this.options.minZoom;
    }, getMaxZoom: function getMaxZoom() {
      return void 0 === this.options.maxZoom ? void 0 === this._layersMaxZoom ? 1 / 0 : this._layersMaxZoom : this.options.maxZoom;
    }, getBoundsZoom: function getBoundsZoom(t, i, e) {
      t = z(t), e = w(e || [0, 0]);var n = this.getZoom() || 0,
          o = this.getMinZoom(),
          s = this.getMaxZoom(),
          r = t.getNorthWest(),
          a = t.getSouthEast(),
          h = this.getSize().subtract(e),
          u = b(this.project(a, n), this.project(r, n)).getSize(),
          l = Yi ? this.options.zoomSnap : 1,
          c = h.x / u.x,
          _ = h.y / u.y,
          d = i ? Math.max(c, _) : Math.min(c, _);return n = this.getScaleZoom(d, n), l && (n = Math.round(n / (l / 100)) * (l / 100), n = i ? Math.ceil(n / l) * l : Math.floor(n / l) * l), Math.max(o, Math.min(s, n));
    }, getSize: function getSize() {
      return this._size && !this._sizeChanged || (this._size = new x(this._container.clientWidth || 0, this._container.clientHeight || 0), this._sizeChanged = !1), this._size.clone();
    }, getPixelBounds: function getPixelBounds(t, i) {
      var e = this._getTopLeftPoint(t, i);return new P(e, e.add(this.getSize()));
    }, getPixelOrigin: function getPixelOrigin() {
      return this._checkIfLoaded(), this._pixelOrigin;
    }, getPixelWorldBounds: function getPixelWorldBounds(t) {
      return this.options.crs.getProjectedBounds(void 0 === t ? this.getZoom() : t);
    }, getPane: function getPane(t) {
      return "string" == typeof t ? this._panes[t] : t;
    }, getPanes: function getPanes() {
      return this._panes;
    }, getContainer: function getContainer() {
      return this._container;
    }, getZoomScale: function getZoomScale(t, i) {
      var e = this.options.crs;return i = void 0 === i ? this._zoom : i, e.scale(t) / e.scale(i);
    }, getScaleZoom: function getScaleZoom(t, i) {
      var e = this.options.crs;i = void 0 === i ? this._zoom : i;var n = e.zoom(t * e.scale(i));return isNaN(n) ? 1 / 0 : n;
    }, project: function project(t, i) {
      return i = void 0 === i ? this._zoom : i, this.options.crs.latLngToPoint(C(t), i);
    }, unproject: function unproject(t, i) {
      return i = void 0 === i ? this._zoom : i, this.options.crs.pointToLatLng(w(t), i);
    }, layerPointToLatLng: function layerPointToLatLng(t) {
      var i = w(t).add(this.getPixelOrigin());return this.unproject(i);
    }, latLngToLayerPoint: function latLngToLayerPoint(t) {
      var i = this.project(C(t))._round();return i._subtract(this.getPixelOrigin());
    }, wrapLatLng: function wrapLatLng(t) {
      return this.options.crs.wrapLatLng(C(t));
    }, wrapLatLngBounds: function wrapLatLngBounds(t) {
      return this.options.crs.wrapLatLngBounds(z(t));
    }, distance: function distance(t, i) {
      return this.options.crs.distance(C(t), C(i));
    }, containerPointToLayerPoint: function containerPointToLayerPoint(t) {
      return w(t).subtract(this._getMapPanePos());
    }, layerPointToContainerPoint: function layerPointToContainerPoint(t) {
      return w(t).add(this._getMapPanePos());
    }, containerPointToLatLng: function containerPointToLatLng(t) {
      var i = this.containerPointToLayerPoint(w(t));return this.layerPointToLatLng(i);
    }, latLngToContainerPoint: function latLngToContainerPoint(t) {
      return this.layerPointToContainerPoint(this.latLngToLayerPoint(C(t)));
    }, mouseEventToContainerPoint: function mouseEventToContainerPoint(t) {
      return tt(t, this._container);
    }, mouseEventToLayerPoint: function mouseEventToLayerPoint(t) {
      return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t));
    }, mouseEventToLatLng: function mouseEventToLatLng(t) {
      return this.layerPointToLatLng(this.mouseEventToLayerPoint(t));
    }, _initContainer: function _initContainer(t) {
      var i = this._container = rt(t);if (!i) throw new Error("Map container not found.");if (i._leaflet_id) throw new Error("Map container is already initialized.");V(i, "scroll", this._onScroll, this), this._containerId = n(i);
    }, _initLayout: function _initLayout() {
      var t = this._container;this._fadeAnimated = this.options.fadeAnimation && Yi, pt(t, "leaflet-container" + (ie ? " leaflet-touch" : "") + (oe ? " leaflet-retina" : "") + (Ii ? " leaflet-oldie" : "") + (Hi ? " leaflet-safari" : "") + (this._fadeAnimated ? " leaflet-fade-anim" : ""));var i = at(t, "position");"absolute" !== i && "relative" !== i && "fixed" !== i && (t.style.position = "relative"), this._initPanes(), this._initControlPos && this._initControlPos();
    }, _initPanes: function _initPanes() {
      var t = this._panes = {};this._paneRenderers = {}, this._mapPane = this.createPane("mapPane", this._container), Lt(this._mapPane, new x(0, 0)), this.createPane("tilePane"), this.createPane("shadowPane"), this.createPane("overlayPane"), this.createPane("markerPane"), this.createPane("tooltipPane"), this.createPane("popupPane"), this.options.markerZoomAnimation || (pt(t.markerPane, "leaflet-zoom-hide"), pt(t.shadowPane, "leaflet-zoom-hide"));
    }, _resetView: function _resetView(t, i) {
      Lt(this._mapPane, new x(0, 0));var e = !this._loaded;this._loaded = !0, i = this._limitZoom(i), this.fire("viewprereset");var n = this._zoom !== i;this._moveStart(n)._move(t, i)._moveEnd(n), this.fire("viewreset"), e && this.fire("load");
    }, _moveStart: function _moveStart(t) {
      return t && this.fire("zoomstart"), this.fire("movestart");
    }, _move: function _move(t, i, e) {
      void 0 === i && (i = this._zoom);var n = this._zoom !== i;return this._zoom = i, this._lastCenter = t, this._pixelOrigin = this._getNewPixelOrigin(t), (n || e && e.pinch) && this.fire("zoom", e), this.fire("move", e);
    }, _moveEnd: function _moveEnd(t) {
      return t && this.fire("zoomend"), this.fire("moveend");
    }, _stop: function _stop() {
      return g(this._flyToFrame), this._panAnim && this._panAnim.stop(), this;
    }, _rawPanBy: function _rawPanBy(t) {
      Lt(this._mapPane, this._getMapPanePos().subtract(t));
    }, _getZoomSpan: function _getZoomSpan() {
      return this.getMaxZoom() - this.getMinZoom();
    }, _panInsideMaxBounds: function _panInsideMaxBounds() {
      this._enforcingBounds || this.panInsideBounds(this.options.maxBounds);
    }, _checkIfLoaded: function _checkIfLoaded() {
      if (!this._loaded) throw new Error("Set map center and zoom first.");
    }, _initEvents: function _initEvents(t) {
      this._targets = {}, this._targets[n(this._container)] = this;var i = t ? G : V;i(this._container, "click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress", this._handleDOMEvent, this), this.options.trackResize && i(window, "resize", this._onResize, this), Yi && this.options.transform3DLimit && (t ? this.off : this.on).call(this, "moveend", this._onMoveEnd);
    }, _onResize: function _onResize() {
      g(this._resizeRequest), this._resizeRequest = f(function () {
        this.invalidateSize({ debounceMoveend: !0 });
      }, this);
    }, _onScroll: function _onScroll() {
      this._container.scrollTop = 0, this._container.scrollLeft = 0;
    }, _onMoveEnd: function _onMoveEnd() {
      var t = this._getMapPanePos();Math.max(Math.abs(t.x), Math.abs(t.y)) >= this.options.transform3DLimit && this._resetView(this.getCenter(), this.getZoom());
    }, _findEventTargets: function _findEventTargets(t, i) {
      for (var e, o = [], s = "mouseout" === i || "mouseover" === i, r = t.target || t.srcElement, a = !1; r;) {
        if (e = this._targets[n(r)], e && ("click" === i || "preclick" === i) && !t._simulated && this._draggableMoved(e)) {
          a = !0;break;
        }if (e && e.listens(i, !0)) {
          if (s && !ot(r, t)) break;if (o.push(e), s) break;
        }if (r === this._container) break;r = r.parentNode;
      }return o.length || a || s || !ot(r, t) || (o = [this]), o;
    }, _handleDOMEvent: function _handleDOMEvent(t) {
      if (this._loaded && !nt(t)) {
        var i = t.type;"mousedown" !== i && "keypress" !== i || zt(t.target || t.srcElement), this._fireDOMEvent(t, i);
      }
    }, _mouseEvents: ["click", "dblclick", "mouseover", "mouseout", "contextmenu"], _fireDOMEvent: function _fireDOMEvent(t, e, n) {
      if ("click" === t.type) {
        var o = i({}, t);o.type = "preclick", this._fireDOMEvent(o, o.type, n);
      }if (!t._stopped && (n = (n || []).concat(this._findEventTargets(t, e)), n.length)) {
        var s = n[0];"contextmenu" === e && s.listens(e, !0) && $(t);var r = { originalEvent: t };if ("keypress" !== t.type) {
          var a = s.options && "icon" in s.options;r.containerPoint = a ? this.latLngToContainerPoint(s.getLatLng()) : this.mouseEventToContainerPoint(t), r.layerPoint = this.containerPointToLayerPoint(r.containerPoint), r.latlng = a ? s.getLatLng() : this.layerPointToLatLng(r.layerPoint);
        }for (var h = 0; h < n.length; h++) {
          if (n[h].fire(e, r, !0), r.originalEvent._stopped || n[h].options.bubblingMouseEvents === !1 && d(this._mouseEvents, e) !== -1) return;
        }
      }
    }, _draggableMoved: function _draggableMoved(t) {
      return t = t.dragging && t.dragging.enabled() ? t : this, t.dragging && t.dragging.moved() || this.boxZoom && this.boxZoom.moved();
    }, _clearHandlers: function _clearHandlers() {
      for (var t = 0, i = this._handlers.length; t < i; t++) {
        this._handlers[t].disable();
      }
    }, whenReady: function whenReady(t, i) {
      return this._loaded ? t.call(i || this, { target: this }) : this.on("load", t, i), this;
    }, _getMapPanePos: function _getMapPanePos() {
      return Pt(this._mapPane) || new x(0, 0);
    }, _moved: function _moved() {
      var t = this._getMapPanePos();return t && !t.equals([0, 0]);
    }, _getTopLeftPoint: function _getTopLeftPoint(t, i) {
      var e = t && void 0 !== i ? this._getNewPixelOrigin(t, i) : this.getPixelOrigin();return e.subtract(this._getMapPanePos());
    }, _getNewPixelOrigin: function _getNewPixelOrigin(t, i) {
      var e = this.getSize()._divideBy(2);return this.project(t, i)._subtract(e)._add(this._getMapPanePos())._round();
    }, _latLngToNewLayerPoint: function _latLngToNewLayerPoint(t, i, e) {
      var n = this._getNewPixelOrigin(e, i);return this.project(t, i)._subtract(n);
    }, _latLngBoundsToNewLayerBounds: function _latLngBoundsToNewLayerBounds(t, i, e) {
      var n = this._getNewPixelOrigin(e, i);return b([this.project(t.getSouthWest(), i)._subtract(n), this.project(t.getNorthWest(), i)._subtract(n), this.project(t.getSouthEast(), i)._subtract(n), this.project(t.getNorthEast(), i)._subtract(n)]);
    }, _getCenterLayerPoint: function _getCenterLayerPoint() {
      return this.containerPointToLayerPoint(this.getSize()._divideBy(2));
    }, _getCenterOffset: function _getCenterOffset(t) {
      return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint());
    }, _limitCenter: function _limitCenter(t, i, e) {
      if (!e) return t;var n = this.project(t, i),
          o = this.getSize().divideBy(2),
          s = new P(n.subtract(o), n.add(o)),
          r = this._getBoundsOffset(s, e, i);return r.round().equals([0, 0]) ? t : this.unproject(n.add(r), i);
    }, _limitOffset: function _limitOffset(t, i) {
      if (!i) return t;var e = this.getPixelBounds(),
          n = new P(e.min.add(t), e.max.add(t));return t.add(this._getBoundsOffset(n, i));
    }, _getBoundsOffset: function _getBoundsOffset(t, i, e) {
      var n = b(this.project(i.getNorthEast(), e), this.project(i.getSouthWest(), e)),
          o = n.min.subtract(t.min),
          s = n.max.subtract(t.max),
          r = this._rebound(o.x, -s.x),
          a = this._rebound(o.y, -s.y);return new x(r, a);
    }, _rebound: function _rebound(t, i) {
      return t + i > 0 ? Math.round(t - i) / 2 : Math.max(0, Math.ceil(t)) - Math.max(0, Math.floor(i));
    }, _limitZoom: function _limitZoom(t) {
      var i = this.getMinZoom(),
          e = this.getMaxZoom(),
          n = Yi ? this.options.zoomSnap : 1;return n && (t = Math.round(t / n) * n), Math.max(i, Math.min(e, t));
    }, _onPanTransitionStep: function _onPanTransitionStep() {
      this.fire("move");
    }, _onPanTransitionEnd: function _onPanTransitionEnd() {
      mt(this._mapPane, "leaflet-pan-anim"), this.fire("moveend");
    }, _tryAnimatedPan: function _tryAnimatedPan(t, i) {
      var e = this._getCenterOffset(t)._floor();return !((i && i.animate) !== !0 && !this.getSize().contains(e)) && (this.panBy(e, i), !0);
    }, _createAnimProxy: function _createAnimProxy() {
      var t = this._proxy = ht("div", "leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t), this.on("zoomanim", function (t) {
        var i = be,
            e = this._proxy.style[i];wt(this._proxy, this.project(t.center, t.zoom), this.getZoomScale(t.zoom, 1)), e === this._proxy.style[i] && this._animatingZoom && this._onZoomTransitionEnd();
      }, this), this.on("load moveend", function () {
        var t = this.getCenter(),
            i = this.getZoom();wt(this._proxy, this.project(t, i), this.getZoomScale(i, 1));
      }, this), this._on("unload", this._destroyAnimProxy, this);
    }, _destroyAnimProxy: function _destroyAnimProxy() {
      ut(this._proxy), delete this._proxy;
    }, _catchTransitionEnd: function _catchTransitionEnd(t) {
      this._animatingZoom && t.propertyName.indexOf("transform") >= 0 && this._onZoomTransitionEnd();
    }, _nothingToAnimate: function _nothingToAnimate() {
      return !this._container.getElementsByClassName("leaflet-zoom-animated").length;
    }, _tryAnimatedZoom: function _tryAnimatedZoom(t, i, e) {
      if (this._animatingZoom) return !0;if (e = e || {}, !this._zoomAnimated || e.animate === !1 || this._nothingToAnimate() || Math.abs(i - this._zoom) > this.options.zoomAnimationThreshold) return !1;var n = this.getZoomScale(i),
          o = this._getCenterOffset(t)._divideBy(1 - 1 / n);return !(e.animate !== !0 && !this.getSize().contains(o)) && (f(function () {
        this._moveStart(!0)._animateZoom(t, i, !0);
      }, this), !0);
    }, _animateZoom: function _animateZoom(t, i, n, o) {
      n && (this._animatingZoom = !0, this._animateToCenter = t, this._animateToZoom = i, pt(this._mapPane, "leaflet-zoom-anim")), this.fire("zoomanim", { center: t, zoom: i, noUpdate: o }), setTimeout(e(this._onZoomTransitionEnd, this), 250);
    }, _onZoomTransitionEnd: function _onZoomTransitionEnd() {
      this._animatingZoom && (mt(this._mapPane, "leaflet-zoom-anim"), this._animatingZoom = !1, this._move(this._animateToCenter, this._animateToZoom), f(function () {
        this._moveEnd(!0);
      }, this));
    } }),
      Be = v.extend({ options: { position: "topright" }, initialize: function initialize(t) {
      l(this, t);
    }, getPosition: function getPosition() {
      return this.options.position;
    }, setPosition: function setPosition(t) {
      var i = this._map;return i && i.removeControl(this), this.options.position = t, i && i.addControl(this), this;
    }, getContainer: function getContainer() {
      return this._container;
    }, addTo: function addTo(t) {
      this.remove(), this._map = t;var i = this._container = this.onAdd(t),
          e = this.getPosition(),
          n = t._controlCorners[e];return pt(i, "leaflet-control"), e.indexOf("bottom") !== -1 ? n.insertBefore(i, n.firstChild) : n.appendChild(i), this;
    }, remove: function remove() {
      return this._map ? (ut(this._container), this.onRemove && this.onRemove(this._map), this._map = null, this) : this;
    }, _refocusOnMap: function _refocusOnMap(t) {
      this._map && t && t.screenX > 0 && t.screenY > 0 && this._map.getContainer().focus();
    } }),
      Ie = function Ie(t) {
    return new Be(t);
  };ke.include({ addControl: function addControl(t) {
      return t.addTo(this), this;
    }, removeControl: function removeControl(t) {
      return t.remove(), this;
    }, _initControlPos: function _initControlPos() {
      function t(t, o) {
        var s = e + t + " " + e + o;i[t + o] = ht("div", s, n);
      }var i = this._controlCorners = {},
          e = "leaflet-",
          n = this._controlContainer = ht("div", e + "control-container", this._container);t("top", "left"), t("top", "right"), t("bottom", "left"), t("bottom", "right");
    }, _clearControlPos: function _clearControlPos() {
      for (var t in this._controlCorners) {
        ut(this._controlCorners[t]);
      }ut(this._controlContainer), delete this._controlCorners, delete this._controlContainer;
    } });var Ae = Be.extend({ options: { collapsed: !0, position: "topright", autoZIndex: !0, hideSingleBase: !1, sortLayers: !1, sortFunction: function sortFunction(t, i, e, n) {
        return e < n ? -1 : n < e ? 1 : 0;
      } }, initialize: function initialize(t, i, e) {
      l(this, e), this._layerControlInputs = [], this._layers = [], this._lastZIndex = 0, this._handlingClick = !1;for (var n in t) {
        this._addLayer(t[n], n);
      }for (n in i) {
        this._addLayer(i[n], n, !0);
      }
    }, onAdd: function onAdd(t) {
      this._initLayout(), this._update(), this._map = t, t.on("zoomend", this._checkDisabledLayers, this);for (var i = 0; i < this._layers.length; i++) {
        this._layers[i].layer.on("add remove", this._onLayerChange, this);
      }return this._container;
    }, addTo: function addTo(t) {
      return Be.prototype.addTo.call(this, t), this._expandIfNotCollapsed();
    }, onRemove: function onRemove() {
      this._map.off("zoomend", this._checkDisabledLayers, this);for (var t = 0; t < this._layers.length; t++) {
        this._layers[t].layer.off("add remove", this._onLayerChange, this);
      }
    }, addBaseLayer: function addBaseLayer(t, i) {
      return this._addLayer(t, i), this._map ? this._update() : this;
    }, addOverlay: function addOverlay(t, i) {
      return this._addLayer(t, i, !0), this._map ? this._update() : this;
    }, removeLayer: function removeLayer(t) {
      t.off("add remove", this._onLayerChange, this);var i = this._getLayer(n(t));return i && this._layers.splice(this._layers.indexOf(i), 1), this._map ? this._update() : this;
    }, expand: function expand() {
      pt(this._container, "leaflet-control-layers-expanded"), this._form.style.height = null;var t = this._map.getSize().y - (this._container.offsetTop + 50);return t < this._form.clientHeight ? (pt(this._form, "leaflet-control-layers-scrollbar"), this._form.style.height = t + "px") : mt(this._form, "leaflet-control-layers-scrollbar"), this._checkDisabledLayers(), this;
    }, collapse: function collapse() {
      return mt(this._container, "leaflet-control-layers-expanded"), this;
    }, _initLayout: function _initLayout() {
      var t = "leaflet-control-layers",
          i = this._container = ht("div", t),
          n = this.options.collapsed;i.setAttribute("aria-haspopup", !0), J(i), X(i);var o = this._form = ht("form", t + "-list");n && (this._map.on("click", this.collapse, this), Ri || V(i, { mouseenter: this.expand, mouseleave: this.collapse }, this));var s = this._layersLink = ht("a", t + "-toggle", i);s.href = "#", s.title = "Layers", ie ? (V(s, "click", Q), V(s, "click", this.expand, this)) : V(s, "focus", this.expand, this), V(o, "click", function () {
        setTimeout(e(this._onInputClick, this), 0);
      }, this), n || this.expand(), this._baseLayersList = ht("div", t + "-base", o), this._separator = ht("div", t + "-separator", o), this._overlaysList = ht("div", t + "-overlays", o), i.appendChild(o);
    }, _getLayer: function _getLayer(t) {
      for (var i = 0; i < this._layers.length; i++) {
        if (this._layers[i] && n(this._layers[i].layer) === t) return this._layers[i];
      }
    }, _addLayer: function _addLayer(t, i, e) {
      this._map && t.on("add remove", this._onLayerChange, this), this._layers.push({ layer: t, name: i, overlay: e }), this.options.sortLayers && this._layers.sort(L.bind(function (t, i) {
        return this.options.sortFunction(t.layer, i.layer, t.name, i.name);
      }, this)), this.options.autoZIndex && t.setZIndex && (this._lastZIndex++, t.setZIndex(this._lastZIndex)), this._expandIfNotCollapsed();
    }, _update: function _update() {
      if (!this._container) return this;lt(this._baseLayersList), lt(this._overlaysList), this._layerControlInputs = [];var t,
          i,
          e,
          n,
          o = 0;for (e = 0; e < this._layers.length; e++) {
        n = this._layers[e], this._addItem(n), i = i || n.overlay, t = t || !n.overlay, o += n.overlay ? 0 : 1;
      }return this.options.hideSingleBase && (t = t && o > 1, this._baseLayersList.style.display = t ? "" : "none"), this._separator.style.display = i && t ? "" : "none", this;
    }, _onLayerChange: function _onLayerChange(t) {
      this._handlingClick || this._update();var i = this._getLayer(n(t.target)),
          e = i.overlay ? "add" === t.type ? "overlayadd" : "overlayremove" : "add" === t.type ? "baselayerchange" : null;e && this._map.fire(e, i);
    }, _createRadioElement: function _createRadioElement(t, i) {
      var e = '<input type="radio" class="leaflet-control-layers-selector" name="' + t + '"' + (i ? ' checked="checked"' : "") + "/>",
          n = document.createElement("div");return n.innerHTML = e, n.firstChild;
    }, _addItem: function _addItem(t) {
      var i,
          e = document.createElement("label"),
          o = this._map.hasLayer(t.layer);t.overlay ? (i = document.createElement("input"), i.type = "checkbox", i.className = "leaflet-control-layers-selector", i.defaultChecked = o) : i = this._createRadioElement("leaflet-base-layers", o), this._layerControlInputs.push(i), i.layerId = n(t.layer), V(i, "click", this._onInputClick, this);var s = document.createElement("span");s.innerHTML = " " + t.name;var r = document.createElement("div");e.appendChild(r), r.appendChild(i), r.appendChild(s);var a = t.overlay ? this._overlaysList : this._baseLayersList;return a.appendChild(e), this._checkDisabledLayers(), e;
    }, _onInputClick: function _onInputClick() {
      var t,
          i,
          e,
          n = this._layerControlInputs,
          o = [],
          s = [];this._handlingClick = !0;for (var r = n.length - 1; r >= 0; r--) {
        t = n[r], i = this._getLayer(t.layerId).layer, e = this._map.hasLayer(i), t.checked && !e ? o.push(i) : !t.checked && e && s.push(i);
      }for (r = 0; r < s.length; r++) {
        this._map.removeLayer(s[r]);
      }for (r = 0; r < o.length; r++) {
        this._map.addLayer(o[r]);
      }this._handlingClick = !1, this._refocusOnMap();
    }, _checkDisabledLayers: function _checkDisabledLayers() {
      for (var t, i, e = this._layerControlInputs, n = this._map.getZoom(), o = e.length - 1; o >= 0; o--) {
        t = e[o], i = this._getLayer(t.layerId).layer, t.disabled = void 0 !== i.options.minZoom && n < i.options.minZoom || void 0 !== i.options.maxZoom && n > i.options.maxZoom;
      }
    }, _expandIfNotCollapsed: function _expandIfNotCollapsed() {
      return this._map && !this.options.collapsed && this.expand(), this;
    }, _expand: function _expand() {
      return this.expand();
    }, _collapse: function _collapse() {
      return this.collapse();
    } }),
      Oe = function Oe(t, i, e) {
    return new Ae(t, i, e);
  },
      Re = Be.extend({ options: { position: "topleft", zoomInText: "+", zoomInTitle: "Zoom in", zoomOutText: "&#x2212;", zoomOutTitle: "Zoom out" }, onAdd: function onAdd(t) {
      var i = "leaflet-control-zoom",
          e = ht("div", i + " leaflet-bar"),
          n = this.options;return this._zoomInButton = this._createButton(n.zoomInText, n.zoomInTitle, i + "-in", e, this._zoomIn), this._zoomOutButton = this._createButton(n.zoomOutText, n.zoomOutTitle, i + "-out", e, this._zoomOut), this._updateDisabled(), t.on("zoomend zoomlevelschange", this._updateDisabled, this), e;
    }, onRemove: function onRemove(t) {
      t.off("zoomend zoomlevelschange", this._updateDisabled, this);
    }, disable: function disable() {
      return this._disabled = !0, this._updateDisabled(), this;
    }, enable: function enable() {
      return this._disabled = !1, this._updateDisabled(), this;
    }, _zoomIn: function _zoomIn(t) {
      !this._disabled && this._map._zoom < this._map.getMaxZoom() && this._map.zoomIn(this._map.options.zoomDelta * (t.shiftKey ? 3 : 1));
    }, _zoomOut: function _zoomOut(t) {
      !this._disabled && this._map._zoom > this._map.getMinZoom() && this._map.zoomOut(this._map.options.zoomDelta * (t.shiftKey ? 3 : 1));
    }, _createButton: function _createButton(t, i, e, n, o) {
      var s = ht("a", e, n);return s.innerHTML = t, s.href = "#", s.title = i, s.setAttribute("role", "button"), s.setAttribute("aria-label", i), J(s), V(s, "click", Q), V(s, "click", o, this), V(s, "click", this._refocusOnMap, this), s;
    }, _updateDisabled: function _updateDisabled() {
      var t = this._map,
          i = "leaflet-disabled";mt(this._zoomInButton, i), mt(this._zoomOutButton, i), (this._disabled || t._zoom === t.getMinZoom()) && pt(this._zoomOutButton, i), (this._disabled || t._zoom === t.getMaxZoom()) && pt(this._zoomInButton, i);
    } });ke.mergeOptions({ zoomControl: !0 }), ke.addInitHook(function () {
    this.options.zoomControl && (this.zoomControl = new Re(), this.addControl(this.zoomControl));
  });var De = function De(t) {
    return new Re(t);
  },
      Ne = Be.extend({ options: { position: "bottomleft", maxWidth: 100, metric: !0, imperial: !0 }, onAdd: function onAdd(t) {
      var i = "leaflet-control-scale",
          e = ht("div", i),
          n = this.options;return this._addScales(n, i + "-line", e), t.on(n.updateWhenIdle ? "moveend" : "move", this._update, this), t.whenReady(this._update, this), e;
    }, onRemove: function onRemove(t) {
      t.off(this.options.updateWhenIdle ? "moveend" : "move", this._update, this);
    }, _addScales: function _addScales(t, i, e) {
      t.metric && (this._mScale = ht("div", i, e)), t.imperial && (this._iScale = ht("div", i, e));
    }, _update: function _update() {
      var t = this._map,
          i = t.getSize().y / 2,
          e = t.distance(t.containerPointToLatLng([0, i]), t.containerPointToLatLng([this.options.maxWidth, i]));this._updateScales(e);
    }, _updateScales: function _updateScales(t) {
      this.options.metric && t && this._updateMetric(t), this.options.imperial && t && this._updateImperial(t);
    }, _updateMetric: function _updateMetric(t) {
      var i = this._getRoundNum(t),
          e = i < 1e3 ? i + " m" : i / 1e3 + " km";this._updateScale(this._mScale, e, i / t);
    }, _updateImperial: function _updateImperial(t) {
      var i,
          e,
          n,
          o = 3.2808399 * t;o > 5280 ? (i = o / 5280, e = this._getRoundNum(i), this._updateScale(this._iScale, e + " mi", e / i)) : (n = this._getRoundNum(o), this._updateScale(this._iScale, n + " ft", n / o));
    }, _updateScale: function _updateScale(t, i, e) {
      t.style.width = Math.round(this.options.maxWidth * e) + "px", t.innerHTML = i;
    }, _getRoundNum: function _getRoundNum(t) {
      var i = Math.pow(10, (Math.floor(t) + "").length - 1),
          e = t / i;return e = e >= 10 ? 10 : e >= 5 ? 5 : e >= 3 ? 3 : e >= 2 ? 2 : 1, i * e;
    } }),
      je = function je(t) {
    return new Ne(t);
  },
      We = Be.extend({ options: { position: "bottomright", prefix: '<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>' }, initialize: function initialize(t) {
      l(this, t), this._attributions = {};
    }, onAdd: function onAdd(t) {
      t.attributionControl = this, this._container = ht("div", "leaflet-control-attribution"), J(this._container);for (var i in t._layers) {
        t._layers[i].getAttribution && this.addAttribution(t._layers[i].getAttribution());
      }return this._update(), this._container;
    }, setPrefix: function setPrefix(t) {
      return this.options.prefix = t, this._update(), this;
    }, addAttribution: function addAttribution(t) {
      return t ? (this._attributions[t] || (this._attributions[t] = 0), this._attributions[t]++, this._update(), this) : this;
    }, removeAttribution: function removeAttribution(t) {
      return t ? (this._attributions[t] && (this._attributions[t]--, this._update()), this) : this;
    }, _update: function _update() {
      if (this._map) {
        var t = [];for (var i in this._attributions) {
          this._attributions[i] && t.push(i);
        }var e = [];this.options.prefix && e.push(this.options.prefix), t.length && e.push(t.join(", ")), this._container.innerHTML = e.join(" | ");
      }
    } });ke.mergeOptions({ attributionControl: !0 }), ke.addInitHook(function () {
    this.options.attributionControl && new We().addTo(this);
  });var He = function He(t) {
    return new We(t);
  };Be.Layers = Ae, Be.Zoom = Re, Be.Scale = Ne, Be.Attribution = We, Ie.layers = Oe, Ie.zoom = De, Ie.scale = je, Ie.attribution = He;var Fe,
      Ue = v.extend({ initialize: function initialize(t) {
      this._map = t;
    }, enable: function enable() {
      return this._enabled ? this : (this._enabled = !0, this.addHooks(), this);
    }, disable: function disable() {
      return this._enabled ? (this._enabled = !1, this.removeHooks(), this) : this;
    }, enabled: function enabled() {
      return !!this._enabled;
    } }),
      Ve = { Events: wi },
      Ge = !1,
      qe = ie ? "touchstart mousedown" : "mousedown",
      Ke = { mousedown: "mouseup", touchstart: "touchend", pointerdown: "touchend", MSPointerDown: "touchend" },
      Ye = { mousedown: "mousemove", touchstart: "touchmove", pointerdown: "touchmove", MSPointerDown: "touchmove" },
      Xe = Li.extend({ options: { clickTolerance: 3 }, initialize: function initialize(t, i, e, n) {
      l(this, n), this._element = t, this._dragStartTarget = i || t, this._preventOutline = e;
    }, enable: function enable() {
      this._enabled || (V(this._dragStartTarget, qe, this._onDown, this), this._enabled = !0);
    }, disable: function disable() {
      this._enabled && (L.Draggable._dragging === this && this.finishDrag(), G(this._dragStartTarget, qe, this._onDown, this), this._enabled = !1, this._moved = !1);
    }, _onDown: function _onDown(t) {
      if (!t._simulated && this._enabled && (this._moved = !1, !dt(this._element, "leaflet-zoom-anim") && !(Ge || t.shiftKey || 1 !== t.which && 1 !== t.button && !t.touches || (Ge = this, this._preventOutline && zt(this._element), bt(), Mi(), this._moving)))) {
        this.fire("down");var i = t.touches ? t.touches[0] : t;this._startPoint = new x(i.clientX, i.clientY), V(document, Ye[t.type], this._onMove, this), V(document, Ke[t.type], this._onUp, this);
      }
    }, _onMove: function _onMove(t) {
      if (!t._simulated && this._enabled) {
        if (t.touches && t.touches.length > 1) return void (this._moved = !0);var i = t.touches && 1 === t.touches.length ? t.touches[0] : t,
            e = new x(i.clientX, i.clientY),
            n = e.subtract(this._startPoint);(n.x || n.y) && (Math.abs(n.x) + Math.abs(n.y) < this.options.clickTolerance || ($(t), this._moved || (this.fire("dragstart"), this._moved = !0, this._startPos = Pt(this._element).subtract(n), pt(document.body, "leaflet-dragging"), this._lastTarget = t.target || t.srcElement, window.SVGElementInstance && this._lastTarget instanceof SVGElementInstance && (this._lastTarget = this._lastTarget.correspondingUseElement), pt(this._lastTarget, "leaflet-drag-target")), this._newPos = this._startPos.add(n), this._moving = !0, g(this._animRequest), this._lastEvent = t, this._animRequest = f(this._updatePosition, this, !0)));
      }
    }, _updatePosition: function _updatePosition() {
      var t = { originalEvent: this._lastEvent };this.fire("predrag", t), Lt(this._element, this._newPos), this.fire("drag", t);
    }, _onUp: function _onUp(t) {
      !t._simulated && this._enabled && this.finishDrag();
    }, finishDrag: function finishDrag() {
      mt(document.body, "leaflet-dragging"), this._lastTarget && (mt(this._lastTarget, "leaflet-drag-target"), this._lastTarget = null);for (var t in Ye) {
        G(document, Ye[t], this._onMove, this), G(document, Ke[t], this._onUp, this);
      }Tt(), Ci(), this._moved && this._moving && (g(this._animRequest), this.fire("dragend", { distance: this._newPos.distanceTo(this._startPos) })), this._moving = !1, Ge = !1;
    } }),
      Je = (Object.freeze || Object)({ simplify: Zt, pointToSegmentDistance: Et, closestPointOnSegment: St, clipSegment: At, _getEdgeIntersection: Ot, _getBitCode: Rt, _sqClosestPointOnSegment: Nt, _flat: jt }),
      $e = (Object.freeze || Object)({ clipPolygon: Wt }),
      Qe = { project: function project(t) {
      return new x(t.lng, t.lat);
    }, unproject: function unproject(t) {
      return new M(t.y, t.x);
    }, bounds: new P([-180, -90], [180, 90]) },
      tn = { R: 6378137, R_MINOR: 6356752.314245179, bounds: new P([-20037508.34279, -15496570.73972], [20037508.34279, 18764656.23138]), project: function project(t) {
      var i = Math.PI / 180,
          e = this.R,
          n = t.lat * i,
          o = this.R_MINOR / e,
          s = Math.sqrt(1 - o * o),
          r = s * Math.sin(n),
          a = Math.tan(Math.PI / 4 - n / 2) / Math.pow((1 - r) / (1 + r), s / 2);return n = -e * Math.log(Math.max(a, 1e-10)), new x(t.lng * i * e, n);
    }, unproject: function unproject(t) {
      for (var i, e = 180 / Math.PI, n = this.R, o = this.R_MINOR / n, s = Math.sqrt(1 - o * o), r = Math.exp(-t.y / n), a = Math.PI / 2 - 2 * Math.atan(r), h = 0, u = .1; h < 15 && Math.abs(u) > 1e-7; h++) {
        i = s * Math.sin(a), i = Math.pow((1 - i) / (1 + i), s / 2), u = Math.PI / 2 - 2 * Math.atan(r * i) - a, a += u;
      }return new M(a * e, t.x * e / n);
    } },
      en = (Object.freeze || Object)({ LonLat: Qe, Mercator: tn, SphericalMercator: Ti }),
      nn = i({}, bi, { code: "EPSG:3395", projection: tn, transformation: function () {
      var t = .5 / (Math.PI * tn.R);return E(t, .5, -t, .5);
    }() }),
      on = i({}, bi, { code: "EPSG:4326", projection: Qe, transformation: E(1 / 180, 1, -1 / 180, .5) }),
      sn = i({}, Pi, { projection: Qe, transformation: E(1, 0, -1, 0), scale: function scale(t) {
      return Math.pow(2, t);
    }, zoom: function zoom(t) {
      return Math.log(t) / Math.LN2;
    }, distance: function distance(t, i) {
      var e = i.lng - t.lng,
          n = i.lat - t.lat;return Math.sqrt(e * e + n * n);
    }, infinite: !0 });Pi.Earth = bi, Pi.EPSG3395 = nn, Pi.EPSG3857 = Ei, Pi.EPSG900913 = Si, Pi.EPSG4326 = on, Pi.Simple = sn;var rn = Li.extend({ options: { pane: "overlayPane", attribution: null, bubblingMouseEvents: !0 }, addTo: function addTo(t) {
      return t.addLayer(this), this;
    }, remove: function remove() {
      return this.removeFrom(this._map || this._mapToAdd);
    }, removeFrom: function removeFrom(t) {
      return t && t.removeLayer(this), this;
    }, getPane: function getPane(t) {
      return this._map.getPane(t ? this.options[t] || t : this.options.pane);
    }, addInteractiveTarget: function addInteractiveTarget(t) {
      return this._map._targets[n(t)] = this, this;
    }, removeInteractiveTarget: function removeInteractiveTarget(t) {
      return delete this._map._targets[n(t)], this;
    }, getAttribution: function getAttribution() {
      return this.options.attribution;
    }, _layerAdd: function _layerAdd(t) {
      var i = t.target;if (i.hasLayer(this)) {
        if (this._map = i, this._zoomAnimated = i._zoomAnimated, this.getEvents) {
          var e = this.getEvents();i.on(e, this), this.once("remove", function () {
            i.off(e, this);
          }, this);
        }this.onAdd(i), this.getAttribution && i.attributionControl && i.attributionControl.addAttribution(this.getAttribution()), this.fire("add"), i.fire("layeradd", { layer: this });
      }
    } });ke.include({ addLayer: function addLayer(t) {
      var i = n(t);return this._layers[i] ? this : (this._layers[i] = t, t._mapToAdd = this, t.beforeAdd && t.beforeAdd(this), this.whenReady(t._layerAdd, t), this);
    }, removeLayer: function removeLayer(t) {
      var i = n(t);return this._layers[i] ? (this._loaded && t.onRemove(this), t.getAttribution && this.attributionControl && this.attributionControl.removeAttribution(t.getAttribution()), delete this._layers[i], this._loaded && (this.fire("layerremove", { layer: t }), t.fire("remove")), t._map = t._mapToAdd = null, this) : this;
    }, hasLayer: function hasLayer(t) {
      return !!t && n(t) in this._layers;
    }, eachLayer: function eachLayer(t, i) {
      for (var e in this._layers) {
        t.call(i, this._layers[e]);
      }return this;
    }, _addLayers: function _addLayers(t) {
      t = t ? mi(t) ? t : [t] : [];for (var i = 0, e = t.length; i < e; i++) {
        this.addLayer(t[i]);
      }
    }, _addZoomLimit: function _addZoomLimit(t) {
      !isNaN(t.options.maxZoom) && isNaN(t.options.minZoom) || (this._zoomBoundLayers[n(t)] = t, this._updateZoomLevels());
    }, _removeZoomLimit: function _removeZoomLimit(t) {
      var i = n(t);this._zoomBoundLayers[i] && (delete this._zoomBoundLayers[i], this._updateZoomLevels());
    }, _updateZoomLevels: function _updateZoomLevels() {
      var t = 1 / 0,
          i = -(1 / 0),
          e = this._getZoomSpan();for (var n in this._zoomBoundLayers) {
        var o = this._zoomBoundLayers[n].options;t = void 0 === o.minZoom ? t : Math.min(t, o.minZoom), i = void 0 === o.maxZoom ? i : Math.max(i, o.maxZoom);
      }this._layersMaxZoom = i === -(1 / 0) ? void 0 : i, this._layersMinZoom = t === 1 / 0 ? void 0 : t, e !== this._getZoomSpan() && this.fire("zoomlevelschange"), void 0 === this.options.maxZoom && this._layersMaxZoom && this.getZoom() > this._layersMaxZoom && this.setZoom(this._layersMaxZoom), void 0 === this.options.minZoom && this._layersMinZoom && this.getZoom() < this._layersMinZoom && this.setZoom(this._layersMinZoom);
    } });var an = rn.extend({ initialize: function initialize(t) {
      this._layers = {};var i, e;if (t) for (i = 0, e = t.length; i < e; i++) {
        this.addLayer(t[i]);
      }
    }, addLayer: function addLayer(t) {
      var i = this.getLayerId(t);return this._layers[i] = t, this._map && this._map.addLayer(t), this;
    }, removeLayer: function removeLayer(t) {
      var i = t in this._layers ? t : this.getLayerId(t);return this._map && this._layers[i] && this._map.removeLayer(this._layers[i]), delete this._layers[i], this;
    }, hasLayer: function hasLayer(t) {
      return !!t && (t in this._layers || this.getLayerId(t) in this._layers);
    }, clearLayers: function clearLayers() {
      for (var t in this._layers) {
        this.removeLayer(this._layers[t]);
      }return this;
    }, invoke: function invoke(t) {
      var i,
          e,
          n = Array.prototype.slice.call(arguments, 1);for (i in this._layers) {
        e = this._layers[i], e[t] && e[t].apply(e, n);
      }return this;
    }, onAdd: function onAdd(t) {
      for (var i in this._layers) {
        t.addLayer(this._layers[i]);
      }
    }, onRemove: function onRemove(t) {
      for (var i in this._layers) {
        t.removeLayer(this._layers[i]);
      }
    }, eachLayer: function eachLayer(t, i) {
      for (var e in this._layers) {
        t.call(i, this._layers[e]);
      }return this;
    }, getLayer: function getLayer(t) {
      return this._layers[t];
    }, getLayers: function getLayers() {
      var t = [];for (var i in this._layers) {
        t.push(this._layers[i]);
      }return t;
    }, setZIndex: function setZIndex(t) {
      return this.invoke("setZIndex", t);
    }, getLayerId: function getLayerId(t) {
      return n(t);
    } }),
      hn = function hn(t) {
    return new an(t);
  },
      un = an.extend({ addLayer: function addLayer(t) {
      return this.hasLayer(t) ? this : (t.addEventParent(this), an.prototype.addLayer.call(this, t), this.fire("layeradd", { layer: t }));
    }, removeLayer: function removeLayer(t) {
      return this.hasLayer(t) ? (t in this._layers && (t = this._layers[t]), t.removeEventParent(this), an.prototype.removeLayer.call(this, t), this.fire("layerremove", { layer: t })) : this;
    }, setStyle: function setStyle(t) {
      return this.invoke("setStyle", t);
    }, bringToFront: function bringToFront() {
      return this.invoke("bringToFront");
    }, bringToBack: function bringToBack() {
      return this.invoke("bringToBack");
    }, getBounds: function getBounds() {
      var t = new T();for (var i in this._layers) {
        var e = this._layers[i];t.extend(e.getBounds ? e.getBounds() : e.getLatLng());
      }return t;
    } }),
      ln = function ln(t) {
    return new un(t);
  },
      cn = v.extend({ initialize: function initialize(t) {
      l(this, t);
    }, createIcon: function createIcon(t) {
      return this._createIcon("icon", t);
    }, createShadow: function createShadow(t) {
      return this._createIcon("shadow", t);
    }, _createIcon: function _createIcon(t, i) {
      var e = this._getIconUrl(t);if (!e) {
        if ("icon" === t) throw new Error("iconUrl not set in Icon options (see the docs).");return null;
      }var n = this._createImg(e, i && "IMG" === i.tagName ? i : null);return this._setIconStyles(n, t), n;
    }, _setIconStyles: function _setIconStyles(t, i) {
      var e = this.options,
          n = e[i + "Size"];"number" == typeof n && (n = [n, n]);var o = w(n),
          s = w("shadow" === i && e.shadowAnchor || e.iconAnchor || o && o.divideBy(2, !0));t.className = "leaflet-marker-" + i + " " + (e.className || ""), s && (t.style.marginLeft = -s.x + "px", t.style.marginTop = -s.y + "px"), o && (t.style.width = o.x + "px", t.style.height = o.y + "px");
    }, _createImg: function _createImg(t, i) {
      return i = i || document.createElement("img"), i.src = t, i;
    }, _getIconUrl: function _getIconUrl(t) {
      return oe && this.options[t + "RetinaUrl"] || this.options[t + "Url"];
    } }),
      _n = cn.extend({ options: { iconUrl: "marker-icon.png", iconRetinaUrl: "marker-icon-2x.png", shadowUrl: "marker-shadow.png", iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], tooltipAnchor: [16, -28], shadowSize: [41, 41] }, _getIconUrl: function _getIconUrl(t) {
      return _n.imagePath || (_n.imagePath = this._detectIconPath()), (this.options.imagePath || _n.imagePath) + cn.prototype._getIconUrl.call(this, t);
    }, _detectIconPath: function _detectIconPath() {
      var t = ht("div", "leaflet-default-icon-path", document.body),
          i = at(t, "background-image") || at(t, "backgroundImage");return document.body.removeChild(t), i = null === i || 0 !== i.indexOf("url") ? "" : i.replace(/^url\([\"\']?/, "").replace(/marker-icon\.png[\"\']?\)$/, "");
    } }),
      dn = Ue.extend({ initialize: function initialize(t) {
      this._marker = t;
    }, addHooks: function addHooks() {
      var t = this._marker._icon;this._draggable || (this._draggable = new Xe(t, t, !0)), this._draggable.on({ dragstart: this._onDragStart, drag: this._onDrag, dragend: this._onDragEnd }, this).enable(), pt(t, "leaflet-marker-draggable");
    }, removeHooks: function removeHooks() {
      this._draggable.off({ dragstart: this._onDragStart, drag: this._onDrag, dragend: this._onDragEnd }, this).disable(), this._marker._icon && mt(this._marker._icon, "leaflet-marker-draggable");
    }, moved: function moved() {
      return this._draggable && this._draggable._moved;
    }, _onDragStart: function _onDragStart() {
      this._oldLatLng = this._marker.getLatLng(), this._marker.closePopup().fire("movestart").fire("dragstart");
    }, _onDrag: function _onDrag(t) {
      var i = this._marker,
          e = i._shadow,
          n = Pt(i._icon),
          o = i._map.layerPointToLatLng(n);e && Lt(e, n), i._latlng = o, t.latlng = o, t.oldLatLng = this._oldLatLng, i.fire("move", t).fire("drag", t);
    }, _onDragEnd: function _onDragEnd(t) {
      delete this._oldLatLng, this._marker.fire("moveend").fire("dragend", t);
    } }),
      pn = rn.extend({ options: { icon: new _n(), interactive: !0, draggable: !1, keyboard: !0, title: "", alt: "", zIndexOffset: 0, opacity: 1, riseOnHover: !1, riseOffset: 250, pane: "markerPane", bubblingMouseEvents: !1 }, initialize: function initialize(t, i) {
      l(this, i), this._latlng = C(t);
    }, onAdd: function onAdd(t) {
      this._zoomAnimated = this._zoomAnimated && t.options.markerZoomAnimation, this._zoomAnimated && t.on("zoomanim", this._animateZoom, this), this._initIcon(), this.update();
    }, onRemove: function onRemove(t) {
      this.dragging && this.dragging.enabled() && (this.options.draggable = !0, this.dragging.removeHooks()), delete this.dragging, this._zoomAnimated && t.off("zoomanim", this._animateZoom, this), this._removeIcon(), this._removeShadow();
    }, getEvents: function getEvents() {
      return { zoom: this.update, viewreset: this.update };
    }, getLatLng: function getLatLng() {
      return this._latlng;
    }, setLatLng: function setLatLng(t) {
      var i = this._latlng;return this._latlng = C(t), this.update(), this.fire("move", { oldLatLng: i, latlng: this._latlng });
    }, setZIndexOffset: function setZIndexOffset(t) {
      return this.options.zIndexOffset = t, this.update();
    }, setIcon: function setIcon(t) {
      return this.options.icon = t, this._map && (this._initIcon(), this.update()), this._popup && this.bindPopup(this._popup, this._popup.options), this;
    }, getElement: function getElement() {
      return this._icon;
    }, update: function update() {
      if (this._icon) {
        var t = this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t);
      }return this;
    }, _initIcon: function _initIcon() {
      var t = this.options,
          i = "leaflet-zoom-" + (this._zoomAnimated ? "animated" : "hide"),
          e = t.icon.createIcon(this._icon),
          n = !1;e !== this._icon && (this._icon && this._removeIcon(), n = !0, t.title && (e.title = t.title), t.alt && (e.alt = t.alt)), pt(e, i), t.keyboard && (e.tabIndex = "0"), this._icon = e, t.riseOnHover && this.on({ mouseover: this._bringToFront, mouseout: this._resetZIndex });var o = t.icon.createShadow(this._shadow),
          s = !1;o !== this._shadow && (this._removeShadow(), s = !0), o && (pt(o, i), o.alt = ""), this._shadow = o, t.opacity < 1 && this._updateOpacity(), n && this.getPane().appendChild(this._icon), this._initInteraction(), o && s && this.getPane("shadowPane").appendChild(this._shadow);
    }, _removeIcon: function _removeIcon() {
      this.options.riseOnHover && this.off({ mouseover: this._bringToFront, mouseout: this._resetZIndex }), ut(this._icon), this.removeInteractiveTarget(this._icon), this._icon = null;
    }, _removeShadow: function _removeShadow() {
      this._shadow && ut(this._shadow), this._shadow = null;
    }, _setPos: function _setPos(t) {
      Lt(this._icon, t), this._shadow && Lt(this._shadow, t), this._zIndex = t.y + this.options.zIndexOffset, this._resetZIndex();
    }, _updateZIndex: function _updateZIndex(t) {
      this._icon.style.zIndex = this._zIndex + t;
    }, _animateZoom: function _animateZoom(t) {
      var i = this._map._latLngToNewLayerPoint(this._latlng, t.zoom, t.center).round();this._setPos(i);
    }, _initInteraction: function _initInteraction() {
      if (this.options.interactive && (pt(this._icon, "leaflet-interactive"), this.addInteractiveTarget(this._icon), dn)) {
        var t = this.options.draggable;this.dragging && (t = this.dragging.enabled(), this.dragging.disable()), this.dragging = new dn(this), t && this.dragging.enable();
      }
    }, setOpacity: function setOpacity(t) {
      return this.options.opacity = t, this._map && this._updateOpacity(), this;
    }, _updateOpacity: function _updateOpacity() {
      var t = this.options.opacity;vt(this._icon, t), this._shadow && vt(this._shadow, t);
    }, _bringToFront: function _bringToFront() {
      this._updateZIndex(this.options.riseOffset);
    }, _resetZIndex: function _resetZIndex() {
      this._updateZIndex(0);
    }, _getPopupAnchor: function _getPopupAnchor() {
      return this.options.icon.options.popupAnchor || [0, 0];
    }, _getTooltipAnchor: function _getTooltipAnchor() {
      return this.options.icon.options.tooltipAnchor || [0, 0];
    } }),
      mn = rn.extend({ options: { stroke: !0, color: "#3388ff", weight: 3, opacity: 1, lineCap: "round", lineJoin: "round", dashArray: null, dashOffset: null, fill: !1, fillColor: null, fillOpacity: .2, fillRule: "evenodd", interactive: !0, bubblingMouseEvents: !0 }, beforeAdd: function beforeAdd(t) {
      this._renderer = t.getRenderer(this);
    }, onAdd: function onAdd() {
      this._renderer._initPath(this), this._reset(), this._renderer._addPath(this);
    }, onRemove: function onRemove() {
      this._renderer._removePath(this);
    }, redraw: function redraw() {
      return this._map && this._renderer._updatePath(this), this;
    }, setStyle: function setStyle(t) {
      return l(this, t), this._renderer && this._renderer._updateStyle(this), this;
    }, bringToFront: function bringToFront() {
      return this._renderer && this._renderer._bringToFront(this), this;
    }, bringToBack: function bringToBack() {
      return this._renderer && this._renderer._bringToBack(this), this;
    }, getElement: function getElement() {
      return this._path;
    }, _reset: function _reset() {
      this._project(), this._update();
    }, _clickTolerance: function _clickTolerance() {
      return (this.options.stroke ? this.options.weight / 2 : 0) + (ie ? 10 : 0);
    } }),
      fn = mn.extend({ options: { fill: !0, radius: 10 }, initialize: function initialize(t, i) {
      l(this, i), this._latlng = C(t), this._radius = this.options.radius;
    }, setLatLng: function setLatLng(t) {
      return this._latlng = C(t), this.redraw(), this.fire("move", { latlng: this._latlng });
    }, getLatLng: function getLatLng() {
      return this._latlng;
    }, setRadius: function setRadius(t) {
      return this.options.radius = this._radius = t, this.redraw();
    }, getRadius: function getRadius() {
      return this._radius;
    }, setStyle: function setStyle(t) {
      var i = t && t.radius || this._radius;return mn.prototype.setStyle.call(this, t), this.setRadius(i), this;
    }, _project: function _project() {
      this._point = this._map.latLngToLayerPoint(this._latlng), this._updateBounds();
    }, _updateBounds: function _updateBounds() {
      var t = this._radius,
          i = this._radiusY || t,
          e = this._clickTolerance(),
          n = [t + e, i + e];this._pxBounds = new P(this._point.subtract(n), this._point.add(n));
    }, _update: function _update() {
      this._map && this._updatePath();
    }, _updatePath: function _updatePath() {
      this._renderer._updateCircle(this);
    }, _empty: function _empty() {
      return this._radius && !this._renderer._bounds.intersects(this._pxBounds);
    }, _containsPoint: function _containsPoint(t) {
      return t.distanceTo(this._point) <= this._radius + this._clickTolerance();
    } }),
      gn = fn.extend({ initialize: function initialize(t, e, n) {
      if ("number" == typeof e && (e = i({}, n, { radius: e })), l(this, e), this._latlng = C(t), isNaN(this.options.radius)) throw new Error("Circle radius cannot be NaN");this._mRadius = this.options.radius;
    }, setRadius: function setRadius(t) {
      return this._mRadius = t, this.redraw();
    }, getRadius: function getRadius() {
      return this._mRadius;
    }, getBounds: function getBounds() {
      var t = [this._radius, this._radiusY || this._radius];return new T(this._map.layerPointToLatLng(this._point.subtract(t)), this._map.layerPointToLatLng(this._point.add(t)));
    }, setStyle: mn.prototype.setStyle, _project: function _project() {
      var t = this._latlng.lng,
          i = this._latlng.lat,
          e = this._map,
          n = e.options.crs;if (n.distance === bi.distance) {
        var o = Math.PI / 180,
            s = this._mRadius / bi.R / o,
            r = e.project([i + s, t]),
            a = e.project([i - s, t]),
            h = r.add(a).divideBy(2),
            u = e.unproject(h).lat,
            l = Math.acos((Math.cos(s * o) - Math.sin(i * o) * Math.sin(u * o)) / (Math.cos(i * o) * Math.cos(u * o))) / o;(isNaN(l) || 0 === l) && (l = s / Math.cos(Math.PI / 180 * i)), this._point = h.subtract(e.getPixelOrigin()), this._radius = isNaN(l) ? 0 : Math.max(Math.round(h.x - e.project([u, t - l]).x), 1), this._radiusY = Math.max(Math.round(h.y - r.y), 1);
      } else {
        var c = n.unproject(n.project(this._latlng).subtract([this._mRadius, 0]));this._point = e.latLngToLayerPoint(this._latlng), this._radius = this._point.x - e.latLngToLayerPoint(c).x;
      }this._updateBounds();
    } }),
      vn = mn.extend({ options: { smoothFactor: 1, noClip: !1 }, initialize: function initialize(t, i) {
      l(this, i), this._setLatLngs(t);
    }, getLatLngs: function getLatLngs() {
      return this._latlngs;
    }, setLatLngs: function setLatLngs(t) {
      return this._setLatLngs(t), this.redraw();
    }, isEmpty: function isEmpty() {
      return !this._latlngs.length;
    }, closestLayerPoint: function closestLayerPoint(t) {
      for (var i, e, n = 1 / 0, o = null, s = Nt, r = 0, a = this._parts.length; r < a; r++) {
        for (var h = this._parts[r], u = 1, l = h.length; u < l; u++) {
          i = h[u - 1], e = h[u];var c = s(t, i, e, !0);c < n && (n = c, o = s(t, i, e));
        }
      }return o && (o.distance = Math.sqrt(n)), o;
    }, getCenter: function getCenter() {
      if (!this._map) throw new Error("Must add layer to map before using getCenter()");var t,
          i,
          e,
          n,
          o,
          s,
          r,
          a = this._rings[0],
          h = a.length;if (!h) return null;for (t = 0, i = 0; t < h - 1; t++) {
        i += a[t].distanceTo(a[t + 1]) / 2;
      }if (0 === i) return this._map.layerPointToLatLng(a[0]);for (t = 0, n = 0; t < h - 1; t++) {
        if (o = a[t], s = a[t + 1], e = o.distanceTo(s), n += e, n > i) return r = (n - i) / e, this._map.layerPointToLatLng([s.x - r * (s.x - o.x), s.y - r * (s.y - o.y)]);
      }
    }, getBounds: function getBounds() {
      return this._bounds;
    }, addLatLng: function addLatLng(t, i) {
      return i = i || this._defaultShape(), t = C(t), i.push(t), this._bounds.extend(t), this.redraw();
    }, _setLatLngs: function _setLatLngs(t) {
      this._bounds = new T(), this._latlngs = this._convertLatLngs(t);
    }, _defaultShape: function _defaultShape() {
      return jt(this._latlngs) ? this._latlngs : this._latlngs[0];
    }, _convertLatLngs: function _convertLatLngs(t) {
      for (var i = [], e = jt(t), n = 0, o = t.length; n < o; n++) {
        e ? (i[n] = C(t[n]), this._bounds.extend(i[n])) : i[n] = this._convertLatLngs(t[n]);
      }return i;
    }, _project: function _project() {
      var t = new P();this._rings = [], this._projectLatlngs(this._latlngs, this._rings, t);var i = this._clickTolerance(),
          e = new x(i, i);this._bounds.isValid() && t.isValid() && (t.min._subtract(e), t.max._add(e), this._pxBounds = t);
    }, _projectLatlngs: function _projectLatlngs(t, i, e) {
      var n,
          o,
          s = t[0] instanceof M,
          r = t.length;if (s) {
        for (o = [], n = 0; n < r; n++) {
          o[n] = this._map.latLngToLayerPoint(t[n]), e.extend(o[n]);
        }i.push(o);
      } else for (n = 0; n < r; n++) {
        this._projectLatlngs(t[n], i, e);
      }
    }, _clipPoints: function _clipPoints() {
      var t = this._renderer._bounds;if (this._parts = [], this._pxBounds && this._pxBounds.intersects(t)) {
        if (this.options.noClip) return void (this._parts = this._rings);var i,
            e,
            n,
            o,
            s,
            r,
            a,
            h = this._parts;for (i = 0, n = 0, o = this._rings.length; i < o; i++) {
          for (a = this._rings[i], e = 0, s = a.length; e < s - 1; e++) {
            r = At(a[e], a[e + 1], t, e, !0), r && (h[n] = h[n] || [], h[n].push(r[0]), r[1] === a[e + 1] && e !== s - 2 || (h[n].push(r[1]), n++));
          }
        }
      }
    }, _simplifyPoints: function _simplifyPoints() {
      for (var t = this._parts, i = this.options.smoothFactor, e = 0, n = t.length; e < n; e++) {
        t[e] = Zt(t[e], i);
      }
    }, _update: function _update() {
      this._map && (this._clipPoints(), this._simplifyPoints(), this._updatePath());
    }, _updatePath: function _updatePath() {
      this._renderer._updatePoly(this);
    }, _containsPoint: function _containsPoint(t, i) {
      var e,
          n,
          o,
          s,
          r,
          a,
          h = this._clickTolerance();if (!this._pxBounds || !this._pxBounds.contains(t)) return !1;for (e = 0, s = this._parts.length; e < s; e++) {
        for (a = this._parts[e], n = 0, r = a.length, o = r - 1; n < r; o = n++) {
          if ((i || 0 !== n) && Et(t, a[o], a[n]) <= h) return !0;
        }
      }return !1;
    } }),
      yn = vn.extend({ options: { fill: !0 }, isEmpty: function isEmpty() {
      return !this._latlngs.length || !this._latlngs[0].length;
    }, getCenter: function getCenter() {
      if (!this._map) throw new Error("Must add layer to map before using getCenter()");var t,
          i,
          e,
          n,
          o,
          s,
          r,
          a,
          h,
          u = this._rings[0],
          l = u.length;if (!l) return null;for (s = r = a = 0, t = 0, i = l - 1; t < l; i = t++) {
        e = u[t], n = u[i], o = e.y * n.x - n.y * e.x, r += (e.x + n.x) * o, a += (e.y + n.y) * o, s += 3 * o;
      }return h = 0 === s ? u[0] : [r / s, a / s], this._map.layerPointToLatLng(h);
    }, _convertLatLngs: function _convertLatLngs(t) {
      var i = vn.prototype._convertLatLngs.call(this, t),
          e = i.length;return e >= 2 && i[0] instanceof M && i[0].equals(i[e - 1]) && i.pop(), i;
    }, _setLatLngs: function _setLatLngs(t) {
      vn.prototype._setLatLngs.call(this, t), jt(this._latlngs) && (this._latlngs = [this._latlngs]);
    }, _defaultShape: function _defaultShape() {
      return jt(this._latlngs[0]) ? this._latlngs[0] : this._latlngs[0][0];
    }, _clipPoints: function _clipPoints() {
      var t = this._renderer._bounds,
          i = this.options.weight,
          e = new x(i, i);if (t = new P(t.min.subtract(e), t.max.add(e)), this._parts = [], this._pxBounds && this._pxBounds.intersects(t)) {
        if (this.options.noClip) return void (this._parts = this._rings);for (var n, o = 0, s = this._rings.length; o < s; o++) {
          n = Wt(this._rings[o], t, !0), n.length && this._parts.push(n);
        }
      }
    }, _updatePath: function _updatePath() {
      this._renderer._updatePoly(this, !0);
    }, _containsPoint: function _containsPoint(t) {
      var i,
          e,
          n,
          o,
          s,
          r,
          a,
          h,
          u = !1;if (!this._pxBounds.contains(t)) return !1;for (o = 0, a = this._parts.length; o < a; o++) {
        for (i = this._parts[o], s = 0, h = i.length, r = h - 1; s < h; r = s++) {
          e = i[s], n = i[r], e.y > t.y != n.y > t.y && t.x < (n.x - e.x) * (t.y - e.y) / (n.y - e.y) + e.x && (u = !u);
        }
      }return u || vn.prototype._containsPoint.call(this, t, !0);
    } }),
      xn = un.extend({ initialize: function initialize(t, i) {
      l(this, i), this._layers = {}, t && this.addData(t);
    }, addData: function addData(t) {
      var i,
          e,
          n,
          o = mi(t) ? t : t.features;if (o) {
        for (i = 0, e = o.length; i < e; i++) {
          n = o[i], (n.geometries || n.geometry || n.features || n.coordinates) && this.addData(n);
        }return this;
      }var s = this.options;if (s.filter && !s.filter(t)) return this;var r = Kt(t, s);return r ? (r.feature = ti(t), r.defaultOptions = r.options, this.resetStyle(r), s.onEachFeature && s.onEachFeature(t, r), this.addLayer(r)) : this;
    }, resetStyle: function resetStyle(t) {
      return t.options = i({}, t.defaultOptions), this._setLayerStyle(t, this.options.style), this;
    }, setStyle: function setStyle(t) {
      return this.eachLayer(function (i) {
        this._setLayerStyle(i, t);
      }, this);
    }, _setLayerStyle: function _setLayerStyle(t, i) {
      "function" == typeof i && (i = i(t.feature)), t.setStyle && t.setStyle(i);
    } }),
      wn = { toGeoJSON: function toGeoJSON(t) {
      return Qt(this, { type: "Point", coordinates: Jt(this.getLatLng(), t) });
    } };pn.include(wn), gn.include(wn), fn.include(wn), vn.include({ toGeoJSON: function toGeoJSON(t) {
      var i = !jt(this._latlngs),
          e = $t(this._latlngs, i ? 1 : 0, !1, t);return Qt(this, { type: (i ? "Multi" : "") + "LineString", coordinates: e });
    } }), yn.include({ toGeoJSON: function toGeoJSON(t) {
      var i = !jt(this._latlngs),
          e = i && !jt(this._latlngs[0]),
          n = $t(this._latlngs, e ? 2 : i ? 1 : 0, !0, t);return i || (n = [n]), Qt(this, { type: (e ? "Multi" : "") + "Polygon", coordinates: n });
    } }), an.include({ toMultiPoint: function toMultiPoint(t) {
      var i = [];return this.eachLayer(function (e) {
        i.push(e.toGeoJSON(t).geometry.coordinates);
      }), Qt(this, { type: "MultiPoint", coordinates: i });
    }, toGeoJSON: function toGeoJSON(t) {
      var i = this.feature && this.feature.geometry && this.feature.geometry.type;if ("MultiPoint" === i) return this.toMultiPoint(t);var e = "GeometryCollection" === i,
          n = [];return this.eachLayer(function (i) {
        if (i.toGeoJSON) {
          var o = i.toGeoJSON(t);if (e) n.push(o.geometry);else {
            var s = ti(o);"FeatureCollection" === s.type ? n.push.apply(n, s.features) : n.push(s);
          }
        }
      }), e ? Qt(this, { geometries: n, type: "GeometryCollection" }) : { type: "FeatureCollection", features: n };
    } });var Ln = ii,
      Pn = rn.extend({ options: { opacity: 1, alt: "", interactive: !1, crossOrigin: !1, errorOverlayUrl: "", zIndex: 1, className: "" }, initialize: function initialize(t, i, e) {
      this._url = t, this._bounds = z(i), l(this, e);
    }, onAdd: function onAdd() {
      this._image || (this._initImage(), this.options.opacity < 1 && this._updateOpacity()), this.options.interactive && (pt(this._image, "leaflet-interactive"), this.addInteractiveTarget(this._image)), this.getPane().appendChild(this._image), this._reset();
    }, onRemove: function onRemove() {
      ut(this._image), this.options.interactive && this.removeInteractiveTarget(this._image);
    }, setOpacity: function setOpacity(t) {
      return this.options.opacity = t, this._image && this._updateOpacity(), this;
    }, setStyle: function setStyle(t) {
      return t.opacity && this.setOpacity(t.opacity), this;
    }, bringToFront: function bringToFront() {
      return this._map && ct(this._image), this;
    }, bringToBack: function bringToBack() {
      return this._map && _t(this._image), this;
    }, setUrl: function setUrl(t) {
      return this._url = t, this._image && (this._image.src = t), this;
    }, setBounds: function setBounds(t) {
      return this._bounds = t, this._map && this._reset(), this;
    }, getEvents: function getEvents() {
      var t = { zoom: this._reset, viewreset: this._reset };return this._zoomAnimated && (t.zoomanim = this._animateZoom), t;
    }, setZIndex: function setZIndex(t) {
      return this.options.zIndex = t, this._updateZIndex(), this;
    }, getBounds: function getBounds() {
      return this._bounds;
    }, getElement: function getElement() {
      return this._image;
    }, _initImage: function _initImage() {
      var t = this._image = ht("img", "leaflet-image-layer " + (this._zoomAnimated ? "leaflet-zoom-animated" : "") + (this.options.className || ""));t.onselectstart = r, t.onmousemove = r, t.onload = e(this.fire, this, "load"), t.onerror = e(this._overlayOnError, this, "error"), this.options.crossOrigin && (t.crossOrigin = ""), this.options.zIndex && this._updateZIndex(), t.src = this._url, t.alt = this.options.alt;
    }, _animateZoom: function _animateZoom(t) {
      var i = this._map.getZoomScale(t.zoom),
          e = this._map._latLngBoundsToNewLayerBounds(this._bounds, t.zoom, t.center).min;wt(this._image, e, i);
    }, _reset: function _reset() {
      var t = this._image,
          i = new P(this._map.latLngToLayerPoint(this._bounds.getNorthWest()), this._map.latLngToLayerPoint(this._bounds.getSouthEast())),
          e = i.getSize();Lt(t, i.min), t.style.width = e.x + "px", t.style.height = e.y + "px";
    }, _updateOpacity: function _updateOpacity() {
      vt(this._image, this.options.opacity);
    }, _updateZIndex: function _updateZIndex() {
      this._image && void 0 !== this.options.zIndex && null !== this.options.zIndex && (this._image.style.zIndex = this.options.zIndex);
    }, _overlayOnError: function _overlayOnError() {
      this.fire("error");var t = this.options.errorOverlayUrl;t && this._url !== t && (this._url = t, this._image.src = t);
    } }),
      bn = function bn(t, i, e) {
    return new Pn(t, i, e);
  },
      Tn = Pn.extend({ options: { autoplay: !0, loop: !0 }, _initImage: function _initImage() {
      var t = this._image = ht("video", "leaflet-image-layer " + (this._zoomAnimated ? "leaflet-zoom-animated" : ""));t.onselectstart = r, t.onmousemove = r, t.onloadeddata = e(this.fire, this, "load"), mi(this._url) || (this._url = [this._url]), t.autoplay = !!this.options.autoplay, t.loop = !!this.options.loop;for (var i = 0; i < this._url.length; i++) {
        var n = ht("source");n.src = this._url[i], t.appendChild(n);
      }
    } }),
      zn = rn.extend({ options: { offset: [0, 7], className: "", pane: "popupPane" }, initialize: function initialize(t, i) {
      l(this, t), this._source = i;
    }, onAdd: function onAdd(t) {
      this._zoomAnimated = t._zoomAnimated, this._container || this._initLayout(), t._fadeAnimated && vt(this._container, 0), clearTimeout(this._removeTimeout), this.getPane().appendChild(this._container), this.update(), t._fadeAnimated && vt(this._container, 1), this.bringToFront();
    }, onRemove: function onRemove(t) {
      t._fadeAnimated ? (vt(this._container, 0), this._removeTimeout = setTimeout(e(ut, void 0, this._container), 200)) : ut(this._container);
    }, getLatLng: function getLatLng() {
      return this._latlng;
    }, setLatLng: function setLatLng(t) {
      return this._latlng = C(t), this._map && (this._updatePosition(), this._adjustPan()), this;
    }, getContent: function getContent() {
      return this._content;
    }, setContent: function setContent(t) {
      return this._content = t, this.update(), this;
    }, getElement: function getElement() {
      return this._container;
    }, update: function update() {
      this._map && (this._container.style.visibility = "hidden", this._updateContent(), this._updateLayout(), this._updatePosition(), this._container.style.visibility = "", this._adjustPan());
    }, getEvents: function getEvents() {
      var t = { zoom: this._updatePosition, viewreset: this._updatePosition };return this._zoomAnimated && (t.zoomanim = this._animateZoom), t;
    }, isOpen: function isOpen() {
      return !!this._map && this._map.hasLayer(this);
    }, bringToFront: function bringToFront() {
      return this._map && ct(this._container), this;
    }, bringToBack: function bringToBack() {
      return this._map && _t(this._container), this;
    }, _updateContent: function _updateContent() {
      if (this._content) {
        var t = this._contentNode,
            i = "function" == typeof this._content ? this._content(this._source || this) : this._content;if ("string" == typeof i) t.innerHTML = i;else {
          for (; t.hasChildNodes();) {
            t.removeChild(t.firstChild);
          }t.appendChild(i);
        }this.fire("contentupdate");
      }
    }, _updatePosition: function _updatePosition() {
      if (this._map) {
        var t = this._map.latLngToLayerPoint(this._latlng),
            i = w(this.options.offset),
            e = this._getAnchor();this._zoomAnimated ? Lt(this._container, t.add(e)) : i = i.add(t).add(e);var n = this._containerBottom = -i.y,
            o = this._containerLeft = -Math.round(this._containerWidth / 2) + i.x;this._container.style.bottom = n + "px", this._container.style.left = o + "px";
      }
    }, _getAnchor: function _getAnchor() {
      return [0, 0];
    } }),
      Mn = zn.extend({ options: { maxWidth: 300, minWidth: 50, maxHeight: null, autoPan: !0, autoPanPaddingTopLeft: null, autoPanPaddingBottomRight: null, autoPanPadding: [5, 5], keepInView: !1, closeButton: !0, autoClose: !0, className: "" }, openOn: function openOn(t) {
      return t.openPopup(this), this;
    }, onAdd: function onAdd(t) {
      zn.prototype.onAdd.call(this, t), t.fire("popupopen", { popup: this }), this._source && (this._source.fire("popupopen", { popup: this }, !0), this._source instanceof mn || this._source.on("preclick", Y));
    }, onRemove: function onRemove(t) {
      zn.prototype.onRemove.call(this, t), t.fire("popupclose", { popup: this }), this._source && (this._source.fire("popupclose", { popup: this }, !0), this._source instanceof mn || this._source.off("preclick", Y));
    }, getEvents: function getEvents() {
      var t = zn.prototype.getEvents.call(this);return (void 0 !== this.options.closeOnClick ? this.options.closeOnClick : this._map.options.closePopupOnClick) && (t.preclick = this._close), this.options.keepInView && (t.moveend = this._adjustPan), t;
    }, _close: function _close() {
      this._map && this._map.closePopup(this);
    }, _initLayout: function _initLayout() {
      var t = "leaflet-popup",
          i = this._container = ht("div", t + " " + (this.options.className || "") + " leaflet-zoom-animated"),
          e = this._wrapper = ht("div", t + "-content-wrapper", i);if (this._contentNode = ht("div", t + "-content", e), J(e), X(this._contentNode), V(e, "contextmenu", Y), this._tipContainer = ht("div", t + "-tip-container", i), this._tip = ht("div", t + "-tip", this._tipContainer), this.options.closeButton) {
        var n = this._closeButton = ht("a", t + "-close-button", i);n.href = "#close", n.innerHTML = "&#215;", V(n, "click", this._onCloseButtonClick, this);
      }
    }, _updateLayout: function _updateLayout() {
      var t = this._contentNode,
          i = t.style;i.width = "", i.whiteSpace = "nowrap";var e = t.offsetWidth;e = Math.min(e, this.options.maxWidth), e = Math.max(e, this.options.minWidth), i.width = e + 1 + "px", i.whiteSpace = "", i.height = "";var n = t.offsetHeight,
          o = this.options.maxHeight,
          s = "leaflet-popup-scrolled";o && n > o ? (i.height = o + "px", pt(t, s)) : mt(t, s), this._containerWidth = this._container.offsetWidth;
    }, _animateZoom: function _animateZoom(t) {
      var i = this._map._latLngToNewLayerPoint(this._latlng, t.zoom, t.center),
          e = this._getAnchor();Lt(this._container, i.add(e));
    }, _adjustPan: function _adjustPan() {
      if (!(!this.options.autoPan || this._map._panAnim && this._map._panAnim._inProgress)) {
        var t = this._map,
            i = parseInt(at(this._container, "marginBottom"), 10) || 0,
            e = this._container.offsetHeight + i,
            n = this._containerWidth,
            o = new x(this._containerLeft, -e - this._containerBottom);o._add(Pt(this._container));var s = t.layerPointToContainerPoint(o),
            r = w(this.options.autoPanPadding),
            a = w(this.options.autoPanPaddingTopLeft || r),
            h = w(this.options.autoPanPaddingBottomRight || r),
            u = t.getSize(),
            l = 0,
            c = 0;s.x + n + h.x > u.x && (l = s.x + n - u.x + h.x), s.x - l - a.x < 0 && (l = s.x - a.x), s.y + e + h.y > u.y && (c = s.y + e - u.y + h.y), s.y - c - a.y < 0 && (c = s.y - a.y), (l || c) && t.fire("autopanstart").panBy([l, c]);
      }
    }, _onCloseButtonClick: function _onCloseButtonClick(t) {
      this._close(), Q(t);
    }, _getAnchor: function _getAnchor() {
      return w(this._source && this._source._getPopupAnchor ? this._source._getPopupAnchor() : [0, 0]);
    } }),
      Cn = function Cn(t, i) {
    return new Mn(t, i);
  };ke.mergeOptions({ closePopupOnClick: !0 }), ke.include({ openPopup: function openPopup(t, i, e) {
      return t instanceof Mn || (t = new Mn(e).setContent(t)), i && t.setLatLng(i), this.hasLayer(t) ? this : (this._popup && this._popup.options.autoClose && this.closePopup(), this._popup = t, this.addLayer(t));
    }, closePopup: function closePopup(t) {
      return t && t !== this._popup || (t = this._popup, this._popup = null), t && this.removeLayer(t), this;
    } }), rn.include({ bindPopup: function bindPopup(t, i) {
      return t instanceof Mn ? (l(t, i), this._popup = t, t._source = this) : (this._popup && !i || (this._popup = new Mn(i, this)), this._popup.setContent(t)), this._popupHandlersAdded || (this.on({ click: this._openPopup, keypress: this._onKeyPress, remove: this.closePopup, move: this._movePopup }), this._popupHandlersAdded = !0), this;
    }, unbindPopup: function unbindPopup() {
      return this._popup && (this.off({ click: this._openPopup, keypress: this._onKeyPress, remove: this.closePopup, move: this._movePopup }), this._popupHandlersAdded = !1, this._popup = null), this;
    }, openPopup: function openPopup(t, i) {
      if (t instanceof rn || (i = t, t = this), t instanceof un) for (var e in this._layers) {
        t = this._layers[e];break;
      }return i || (i = t.getCenter ? t.getCenter() : t.getLatLng()), this._popup && this._map && (this._popup._source = t, this._popup.update(), this._map.openPopup(this._popup, i)), this;
    }, closePopup: function closePopup() {
      return this._popup && this._popup._close(), this;
    }, togglePopup: function togglePopup(t) {
      return this._popup && (this._popup._map ? this.closePopup() : this.openPopup(t)), this;
    }, isPopupOpen: function isPopupOpen() {
      return !!this._popup && this._popup.isOpen();
    }, setPopupContent: function setPopupContent(t) {
      return this._popup && this._popup.setContent(t), this;
    }, getPopup: function getPopup() {
      return this._popup;
    }, _openPopup: function _openPopup(t) {
      var i = t.layer || t.target;if (this._popup && this._map) return Q(t), i instanceof mn ? void this.openPopup(t.layer || t.target, t.latlng) : void (this._map.hasLayer(this._popup) && this._popup._source === i ? this.closePopup() : this.openPopup(i, t.latlng));
    }, _movePopup: function _movePopup(t) {
      this._popup.setLatLng(t.latlng);
    }, _onKeyPress: function _onKeyPress(t) {
      13 === t.originalEvent.keyCode && this._openPopup(t);
    } });var Zn = zn.extend({ options: { pane: "tooltipPane", offset: [0, 0], direction: "auto", permanent: !1, sticky: !1, interactive: !1, opacity: .9 }, onAdd: function onAdd(t) {
      zn.prototype.onAdd.call(this, t), this.setOpacity(this.options.opacity), t.fire("tooltipopen", { tooltip: this }), this._source && this._source.fire("tooltipopen", { tooltip: this }, !0);
    }, onRemove: function onRemove(t) {
      zn.prototype.onRemove.call(this, t), t.fire("tooltipclose", { tooltip: this }), this._source && this._source.fire("tooltipclose", { tooltip: this }, !0);
    }, getEvents: function getEvents() {
      var t = zn.prototype.getEvents.call(this);return ie && !this.options.permanent && (t.preclick = this._close), t;
    }, _close: function _close() {
      this._map && this._map.closeTooltip(this);
    }, _initLayout: function _initLayout() {
      var t = "leaflet-tooltip",
          i = t + " " + (this.options.className || "") + " leaflet-zoom-" + (this._zoomAnimated ? "animated" : "hide");this._contentNode = this._container = ht("div", i);
    }, _updateLayout: function _updateLayout() {}, _adjustPan: function _adjustPan() {}, _setPosition: function _setPosition(t) {
      var i = this._map,
          e = this._container,
          n = i.latLngToContainerPoint(i.getCenter()),
          o = i.layerPointToContainerPoint(t),
          s = this.options.direction,
          r = e.offsetWidth,
          a = e.offsetHeight,
          h = w(this.options.offset),
          u = this._getAnchor();"top" === s ? t = t.add(w(-r / 2 + h.x, -a + h.y + u.y, !0)) : "bottom" === s ? t = t.subtract(w(r / 2 - h.x, -h.y, !0)) : "center" === s ? t = t.subtract(w(r / 2 + h.x, a / 2 - u.y + h.y, !0)) : "right" === s || "auto" === s && o.x < n.x ? (s = "right", t = t.add(w(h.x + u.x, u.y - a / 2 + h.y, !0))) : (s = "left", t = t.subtract(w(r + u.x - h.x, a / 2 - u.y - h.y, !0))), mt(e, "leaflet-tooltip-right"), mt(e, "leaflet-tooltip-left"), mt(e, "leaflet-tooltip-top"), mt(e, "leaflet-tooltip-bottom"), pt(e, "leaflet-tooltip-" + s), Lt(e, t);
    }, _updatePosition: function _updatePosition() {
      var t = this._map.latLngToLayerPoint(this._latlng);this._setPosition(t);
    }, setOpacity: function setOpacity(t) {
      this.options.opacity = t, this._container && vt(this._container, t);
    }, _animateZoom: function _animateZoom(t) {
      var i = this._map._latLngToNewLayerPoint(this._latlng, t.zoom, t.center);this._setPosition(i);
    }, _getAnchor: function _getAnchor() {
      return w(this._source && this._source._getTooltipAnchor && !this.options.sticky ? this._source._getTooltipAnchor() : [0, 0]);
    } }),
      En = function En(t, i) {
    return new Zn(t, i);
  };ke.include({ openTooltip: function openTooltip(t, i, e) {
      return t instanceof Zn || (t = new Zn(e).setContent(t)), i && t.setLatLng(i), this.hasLayer(t) ? this : this.addLayer(t);
    }, closeTooltip: function closeTooltip(t) {
      return t && this.removeLayer(t), this;
    } }), rn.include({ bindTooltip: function bindTooltip(t, i) {
      return t instanceof Zn ? (l(t, i), this._tooltip = t, t._source = this) : (this._tooltip && !i || (this._tooltip = new Zn(i, this)), this._tooltip.setContent(t)), this._initTooltipInteractions(), this._tooltip.options.permanent && this._map && this._map.hasLayer(this) && this.openTooltip(), this;
    }, unbindTooltip: function unbindTooltip() {
      return this._tooltip && (this._initTooltipInteractions(!0), this.closeTooltip(), this._tooltip = null), this;
    }, _initTooltipInteractions: function _initTooltipInteractions(t) {
      if (t || !this._tooltipHandlersAdded) {
        var i = t ? "off" : "on",
            e = { remove: this.closeTooltip, move: this._moveTooltip };this._tooltip.options.permanent ? e.add = this._openTooltip : (e.mouseover = this._openTooltip, e.mouseout = this.closeTooltip, this._tooltip.options.sticky && (e.mousemove = this._moveTooltip), ie && (e.click = this._openTooltip)), this[i](e), this._tooltipHandlersAdded = !t;
      }
    }, openTooltip: function openTooltip(t, i) {
      if (t instanceof rn || (i = t, t = this), t instanceof un) for (var e in this._layers) {
        t = this._layers[e];break;
      }return i || (i = t.getCenter ? t.getCenter() : t.getLatLng()), this._tooltip && this._map && (this._tooltip._source = t, this._tooltip.update(), this._map.openTooltip(this._tooltip, i), this._tooltip.options.interactive && this._tooltip._container && (pt(this._tooltip._container, "leaflet-clickable"), this.addInteractiveTarget(this._tooltip._container))), this;
    }, closeTooltip: function closeTooltip() {
      return this._tooltip && (this._tooltip._close(), this._tooltip.options.interactive && this._tooltip._container && (mt(this._tooltip._container, "leaflet-clickable"), this.removeInteractiveTarget(this._tooltip._container))), this;
    }, toggleTooltip: function toggleTooltip(t) {
      return this._tooltip && (this._tooltip._map ? this.closeTooltip() : this.openTooltip(t)), this;
    }, isTooltipOpen: function isTooltipOpen() {
      return this._tooltip.isOpen();
    }, setTooltipContent: function setTooltipContent(t) {
      return this._tooltip && this._tooltip.setContent(t), this;
    }, getTooltip: function getTooltip() {
      return this._tooltip;
    }, _openTooltip: function _openTooltip(t) {
      var i = t.layer || t.target;this._tooltip && this._map && this.openTooltip(i, this._tooltip.options.sticky ? t.latlng : void 0);
    }, _moveTooltip: function _moveTooltip(t) {
      var i,
          e,
          n = t.latlng;this._tooltip.options.sticky && t.originalEvent && (i = this._map.mouseEventToContainerPoint(t.originalEvent), e = this._map.containerPointToLayerPoint(i), n = this._map.layerPointToLatLng(e)), this._tooltip.setLatLng(n);
    } });var Sn = cn.extend({ options: { iconSize: [12, 12], html: !1, bgPos: null, className: "leaflet-div-icon" }, createIcon: function createIcon(t) {
      var i = t && "DIV" === t.tagName ? t : document.createElement("div"),
          e = this.options;if (i.innerHTML = e.html !== !1 ? e.html : "", e.bgPos) {
        var n = w(e.bgPos);i.style.backgroundPosition = -n.x + "px " + -n.y + "px";
      }return this._setIconStyles(i, "icon"), i;
    }, createShadow: function createShadow() {
      return null;
    } });cn.Default = _n;var kn = rn.extend({ options: { tileSize: 256, opacity: 1, updateWhenIdle: Xi, updateWhenZooming: !0, updateInterval: 200, zIndex: 1, bounds: null, minZoom: 0, maxZoom: void 0, maxNativeZoom: void 0, minNativeZoom: void 0, noWrap: !1, pane: "tilePane", className: "", keepBuffer: 2 }, initialize: function initialize(t) {
      l(this, t);
    }, onAdd: function onAdd() {
      this._initContainer(), this._levels = {}, this._tiles = {}, this._resetView(), this._update();
    }, beforeAdd: function beforeAdd(t) {
      t._addZoomLimit(this);
    }, onRemove: function onRemove(t) {
      this._removeAllTiles(), ut(this._container), t._removeZoomLimit(this), this._container = null, this._tileZoom = null;
    }, bringToFront: function bringToFront() {
      return this._map && (ct(this._container), this._setAutoZIndex(Math.max)), this;
    }, bringToBack: function bringToBack() {
      return this._map && (_t(this._container), this._setAutoZIndex(Math.min)), this;
    }, getContainer: function getContainer() {
      return this._container;
    }, setOpacity: function setOpacity(t) {
      return this.options.opacity = t, this._updateOpacity(), this;
    }, setZIndex: function setZIndex(t) {
      return this.options.zIndex = t, this._updateZIndex(), this;
    }, isLoading: function isLoading() {
      return this._loading;
    }, redraw: function redraw() {
      return this._map && (this._removeAllTiles(), this._update()), this;
    }, getEvents: function getEvents() {
      var t = { viewprereset: this._invalidateAll, viewreset: this._resetView, zoom: this._resetView, moveend: this._onMoveEnd };return this.options.updateWhenIdle || (this._onMove || (this._onMove = o(this._onMoveEnd, this.options.updateInterval, this)), t.move = this._onMove), this._zoomAnimated && (t.zoomanim = this._animateZoom), t;
    }, createTile: function createTile() {
      return document.createElement("div");
    }, getTileSize: function getTileSize() {
      var t = this.options.tileSize;return t instanceof x ? t : new x(t, t);
    }, _updateZIndex: function _updateZIndex() {
      this._container && void 0 !== this.options.zIndex && null !== this.options.zIndex && (this._container.style.zIndex = this.options.zIndex);
    }, _setAutoZIndex: function _setAutoZIndex(t) {
      for (var i, e = this.getPane().children, n = -t(-(1 / 0), 1 / 0), o = 0, s = e.length; o < s; o++) {
        i = e[o].style.zIndex, e[o] !== this._container && i && (n = t(n, +i));
      }isFinite(n) && (this.options.zIndex = n + t(-1, 1), this._updateZIndex());
    }, _updateOpacity: function _updateOpacity() {
      if (this._map && !Ii) {
        vt(this._container, this.options.opacity);var t = +new Date(),
            i = !1,
            e = !1;for (var n in this._tiles) {
          var o = this._tiles[n];if (o.current && o.loaded) {
            var s = Math.min(1, (t - o.loaded) / 200);vt(o.el, s), s < 1 ? i = !0 : (o.active ? e = !0 : this._onOpaqueTile(o), o.active = !0);
          }
        }e && !this._noPrune && this._pruneTiles(), i && (g(this._fadeFrame), this._fadeFrame = f(this._updateOpacity, this));
      }
    }, _onOpaqueTile: r, _initContainer: function _initContainer() {
      this._container || (this._container = ht("div", "leaflet-layer " + (this.options.className || "")), this._updateZIndex(), this.options.opacity < 1 && this._updateOpacity(), this.getPane().appendChild(this._container));
    }, _updateLevels: function _updateLevels() {
      var t = this._tileZoom,
          i = this.options.maxZoom;if (void 0 !== t) {
        for (var e in this._levels) {
          this._levels[e].el.children.length || e === t ? (this._levels[e].el.style.zIndex = i - Math.abs(t - e), this._onUpdateLevel(e)) : (ut(this._levels[e].el), this._removeTilesAtZoom(e), this._onRemoveLevel(e), delete this._levels[e]);
        }var n = this._levels[t],
            o = this._map;return n || (n = this._levels[t] = {}, n.el = ht("div", "leaflet-tile-container leaflet-zoom-animated", this._container), n.el.style.zIndex = i, n.origin = o.project(o.unproject(o.getPixelOrigin()), t).round(), n.zoom = t, this._setZoomTransform(n, o.getCenter(), o.getZoom()), r(n.el.offsetWidth), this._onCreateLevel(n)), this._level = n, n;
      }
    }, _onUpdateLevel: r, _onRemoveLevel: r, _onCreateLevel: r, _pruneTiles: function _pruneTiles() {
      if (this._map) {
        var t,
            i,
            e = this._map.getZoom();if (e > this.options.maxZoom || e < this.options.minZoom) return void this._removeAllTiles();for (t in this._tiles) {
          i = this._tiles[t], i.retain = i.current;
        }for (t in this._tiles) {
          if (i = this._tiles[t], i.current && !i.active) {
            var n = i.coords;this._retainParent(n.x, n.y, n.z, n.z - 5) || this._retainChildren(n.x, n.y, n.z, n.z + 2);
          }
        }for (t in this._tiles) {
          this._tiles[t].retain || this._removeTile(t);
        }
      }
    }, _removeTilesAtZoom: function _removeTilesAtZoom(t) {
      for (var i in this._tiles) {
        this._tiles[i].coords.z === t && this._removeTile(i);
      }
    }, _removeAllTiles: function _removeAllTiles() {
      for (var t in this._tiles) {
        this._removeTile(t);
      }
    }, _invalidateAll: function _invalidateAll() {
      for (var t in this._levels) {
        ut(this._levels[t].el), this._onRemoveLevel(t), delete this._levels[t];
      }this._removeAllTiles(), this._tileZoom = null;
    }, _retainParent: function _retainParent(t, i, e, n) {
      var o = Math.floor(t / 2),
          s = Math.floor(i / 2),
          r = e - 1,
          a = new x(+o, +s);a.z = +r;var h = this._tileCoordsToKey(a),
          u = this._tiles[h];return u && u.active ? (u.retain = !0, !0) : (u && u.loaded && (u.retain = !0), r > n && this._retainParent(o, s, r, n));
    }, _retainChildren: function _retainChildren(t, i, e, n) {
      for (var o = 2 * t; o < 2 * t + 2; o++) {
        for (var s = 2 * i; s < 2 * i + 2; s++) {
          var r = new x(o, s);r.z = e + 1;var a = this._tileCoordsToKey(r),
              h = this._tiles[a];h && h.active ? h.retain = !0 : (h && h.loaded && (h.retain = !0), e + 1 < n && this._retainChildren(o, s, e + 1, n));
        }
      }
    }, _resetView: function _resetView(t) {
      var i = t && (t.pinch || t.flyTo);this._setView(this._map.getCenter(), this._map.getZoom(), i, i);
    }, _animateZoom: function _animateZoom(t) {
      this._setView(t.center, t.zoom, !0, t.noUpdate);
    }, _clampZoom: function _clampZoom(t) {
      var i = this.options;return void 0 !== i.minNativeZoom && t < i.minNativeZoom ? i.minNativeZoom : void 0 !== i.maxNativeZoom && i.maxNativeZoom < t ? i.maxNativeZoom : t;
    }, _setView: function _setView(t, i, e, n) {
      var o = this._clampZoom(Math.round(i));(void 0 !== this.options.maxZoom && o > this.options.maxZoom || void 0 !== this.options.minZoom && o < this.options.minZoom) && (o = void 0);var s = this.options.updateWhenZooming && o !== this._tileZoom;n && !s || (this._tileZoom = o, this._abortLoading && this._abortLoading(), this._updateLevels(), this._resetGrid(), void 0 !== o && this._update(t), e || this._pruneTiles(), this._noPrune = !!e), this._setZoomTransforms(t, i);
    }, _setZoomTransforms: function _setZoomTransforms(t, i) {
      for (var e in this._levels) {
        this._setZoomTransform(this._levels[e], t, i);
      }
    }, _setZoomTransform: function _setZoomTransform(t, i, e) {
      var n = this._map.getZoomScale(e, t.zoom),
          o = t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(i, e)).round();Yi ? wt(t.el, o, n) : Lt(t.el, o);
    }, _resetGrid: function _resetGrid() {
      var t = this._map,
          i = t.options.crs,
          e = this._tileSize = this.getTileSize(),
          n = this._tileZoom,
          o = this._map.getPixelWorldBounds(this._tileZoom);o && (this._globalTileRange = this._pxBoundsToTileRange(o)), this._wrapX = i.wrapLng && !this.options.noWrap && [Math.floor(t.project([0, i.wrapLng[0]], n).x / e.x), Math.ceil(t.project([0, i.wrapLng[1]], n).x / e.y)], this._wrapY = i.wrapLat && !this.options.noWrap && [Math.floor(t.project([i.wrapLat[0], 0], n).y / e.x), Math.ceil(t.project([i.wrapLat[1], 0], n).y / e.y)];
    }, _onMoveEnd: function _onMoveEnd() {
      this._map && !this._map._animatingZoom && this._update();
    }, _getTiledPixelBounds: function _getTiledPixelBounds(t) {
      var i = this._map,
          e = i._animatingZoom ? Math.max(i._animateToZoom, i.getZoom()) : i.getZoom(),
          n = i.getZoomScale(e, this._tileZoom),
          o = i.project(t, this._tileZoom).floor(),
          s = i.getSize().divideBy(2 * n);return new P(o.subtract(s), o.add(s));
    }, _update: function _update(t) {
      var i = this._map;if (i) {
        var e = this._clampZoom(i.getZoom());if (void 0 === t && (t = i.getCenter()), void 0 !== this._tileZoom) {
          var n = this._getTiledPixelBounds(t),
              o = this._pxBoundsToTileRange(n),
              s = o.getCenter(),
              r = [],
              a = this.options.keepBuffer,
              h = new P(o.getBottomLeft().subtract([a, -a]), o.getTopRight().add([a, -a]));if (!(isFinite(o.min.x) && isFinite(o.min.y) && isFinite(o.max.x) && isFinite(o.max.y))) throw new Error("Attempted to load an infinite number of tiles");for (var u in this._tiles) {
            var l = this._tiles[u].coords;l.z === this._tileZoom && h.contains(new x(l.x, l.y)) || (this._tiles[u].current = !1);
          }if (Math.abs(e - this._tileZoom) > 1) return void this._setView(t, e);for (var c = o.min.y; c <= o.max.y; c++) {
            for (var _ = o.min.x; _ <= o.max.x; _++) {
              var d = new x(_, c);d.z = this._tileZoom, this._isValidTile(d) && (this._tiles[this._tileCoordsToKey(d)] || r.push(d));
            }
          }if (r.sort(function (t, i) {
            return t.distanceTo(s) - i.distanceTo(s);
          }), 0 !== r.length) {
            this._loading || (this._loading = !0, this.fire("loading"));var p = document.createDocumentFragment();for (_ = 0; _ < r.length; _++) {
              this._addTile(r[_], p);
            }this._level.el.appendChild(p);
          }
        }
      }
    }, _isValidTile: function _isValidTile(t) {
      var i = this._map.options.crs;if (!i.infinite) {
        var e = this._globalTileRange;if (!i.wrapLng && (t.x < e.min.x || t.x > e.max.x) || !i.wrapLat && (t.y < e.min.y || t.y > e.max.y)) return !1;
      }if (!this.options.bounds) return !0;var n = this._tileCoordsToBounds(t);return z(this.options.bounds).overlaps(n);
    }, _keyToBounds: function _keyToBounds(t) {
      return this._tileCoordsToBounds(this._keyToTileCoords(t));
    }, _tileCoordsToBounds: function _tileCoordsToBounds(t) {
      var i = this._map,
          e = this.getTileSize(),
          n = t.scaleBy(e),
          o = n.add(e),
          s = i.unproject(n, t.z),
          r = i.unproject(o, t.z),
          a = new T(s, r);return this.options.noWrap || i.wrapLatLngBounds(a), a;
    }, _tileCoordsToKey: function _tileCoordsToKey(t) {
      return t.x + ":" + t.y + ":" + t.z;
    }, _keyToTileCoords: function _keyToTileCoords(t) {
      var i = t.split(":"),
          e = new x(+i[0], +i[1]);return e.z = +i[2], e;
    }, _removeTile: function _removeTile(t) {
      var i = this._tiles[t];i && (ut(i.el), delete this._tiles[t], this.fire("tileunload", { tile: i.el, coords: this._keyToTileCoords(t) }));
    }, _initTile: function _initTile(t) {
      pt(t, "leaflet-tile");var i = this.getTileSize();t.style.width = i.x + "px", t.style.height = i.y + "px", t.onselectstart = r, t.onmousemove = r, Ii && this.options.opacity < 1 && vt(t, this.options.opacity), Ri && !Di && (t.style.WebkitBackfaceVisibility = "hidden");
    }, _addTile: function _addTile(t, i) {
      var n = this._getTilePos(t),
          o = this._tileCoordsToKey(t),
          s = this.createTile(this._wrapCoords(t), e(this._tileReady, this, t));this._initTile(s), this.createTile.length < 2 && f(e(this._tileReady, this, t, null, s)), Lt(s, n), this._tiles[o] = { el: s, coords: t, current: !0 }, i.appendChild(s), this.fire("tileloadstart", { tile: s, coords: t });
    }, _tileReady: function _tileReady(t, i, n) {
      if (this._map) {
        i && this.fire("tileerror", { error: i, tile: n, coords: t });var o = this._tileCoordsToKey(t);n = this._tiles[o], n && (n.loaded = +new Date(), this._map._fadeAnimated ? (vt(n.el, 0), g(this._fadeFrame), this._fadeFrame = f(this._updateOpacity, this)) : (n.active = !0, this._pruneTiles()), i || (pt(n.el, "leaflet-tile-loaded"), this.fire("tileload", { tile: n.el, coords: t })), this._noTilesToLoad() && (this._loading = !1, this.fire("load"), Ii || !this._map._fadeAnimated ? f(this._pruneTiles, this) : setTimeout(e(this._pruneTiles, this), 250)));
      }
    }, _getTilePos: function _getTilePos(t) {
      return t.scaleBy(this.getTileSize()).subtract(this._level.origin);
    }, _wrapCoords: function _wrapCoords(t) {
      var i = new x(this._wrapX ? s(t.x, this._wrapX) : t.x, this._wrapY ? s(t.y, this._wrapY) : t.y);return i.z = t.z, i;
    }, _pxBoundsToTileRange: function _pxBoundsToTileRange(t) {
      var i = this.getTileSize();return new P(t.min.unscaleBy(i).floor(), t.max.unscaleBy(i).ceil().subtract([1, 1]));
    }, _noTilesToLoad: function _noTilesToLoad() {
      for (var t in this._tiles) {
        if (!this._tiles[t].loaded) return !1;
      }return !0;
    } }),
      Bn = kn.extend({ options: { minZoom: 0, maxZoom: 18, subdomains: "abc", errorTileUrl: "", zoomOffset: 0, tms: !1, zoomReverse: !1, detectRetina: !1, crossOrigin: !1 }, initialize: function initialize(t, i) {
      this._url = t, i = l(this, i), i.detectRetina && oe && i.maxZoom > 0 && (i.tileSize = Math.floor(i.tileSize / 2), i.zoomReverse ? (i.zoomOffset--, i.minZoom++) : (i.zoomOffset++, i.maxZoom--), i.minZoom = Math.max(0, i.minZoom)), "string" == typeof i.subdomains && (i.subdomains = i.subdomains.split("")), Ri || this.on("tileunload", this._onTileRemove);
    }, setUrl: function setUrl(t, i) {
      return this._url = t, i || this.redraw(), this;
    }, createTile: function createTile(t, i) {
      var n = document.createElement("img");return V(n, "load", e(this._tileOnLoad, this, i, n)), V(n, "error", e(this._tileOnError, this, i, n)), this.options.crossOrigin && (n.crossOrigin = ""), n.alt = "", n.setAttribute("role", "presentation"), n.src = this.getTileUrl(t), n;
    }, getTileUrl: function getTileUrl(t) {
      var e = { r: oe ? "@2x" : "", s: this._getSubdomain(t), x: t.x, y: t.y, z: this._getZoomForUrl() };if (this._map && !this._map.options.crs.infinite) {
        var n = this._globalTileRange.max.y - t.y;this.options.tms && (e.y = n), e["-y"] = n;
      }return _(this._url, i(e, this.options));
    }, _tileOnLoad: function _tileOnLoad(t, i) {
      Ii ? setTimeout(e(t, this, null, i), 0) : t(null, i);
    }, _tileOnError: function _tileOnError(t, i, e) {
      var n = this.options.errorTileUrl;n && i.src !== n && (i.src = n), t(e, i);
    }, _onTileRemove: function _onTileRemove(t) {
      t.tile.onload = null;
    }, _getZoomForUrl: function _getZoomForUrl() {
      var t = this._tileZoom,
          i = this.options.maxZoom,
          e = this.options.zoomReverse,
          n = this.options.zoomOffset;return e && (t = i - t), t + n;
    }, _getSubdomain: function _getSubdomain(t) {
      var i = Math.abs(t.x + t.y) % this.options.subdomains.length;return this.options.subdomains[i];
    }, _abortLoading: function _abortLoading() {
      var t, i;for (t in this._tiles) {
        this._tiles[t].coords.z !== this._tileZoom && (i = this._tiles[t].el, i.onload = r, i.onerror = r, i.complete || (i.src = fi, ut(i)));
      }
    } }),
      In = Bn.extend({ defaultWmsParams: { service: "WMS", request: "GetMap", layers: "", styles: "", format: "image/jpeg", transparent: !1, version: "1.1.1" }, options: { crs: null, uppercase: !1 }, initialize: function initialize(t, e) {
      this._url = t;var n = i({}, this.defaultWmsParams);for (var o in e) {
        o in this.options || (n[o] = e[o]);
      }e = l(this, e), n.width = n.height = e.tileSize * (e.detectRetina && oe ? 2 : 1), this.wmsParams = n;
    }, onAdd: function onAdd(t) {
      this._crs = this.options.crs || t.options.crs, this._wmsVersion = parseFloat(this.wmsParams.version);var i = this._wmsVersion >= 1.3 ? "crs" : "srs";this.wmsParams[i] = this._crs.code, Bn.prototype.onAdd.call(this, t);
    }, getTileUrl: function getTileUrl(t) {
      var i = this._tileCoordsToBounds(t),
          e = this._crs.project(i.getNorthWest()),
          n = this._crs.project(i.getSouthEast()),
          o = (this._wmsVersion >= 1.3 && this._crs === on ? [n.y, e.x, e.y, n.x] : [e.x, n.y, n.x, e.y]).join(","),
          s = Bn.prototype.getTileUrl.call(this, t);return s + c(this.wmsParams, s, this.options.uppercase) + (this.options.uppercase ? "&BBOX=" : "&bbox=") + o;
    }, setParams: function setParams(t, e) {
      return i(this.wmsParams, t), e || this.redraw(), this;
    } });Bn.WMS = In, si.wms = ri;var An = rn.extend({ options: { padding: .1 }, initialize: function initialize(t) {
      l(this, t), n(this), this._layers = this._layers || {};
    }, onAdd: function onAdd() {
      this._container || (this._initContainer(), this._zoomAnimated && pt(this._container, "leaflet-zoom-animated")), this.getPane().appendChild(this._container), this._update(), this.on("update", this._updatePaths, this);
    }, onRemove: function onRemove() {
      this.off("update", this._updatePaths, this), this._destroyContainer();
    }, getEvents: function getEvents() {
      var t = { viewreset: this._reset, zoom: this._onZoom, moveend: this._update, zoomend: this._onZoomEnd };return this._zoomAnimated && (t.zoomanim = this._onAnimZoom), t;
    }, _onAnimZoom: function _onAnimZoom(t) {
      this._updateTransform(t.center, t.zoom);
    }, _onZoom: function _onZoom() {
      this._updateTransform(this._map.getCenter(), this._map.getZoom());
    }, _updateTransform: function _updateTransform(t, i) {
      var e = this._map.getZoomScale(i, this._zoom),
          n = Pt(this._container),
          o = this._map.getSize().multiplyBy(.5 + this.options.padding),
          s = this._map.project(this._center, i),
          r = this._map.project(t, i),
          a = r.subtract(s),
          h = o.multiplyBy(-e).add(n).add(o).subtract(a);Yi ? wt(this._container, h, e) : Lt(this._container, h);
    }, _reset: function _reset() {
      this._update(), this._updateTransform(this._center, this._zoom);for (var t in this._layers) {
        this._layers[t]._reset();
      }
    }, _onZoomEnd: function _onZoomEnd() {
      for (var t in this._layers) {
        this._layers[t]._project();
      }
    }, _updatePaths: function _updatePaths() {
      for (var t in this._layers) {
        this._layers[t]._update();
      }
    }, _update: function _update() {
      var t = this.options.padding,
          i = this._map.getSize(),
          e = this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds = new P(e, e.add(i.multiplyBy(1 + 2 * t)).round()), this._center = this._map.getCenter(), this._zoom = this._map.getZoom();
    } }),
      On = An.extend({ getEvents: function getEvents() {
      var t = An.prototype.getEvents.call(this);return t.viewprereset = this._onViewPreReset, t;
    }, _onViewPreReset: function _onViewPreReset() {
      this._postponeUpdatePaths = !0;
    }, onAdd: function onAdd() {
      An.prototype.onAdd.call(this), this._draw();
    }, _initContainer: function _initContainer() {
      var t = this._container = document.createElement("canvas");V(t, "mousemove", o(this._onMouseMove, 32, this), this), V(t, "click dblclick mousedown mouseup contextmenu", this._onClick, this), V(t, "mouseout", this._handleMouseOut, this), this._ctx = t.getContext("2d");
    }, _destroyContainer: function _destroyContainer() {
      delete this._ctx, ut(this._container), G(this._container), delete this._container;
    }, _updatePaths: function _updatePaths() {
      if (!this._postponeUpdatePaths) {
        var t;this._redrawBounds = null;for (var i in this._layers) {
          t = this._layers[i], t._update();
        }this._redraw();
      }
    }, _update: function _update() {
      if (!this._map._animatingZoom || !this._bounds) {
        this._drawnLayers = {}, An.prototype._update.call(this);var t = this._bounds,
            i = this._container,
            e = t.getSize(),
            n = oe ? 2 : 1;Lt(i, t.min), i.width = n * e.x, i.height = n * e.y, i.style.width = e.x + "px", i.style.height = e.y + "px", oe && this._ctx.scale(2, 2), this._ctx.translate(-t.min.x, -t.min.y), this.fire("update");
      }
    }, _reset: function _reset() {
      An.prototype._reset.call(this), this._postponeUpdatePaths && (this._postponeUpdatePaths = !1, this._updatePaths());
    }, _initPath: function _initPath(t) {
      this._updateDashArray(t), this._layers[n(t)] = t;var i = t._order = { layer: t, prev: this._drawLast, next: null };this._drawLast && (this._drawLast.next = i), this._drawLast = i, this._drawFirst = this._drawFirst || this._drawLast;
    }, _addPath: function _addPath(t) {
      this._requestRedraw(t);
    }, _removePath: function _removePath(t) {
      var i = t._order,
          e = i.next,
          n = i.prev;e ? e.prev = n : this._drawLast = n, n ? n.next = e : this._drawFirst = e, delete t._order, delete this._layers[L.stamp(t)], this._requestRedraw(t);
    }, _updatePath: function _updatePath(t) {
      this._extendRedrawBounds(t), t._project(), t._update(), this._requestRedraw(t);
    }, _updateStyle: function _updateStyle(t) {
      this._updateDashArray(t), this._requestRedraw(t);
    }, _updateDashArray: function _updateDashArray(t) {
      if (t.options.dashArray) {
        var i,
            e = t.options.dashArray.split(","),
            n = [];for (i = 0; i < e.length; i++) {
          n.push(Number(e[i]));
        }t.options._dashArray = n;
      }
    }, _requestRedraw: function _requestRedraw(t) {
      this._map && (this._extendRedrawBounds(t), this._redrawRequest = this._redrawRequest || f(this._redraw, this));
    }, _extendRedrawBounds: function _extendRedrawBounds(t) {
      if (t._pxBounds) {
        var i = (t.options.weight || 0) + 1;this._redrawBounds = this._redrawBounds || new P(), this._redrawBounds.extend(t._pxBounds.min.subtract([i, i])), this._redrawBounds.extend(t._pxBounds.max.add([i, i]));
      }
    }, _redraw: function _redraw() {
      this._redrawRequest = null, this._redrawBounds && (this._redrawBounds.min._floor(), this._redrawBounds.max._ceil()), this._clear(), this._draw(), this._redrawBounds = null;
    }, _clear: function _clear() {
      var t = this._redrawBounds;if (t) {
        var i = t.getSize();this._ctx.clearRect(t.min.x, t.min.y, i.x, i.y);
      } else this._ctx.clearRect(0, 0, this._container.width, this._container.height);
    }, _draw: function _draw() {
      var t,
          i = this._redrawBounds;if (this._ctx.save(), i) {
        var e = i.getSize();this._ctx.beginPath(), this._ctx.rect(i.min.x, i.min.y, e.x, e.y), this._ctx.clip();
      }this._drawing = !0;for (var n = this._drawFirst; n; n = n.next) {
        t = n.layer, (!i || t._pxBounds && t._pxBounds.intersects(i)) && t._updatePath();
      }this._drawing = !1, this._ctx.restore();
    }, _updatePoly: function _updatePoly(t, i) {
      if (this._drawing) {
        var e,
            n,
            o,
            s,
            r = t._parts,
            a = r.length,
            h = this._ctx;if (a) {
          for (this._drawnLayers[t._leaflet_id] = t, h.beginPath(), e = 0; e < a; e++) {
            for (n = 0, o = r[e].length; n < o; n++) {
              s = r[e][n], h[n ? "lineTo" : "moveTo"](s.x, s.y);
            }i && h.closePath();
          }this._fillStroke(h, t);
        }
      }
    }, _updateCircle: function _updateCircle(t) {
      if (this._drawing && !t._empty()) {
        var i = t._point,
            e = this._ctx,
            n = t._radius,
            o = (t._radiusY || n) / n;this._drawnLayers[t._leaflet_id] = t, 1 !== o && (e.save(), e.scale(1, o)), e.beginPath(), e.arc(i.x, i.y / o, n, 0, 2 * Math.PI, !1), 1 !== o && e.restore(), this._fillStroke(e, t);
      }
    }, _fillStroke: function _fillStroke(t, i) {
      var e = i.options;e.fill && (t.globalAlpha = e.fillOpacity, t.fillStyle = e.fillColor || e.color, t.fill(e.fillRule || "evenodd")), e.stroke && 0 !== e.weight && (t.setLineDash && t.setLineDash(i.options && i.options._dashArray || []), t.globalAlpha = e.opacity, t.lineWidth = e.weight, t.strokeStyle = e.color, t.lineCap = e.lineCap, t.lineJoin = e.lineJoin, t.stroke());
    }, _onClick: function _onClick(t) {
      for (var i, e, n = this._map.mouseEventToLayerPoint(t), o = this._drawFirst; o; o = o.next) {
        i = o.layer, i.options.interactive && i._containsPoint(n) && !this._map._draggableMoved(i) && (e = i);
      }e && (et(t), this._fireEvent([e], t));
    }, _onMouseMove: function _onMouseMove(t) {
      if (this._map && !this._map.dragging.moving() && !this._map._animatingZoom) {
        var i = this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t, i);
      }
    }, _handleMouseOut: function _handleMouseOut(t) {
      var i = this._hoveredLayer;i && (mt(this._container, "leaflet-interactive"), this._fireEvent([i], t, "mouseout"), this._hoveredLayer = null);
    }, _handleMouseHover: function _handleMouseHover(t, i) {
      for (var e, n, o = this._drawFirst; o; o = o.next) {
        e = o.layer, e.options.interactive && e._containsPoint(i) && (n = e);
      }n !== this._hoveredLayer && (this._handleMouseOut(t), n && (pt(this._container, "leaflet-interactive"), this._fireEvent([n], t, "mouseover"), this._hoveredLayer = n)), this._hoveredLayer && this._fireEvent([this._hoveredLayer], t);
    }, _fireEvent: function _fireEvent(t, i, e) {
      this._map._fireDOMEvent(i, e || i.type, t);
    }, _bringToFront: function _bringToFront(t) {
      var i = t._order,
          e = i.next,
          n = i.prev;e && (e.prev = n, n ? n.next = e : e && (this._drawFirst = e), i.prev = this._drawLast, this._drawLast.next = i, i.next = null, this._drawLast = i, this._requestRedraw(t));
    }, _bringToBack: function _bringToBack(t) {
      var i = t._order,
          e = i.next,
          n = i.prev;n && (n.next = e, e ? e.prev = n : n && (this._drawLast = n), i.prev = null, i.next = this._drawFirst, this._drawFirst.prev = i, this._drawFirst = i, this._requestRedraw(t));
    } }),
      Rn = function () {
    try {
      return document.namespaces.add("lvml", "urn:schemas-microsoft-com:vml"), function (t) {
        return document.createElement("<lvml:" + t + ' class="lvml">');
      };
    } catch (t) {
      return function (t) {
        return document.createElement("<" + t + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">');
      };
    }
  }(),
      Dn = { _initContainer: function _initContainer() {
      this._container = ht("div", "leaflet-vml-container");
    }, _update: function _update() {
      this._map._animatingZoom || (An.prototype._update.call(this), this.fire("update"));
    }, _initPath: function _initPath(t) {
      var i = t._container = Rn("shape");pt(i, "leaflet-vml-shape " + (this.options.className || "")), i.coordsize = "1 1", t._path = Rn("path"), i.appendChild(t._path), this._updateStyle(t), this._layers[n(t)] = t;
    }, _addPath: function _addPath(t) {
      var i = t._container;this._container.appendChild(i), t.options.interactive && t.addInteractiveTarget(i);
    }, _removePath: function _removePath(t) {
      var i = t._container;ut(i), t.removeInteractiveTarget(i), delete this._layers[n(t)];
    }, _updateStyle: function _updateStyle(t) {
      var i = t._stroke,
          e = t._fill,
          n = t.options,
          o = t._container;o.stroked = !!n.stroke, o.filled = !!n.fill, n.stroke ? (i || (i = t._stroke = Rn("stroke")), o.appendChild(i), i.weight = n.weight + "px", i.color = n.color, i.opacity = n.opacity, n.dashArray ? i.dashStyle = mi(n.dashArray) ? n.dashArray.join(" ") : n.dashArray.replace(/( *, *)/g, " ") : i.dashStyle = "", i.endcap = n.lineCap.replace("butt", "flat"), i.joinstyle = n.lineJoin) : i && (o.removeChild(i), t._stroke = null), n.fill ? (e || (e = t._fill = Rn("fill")), o.appendChild(e), e.color = n.fillColor || n.color, e.opacity = n.fillOpacity) : e && (o.removeChild(e), t._fill = null);
    }, _updateCircle: function _updateCircle(t) {
      var i = t._point.round(),
          e = Math.round(t._radius),
          n = Math.round(t._radiusY || e);this._setPath(t, t._empty() ? "M0 0" : "AL " + i.x + "," + i.y + " " + e + "," + n + " 0,23592600");
    }, _setPath: function _setPath(t, i) {
      t._path.v = i;
    }, _bringToFront: function _bringToFront(t) {
      ct(t._container);
    }, _bringToBack: function _bringToBack(t) {
      _t(t._container);
    } },
      Nn = ae ? Rn : S,
      jn = An.extend({ getEvents: function getEvents() {
      var t = An.prototype.getEvents.call(this);return t.zoomstart = this._onZoomStart, t;
    }, _initContainer: function _initContainer() {
      this._container = Nn("svg"), this._container.setAttribute("pointer-events", "none"), this._rootGroup = Nn("g"), this._container.appendChild(this._rootGroup);
    }, _destroyContainer: function _destroyContainer() {
      ut(this._container), G(this._container), delete this._container, delete this._rootGroup;
    }, _onZoomStart: function _onZoomStart() {
      this._update();
    }, _update: function _update() {
      if (!this._map._animatingZoom || !this._bounds) {
        An.prototype._update.call(this);var t = this._bounds,
            i = t.getSize(),
            e = this._container;this._svgSize && this._svgSize.equals(i) || (this._svgSize = i, e.setAttribute("width", i.x), e.setAttribute("height", i.y)), Lt(e, t.min), e.setAttribute("viewBox", [t.min.x, t.min.y, i.x, i.y].join(" ")), this.fire("update");
      }
    }, _initPath: function _initPath(t) {
      var i = t._path = Nn("path");t.options.className && pt(i, t.options.className), t.options.interactive && pt(i, "leaflet-interactive"), this._updateStyle(t), this._layers[n(t)] = t;
    }, _addPath: function _addPath(t) {
      this._rootGroup || this._initContainer(), this._rootGroup.appendChild(t._path), t.addInteractiveTarget(t._path);
    }, _removePath: function _removePath(t) {
      ut(t._path), t.removeInteractiveTarget(t._path), delete this._layers[n(t)];
    }, _updatePath: function _updatePath(t) {
      t._project(), t._update();
    }, _updateStyle: function _updateStyle(t) {
      var i = t._path,
          e = t.options;i && (e.stroke ? (i.setAttribute("stroke", e.color), i.setAttribute("stroke-opacity", e.opacity), i.setAttribute("stroke-width", e.weight), i.setAttribute("stroke-linecap", e.lineCap), i.setAttribute("stroke-linejoin", e.lineJoin), e.dashArray ? i.setAttribute("stroke-dasharray", e.dashArray) : i.removeAttribute("stroke-dasharray"), e.dashOffset ? i.setAttribute("stroke-dashoffset", e.dashOffset) : i.removeAttribute("stroke-dashoffset")) : i.setAttribute("stroke", "none"), e.fill ? (i.setAttribute("fill", e.fillColor || e.color), i.setAttribute("fill-opacity", e.fillOpacity), i.setAttribute("fill-rule", e.fillRule || "evenodd")) : i.setAttribute("fill", "none"));
    }, _updatePoly: function _updatePoly(t, i) {
      this._setPath(t, k(t._parts, i));
    }, _updateCircle: function _updateCircle(t) {
      var i = t._point,
          e = t._radius,
          n = t._radiusY || e,
          o = "a" + e + "," + n + " 0 1,0 ",
          s = t._empty() ? "M0 0" : "M" + (i.x - e) + "," + i.y + o + 2 * e + ",0 " + o + 2 * -e + ",0 ";this._setPath(t, s);
    }, _setPath: function _setPath(t, i) {
      t._path.setAttribute("d", i);
    }, _bringToFront: function _bringToFront(t) {
      ct(t._path);
    }, _bringToBack: function _bringToBack(t) {
      _t(t._path);
    } });ae && jn.include(Dn), ke.include({ getRenderer: function getRenderer(t) {
      var i = t.options.renderer || this._getPaneRenderer(t.options.pane) || this.options.renderer || this._renderer;return i || (i = this._renderer = this.options.preferCanvas && ai() || hi()), this.hasLayer(i) || this.addLayer(i), i;
    }, _getPaneRenderer: function _getPaneRenderer(t) {
      if ("overlayPane" === t || void 0 === t) return !1;var i = this._paneRenderers[t];return void 0 === i && (i = jn && hi({ pane: t }) || On && ai({ pane: t }), this._paneRenderers[t] = i), i;
    } });var Wn = yn.extend({ initialize: function initialize(t, i) {
      yn.prototype.initialize.call(this, this._boundsToLatLngs(t), i);
    }, setBounds: function setBounds(t) {
      return this.setLatLngs(this._boundsToLatLngs(t));
    }, _boundsToLatLngs: function _boundsToLatLngs(t) {
      return t = z(t), [t.getSouthWest(), t.getNorthWest(), t.getNorthEast(), t.getSouthEast()];
    } });jn.create = Nn, jn.pointsToPath = k, xn.geometryToLayer = Kt, xn.coordsToLatLng = Yt, xn.coordsToLatLngs = Xt, xn.latLngToCoords = Jt, xn.latLngsToCoords = $t, xn.getFeature = Qt, xn.asFeature = ti, ke.mergeOptions({ boxZoom: !0 });var Hn = Ue.extend({ initialize: function initialize(t) {
      this._map = t, this._container = t._container, this._pane = t._panes.overlayPane, this._resetStateTimeout = 0, t.on("unload", this._destroy, this);
    }, addHooks: function addHooks() {
      V(this._container, "mousedown", this._onMouseDown, this);
    }, removeHooks: function removeHooks() {
      G(this._container, "mousedown", this._onMouseDown, this);
    }, moved: function moved() {
      return this._moved;
    }, _destroy: function _destroy() {
      ut(this._pane), delete this._pane;
    }, _resetState: function _resetState() {
      this._resetStateTimeout = 0, this._moved = !1;
    }, _clearDeferredResetState: function _clearDeferredResetState() {
      0 !== this._resetStateTimeout && (clearTimeout(this._resetStateTimeout), this._resetStateTimeout = 0);
    }, _onMouseDown: function _onMouseDown(t) {
      return !(!t.shiftKey || 1 !== t.which && 1 !== t.button) && (this._clearDeferredResetState(), this._resetState(), Mi(), bt(), this._startPoint = this._map.mouseEventToContainerPoint(t), void V(document, { contextmenu: Q, mousemove: this._onMouseMove, mouseup: this._onMouseUp, keydown: this._onKeyDown }, this));
    }, _onMouseMove: function _onMouseMove(t) {
      this._moved || (this._moved = !0, this._box = ht("div", "leaflet-zoom-box", this._container), pt(this._container, "leaflet-crosshair"), this._map.fire("boxzoomstart")), this._point = this._map.mouseEventToContainerPoint(t);var i = new P(this._point, this._startPoint),
          e = i.getSize();Lt(this._box, i.min), this._box.style.width = e.x + "px", this._box.style.height = e.y + "px";
    }, _finish: function _finish() {
      this._moved && (ut(this._box), mt(this._container, "leaflet-crosshair")), Ci(), Tt(), G(document, { contextmenu: Q, mousemove: this._onMouseMove, mouseup: this._onMouseUp, keydown: this._onKeyDown }, this);
    }, _onMouseUp: function _onMouseUp(t) {
      if ((1 === t.which || 1 === t.button) && (this._finish(), this._moved)) {
        this._clearDeferredResetState(), this._resetStateTimeout = setTimeout(e(this._resetState, this), 0);var i = new T(this._map.containerPointToLatLng(this._startPoint), this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend", { boxZoomBounds: i });
      }
    }, _onKeyDown: function _onKeyDown(t) {
      27 === t.keyCode && this._finish();
    } });ke.addInitHook("addHandler", "boxZoom", Hn), ke.mergeOptions({ doubleClickZoom: !0 });var Fn = Ue.extend({ addHooks: function addHooks() {
      this._map.on("dblclick", this._onDoubleClick, this);
    }, removeHooks: function removeHooks() {
      this._map.off("dblclick", this._onDoubleClick, this);
    }, _onDoubleClick: function _onDoubleClick(t) {
      var i = this._map,
          e = i.getZoom(),
          n = i.options.zoomDelta,
          o = t.originalEvent.shiftKey ? e - n : e + n;"center" === i.options.doubleClickZoom ? i.setZoom(o) : i.setZoomAround(t.containerPoint, o);
    } });ke.addInitHook("addHandler", "doubleClickZoom", Fn), ke.mergeOptions({ dragging: !0, inertia: !Di, inertiaDeceleration: 3400, inertiaMaxSpeed: 1 / 0, easeLinearity: .2, worldCopyJump: !1, maxBoundsViscosity: 0 });var Un = Ue.extend({ addHooks: function addHooks() {
      if (!this._draggable) {
        var t = this._map;this._draggable = new Xe(t._mapPane, t._container), this._draggable.on({ dragstart: this._onDragStart, drag: this._onDrag, dragend: this._onDragEnd }, this), this._draggable.on("predrag", this._onPreDragLimit, this), t.options.worldCopyJump && (this._draggable.on("predrag", this._onPreDragWrap, this), t.on("zoomend", this._onZoomEnd, this), t.whenReady(this._onZoomEnd, this));
      }pt(this._map._container, "leaflet-grab leaflet-touch-drag"), this._draggable.enable(), this._positions = [], this._times = [];
    }, removeHooks: function removeHooks() {
      mt(this._map._container, "leaflet-grab"), mt(this._map._container, "leaflet-touch-drag"), this._draggable.disable();
    }, moved: function moved() {
      return this._draggable && this._draggable._moved;
    }, moving: function moving() {
      return this._draggable && this._draggable._moving;
    }, _onDragStart: function _onDragStart() {
      var t = this._map;if (t._stop(), this._map.options.maxBounds && this._map.options.maxBoundsViscosity) {
        var i = z(this._map.options.maxBounds);this._offsetLimit = b(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1), this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize())), this._viscosity = Math.min(1, Math.max(0, this._map.options.maxBoundsViscosity));
      } else this._offsetLimit = null;t.fire("movestart").fire("dragstart"), t.options.inertia && (this._positions = [], this._times = []);
    }, _onDrag: function _onDrag(t) {
      if (this._map.options.inertia) {
        var i = this._lastTime = +new Date(),
            e = this._lastPos = this._draggable._absPos || this._draggable._newPos;this._positions.push(e), this._times.push(i), i - this._times[0] > 50 && (this._positions.shift(), this._times.shift());
      }this._map.fire("move", t).fire("drag", t);
    }, _onZoomEnd: function _onZoomEnd() {
      var t = this._map.getSize().divideBy(2),
          i = this._map.latLngToLayerPoint([0, 0]);this._initialWorldOffset = i.subtract(t).x, this._worldWidth = this._map.getPixelWorldBounds().getSize().x;
    }, _viscousLimit: function _viscousLimit(t, i) {
      return t - (t - i) * this._viscosity;
    }, _onPreDragLimit: function _onPreDragLimit() {
      if (this._viscosity && this._offsetLimit) {
        var t = this._draggable._newPos.subtract(this._draggable._startPos),
            i = this._offsetLimit;t.x < i.min.x && (t.x = this._viscousLimit(t.x, i.min.x)), t.y < i.min.y && (t.y = this._viscousLimit(t.y, i.min.y)), t.x > i.max.x && (t.x = this._viscousLimit(t.x, i.max.x)), t.y > i.max.y && (t.y = this._viscousLimit(t.y, i.max.y)), this._draggable._newPos = this._draggable._startPos.add(t);
      }
    }, _onPreDragWrap: function _onPreDragWrap() {
      var t = this._worldWidth,
          i = Math.round(t / 2),
          e = this._initialWorldOffset,
          n = this._draggable._newPos.x,
          o = (n - i + e) % t + i - e,
          s = (n + i + e) % t - i - e,
          r = Math.abs(o + e) < Math.abs(s + e) ? o : s;this._draggable._absPos = this._draggable._newPos.clone(), this._draggable._newPos.x = r;
    }, _onDragEnd: function _onDragEnd(t) {
      var i = this._map,
          e = i.options,
          n = !e.inertia || this._times.length < 2;if (i.fire("dragend", t), n) i.fire("moveend");else {
        var o = this._lastPos.subtract(this._positions[0]),
            s = (this._lastTime - this._times[0]) / 1e3,
            r = e.easeLinearity,
            a = o.multiplyBy(r / s),
            h = a.distanceTo([0, 0]),
            u = Math.min(e.inertiaMaxSpeed, h),
            l = a.multiplyBy(u / h),
            c = u / (e.inertiaDeceleration * r),
            _ = l.multiplyBy(-c / 2).round();_.x || _.y ? (_ = i._limitOffset(_, i.options.maxBounds), f(function () {
          i.panBy(_, { duration: c, easeLinearity: r, noMoveStart: !0, animate: !0 });
        })) : i.fire("moveend");
      }
    } });ke.addInitHook("addHandler", "dragging", Un), ke.mergeOptions({ keyboard: !0, keyboardPanDelta: 80 });var Vn = Ue.extend({ keyCodes: { left: [37], right: [39], down: [40], up: [38], zoomIn: [187, 107, 61, 171], zoomOut: [189, 109, 54, 173] }, initialize: function initialize(t) {
      this._map = t, this._setPanDelta(t.options.keyboardPanDelta), this._setZoomDelta(t.options.zoomDelta);
    }, addHooks: function addHooks() {
      var t = this._map._container;t.tabIndex <= 0 && (t.tabIndex = "0"), V(t, { focus: this._onFocus, blur: this._onBlur, mousedown: this._onMouseDown }, this), this._map.on({ focus: this._addHooks, blur: this._removeHooks }, this);
    }, removeHooks: function removeHooks() {
      this._removeHooks(), G(this._map._container, { focus: this._onFocus, blur: this._onBlur, mousedown: this._onMouseDown }, this), this._map.off({ focus: this._addHooks, blur: this._removeHooks }, this);
    }, _onMouseDown: function _onMouseDown() {
      if (!this._focused) {
        var t = document.body,
            i = document.documentElement,
            e = t.scrollTop || i.scrollTop,
            n = t.scrollLeft || i.scrollLeft;this._map._container.focus(), window.scrollTo(n, e);
      }
    }, _onFocus: function _onFocus() {
      this._focused = !0, this._map.fire("focus");
    }, _onBlur: function _onBlur() {
      this._focused = !1, this._map.fire("blur");
    }, _setPanDelta: function _setPanDelta(t) {
      var i,
          e,
          n = this._panKeys = {},
          o = this.keyCodes;for (i = 0, e = o.left.length; i < e; i++) {
        n[o.left[i]] = [-1 * t, 0];
      }for (i = 0, e = o.right.length; i < e; i++) {
        n[o.right[i]] = [t, 0];
      }for (i = 0, e = o.down.length; i < e; i++) {
        n[o.down[i]] = [0, t];
      }for (i = 0, e = o.up.length; i < e; i++) {
        n[o.up[i]] = [0, -1 * t];
      }
    }, _setZoomDelta: function _setZoomDelta(t) {
      var i,
          e,
          n = this._zoomKeys = {},
          o = this.keyCodes;for (i = 0, e = o.zoomIn.length; i < e; i++) {
        n[o.zoomIn[i]] = t;
      }for (i = 0, e = o.zoomOut.length; i < e; i++) {
        n[o.zoomOut[i]] = -t;
      }
    }, _addHooks: function _addHooks() {
      V(document, "keydown", this._onKeyDown, this);
    }, _removeHooks: function _removeHooks() {
      G(document, "keydown", this._onKeyDown, this);
    }, _onKeyDown: function _onKeyDown(t) {
      if (!(t.altKey || t.ctrlKey || t.metaKey)) {
        var i,
            e = t.keyCode,
            n = this._map;if (e in this._panKeys) {
          if (n._panAnim && n._panAnim._inProgress) return;i = this._panKeys[e], t.shiftKey && (i = w(i).multiplyBy(3)), n.panBy(i), n.options.maxBounds && n.panInsideBounds(n.options.maxBounds);
        } else if (e in this._zoomKeys) n.setZoom(n.getZoom() + (t.shiftKey ? 3 : 1) * this._zoomKeys[e]);else {
          if (27 !== e || !n._popup) return;n.closePopup();
        }Q(t);
      }
    } });ke.addInitHook("addHandler", "keyboard", Vn), ke.mergeOptions({ scrollWheelZoom: !0, wheelDebounceTime: 40, wheelPxPerZoomLevel: 60 });var Gn = Ue.extend({ addHooks: function addHooks() {
      V(this._map._container, "mousewheel", this._onWheelScroll, this), this._delta = 0;
    }, removeHooks: function removeHooks() {
      G(this._map._container, "mousewheel", this._onWheelScroll, this);
    }, _onWheelScroll: function _onWheelScroll(t) {
      var i = it(t),
          n = this._map.options.wheelDebounceTime;this._delta += i, this._lastMousePos = this._map.mouseEventToContainerPoint(t), this._startTime || (this._startTime = +new Date());var o = Math.max(n - (+new Date() - this._startTime), 0);clearTimeout(this._timer), this._timer = setTimeout(e(this._performZoom, this), o), Q(t);
    }, _performZoom: function _performZoom() {
      var t = this._map,
          i = t.getZoom(),
          e = this._map.options.zoomSnap || 0;t._stop();var n = this._delta / (4 * this._map.options.wheelPxPerZoomLevel),
          o = 4 * Math.log(2 / (1 + Math.exp(-Math.abs(n)))) / Math.LN2,
          s = e ? Math.ceil(o / e) * e : o,
          r = t._limitZoom(i + (this._delta > 0 ? s : -s)) - i;this._delta = 0, this._startTime = null, r && ("center" === t.options.scrollWheelZoom ? t.setZoom(i + r) : t.setZoomAround(this._lastMousePos, i + r));
    } });ke.addInitHook("addHandler", "scrollWheelZoom", Gn), ke.mergeOptions({ tap: !0, tapTolerance: 15 });var qn = Ue.extend({ addHooks: function addHooks() {
      V(this._map._container, "touchstart", this._onDown, this);
    }, removeHooks: function removeHooks() {
      G(this._map._container, "touchstart", this._onDown, this);
    }, _onDown: function _onDown(t) {
      if (t.touches) {
        if ($(t), this._fireClick = !0, t.touches.length > 1) return this._fireClick = !1, void clearTimeout(this._holdTimeout);var i = t.touches[0],
            n = i.target;this._startPos = this._newPos = new x(i.clientX, i.clientY), n.tagName && "a" === n.tagName.toLowerCase() && pt(n, "leaflet-active"), this._holdTimeout = setTimeout(e(function () {
          this._isTapValid() && (this._fireClick = !1, this._onUp(), this._simulateEvent("contextmenu", i));
        }, this), 1e3), this._simulateEvent("mousedown", i), V(document, { touchmove: this._onMove, touchend: this._onUp }, this);
      }
    }, _onUp: function _onUp(t) {
      if (clearTimeout(this._holdTimeout), G(document, { touchmove: this._onMove, touchend: this._onUp }, this), this._fireClick && t && t.changedTouches) {
        var i = t.changedTouches[0],
            e = i.target;e && e.tagName && "a" === e.tagName.toLowerCase() && mt(e, "leaflet-active"), this._simulateEvent("mouseup", i), this._isTapValid() && this._simulateEvent("click", i);
      }
    }, _isTapValid: function _isTapValid() {
      return this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;
    }, _onMove: function _onMove(t) {
      var i = t.touches[0];this._newPos = new x(i.clientX, i.clientY), this._simulateEvent("mousemove", i);
    }, _simulateEvent: function _simulateEvent(t, i) {
      var e = document.createEvent("MouseEvents");e._simulated = !0, i.target._simulatedClick = !0, e.initMouseEvent(t, !0, !0, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, !1, !1, !1, !1, 0, null), i.target.dispatchEvent(e);
    } });ie && !te && ke.addInitHook("addHandler", "tap", qn), ke.mergeOptions({ touchZoom: ie && !Di, bounceAtZoomLimits: !0 });var Kn = Ue.extend({ addHooks: function addHooks() {
      pt(this._map._container, "leaflet-touch-zoom"), V(this._map._container, "touchstart", this._onTouchStart, this);
    }, removeHooks: function removeHooks() {
      mt(this._map._container, "leaflet-touch-zoom"), G(this._map._container, "touchstart", this._onTouchStart, this);
    }, _onTouchStart: function _onTouchStart(t) {
      var i = this._map;if (t.touches && 2 === t.touches.length && !i._animatingZoom && !this._zooming) {
        var e = i.mouseEventToContainerPoint(t.touches[0]),
            n = i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint = i.getSize()._divideBy(2), this._startLatLng = i.containerPointToLatLng(this._centerPoint), "center" !== i.options.touchZoom && (this._pinchStartLatLng = i.containerPointToLatLng(e.add(n)._divideBy(2))), this._startDist = e.distanceTo(n), this._startZoom = i.getZoom(), this._moved = !1, this._zooming = !0, i._stop(), V(document, "touchmove", this._onTouchMove, this), V(document, "touchend", this._onTouchEnd, this), $(t);
      }
    }, _onTouchMove: function _onTouchMove(t) {
      if (t.touches && 2 === t.touches.length && this._zooming) {
        var i = this._map,
            n = i.mouseEventToContainerPoint(t.touches[0]),
            o = i.mouseEventToContainerPoint(t.touches[1]),
            s = n.distanceTo(o) / this._startDist;if (this._zoom = i.getScaleZoom(s, this._startZoom), !i.options.bounceAtZoomLimits && (this._zoom < i.getMinZoom() && s < 1 || this._zoom > i.getMaxZoom() && s > 1) && (this._zoom = i._limitZoom(this._zoom)), "center" === i.options.touchZoom) {
          if (this._center = this._startLatLng, 1 === s) return;
        } else {
          var r = n._add(o)._divideBy(2)._subtract(this._centerPoint);if (1 === s && 0 === r.x && 0 === r.y) return;this._center = i.unproject(i.project(this._pinchStartLatLng, this._zoom).subtract(r), this._zoom);
        }this._moved || (i._moveStart(!0), this._moved = !0), g(this._animRequest);var a = e(i._move, i, this._center, this._zoom, { pinch: !0, round: !1 });this._animRequest = f(a, this, !0), $(t);
      }
    }, _onTouchEnd: function _onTouchEnd() {
      return this._moved && this._zooming ? (this._zooming = !1, g(this._animRequest), G(document, "touchmove", this._onTouchMove), G(document, "touchend", this._onTouchEnd), void (this._map.options.zoomAnimation ? this._map._animateZoom(this._center, this._map._limitZoom(this._zoom), !0, this._map.options.zoomSnap) : this._map._resetView(this._center, this._map._limitZoom(this._zoom)))) : void (this._zooming = !1);
    } });ke.addInitHook("addHandler", "touchZoom", Kn), ke.BoxZoom = Hn, ke.DoubleClickZoom = Fn, ke.Drag = Un, ke.Keyboard = Vn, ke.ScrollWheelZoom = Gn, ke.Tap = qn, ke.TouchZoom = Kn;var Yn = window.L;window.L = t, t.version = ci, t.noConflict = li, t.Control = Be, t.control = Ie, t.Browser = he, t.Evented = Li, t.Mixin = Ve, t.Util = xi, t.Class = v, t.Handler = Ue, t.extend = i, t.bind = e, t.stamp = n, t.setOptions = l, t.DomEvent = Pe, t.DomUtil = Ee, t.PosAnimation = Se, t.Draggable = Xe, t.LineUtil = Je, t.PolyUtil = $e, t.Point = x, t.point = w, t.Bounds = P, t.bounds = b, t.Transformation = Z, t.transformation = E, t.Projection = en, t.LatLng = M, t.latLng = C, t.LatLngBounds = T, t.latLngBounds = z, t.CRS = Pi, t.GeoJSON = xn, t.geoJSON = ii, t.geoJson = Ln, t.Layer = rn, t.LayerGroup = an, t.layerGroup = hn, t.FeatureGroup = un, t.featureGroup = ln, t.ImageOverlay = Pn, t.imageOverlay = bn, t.VideoOverlay = Tn, t.videoOverlay = ei, t.DivOverlay = zn, t.Popup = Mn, t.popup = Cn, t.Tooltip = Zn, t.tooltip = En, t.Icon = cn, t.icon = Ht, t.DivIcon = Sn, t.divIcon = ni, t.Marker = pn, t.marker = Ft, t.TileLayer = Bn, t.tileLayer = si, t.GridLayer = kn, t.gridLayer = oi, t.SVG = jn, t.svg = hi, t.Renderer = An, t.Canvas = On, t.canvas = ai, t.Path = mn, t.CircleMarker = fn, t.circleMarker = Ut, t.Circle = gn, t.circle = Vt, t.Polyline = vn, t.polyline = Gt, t.Polygon = yn, t.polygon = qt, t.Rectangle = Wn, t.rectangle = ui, t.Map = ke, t.map = Ct;
});
//# sourceMappingURL=leaflet.js.map
'use strict';

function cloudTag(barOptions) {
  if (barOptions.id) {
    $(barOptions.id).empty();
  }
  //--------------------------Initialize Values-----------------------------
  if (barOptions) {
    this.container = barOptions.id ? barOptions.id : "body";
    this.data = barOptions.data ? barOptions.data : [];
    this.margin = barOptions.margin ? {
      top: barOptions.margin.top ? barOptions.margin.top : 20,
      right: barOptions.margin.right ? barOptions.margin.right : 20,
      bottom: barOptions.margin.bottom ? barOptions.margin.bottom : 30,
      left: barOptions.margin.left ? barOptions.margin.left : 40
    } : { top: 20, right: 20, bottom: 50, left: 50 };
    this.height = barOptions.height ? barOptions.height : 600;
    this.width = barOptions.width ? barOptions.width : $(this.container).width() - 10;

    this.randomIdString = Math.floor(Math.random() * 10000000000);
    barOptions.textClick = barOptions.textClick ? barOptions.textClick : 'true';
  } else {
    console.error('cloud Chart Initialization Error : cloud Chart Params Not Defined');
    return false;
  }
  var randomSubstring = this.randomIdString;
  this.data.map(function (d) {
    d.text = d.name;

    return d.size = d.count;
  });
  this.data.sort(function (a, b) {
    return b.count - a.count;
  });
  this.data.splice(30);
  var margin = this.margin,
      width = this.width - margin.left - margin.right,
      height = this.height - margin.top - margin.bottom,
      barColor = this.barColor;
  if (height > width) {
    height = 3 * width / 4;
    this.height = 3 * this.width / 4;
  }
  //define tool tip
  // 	    $(".world_map_tooltip").remove();
  // 	    var tool_tip = $('body').append('<div class="world_map_tooltip" style="position: absolute; opacity: 1; pointer-events: none; visibility: hidden;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
  var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
  // 	    var colorScale = d3.scaleThreshold()
  // 	            .domain([10000, 100000, 500000, 1000000, 5000000, 10000000, 50000000, 100000000, 500000000, 1500000000])
  // 	            .range(["rgb(247,251,255)", "rgb(222,235,247)", "rgb(198,219,239)", "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)", "rgb(33,113,181)", "rgb(8,81,156)", "rgb(8,48,107)", "rgb(3,19,43)"]);


  var textcloudData = this.data;
  var domainX = barOptions['domain'] ? barOptions['domain']['x'] : 0;
  var domainY = barOptions['domain'] ? barOptions['domain']['y'] : 500;
  var domain = d3.extent(textcloudData, function (d) {
    return d.count;
  });
  var sizeScale = d3.scaleLinear().domain(domain).range([8, 60]);

  //define svg
  var svg = d3.select(this.container).append("svg").attr('height', this.height).attr('width', this.width).attr('id', 'mainSvg-' + randomSubstring).attr("class", "wordcloud").append("g").attr("transform", "translate(" + this.width / 2 + "," + this.height / 2 + ")");
  // 	    .attr("transform", "translate(320,200)");
  d3.layout.cloud().size([this.width, this.height]).words(textcloudData).rotate(0)
  // 	             .rotate(function() { return ~~(Math.random() * 2) * 90; })
  .font('monospace').fontSize(function (d) {

    return parseInt(sizeScale(d.size));
  })
  // 	             .spiral("archimedean")
  .on("end", draw).start();

  function draw(words) {
    var clickText = svg.selectAll("g text").data(words, function (d) {
      return d.text;
    })

    //Entering words
    .enter().append("text").style("font-family", '"Roboto Regular"').style("fill", function (d, i) {
      if (d.color) {
        return d.color;
      }
      return "#4192b7";
    }).style("font-size", function (d, i) {

      return parseInt(sizeScale(d.size));
    }).attr("text-anchor", "middle")
    // 	            .attr('font-size', 1)
    .attr("transform", function (d) {
      return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
    }).text(function (d) {
      return d.text;
    });
    if (barOptions.textClick == 'true') {
      clickText.on("click", function (d) {
        if (d.text == void 0) return;
        if (window.location.href.split("/transactionIntelligence/#")[1]) {
          window.open(window.location.href.split("/transactionIntelligence/#")[0] + "/entity/#!/company/" + d.text, '_blank');
        } else window.open(window.location.href.split("/#/")[0] + "/entity/#!/company/" + d.text, '_blank');
      }).style("cursor", "pointer");
    }
  }
  //        var defualts = {
  //             tag:"hottopictag",
  //        	 ballSize: 200
  //        };
  //
  //        var opts = $.extend({}, defualts, options);
  //        var tagEle = "querySelectorAll" in document ? document.querySelector("#"+options.id).querySelectorAll("."+opts.tag) : getClass(opts.tag),
  //            paper = $(this)[0];
  //            RADIUS = opts.ballSize,
  //            fallLength = 300*50,
  //            tags=[],
  //            angleX = Math.PI/fallLength,
  //            angleY = Math.PI/fallLength,
  //            CX = paper.offsetWidth/2,
  //            CY = paper.offsetHeight/2,
  //            EX = paper.offsetLeft + document.body.scrollLeft + document.documentElement.scrollLeft,
  //            EY = paper.offsetTop + document.body.scrollTop + document.documentElement.scrollTop;
  //
  //        function getClass(className){
  //            var ele = document.getElementsByTagName("*");
  //            var classEle = [];
  //            for(var i=0;i<ele.length;i++){
  //                var cn = ele[i].className;
  //                if(cn === className){
  //                    classEle.push(ele[i]);
  //                }
  //            }
  //            return classEle;
  //        }
  //
  //        function innit(){
  //            for(var i=0;i<tagEle.length;i++){
  //                var a , b;
  //                var k = (2*(i+1)-1)/tagEle.length - 1;
  //                var a = Math.acos(k);
  //                var b = a*Math.sqrt(tagEle.length*Math.PI);
  //                // var a = Math.random()*2*Math.PI;
  //                // var b = Math.random()*2*Math.PI;
  //                var x = RADIUS * Math.sin(a) * Math.cos(b);
  //                var y = RADIUS * Math.sin(a) * Math.sin(b);
  //                var z = RADIUS * Math.cos(a);
  //                var t = new tag(tagEle[i] , x , y , z);
  //               //tagEle[i].style.color = "rgb("+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+")";
  //                tags.push(t);
  //                t.move();
  //            }
  //        }
  //
  ////        Array.prototype.forEach = function(callback){
  ////            for(var i=0;i<this.length;i++){
  ////                callback.call(this[i]);
  ////            }
  ////        }
  //
  //        function animate(){
  //            setInterval(function(){
  //                rotateX();
  //                rotateY();
  //                for(var i=0;i<tags.length;i++){
  //                	tags[i].move();
  //                }
  ////                tags.forEach(function(){
  ////                    this.move();
  ////                })
  //            } , 200)
  //        }
  //
  //        if("addEventListener" in window){
  //            paper.addEventListener("mousemove" , function(event){
  //                var x = event.clientX - EX - CX;
  //                var y = event.clientY - EY - CY;
  //                // angleY = -x* (Math.sqrt(Math.pow(x , 2) + Math.pow(y , 2)) > RADIUS/4 ? 0.0002 : 0.0001);
  //                // angleX = -y* (Math.sqrt(Math.pow(x , 2) + Math.pow(y , 2)) > RADIUS/4 ? 0.0002 : 0.0001);
  //                angleY = x*0.0001;
  //                angleX = y*0.0001;
  //            });
  //        }
  //        else {
  //            paper.attachEvent("onmousemove" , function(event){
  //                var x = event.clientX - EX - CX;
  //                var y = event.clientY - EY - CY;
  //                angleY = x*0.0001;
  //                angleX = y*0.0001;
  //            });
  //        }
  //
  //        function rotateX(){
  //            var cos = Math.cos(angleX);
  //            var sin = Math.sin(angleX);
  //            for(var i=0;i<tags.length;i++){
  //            	var _this = tags[i];
  //            	var y1 = _this.y * cos - _this.z * sin;
  //                  var z1 = _this.z * cos + _this.y * sin;
  //                  _this.y = y1;
  //                  _this.z = z1;
  //            }
  ////            tags.forEach(function(){
  ////                var y1 = this.y * cos - this.z * sin;
  ////                var z1 = this.z * cos + this.y * sin;
  ////                this.y = y1;
  ////                this.z = z1;
  ////            })
  //
  //        }
  //
  //        function rotateY(){
  //            var cos = Math.cos(angleY);
  //            var sin = Math.sin(angleY);
  //            for(var i=0;i<tags.length;i++){
  //            	var _this = tags[i];
  //            	  var x1 = _this.x * cos - _this.z * sin;
  //                  var z1 = _this.z * cos + _this.x * sin;
  //                  _this.x = x1;
  //                  _this.z = z1;
  //            }
  ////            tags.forEach(function(){
  ////                var x1 = this.x * cos - this.z * sin;
  ////                var z1 = this.z * cos + this.x * sin;
  ////                this.x = x1;
  ////                this.z = z1;
  ////            })
  //        }
  //
  //        var tag = function(ele , x , y , z){
  //            this.ele = ele;
  //            this.x = x;
  //            this.y = y;
  //            this.z = z;
  //        }
  //
  //        tag.prototype = {
  //            move:function(){
  //                var scale = fallLength/(fallLength-this.z);
  //                var alpha = (this.z+RADIUS)/(2*RADIUS);
  //                this.ele.style.fontSize = 15 * scale + "px";
  //                this.ele.style.fontWeight= 'normal';
  //                this.ele.style.opacity = alpha + 0.5;
  //                this.ele.style.filter = "alpha(opacity = "+(alpha+0.5)*100+")";
  //                this.ele.style.zIndex = parseInt(scale*100);
  //                this.ele.style.left = this.x + CX - this.ele.offsetWidth/2 +"px";
  //                this.ele.style.top = this.y + CY - this.ele.offsetHeight/2 +"px";
  //            }
  //        }
  //        innit();
  //        animate();
}
"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

// https://github.com/topojson/topojson-client Version 1.8.0. Copyright 2016 Mike Bostock.
!function (n, t) {
  "object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? t(exports) : "function" == typeof define && define.amd ? define(["exports"], t) : t(n.topojson = n.topojson || {});
}(undefined, function (n) {
  "use strict";
  function t(n) {
    if (!n) return h;var t,
        r,
        e = n.scale[0],
        o = n.scale[1],
        i = n.translate[0],
        u = n.translate[1];return function (n, f) {
      f || (t = r = 0), n[0] = (t += n[0]) * e + i, n[1] = (r += n[1]) * o + u;
    };
  }function r(n) {
    if (!n) return h;var t,
        r,
        e = n.scale[0],
        o = n.scale[1],
        i = n.translate[0],
        u = n.translate[1];return function (n, f) {
      f || (t = r = 0);var c = Math.round((n[0] - i) / e),
          a = Math.round((n[1] - u) / o);n[0] = c - t, n[1] = a - r, t = c, r = a;
    };
  }function e(n, t) {
    for (var r, e = n.length, o = e - t; o < --e;) {
      r = n[o], n[o++] = n[e], n[e] = r;
    }
  }function o(n, t) {
    for (var r = 0, e = n.length; r < e;) {
      var o = r + e >>> 1;n[o] < t ? r = o + 1 : e = o;
    }return r;
  }function i(n, t) {
    var r = { type: "Feature", id: t.id, properties: t.properties || {}, geometry: u(n, t) };return null == t.id && delete r.id, r;
  }function u(n, r) {
    function o(n, t) {
      t.length && t.pop();for (var r, o = l[n < 0 ? ~n : n], i = 0, u = o.length; i < u; ++i) {
        t.push(r = o[i].slice()), s(r, i);
      }n < 0 && e(t, u);
    }function i(n) {
      return n = n.slice(), s(n, 0), n;
    }function u(n) {
      for (var t = [], r = 0, e = n.length; r < e; ++r) {
        o(n[r], t);
      }return t.length < 2 && t.push(t[0].slice()), t;
    }function f(n) {
      for (var t = u(n); t.length < 4;) {
        t.push(t[0].slice());
      }return t;
    }function c(n) {
      return n.map(f);
    }function a(n) {
      var t = n.type;return "GeometryCollection" === t ? { type: t, geometries: n.geometries.map(a) } : t in h ? { type: t, coordinates: h[t](n) } : null;
    }var s = t(n.transform),
        l = n.arcs,
        h = { Point: function Point(n) {
        return i(n.coordinates);
      }, MultiPoint: function MultiPoint(n) {
        return n.coordinates.map(i);
      }, LineString: function LineString(n) {
        return u(n.arcs);
      }, MultiLineString: function MultiLineString(n) {
        return n.arcs.map(u);
      }, Polygon: function Polygon(n) {
        return c(n.arcs);
      }, MultiPolygon: function MultiPolygon(n) {
        return n.arcs.map(c);
      } };return a(r);
  }function f(n, t, r) {
    function e(n) {
      var t = n < 0 ? ~n : n;(a[t] || (a[t] = [])).push({ i: n, g: c });
    }function o(n) {
      n.forEach(e);
    }function i(n) {
      n.forEach(o);
    }function u(n) {
      "GeometryCollection" === n.type ? n.geometries.forEach(u) : n.type in s && (c = n, s[n.type](n.arcs));
    }var f = [];if (arguments.length > 1) {
      var c,
          a = [],
          s = { LineString: o, MultiLineString: i, Polygon: i, MultiPolygon: function MultiPolygon(n) {
          n.forEach(i);
        } };u(t), a.forEach(arguments.length < 3 ? function (n) {
        f.push(n[0].i);
      } : function (n) {
        r(n[0].g, n[n.length - 1].g) && f.push(n[0].i);
      });
    } else for (var l = 0, h = n.arcs.length; l < h; ++l) {
      f.push(l);
    }return { type: "MultiLineString", arcs: v(n, f) };
  }function c(n) {
    var t = n[0],
        r = n[1],
        e = n[2];return Math.abs((t[0] - e[0]) * (r[1] - t[1]) - (t[0] - r[0]) * (e[1] - t[1]));
  }function a(n) {
    for (var t, r = -1, e = n.length, o = n[e - 1], i = 0; ++r < e;) {
      t = o, o = n[r], i += t[0] * o[1] - t[1] * o[0];
    }return i / 2;
  }function s(n, t) {
    function r(n) {
      n.forEach(function (t) {
        t.forEach(function (t) {
          (o[t = t < 0 ? ~t : t] || (o[t] = [])).push(n);
        });
      }), i.push(n);
    }function e(t) {
      return Math.abs(a(u(n, { type: "Polygon", arcs: [t] }).coordinates[0]));
    }var o = {},
        i = [],
        f = [];return t.forEach(function (n) {
      "Polygon" === n.type ? r(n.arcs) : "MultiPolygon" === n.type && n.arcs.forEach(r);
    }), i.forEach(function (n) {
      if (!n._) {
        var t = [],
            r = [n];for (n._ = 1, f.push(t); n = r.pop();) {
          t.push(n), n.forEach(function (n) {
            n.forEach(function (n) {
              o[n < 0 ? ~n : n].forEach(function (n) {
                n._ || (n._ = 1, r.push(n));
              });
            });
          });
        }
      }
    }), i.forEach(function (n) {
      delete n._;
    }), { type: "MultiPolygon", arcs: f.map(function (t) {
        var r,
            i = [];if (t.forEach(function (n) {
          n.forEach(function (n) {
            n.forEach(function (n) {
              o[n < 0 ? ~n : n].length < 2 && i.push(n);
            });
          });
        }), i = v(n, i), (r = i.length) > 1) for (var u, f, c = 1, a = e(i[0]); c < r; ++c) {
          (u = e(i[c])) > a && (f = i[0], i[0] = i[c], i[c] = f, a = u);
        }return i;
      }) };
  }function l(n, t) {
    return n[1][2] - t[1][2];
  }var h = function h() {},
      p = function p(n, t) {
    return "GeometryCollection" === t.type ? { type: "FeatureCollection", features: t.geometries.map(function (t) {
        return i(n, t);
      }) } : i(n, t);
  },
      v = function v(n, t) {
    function r(t) {
      var r,
          e = n.arcs[t < 0 ? ~t : t],
          o = e[0];return n.transform ? (r = [0, 0], e.forEach(function (n) {
        r[0] += n[0], r[1] += n[1];
      })) : r = e[e.length - 1], t < 0 ? [r, o] : [o, r];
    }function e(n, t) {
      for (var r in n) {
        var e = n[r];delete t[e.start], delete e.start, delete e.end, e.forEach(function (n) {
          o[n < 0 ? ~n : n] = 1;
        }), f.push(e);
      }
    }var o = {},
        i = {},
        u = {},
        f = [],
        c = -1;return t.forEach(function (r, e) {
      var o,
          i = n.arcs[r < 0 ? ~r : r];i.length < 3 && !i[1][0] && !i[1][1] && (o = t[++c], t[c] = r, t[e] = o);
    }), t.forEach(function (n) {
      var t,
          e,
          o = r(n),
          f = o[0],
          c = o[1];if (t = u[f]) {
        if (delete u[t.end], t.push(n), t.end = c, e = i[c]) {
          delete i[e.start];var a = e === t ? t : t.concat(e);i[a.start = t.start] = u[a.end = e.end] = a;
        } else i[t.start] = u[t.end] = t;
      } else if (t = i[c]) {
        if (delete i[t.start], t.unshift(n), t.start = f, e = u[f]) {
          delete u[e.end];var s = e === t ? t : e.concat(t);i[s.start = e.start] = u[s.end = t.end] = s;
        } else i[t.start] = u[t.end] = t;
      } else t = [n], i[t.start = f] = u[t.end = c] = t;
    }), e(u, i), e(i, u), t.forEach(function (n) {
      o[n < 0 ? ~n : n] || f.push([n]);
    }), f;
  },
      g = function g(n) {
    return u(n, f.apply(this, arguments));
  },
      d = function d(n) {
    return u(n, s.apply(this, arguments));
  },
      y = function y(n) {
    function t(n, t) {
      n.forEach(function (n) {
        n < 0 && (n = ~n);var r = i[n];r ? r.push(t) : i[n] = [t];
      });
    }function r(n, r) {
      n.forEach(function (n) {
        t(n, r);
      });
    }function e(n, t) {
      "GeometryCollection" === n.type ? n.geometries.forEach(function (n) {
        e(n, t);
      }) : n.type in f && f[n.type](n.arcs, t);
    }var i = {},
        u = n.map(function () {
      return [];
    }),
        f = { LineString: t, MultiLineString: r, Polygon: r, MultiPolygon: function MultiPolygon(n, t) {
        n.forEach(function (n) {
          r(n, t);
        });
      } };n.forEach(e);for (var c in i) {
      for (var a = i[c], s = a.length, l = 0; l < s; ++l) {
        for (var h = l + 1; h < s; ++h) {
          var p,
              v = a[l],
              g = a[h];(p = u[v])[c = o(p, g)] !== g && p.splice(c, 0, g), (p = u[g])[c = o(p, v)] !== v && p.splice(c, 0, v);
        }
      }
    }return u;
  },
      m = function m() {
    function n(n, t) {
      for (; t > 0;) {
        var r = (t + 1 >> 1) - 1,
            o = e[r];if (l(n, o) >= 0) break;e[o._ = t] = o, e[n._ = t = r] = n;
      }
    }function t(n, t) {
      for (;;) {
        var r = t + 1 << 1,
            i = r - 1,
            u = t,
            f = e[u];if (i < o && l(e[i], f) < 0 && (f = e[u = i]), r < o && l(e[r], f) < 0 && (f = e[u = r]), u === t) break;e[f._ = t] = f, e[n._ = t = u] = n;
      }
    }var r = {},
        e = [],
        o = 0;return r.push = function (t) {
      return n(e[t._ = o] = t, o++), o;
    }, r.pop = function () {
      if (!(o <= 0)) {
        var n,
            r = e[0];return --o > 0 && (n = e[o], t(e[n._ = 0] = n, 0)), r;
      }
    }, r.remove = function (r) {
      var i,
          u = r._;if (e[u] === r) return u !== --o && (i = e[o], (l(i, r) < 0 ? n : t)(e[i._ = u] = i, u)), u;
    }, r;
  },
      E = function E(n, e) {
    function o(n) {
      f.remove(n), n[1][2] = e(n), f.push(n);
    }var i = t(n.transform),
        u = r(n.transform),
        f = m();return null == e && (e = c), n.arcs.forEach(function (n) {
      var t,
          r,
          c,
          a,
          s = [],
          l = 0;for (r = 0, c = n.length; r < c; ++r) {
        a = n[r], i(n[r] = [a[0], a[1], 1 / 0], r);
      }for (r = 1, c = n.length - 1; r < c; ++r) {
        t = n.slice(r - 1, r + 2), t[1][2] = e(t), s.push(t), f.push(t);
      }for (r = 0, c = s.length; r < c; ++r) {
        t = s[r], t.previous = s[r - 1], t.next = s[r + 1];
      }for (; t = f.pop();) {
        var h = t.previous,
            p = t.next;t[1][2] < l ? t[1][2] = l : l = t[1][2], h && (h.next = p, h[2] = t[2], o(h)), p && (p.previous = h, p[0] = t[0], o(p));
      }n.forEach(u);
    }), n;
  };n.mesh = g, n.meshArcs = f, n.merge = d, n.mergeArcs = s, n.feature = p, n.neighbors = y, n.presimplify = E, Object.defineProperty(n, "__esModule", { value: !0 });
});
"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

// Word cloud layout by Jason Davies, http://www.jasondavies.com/word-cloud/
// Algorithm due to Jonathan Feinberg, http://static.mrfeinberg.com/bv_ch03.pdf
// Copies a variable number of methods from source to target.
d3.rebind = function (target, source) {
  var i = 1,
      n = arguments.length,
      method;
  while (++i < n) {
    target[method = arguments[i]] = d3_rebind(target, source, source[method]);
  }return target;
};

(function (f) {
  if ((typeof exports === "undefined" ? "undefined" : _typeof(exports)) === "object" && typeof module !== "undefined") {
    module.exports = f();
  } else if (typeof define === "function" && define.amd) {
    define([], f);
  } else {
    var g;if (typeof window !== "undefined") {
      g = window;
    } else if (typeof global !== "undefined") {
      g = global;
    } else if (typeof self !== "undefined") {
      g = self;
    } else {
      g = this;
    }g = g.d3 || (g.d3 = {});g = g.layout || (g.layout = {});g.cloud = f();
  }
})(function () {
  var define, module, exports;return function e(t, n, r) {
    function s(o, u) {
      if (!n[o]) {
        if (!t[o]) {
          var a = typeof require == "function" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error("Cannot find module '" + o + "'");throw f.code = "MODULE_NOT_FOUND", f;
        }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {
          var n = t[o][1][e];return s(n ? n : e);
        }, l, l.exports, e, t, n, r);
      }return n[o].exports;
    }var i = typeof require == "function" && require;for (var o = 0; o < r.length; o++) {
      s(r[o]);
    }return s;
  }({ 1: [function (require, module, exports) {
      // Word cloud layout by Jason Davies, https://www.jasondavies.com/wordcloud/
      // Algorithm due to Jonathan Feinberg, http://static.mrfeinberg.com/bv_ch03.pdf

      var dispatch = require("d3-dispatch").dispatch;

      var cloudRadians = Math.PI / 180,
          cw = 1 << 11 >> 5,
          ch = 1 << 11;

      module.exports = function () {
        var size = [256, 256],
            text = cloudText,
            font = cloudFont,
            fontSize = cloudFontSize,
            fontStyle = cloudFontNormal,
            fontWeight = cloudFontNormal,
            rotate = cloudRotate,
            padding = cloudPadding,
            spiral = archimedeanSpiral,
            words = [],
            timeInterval = Infinity,
            event = dispatch("word", "end"),
            timer = null,
            random = Math.random,
            cloud = {},
            canvas = cloudCanvas;

        cloud.canvas = function (_) {
          return arguments.length ? (canvas = functor(_), cloud) : canvas;
        };

        cloud.start = function () {
          var contextAndRatio = getContext(canvas()),
              board = zeroArray((size[0] >> 5) * size[1]),
              bounds = null,
              n = words.length,
              i = -1,
              tags = [],
              data = words.map(function (d, i) {
            d.text = text.call(this, d, i);
            d.font = font.call(this, d, i);
            d.style = fontStyle.call(this, d, i);
            d.weight = fontWeight.call(this, d, i);
            d.rotate = rotate.call(this, d, i);
            d.size = ~~fontSize.call(this, d, i);
            d.padding = padding.call(this, d, i);
            return d;
          }).sort(function (a, b) {
            return b.size - a.size;
          });

          if (timer) clearInterval(timer);
          timer = setInterval(step, 0);
          step();

          return cloud;

          function step() {
            var start = Date.now();
            while (Date.now() - start < timeInterval && ++i < n && timer) {
              var d = data[i];
              d.x = size[0] * (random() + .5) >> 1;
              d.y = size[1] * (random() + .5) >> 1;
              cloudSprite(contextAndRatio, d, data, i);
              if (d.hasText && place(board, d, bounds)) {
                tags.push(d);
                event.call("word", cloud, d);
                if (bounds) cloudBounds(bounds, d);else bounds = [{ x: d.x + d.x0, y: d.y + d.y0 }, { x: d.x + d.x1, y: d.y + d.y1 }];
                // Temporary hack
                d.x -= size[0] >> 1;
                d.y -= size[1] >> 1;
              }
            }
            if (i >= n) {
              cloud.stop();
              event.call("end", cloud, tags, bounds);
            }
          }
        };

        cloud.stop = function () {
          if (timer) {
            clearInterval(timer);
            timer = null;
          }
          return cloud;
        };

        function getContext(canvas) {
          canvas.width = canvas.height = 1;
          var ratio = Math.sqrt(canvas.getContext("2d").getImageData(0, 0, 1, 1).data.length >> 2);
          canvas.width = (cw << 5) / ratio;
          canvas.height = ch / ratio;

          var context = canvas.getContext("2d");
          context.fillStyle = context.strokeStyle = "red";
          context.textAlign = "center";

          return { context: context, ratio: ratio };
        }

        function place(board, tag, bounds) {
          var perimeter = [{ x: 0, y: 0 }, { x: size[0], y: size[1] }],
              startX = tag.x,
              startY = tag.y,
              maxDelta = Math.sqrt(size[0] * size[0] + size[1] * size[1]),
              s = spiral(size),
              dt = random() < .5 ? 1 : -1,
              t = -dt,
              dxdy,
              dx,
              dy;

          while (dxdy = s(t += dt)) {
            dx = ~~dxdy[0];
            dy = ~~dxdy[1];

            if (Math.min(Math.abs(dx), Math.abs(dy)) >= maxDelta) break;

            tag.x = startX + dx;
            tag.y = startY + dy;

            if (tag.x + tag.x0 < 0 || tag.y + tag.y0 < 0 || tag.x + tag.x1 > size[0] || tag.y + tag.y1 > size[1]) continue;
            // TODO only check for collisions within current bounds.
            if (!bounds || !cloudCollide(tag, board, size[0])) {
              if (!bounds || collideRects(tag, bounds)) {
                var sprite = tag.sprite,
                    w = tag.width >> 5,
                    sw = size[0] >> 5,
                    lx = tag.x - (w << 4),
                    sx = lx & 0x7f,
                    msx = 32 - sx,
                    h = tag.y1 - tag.y0,
                    x = (tag.y + tag.y0) * sw + (lx >> 5),
                    last;
                for (var j = 0; j < h; j++) {
                  last = 0;
                  for (var i = 0; i <= w; i++) {
                    board[x + i] |= last << msx | (i < w ? (last = sprite[j * w + i]) >>> sx : 0);
                  }
                  x += sw;
                }
                delete tag.sprite;
                return true;
              }
            }
          }
          return false;
        }

        cloud.timeInterval = function (_) {
          return arguments.length ? (timeInterval = _ == null ? Infinity : _, cloud) : timeInterval;
        };

        cloud.words = function (_) {
          return arguments.length ? (words = _, cloud) : words;
        };

        cloud.size = function (_) {
          return arguments.length ? (size = [+_[0], +_[1]], cloud) : size;
        };

        cloud.font = function (_) {
          return arguments.length ? (font = functor(_), cloud) : font;
        };

        cloud.fontStyle = function (_) {
          return arguments.length ? (fontStyle = functor(_), cloud) : fontStyle;
        };

        cloud.fontWeight = function (_) {
          return arguments.length ? (fontWeight = functor(_), cloud) : fontWeight;
        };

        cloud.rotate = function (_) {
          return arguments.length ? (rotate = functor(_), cloud) : rotate;
        };

        cloud.text = function (_) {
          return arguments.length ? (text = functor(_), cloud) : text;
        };

        cloud.spiral = function (_) {
          return arguments.length ? (spiral = spirals[_] || _, cloud) : spiral;
        };

        cloud.fontSize = function (_) {
          return arguments.length ? (fontSize = functor(_), cloud) : fontSize;
        };

        cloud.padding = function (_) {
          return arguments.length ? (padding = functor(_), cloud) : padding;
        };

        cloud.random = function (_) {
          return arguments.length ? (random = _, cloud) : random;
        };

        cloud.on = function () {
          var value = event.on.apply(event, arguments);
          return value === event ? cloud : value;
        };

        return cloud;
      };

      function cloudText(d) {
        return d.text;
      }

      function cloudFont() {
        return "serif";
      }

      function cloudFontNormal() {
        return "normal";
      }

      function cloudFontSize(d) {
        return Math.sqrt(d.value);
      }

      function cloudRotate() {
        return (~~(Math.random() * 6) - 3) * 30;
      }

      function cloudPadding() {
        return 1;
      }

      // Fetches a monochrome sprite bitmap for the specified text.
      // Load in batches for speed.
      function cloudSprite(contextAndRatio, d, data, di) {
        if (d.sprite) return;
        var c = contextAndRatio.context,
            ratio = contextAndRatio.ratio;

        c.clearRect(0, 0, (cw << 5) / ratio, ch / ratio);
        var x = 0,
            y = 0,
            maxh = 0,
            n = data.length;
        --di;
        while (++di < n) {
          d = data[di];
          c.save();
          c.font = d.style + " " + d.weight + " " + ~~((d.size + 1) / ratio) + "px " + d.font;
          var w = c.measureText(d.text + "m").width * ratio,
              h = d.size << 1;
          if (d.rotate) {
            var sr = Math.sin(d.rotate * cloudRadians),
                cr = Math.cos(d.rotate * cloudRadians),
                wcr = w * cr,
                wsr = w * sr,
                hcr = h * cr,
                hsr = h * sr;
            w = Math.max(Math.abs(wcr + hsr), Math.abs(wcr - hsr)) + 0x1f >> 5 << 5;
            h = ~~Math.max(Math.abs(wsr + hcr), Math.abs(wsr - hcr));
          } else {
            w = w + 0x1f >> 5 << 5;
          }
          if (h > maxh) maxh = h;
          if (x + w >= cw << 5) {
            x = 0;
            y += maxh;
            maxh = 0;
          }
          if (y + h >= ch) break;
          c.translate((x + (w >> 1)) / ratio, (y + (h >> 1)) / ratio);
          if (d.rotate) c.rotate(d.rotate * cloudRadians);
          c.fillText(d.text, 0, 0);
          if (d.padding) c.lineWidth = 2 * d.padding, c.strokeText(d.text, 0, 0);
          c.restore();
          d.width = w;
          d.height = h;
          d.xoff = x;
          d.yoff = y;
          d.x1 = w >> 1;
          d.y1 = h >> 1;
          d.x0 = -d.x1;
          d.y0 = -d.y1;
          d.hasText = true;
          x += w;
        }
        var pixels = c.getImageData(0, 0, (cw << 5) / ratio, ch / ratio).data,
            sprite = [];
        while (--di >= 0) {
          d = data[di];
          if (!d.hasText) continue;
          var w = d.width,
              w32 = w >> 5,
              h = d.y1 - d.y0;
          // Zero the buffer
          for (var i = 0; i < h * w32; i++) {
            sprite[i] = 0;
          }x = d.xoff;
          if (x == null) return;
          y = d.yoff;
          var seen = 0,
              seenRow = -1;
          for (var j = 0; j < h; j++) {
            for (var i = 0; i < w; i++) {
              var k = w32 * j + (i >> 5),
                  m = pixels[(y + j) * (cw << 5) + (x + i) << 2] ? 1 << 31 - i % 32 : 0;
              sprite[k] |= m;
              seen |= m;
            }
            if (seen) seenRow = j;else {
              d.y0++;
              h--;
              j--;
              y++;
            }
          }
          d.y1 = d.y0 + seenRow;
          d.sprite = sprite.slice(0, (d.y1 - d.y0) * w32);
        }
      }

      // Use mask-based collision detection.
      function cloudCollide(tag, board, sw) {
        sw >>= 5;
        var sprite = tag.sprite,
            w = tag.width >> 5,
            lx = tag.x - (w << 4),
            sx = lx & 0x7f,
            msx = 32 - sx,
            h = tag.y1 - tag.y0,
            x = (tag.y + tag.y0) * sw + (lx >> 5),
            last;
        for (var j = 0; j < h; j++) {
          last = 0;
          for (var i = 0; i <= w; i++) {
            if ((last << msx | (i < w ? (last = sprite[j * w + i]) >>> sx : 0)) & board[x + i]) return true;
          }
          x += sw;
        }
        return false;
      }

      function cloudBounds(bounds, d) {
        var b0 = bounds[0],
            b1 = bounds[1];
        if (d.x + d.x0 < b0.x) b0.x = d.x + d.x0;
        if (d.y + d.y0 < b0.y) b0.y = d.y + d.y0;
        if (d.x + d.x1 > b1.x) b1.x = d.x + d.x1;
        if (d.y + d.y1 > b1.y) b1.y = d.y + d.y1;
      }

      function collideRects(a, b) {
        return a.x + a.x1 > b[0].x && a.x + a.x0 < b[1].x && a.y + a.y1 > b[0].y && a.y + a.y0 < b[1].y;
      }

      function archimedeanSpiral(size) {
        var e = size[0] / size[1];
        return function (t) {
          return [e * (t *= .1) * Math.cos(t), t * Math.sin(t)];
        };
      }

      function rectangularSpiral(size) {
        var dy = 4,
            dx = dy * size[0] / size[1],
            x = 0,
            y = 0;
        return function (t) {
          var sign = t < 0 ? -1 : 1;
          // See triangular numbers: T_n = n * (n + 1) / 2.
          switch (Math.sqrt(1 + 4 * sign * t) - sign & 3) {
            case 0:
              x += dx;break;
            case 1:
              y += dy;break;
            case 2:
              x -= dx;break;
            default:
              y -= dy;break;
          }
          return [x, y];
        };
      }

      // TODO reuse arrays?
      function zeroArray(n) {
        var a = [],
            i = -1;
        while (++i < n) {
          a[i] = 0;
        }return a;
      }

      function cloudCanvas() {
        return document.createElement("canvas");
      }

      function functor(d) {
        return typeof d === "function" ? d : function () {
          return d;
        };
      }

      var spirals = {
        archimedean: archimedeanSpiral,
        rectangular: rectangularSpiral
      };
    }, { "d3-dispatch": 2 }], 2: [function (require, module, exports) {
      // https://d3js.org/d3-dispatch/ Version 1.0.2. Copyright 2016 Mike Bostock.
      (function (global, factory) {
        (typeof exports === "undefined" ? "undefined" : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : factory(global.d3 = global.d3 || {});
      })(this, function (exports) {
        'use strict';

        var noop = { value: function value() {} };

        function dispatch() {
          for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {
            if (!(t = arguments[i] + "") || t in _) throw new Error("illegal type: " + t);
            _[t] = [];
          }
          return new Dispatch(_);
        }

        function Dispatch(_) {
          this._ = _;
        }

        function parseTypenames(typenames, types) {
          return typenames.trim().split(/^|\s+/).map(function (t) {
            var name = "",
                i = t.indexOf(".");
            if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);
            if (t && !types.hasOwnProperty(t)) throw new Error("unknown type: " + t);
            return { type: t, name: name };
          });
        }

        Dispatch.prototype = dispatch.prototype = {
          constructor: Dispatch,
          on: function on(typename, callback) {
            var _ = this._,
                T = parseTypenames(typename + "", _),
                t,
                i = -1,
                n = T.length;

            // If no callback was specified, return the callback of the given type and name.
            if (arguments.length < 2) {
              while (++i < n) {
                if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;
              }return;
            }

            // If a type was specified, set the callback for the given type and name.
            // Otherwise, if a null callback was specified, remove callbacks of the given name.
            if (callback != null && typeof callback !== "function") throw new Error("invalid callback: " + callback);
            while (++i < n) {
              if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);else if (callback == null) for (t in _) {
                _[t] = set(_[t], typename.name, null);
              }
            }

            return this;
          },
          copy: function copy() {
            var copy = {},
                _ = this._;
            for (var t in _) {
              copy[t] = _[t].slice();
            }return new Dispatch(copy);
          },
          call: function call(type, that) {
            if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) {
              args[i] = arguments[i + 2];
            }if (!this._.hasOwnProperty(type)) throw new Error("unknown type: " + type);
            for (t = this._[type], i = 0, n = t.length; i < n; ++i) {
              t[i].value.apply(that, args);
            }
          },
          apply: function apply(type, that, args) {
            if (!this._.hasOwnProperty(type)) throw new Error("unknown type: " + type);
            for (var t = this._[type], i = 0, n = t.length; i < n; ++i) {
              t[i].value.apply(that, args);
            }
          }
        };

        function get(type, name) {
          for (var i = 0, n = type.length, c; i < n; ++i) {
            if ((c = type[i]).name === name) {
              return c.value;
            }
          }
        }

        function set(type, name, callback) {
          for (var i = 0, n = type.length; i < n; ++i) {
            if (type[i].name === name) {
              type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));
              break;
            }
          }
          if (callback != null) type.push({ name: name, value: callback });
          return type;
        }

        exports.dispatch = dispatch;

        Object.defineProperty(exports, '__esModule', { value: true });
      });
    }, {}] }, {}, [1])(1);
});
"use strict";

/* cluster bubble chart constant values */
var clusterBubbleConst = {
    colors: ["#31d99c", "#5888C8", "#de5942", "#ffa618"],
    dy: ".3em"
};
function clusterbubbleChart(clusturedOptions) {
    if (clusturedOptions.container) {
        $(clusturedOptions.container).empty();
    }
    /*--------------------------Initialize Values-----------------------------*/
    if (clusturedOptions) {
        this.container = clusturedOptions.container ? clusturedOptions.container : "body";
        this.data = clusturedOptions.data ? clusturedOptions.data : [];
        this.header = clusturedOptions.header ? clusturedOptions.header : "CLUSTURED CHART";
        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.height = clusturedOptions.height ? clusturedOptions.height : 600;
        this.headerOptionsExpand = clusturedOptions.headerOptionsExpand == false ? clusturedOptions.headerOptionsExpand : true;
        this.headerOptions = clusturedOptions.headerOptions == false ? clusturedOptions.headerOptions : true;
        this.isheader = clusturedOptions.isheader == false ? clusturedOptions.isheader : true;
    } else {
        return false;
    }

    var actualOptions = jQuery.extend(true, {}, clusturedOptions);
    var clusterbubbleChartId = this.container;
    var randomSubstring = this.randomIdString;
    var h1 = this.height;
    var h = parseInt(h1) + 40;
    var header = this.header;

    var _this = this;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';

    var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;margin: auto; background-color:transparent; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    $(this.container).html(chartContainerdiv);
    $(this.container).append(modal);
    var chart_container = "#bubble_chart_div" + randomSubstring;
    this.width = clusturedOptions.width ? clusturedOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }

    this.diameter = this.height > this.width ? this.width - 50 : this.height - 50;
    if (!this.headerOptionsExpand) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }

    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    if (this.headerOptions) $(chart_container).siblings(".headerDiv").append(header_options);

    if (!this.headerOptionsExpand) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }
    if (!this.isheader) {
        $(chart_container).siblings(".headerDiv").css("display", "none");
    }
    data = this.data;
    var tool_tip = $('body').append('<div class="Cluster_Chart_tooltip" style="text-transform:uppercase;position: absolute; z-index: 99999;opacity: 1; pointer-events: none; display:none"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(clusterBubbleConst.colors);
    var width = this.width,
        height = this.height,
        diameter = this.diameter,
        node,
        root,
        radius = Math.min(width, height) / 2;

    var pie = d3.pie().sort(null).value(function (d) {
        return d.value;
    });
    var arc = d3.arc().outerRadius(radius - 66).innerRadius(radius - 40).padAngle(0.03);

    var svg = d3.select(chart_container).append("svg:svg").attr("width", width).attr("height", height).append("svg:g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    plotclusterbubbleChart(data);
    function plotclusterbubbleChart(data) {
        var g = svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class", "arc").call(d3.zoom().on("zoom", function () {
            g.attr("transform", d3.event.transform);
        }));

        g.append("path").attr("d", arc).style("fill", function (d) {
            return colorScale(d.data.label);
        }).on("mouseover", function (d) {
            if (d.data.txt) {
                $(".Cluster_Chart_tooltip").html(d.data.txt);
                $(".Cluster_Chart_tooltip").css("visibility", "visible");
                return $(".Cluster_Chart_tooltip").css("display", "block");
            } else if (d.data.label) {
                $(this).css("opacity", 1);
                var valueStr = '';
                valueStr = ': <span>' + d.data.value + '</span>';
                $(".Cluster_Chart_tooltip").html('<span>' + d.data.label + '</span> ' + valueStr);
                $(".Cluster_Chart_tooltip").css("visibility", "visible");
                return $(".Cluster_Chart_tooltip").css("display", "block");
            } else {
                $(".Cluster_Chart_tooltip").css("visibility", "hidden");
                return $(".Cluster_Chart_tooltip").css("display", "none");
            }
        }).on("mousemove", function () {
            var p = $(chart_container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".Cluster_Chart_tooltip").width() + 50;
            var cursor = d3.event.x;

            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("Cluster_Chart_tooltip");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".Cluster_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Cluster_Chart_tooltip").width() + "px");
            } else {

                var element = document.getElementsByClassName("Cluster_Chart_tooltip");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".Cluster_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
            return $(".Cluster_Chart_tooltip").css("top", d3.event.pageY + "px");
        }).on("mouseout", function () {
            $(".Cluster_Chart_tooltip").css("visibility", "hidden");
            /*hide tool-tip*/
            return $(".Cluster_Chart_tooltip").css("display", "none");
        });;

        arc.outerRadius(radius - 10).innerRadius(-110);

        /*create zone regions*/
        var zones = [];
        g.append("g").attr("class", function (d, i) {
            return "bubble" + i;
        }).attr("transform", function (d) {
            zones[d.data.label] = arc.centroid(d);
            return "translate(" + arc.centroid(d) + ")";
        });

        /*loop through data and for EACH children array paint dots.*/
        $.each(data, function (index, value) {
            setBubbleChart(radius - 30, index, value.children);
        });
        /*custom bubble chart*/
        function bubbledata(data) {
            return $.extend(true, {}, {
                "children": data
            });
            /* return deep clone*/
        }

        function setBubbleChart(width, index, data) {
            if (data.length == 0) {
                return;
            }
            /*_create bubble*/
            var diameter = width / 2;

            var bubs = svg.select(".bubble" + index).append("g").attr("class", "bubs");

            bubs.attr("transform", "translate(" + -diameter / 2 + "," + -diameter / 2 + ")");
            /*_create bubble*/
            var data = bubbledata(data);
            var pack = d3.pack().size([diameter, diameter]);
            node = root = d3.hierarchy(data).sum(function (d) {
                return d.size;
            }).sort(function (a, b) {
                return b.value - a.value;
            });

            var nodes = pack(root).descendants();

            var bubbles = bubs.selectAll('circle').data(nodes);

            bubbles.enter().insert("circle").attr('transform', function (d) {
                return 'translate(' + d.x + ',' + d.y + ')';
            }).attr('r', function (d) {
                return d.r;
            }).style("stroke-width", 3).style("opacity", 0.4).style("fill", function (d) {
                if (d.data.group) {
                    return colorScale(d.data.group);
                } else {
                    return "none";
                }
            }).style("stroke", function (d) {
                if (d.data.group) {
                    return colorScale(d.data.group);
                } else {
                    return "none";
                }
            }).on("mouseover", function (d) {
                if (d.data.txt) {
                    $(".Cluster_Chart_tooltip").html(d.data.txt);
                    $(".Cluster_Chart_tooltip").css("visibility", "visible");

                    return $(".Cluster_Chart_tooltip").css("display", "block");
                } else if (d.data.size) {
                    $(this).css("opacity", 1);
                    var valueStr = '';
                    valueStr = ': <span>' + d.data.size.toFixed(2) + '</span>';
                    $(".Cluster_Chart_tooltip").html('<span>' + d.data.name + '</span> ' + valueStr);
                    $(".Cluster_Chart_tooltip").css("visibility", "visible");
                    return $(".Cluster_Chart_tooltip").css("display", "block");
                } else {
                    $(".Cluster_Chart_tooltip").css("visibility", "hidden");
                    return $(".Cluster_Chart_tooltip").css("display", "none");
                }
            }).on("mousemove", function () {
                var p = $(chart_container);
                var position = p.offset();
                var windowWidth = window.innerWidth;
                var tooltipWidth = $(".Cluster_Chart_tooltip").width() + 50;
                var cursor = d3.event.x;
                if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                    var element = document.getElementsByClassName("Cluster_Chart_tooltip");
                    element[0].classList.remove("tooltip-left");
                    element[0].classList.add("tooltip-right");
                    $(".Cluster_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Cluster_Chart_tooltip").width() + "px");
                } else {
                    var element = document.getElementsByClassName("Cluster_Chart_tooltip");
                    element[0].classList.remove("tooltip-right");
                    element[0].classList.add("tooltip-left");
                    $(".Cluster_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
                }
                return $(".Cluster_Chart_tooltip").css("top", d3.event.pageY + "px");
            }).on("mouseout", function () {
                $(this).css("opacity", 0.4);
                /*hide tool-tip*/
                $(".Cluster_Chart_tooltip").css("visibility", "hidden");
                return $(".Cluster_Chart_tooltip").css("display", "none");
            });

            bubbles.enter().insert("text").attr('transform', function (d) {
                return 'translate(' + d.x + ',' + d.y + ')';
            }).attr("class", "bubbletext").attr("dy", clusterBubbleConst.dy).style("text-anchor", "middle").text(function (d) {});

            bubbles = bubbles.attr('transform', function (d) {
                return 'translate(' + d.x + ',' + d.y + ')';
            }).attr('r', function (d) {
                return d.r;
            }).style("stroke-width", 5);
        }
    }

    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {

        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(clusterbubbleChartId).empty();
            ClusterBubble(actualOptions);
        }
    });
    /**
     * Fuction to handle show hide of header options
     */

    $("body").on("click", ".header_table_" + randomSubstring, function () {

        $(chart_container).empty();
        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");

        var tbl = "<div id ='cluster_table_" + randomSubstring + "'  style='padding:5px;background-color: #425661;overflow:overflow:hidden;height:" + _this.height + "px'><table id ='cluster_table1_" + randomSubstring + "' class='table-striped ' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E; ' ><thead><tr><th>NAME</th><th>VALUE</th><th>GROUP</th></tr></thead><tbody>";
        $.each(data, function (i, v) {
            $.each(v.children, function (index, value) {
                tbl = tbl + "<tr><td>" + value.name.toUpperCase() + "</td><td>" + value.size + "</td><td>" + value.group + "</td></tr>";
            });
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $("#cluster_table1_" + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });
        $("#cluster_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#cluster_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");
        var id1 = $("#cluster_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#cluster_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#cluster_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });

    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;
            options.headerOptionsExpand = false;
            options.height = 450;
            new ClusterBubble(options);
        }, 500);
    });
}
"use strict";

function CaseTimeLineChart(CaseTimeLineOptions) {
    if (CaseTimeLineOptions.container) {
        $(CaseTimeLineOptions.container).empty();
    }
    /* --------------------------Initialize Values----------------------------- */
    if (CaseTimeLineOptions) {
        this.container = CaseTimeLineOptions.container ? CaseTimeLineOptions.container : "body";
        this.data = CaseTimeLineOptions.data ? CaseTimeLineOptions.data : [];
        this.height = CaseTimeLineOptions.height ? CaseTimeLineOptions.height : 600;
        this.uri = CaseTimeLineOptions.uri;
        this.CaseTimeLineHeader = CaseTimeLineOptions.header ? CaseTimeLineOptions.header : "CaseTimeLine CHART";
        this.margin = CaseTimeLineOptions.margin ? {
            top: CaseTimeLineOptions.margin.top ? CaseTimeLineOptions.margin.top : 20,
            right: CaseTimeLineOptions.margin.right ? CaseTimeLineOptions.margin.right : 20,
            bottom: CaseTimeLineOptions.margin.bottom ? CaseTimeLineOptions.margin.bottom : 30,
            left: CaseTimeLineOptions.margin.left ? CaseTimeLineOptions.margin.left : 40
        } : { top: 10, right: 10, bottom: 20, left: 10 };
        this.randomIdString = Math.floor(Math.random() * 10000000000);
    } else {

        return false;
    }
    var actualOptioins = jQuery.extend(true, {}, CaseTimeLineOptions);
    var options = jQuery.extend(true, {}, CaseTimeLineOptions);
    var randomSubstring = this.randomIdString;
    var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 5px; font-size: 14px;"> <div class="graphBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"><div id="CaseTimeLine_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    $(this.container).html(chartContainerdiv);
    var chart_container;
    var domElement = chart_container = "#CaseTimeLine_chart_div" + randomSubstring;
    this.width = CaseTimeLineOptions.width ? CaseTimeLineOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);
    var data = this.data;
    var curretn_uri = this.uri;
    var CaseTimeLine_header = this.header;
    var tool_tip = $('body').append('<div class="CaseTimeLine_Chart_tooltip" style="position: absolute; opacity: 1; pointer-events: none; display:none;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    var containerid = this.container;
    var colorScale = d3.scaleOrdinal().range(["#32709A", "#1CB766", "#CEB012", "#E61872", "#ffa618"]);
    var margin = this.margin,
        width = this.width - margin.left - margin.right,
        height = this.height - margin.top - margin.bottom;
    var outerWidth = this.width,
        outerHeight = this.height;
    /* APPEND legend header */
    $(".groupedbarlegendContainerDiv").remove();
    $(chart_container).parent().find(".headerDiv").append("<div style='float:right;font-size:14px;' class='groupedbarlegendContainerDiv legend-container' id='legendContainer-" + randomSubstring + "'></div>");

    timeline(chart_container).data(data).band("mainBand", 0.82).band("naviBand", 0.08).xAxis("mainBand").xAxis("naviBand").brush("naviBand", ["mainBand"]).redraw();

    function timeline(domElement) {
        /* global timeline variables */
        var timeline = {},
            /* The timeline */
        data = {},
            /* Container for the data */
        components = [],
            /* All the components of the timeline for redrawing */
        bandGap = 25,
            /* Arbitray gap between to consecutive bands */
        bands = {},
            /* Registry for all the bands in the timeline */
        bandY = 0,
            /* Y-Position of the next band */
        bandNum = 0; /* Count of bands for ids */

        /* Create svg element */
        var svg = d3.select(domElement).append("svg").attr("class", "svg").attr("id", "svg").style("backgroundcolor", "#384B59").attr("width", outerWidth).attr("height", outerHeight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("clipPath").attr("id", "chart-area").append("rect").attr("width", width + 5).attr("height", height);

        var chart = svg.append("g").attr("class", "chart").attr("clip-path", "url(#chart-area)");

        var tooltip = d3.select("body").append("div").attr("class", "tooltip").style("display", "block");
        /* data */
        timeline.data = function (items) {
            var today = new Date(),
                tracks = [],
                yearMillis = 31622400000,
                instantOffset = 100 * yearMillis;
            data.items = items;

            function compareAscending(item1, item2) {
                /* Every item must have two fields: 'start' and 'end'. */
                var result = item1.start - item2.start;
                /* earlier first */
                if (result < 0) {
                    return -1;
                }
                if (result > 0) {
                    return 1;
                }
                /* longer first */
                result = item2.end - item1.end;
                if (result < 0) {
                    return -1;
                }
                if (result > 0) {
                    return 1;
                }
                return 0;
            }

            function compareDescending(item1, item2) {
                /* Every item must have two fields: 'start' and 'end'. */
                var result = item1.start - item2.start;
                /* later first */
                if (result < 0) {
                    return 1;
                }
                if (result > 0) {
                    return -1;
                }
                /* shorter first */
                result = item2.end - item1.end;
                if (result < 0) {
                    return 1;
                }
                if (result > 0) {
                    return -1;
                }
                return 0;
            }

            function calculateTracks(items, sortOrder, timeOrder) {
                var i, track;
                sortOrder = sortOrder || "descending";
                timeOrder = timeOrder || "backward";

                function sortBackward() {
                    /* older items end deeper */
                    items.forEach(function (item) {
                        for (i = 0, track = 0; i < tracks.length; i++, track++) {
                            if (item.end < tracks[i]) {
                                break;
                            }
                        }
                        item.track = track;
                        tracks[track] = item.start;
                    });
                }
                function sortForward() {
                    /* younger items end deeper */
                    items.forEach(function (item) {
                        for (i = 0, track = 0; i < tracks.length; i++, track++) {
                            if (item.start > tracks[i]) {
                                break;
                            }
                        }
                        item.track = track;
                        tracks[track] = item.end;
                    });
                }

                if (sortOrder === "ascending") data.items.sort(compareAscending);else data.items.sort(compareDescending);

                if (timeOrder === "forward") sortForward();else sortBackward();
            }
            var groups = [];
            /* Convert yearStrings into dates */
            data.items.forEach(function (item) {
                if ($.inArray(item.group, groups) == -1) {
                    groups.push(item.group);
                }
                item.start = parseDate(item.start);
                if (item.end == "") {
                    item.end = new Date(item.start.getTime() + instantOffset);
                    item.instant = true;
                } else {
                    item.end = parseDate(item.end);
                    item.instant = false;
                }
                if (item.end > today) {
                    item.end = today;
                }
            });
            calculateTracks(data.items, "descending", "backward");

            data.nTracks = tracks.length;
            data.minDate = d3.min(data.items, function (d) {
                return d.start;
            });
            data.maxDate = d3.max(data.items, function (d) {
                return d.end;
            });
            renderLegends(groups);
            function renderLegends(labelObject) {
                var legenddiv = d3.select('#legendContainer-' + randomSubstring);
                var legendHolder = legenddiv.selectAll('.legend-holder').data(labelObject).enter().append('div').attr('class', function (d) {
                    return 'legend-holder legend_holder_div_' + randomSubstring + '_' + d;
                }).style('display', 'inline-block').style('width', '80px').style('opacity', '1').style('cursor', 'pointer').on("click", function () {
                    var current_div_class = $(this).attr("class");
                    var rectClass = "rect_" + current_div_class.split(" ")[1].split("legend_holder_div_")[1];

                    /* Get current div opacity */
                    var current_opacity = $(this).css("opacity");
                    newOpacity = current_opacity == 1 ? 0.5 : 1;
                    $(this).css("opacity", newOpacity);
                    $("." + rectClass).css("opacity", newOpacity == 0.5 ? 0.2 : newOpacity);
                });
                /* append legend circles */
                legendHolder.append('div').style('background-color', function (d, i) {
                    return colorScale(d);
                }).attr("class", "bar_legend_circles").style("height", "10px").style("width", "10px").style("border-radius", "6px").style("display", "inline-block");

                /* append legend text */
                legendHolder.append("p").text(function (d, i) {
                    return d.toUpperCase();
                }).style('color', function (d, i) {
                    return colorScale(d);
                }).style('display', 'inline-block').style('margin-left', '5px');
            }
            return timeline;
        };
        /*-------------------------------------------- band -------------------------------------------*/
        timeline.band = function (bandName, sizeFactor) {
            var band = {};
            band.id = "band" + bandNum;
            band.x = 0;
            band.y = bandY;
            band.w = width;
            band.h = height * (sizeFactor || 1);
            band.trackOffset = 4;
            /* Prevent tracks from getting too high */
            band.trackHeight = Math.min((band.h - band.trackOffset) / data.nTracks, 50);
            band.itemHeight = band.trackHeight * 0.9, band.parts = [], band.instantWidth = 100; /* arbitray value */

            band.xScale = d3.scaleTime().domain([data.minDate, data.maxDate]).range([0, band.w]);

            band.yScale = function (track) {
                return band.trackOffset + track * band.trackHeight;
            };

            band.g = chart.append("g").attr("id", band.id).attr("transform", "translate(0," + band.y + ")");

            band.g.append("rect").attr("class", "band").attr("width", band.w).attr("height", band.h).style("fill", "none");

            /* Items */
            if (bandNum == 1) {
                band.itemHeight = 10;
            }
            var items = band.g.selectAll("g").data(data.items).enter().append("svg").attr("y", function (d) {
                return band.yScale(d.track);
            }).attr("height", band.itemHeight).attr("class", function (d) {
                return d.instant ? "part instant" : "part interval";
            });
            if (bandNum == 1) {
                var intervals = d3.select("#band" + bandNum).selectAll(".interval");
                intervals.append("circle").attr("cx", band.itemHeight / 2).attr("cy", band.itemHeight / 2).attr("r", 5).style("fill", function (d, i) {
                    return colorScale(d.group);
                });
                intervals.style("fill", "#2E3F49").style("stroke-width", "6").style("pointer-events", "true");
            } else {
                var intervals = d3.select("#band" + bandNum).selectAll(".interval");
                intervals.append("rect").attr("width", "100%").attr("height", "100%").attr("rx", 5).attr("ry", 5).attr("class", function (d) {
                    return "rect_" + randomSubstring + "_" + d.group;
                }).style("fill", "transperant").style("stroke", "#425661").style("stroke-width", "2px");
                intervals.append("text").attr("class", function (d) {
                    return " intervalLabel rect_" + randomSubstring + "_" + d.group;
                }).style("fill", function (d, i) {
                    return colorScale(d.group);
                }).style("font-size", "14px").style("font-weight", "700").attr("x", 10).attr("y", 15).text(function (d) {
                    return d.label.toUpperCase();
                });
                intervals.append("text").attr("class", function (d) {
                    return " intervalLabel rect_" + randomSubstring + "_" + d.group;
                }).style("fill", "#5E6C73").style("font-size", "12px").attr("x", 10).attr("y", 30).attr("height", 50).text(function (d) {
                    return d.description.toUpperCase();
                });
                intervals.style("fill", "#2E3F49").style("stroke-width", "6").style("pointer-events", "true");
            }
            band.addActions = function (actions) {
                /* actions - array: [[trigger, function], ...] */
                actions.forEach(function (action) {
                    items.on(action[0], action[1]);
                });
            };

            band.redraw = function () {
                items.attr("x", function (d) {
                    return band.xScale(d.start);
                }).attr("width", function (d) {
                    return band.xScale(d.end) - band.xScale(d.start);
                });
                band.parts.forEach(function (part) {
                    part.redraw();
                });
                $.each(items._groups[0], function () {
                    if ($(this).find("text") && $(this).find("text")[0]) {
                        if (parseFloat($(this).attr("x")) > 0 && parseFloat($(this).attr("x")) < parseFloat($(this).parent().parent().parent().parent().attr("width")) && $(this).find("text")[0].innerHTML == "PETRO SAUDI PANAMA") {
                            showriskTransaction("Risky Transaction", "Click here to Navigate");
                        }
                    }
                });
            };
            bands[bandName] = band;
            components.push(band);
            /* Adjust values for next band */
            bandY += band.h + bandGap;
            bandNum += 1;

            return timeline;
        };
        /* -------------------------------------- xAxis ------------------------------- */
        timeline.xAxis = function (bandName, orientation) {
            var band = bands[bandName];
            var axis = d3.axisBottom(band.xScale).tickSize(6, 0).tickFormat(function (d) {
                //		                	 return toYear(d);
                if (d3.timeYear(d) < d) {
                    return d3.timeFormat('%b')(d);
                } else {
                    return d3.timeFormat('%Y')(d);
                }
            });

            var xAxis = chart.append("g").attr("class", "axis").attr("transform", "translate(0," + (band.y + band.h) + ")").call(axis);
            xAxis.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
            xAxis.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
            xAxis.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");

            xAxis.redraw = function () {
                xAxis.call(axis);
                xAxis.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                xAxis.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
                xAxis.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
            };

            band.parts.push(xAxis); /* for brush.redraw */
            components.push(xAxis); /* for timeline.redraw */

            return timeline;
        };

        /* ----------------------------------------- brush ---------------------------------*/
        timeline.brush = function (bandName, targetNames) {
            var band = bands[bandName];
            var brush = d3.brushX(band.xScale.range([0, band.w])).extent([[0, 0], [width, height]]).on("end", function () {
                xBrush.selectAll("rect").attr("y", 4).attr("height", band.h - 4);

                xBrush.selectAll("rect.selection").style("stroke", "#0CB298");

                var extent = d3.event.selection;
                var domain = extent === null ? band.xScale.domain() : extent.map(band.xScale.invert, band.xScale);
                updateNotifications(domain[0], domain[1]);
                /*caseTimelineScope.updateCaseLog(data.items, domain[0], domain[1]);
                 updateCalendar(domain[0], domain[1]);*/
                //		                        updateAssociatedEntities(domain[0], domain[1]);
                targetNames.forEach(function (d) {
                    bands[d].xScale.domain(domain);
                    bands[d].redraw();
                });
            });

            var xBrush = band.g.append("svg").attr("class", "x brush").call(brush);
            xBrush.call(brush.move, [0, width]);
            xBrush.selectAll("rect").attr("y", 4).attr("height", band.h - 4);
            //	            xBrush.selectAll(".resize").remove();
            //	            xBrush.selectAll(".handle").remove();
            return timeline;
        };

        /* ----------------------------------------- redraw ----------------------------------*/
        timeline.redraw = function () {
            components.forEach(function (component) {
                component.redraw();
            });
        };

        function updateCalendar(startDate, endDate) {
            $('#datepicker').datepicker("setDate", new Date(startDate));
            var startDateVal = new Date(startDate);
            var endDateVal = new Date(endDate);

            if (startDateVal.getFullYear() >= 2012 || endDateVal.getFullYear() >= 2012) {
                var eventStr = '';
                eventStr += '<div class="event-list-item">' + '<div class="avatar-holder"><img src="http://findicons.com/files/icons/1072/face_avatars/300/a01.png" class="img-avatar" style="height: 40px; width: 40px"></div>' + '<div class="event-details">' + '<h1 class="headeline">' + 'E-mail from Compliance to the RM with request for information.' + '</h1>' + '<div class="details">' + '<strong>Venue:</strong><span>' + '' + '</span>' + '<br>' + '<strong>Time:</strong><span>' + 'February 8, 2012' + '</span>' + '</div>' + '</div>' + '</div>';

                eventStr += '<div class="event-list-item">' + '<div class="avatar-holder"><img src="http://findicons.com/files/icons/1072/face_avatars/300/a01.png" class="img-avatar" style="height: 40px; width: 40px"></div>' + '<div class="event-details">' + '<h1 class="headeline">' + 'E-mail from the RM to Compliance saying there is a business rationale.' + '</h1>' + '<div class="details">' + '<strong>Venue: </strong><span>' + '' + '</span>' + '<br>' + '<strong>Time: </strong><span>' + 'February 12, 2012' + '</span>' + '</div>' + '</div>' + '</div>';

                $('.event-item-holder').html('');
                $('.event-item-holder').html(eventStr);
            } else {
                $('.event-item-holder').html('');
            }
        }

        /* Notification Sensitive to Case Timeline */
        function updateNotifications(startDate, endDate) {
            var dataItems = data.items;
            var notifItemCount = 0;
            var startDateCompare = new Date(startDate);
            var endDateCompare = new Date(endDate);
            var htmlString = '';

            $.each(dataItems, function (i, dataItem) {
                var dataStartDate = new Date(dataItem.start);
                var detailsVal;
                if (dataItem.detailedDescription) {
                    detailsVal = dataItem.detailedDescription;
                } else {
                    detailsVal = dataItem.description;
                }

                if (dataStartDate.getTime() >= startDateCompare.getTime() && dataStartDate.getTime() <= endDateCompare.getTime()) {
                    htmlString += '<li class="dataItem" data-toggle="modal" data-details="' + detailsVal + '" data-target="#detailsModal" ng-repeat="notif in notifications" class="ng-scope">' + '<div>' + '<i class="fa fa-star-o" aria-hidden="true"></i>' + '<span class="notification-headline">ALERT</span>' + '<span class="pull-right ng-binding">' + dataItem.label + '</span>' + '</div>' + '<p class="ng-binding">' + dataItem.description + '</p>' + '</li>';
                    notifItemCount++;
                }
            });

            $(document).on("click", ".dataItem", function () {
                var detailsVal = $(this).data('details');
                $('#detailsText').html('');
                $('#detailsText').html(detailsVal);
            });
            $('.notifications-counter').html('You have total ' + notifItemCount + ' notifications today');
            $('.notifications-list').html(htmlString);
        }

        /* Associated Entities Sensitive to Case Time line */
        function updateAssociatedEntities(startDate, endDate) {
            var uri1 = "vendor/data/dataAssociatedEntities.json";
            d3.json(uri1, function (data) {
                var associatedEntitiesData = "[";
                var j = 0;
                $.each(data, function (i, jsonItem) {
                    /* Calculate date here. */
                    var dateJsonItem = new Date(jsonItem.date);
                    var startDateCompare = new Date(startDate);
                    var endDateCompare = new Date(endDate);

                    if (dateJsonItem.getTime() > startDateCompare.getTime() && dateJsonItem.getTime() < endDateCompare.getTime()) {
                        if (j > 0) {
                            associatedEntitiesData += ",";
                        }
                        j = 1;
                        associatedEntitiesData += JSON.stringify(jsonItem);
                    }
                });
                associatedEntitiesData += "]";
                timescalebubbleData = JSON.parse(associatedEntitiesData);
                var trData;
                $.each(timescalebubbleData, function (i, d) {
                    if (i == 0) {
                        trData = '<tr><td>' + d.date + '</td><td>' + d.entityName + '</td><td>' + d.rate + '%</td></tr>';
                    } else {
                        trData = trData + '<tr><td>' + d.date + '</td><td>' + d.entityName + '</td><td>' + d.rate + '%</td></tr>';
                    }
                });
                $("#associatedEntitiestablebody").empty();
                $("#associatedEntitiestablebody").append(trData);
                /* $scope.associatedEntitiesDatas = timescalebubbleData;*/
                timescalebubbleChart({
                    container: '#associatedEntitiesChart',
                    data: timescalebubbleData,
                    height: '250',
                    isheader: false,
                    ytext: "Similarity Percent",
                    xticks: 5,
                    margin: { top: 20, right: 0, bottom: 30, left: 50 }

                });
            });
        }
        /* Utility functions */
        function parseDate(dateString) {
            /* 'dateString' must either conform to the ISO date format YYYY-MM-DD
             	or be a full year without month and day.
             	AD years may not contain letters, only digits '0'-'9'!
             	Invalid AD years: '10 AD', '1234 AD', '500 CE', '300
            n.Chr.'
             	Valid AD years: '1', '99', '2013'
            	BC years must contain letters or negative numbers!
             	Valid BC years: '1 BC', '-1', '12 BCE', '10 v.Chr.',
            '-384'
            	A dateString of '0' will be converted to '1 BC'.
             	Because JavaScript can't define AD years between 0..99,
             	these years require a special treatment.*/

            var format = d3.timeParse("%Y-%m-%d"),
                date,
                year;

            date = format(dateString);
            if (date !== null) return date;

            /* BC yearStrings are not numbers!*/
            if (isNaN(dateString)) {
                /* Handle BC year */
                /* Remove non-digits, convert to negative number */
                year = -dateString.replace(/[^0-9]/g, "");
            } else {
                /* Handle AD year */
                /* Convert to positive number */
                year = +dateString;
            }
            if (year < 0 || year > 99) {
                /* 'Normal' dates */
                date = new Date(year, 6, 1);
            } else if (year == 0) {
                /* Year 0 is '1 BC' */
                date = new Date(-1, 6, 1);
            } else {
                /* Create arbitrary year and then set the correct year
                   For full years, I chose to set the date to mid year (1st of July). */
                date = new Date(year, 6, 1);
                date.setUTCFullYear(("0000" + year).slice(-4));
            }
            /* Finally create the date */
            return date;
        }
        function toYear(date, bcString) {
            /* bcString is the prefix or postfix for BC dates.
             If bcString starts with '-' (minus),
             if will be placed in front of the year. */
            bcString = bcString || " BC"; /* With blank! */
            var year = date.getUTCFullYear();
            if (year > 0) return year.toString();
            if (bcString[0] == '-') return bcString + -year;
            return -year + bcString;
        }
        return timeline;
    }
    /**
    * Function to handle show hide of header options
    */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
    * Function to handle show hide of header options
    */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            chartCaseTimeLine(options);
        }
    });
    /**
    * Function to handle show hide of header options
    */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        $(chart_container).empty();
        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");
        var tbl = "<div id ='CaseTimeLineChart_table'" + randomSubstring + ">";
        var tbl = "<div id ='worldChart_table'" + randomSubstring + "><table class='table-striped' style='width:100%;background-color:#FFF'><thead><tr><th>Label</th><th>Start</th><th>End</th></tr></thead><tbody>";
        $.each(data, function (index, value) {
            tbl = tbl + "<tr><td>" + value.label + "</td><td>" + value.start + "</td><td>" + (value.end ? value.end : "-") + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
    });
    /**
    * Function to handle show hide of header options
    */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new CaseTimeLineChart(actualOptioins);
        }
    });
}
"use strict";

function WorldChart(barOptions) {
    if (barOptions.container) {
        $(barOptions.container).empty();
    }
    //--------------------------Initialize Values-----------------------------
    if (barOptions) {
        this.container = barOptions.container ? barOptions.container : "body";
        this.barColor = barOptions.barColor ? barOptions.barColor : "blue";
        this.readFromFile = barOptions.readFromFile !== undefined ? barOptions.readFromFile : false;
        this.dataFileLocation = barOptions.readFromFile !== undefined || barOptions.readFromFile ? barOptions.dataFileLocation : undefined;
        this.data = barOptions.data ? barOptions.data : [];
        this.showTicks = barOptions.showTicks ? barOptions.showTicks : true;
        this.ticks = barOptions.ticks ? barOptions.ticks : 'all';
        this.showLegends = barOptions.showLegends !== undefined ? barOptions.showLegends : false;
        this.xLabelRotation = barOptions.xLabelRotation ? barOptions.xLabelRotation : 0;
        this.yLabelRotation = barOptions.yLabelRotation ? barOptions.yLabelRotation : 0;
        this.margin = barOptions.margin ? {
            top: barOptions.margin.top ? barOptions.margin.top : 20,
            right: barOptions.margin.right ? barOptions.margin.right : 20,
            bottom: barOptions.margin.bottom ? barOptions.margin.bottom : 30,
            left: barOptions.margin.left ? barOptions.margin.left : 40
        } : { top: 20, right: 20, bottom: 50, left: 50 };
        this.height = barOptions.height ? barOptions.height : 600;
        this.width = barOptions.width ? barOptions.width : $(this.container).width() - 10;
        this.showAxisX = barOptions.showAxisX !== undefined ? barOptions.showAxisX : true;
        this.showAxisY = barOptions.showAxisY !== undefined ? barOptions.showAxisY : true;
        this.showXaxisTicks = barOptions.showXaxisTicks !== undefined ? barOptions.showXaxisTicks : true;
        this.showYaxisTicks = barOptions.showYaxisTicks !== undefined ? barOptions.showYaxisTicks : true;
        this.groupedStacked = barOptions.groupedStacked ? barOptions.groupedStacked : "grouped";
        this.randomIdString = Math.floor(Math.random() * 10000000000);
    } else {

        return false;
    }
    var randomSubstring = this.randomIdString;

    var margin = this.margin,
        width = this.width - margin.left - margin.right,
        height = this.height - margin.top - margin.bottom,
        barColor = this.barColor;
    if (height > width) {
        height = width;
        this.height = this.width;
    }
    //define tool tip
    $(".world_map_tooltip").remove();
    var tool_tip = $('body').append('<div class="world_map_tooltip" style="position: absolute; opacity: 1; pointer-events: none; visibility: hidden;display:none"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    //    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleThreshold().domain([10000, 100000, 500000, 1000000, 5000000, 10000000, 50000000, 100000000, 500000000, 1500000000]).range(["rgb(247,251,255)", "rgb(222,235,247)", "rgb(198,219,239)", "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)", "rgb(33,113,181)", "rgb(8,81,156)", "rgb(8,48,107)", "rgb(3,19,43)"]);

    var centered;

    var worlddata = this.data[0];
    var populationData = this.data[1];
    var path = d3.geoPath();
    //define svg
    var svg = d3.select(this.container).append("svg").attr('height', this.height).attr('width', this.width).attr('id', 'mainSvg-' + randomSubstring).append('g').attr('class', 'map');
    //            .on("click", clicked);
    var mapScale = Math.floor(width / 6);

    var projection = d3.geoMercator().scale(mapScale).translate([width / 2, height / 2]);

    var path = d3.geoPath().projection(projection);

    var WorldData = this.data;
    if (WorldData) {
        if (WorldData.length) drawWorld(worlddata, populationData);
    } else {}

    function drawWorld(data, population) {

        var populationById = {};

        population.forEach(function (d) {
            populationById[d.id] = +d.population;
        });

        //        data.features.forEach(function (d) {
        //            d.population = populationById[d.id]
        //        });

        svg.append("g").attr("class", "countries").selectAll("path").data(data.features).enter().append("path").attr("d", path).style("fill", function (d) {
            if (populationById[d.id]) {
                return "#435DBE";
            } else {
                return "#3778BF";
            }

            return colorScale(populationById[d.id]);
        }).style('stroke', 'white').style('stroke-width', 0.5).style("opacity", 0.8).on("mouseover", function (d) {

            $(this).find(".countries").css("fill", "#0DB199");
            var populationTxt = '';
            if (populationById[d.id]) {
                populationTxt = '<br><span>Population: ' + populationById[d.id] + '</span>';
            }
            $(".world_map_tooltip").html('<span> Country: ' + d.properties.name + '</span>' + populationTxt);
            $(".world_map_tooltip").css("display", "block");
            return $(".world_map_tooltip").css("visibility", "visible");
        }).on("mousemove", function () {
            $(".world_map_tooltip").css("top", d3.event.pageY - 10 + "px");
            return $(".world_map_tooltip").css("left", d3.event.pageX + 10 + "px");
        }).on("mouseout", function () {
            $(".world_map_tooltip").css("display", "none");
            return $(".world_map_tooltip").css("visibility", "hidden");
        });
        //                .on("click", clicked);
        //
        //                 var groupedG = g.append("g")
        //                .selectAll("g")
        //                .data(data)
        //                .enter().append("g").attr("class", "groupg")
        //                .on("mouseover", function (d) {
        //                    //show tooltip
        //                    $(this).find(".background_rect").css("fill", "#0DB199");
        //                    $(".world_map_tooltip").empty();
        //                    var keys = d3.keys(d).slice(1);
        //
        //                    var text = '<span>' + d.x + '</span><table>';
        //                    for (var i in keys) {
        //                        text += '<tr><td style="color:' + colorScale(keys[i]) + '">' + keys[i] + '</td><td>' + d[keys[i]] + '</td></tr>';
        //                    }
        //                    text += '</table>';
        //                    // var text = '<table><tr><td></td><td></td></tr></table>'
        //                    $(".world_map_tooltip").html(text);
        //                    return $(".world_map_tooltip").css("visibility", "visible");
        //
        //                })
        //                .on("mousemove", function () {
        //                    $(".world_map_tooltip").css("top", (d3.event.pageY - 10) + "px")
        //                    return  $(".world_map_tooltip").css("left", (d3.event.pageX + 10) + "px");
        //
        //                })
        //                .on("mouseout", function () {
        //                    //hide tool-tip
        //                    $(this).find(".background_rect").css("fill", "transparent");
        //                    return $(".world_map_tooltip").css("visibility", "hidden");
        //                })
        //                .attr("transform", function (d) {
        //                    return "translate(" + x0(d.x) + ",0)";
        //                });
        //        //append background rect for tooltip
        //        groupedG.append("rect").attr("class", "background_rect")
        //                .attr("x", 0).attr("y", 0).attr("width", x0.bandwidth()).attr("height", height).attr("fill", "transparent").attr("opacity", 0.5);

        svg.append("path").datum(topojson.mesh(data.features, function (a, b) {
            return a.id !== b.id;
        }))
        //                 .datum(topojson.mesh(data.features, function(a, b) { return a !== b; }))
        .attr("class", "names").attr("d", path);
        //          svg.selectAll("path")
        //      .classed("active", centered && function(d) { return d === centered; });

        //        function clicked(d) {
        //  var x, y, k;
        //  if (d && centered !== d) {
        //    var centroid = path.centroid(d);
        //    x = centroid[0];
        //    y = centroid[1];
        //    k = 4;
        //    centered = d;
        //  } else {
        //    x = width / 2;
        //    y = height / 2;
        //    k = 1;
        //    centered = null;
        //  }
        //    svg.selectAll("path")
        //      .classed("active", centered && function(d) { return d === centered; });
        //
        //  svg.transition()
        //      .duration(750)
        //      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
        //      .style("stroke-width", 1.5 / k + "px");
        //    }
        var zoom = d3.zoom()
        //  .scaleExtent([1, 40])
        .on("zoom", function () {
            svg.attr("transform", d3.event.transform);
            svg.selectAll("path").attr("d", path.projection(projection));
        });
        svg.call(zoom);
    }
}
"use strict";

/*------ Store brush Values ----*/
var brushValues = {
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942"],
    radius: 5
    /*----- Function to render brush ----*/
};function createBrush(brushoptions) {
    var container = brushoptions.container ? brushoptions.container : 'body';
    var svg_backgroundcolor = brushoptions.svg_backgroundcolor ? brushoptions.svg_backgroundcolor : "transparent";

    var height = brushoptions.height ? brushoptions.height : 50;
    var Svgwidth = brushoptions.width ? brushoptions.width : $(container).width();

    var margin = brushoptions.margin ? brushoptions.margin : { top: 20, bottom: 20, left: 20, right: 20 };
    var data = brushoptions.data ? brushoptions.data : d3.range(width).map(Math.random);
    var xdomain = d3.extent(data, function (d) {
        if (d.time) {
            return d.time;
        }
        return new Date(d);
    });
    $(container).empty();
    var width = Svgwidth - margin.left - margin.right;

    var x = d3.scaleTime().domain(xdomain).rangeRound([0, width]),
        y = d3.randomNormal(height / 2, height / 8);
    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(brushoptions.colors ? brushoptions.colors : brushValues.colors);
    var svg = d3.select(container).append("svg").attr("width", Svgwidth).attr("height", height + margin.top + margin.bottom).style("background-color", svg_backgroundcolor);
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    g.append("defs").append("svg:clipPath").attr("id", "brushClip").append("svg:rect").attr("id", "clip_rect_brush").attr("x", "0").attr("y", "10").attr("width", width).attr("height", height);

    var brush = d3.brushX().extent([[0, 0], [width, height]]).on("end", function () {
        if (brushoptions.noBrush) {
            return false;
        }
        var s = d3.event.selection;
        if (s != null) {
            var sx = s.map(x.invert);
            var x0 = parseInt(sx[0].getTime());
            var x1 = parseInt(sx[1].getTime());
            getDateRange(x0, x1);
            /*  chartsFilter(x0,x1) */
        }
    });

    var x_g = g.append("g").attr("class", "axis axis--x-brush").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x)).style("stroke", "#838F99");
    if (brushoptions.brushFill) {
        x_g.selectAll("path").style('stroke', brushoptions.brushFill);
        x_g.selectAll("line").style('stroke', brushoptions.brushFill);
        x_g.selectAll("text").style("stroke", "none").style('fill', "#879fa9");
    }
    var gBrush = g.append("g").attr("class", "brush").style("fill", "#334552").call(brush).call(brush.move, x.range());
    /* gBrush.call(brush.move, [0, 1].map(x)); */
    gBrush.select(".selection").style("fill", brushoptions.brushFill ? brushoptions.brushFill : "#0cb29a").style("stroke", brushoptions.brushFill ? brushoptions.brushFill : "#0cb29a").style("fill-opacity", 0.3);
    gBrush.select(".overlay").style("fill", "transparent");
    var circle = g.append("g").attr("clip-path", "url(#brushClip)").attr("class", "circle").selectAll("circle").data(data).enter().append("circle").style("fill", function (d) {
        if (d.type && brushoptions.colorsObj) {
            return brushoptions.colorsObj[d.type];
        }
        return colorScale(d);
    }).attr("transform", function (d, i) {

        return "translate(" + x(d.time ? d.time : new Date(d)) + "," + y() + ")";
    }).attr("r", brushValues.radius);
}
"use strict";

/* collapse chart constant values */
var collapseConst = {
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942", "#ffa618"],
    fullScreenDuration: 500
};
function collapseChart(collapseOptions) {
    if (collapseOptions.container) {
        $(collapseOptions.container).empty();
    }
    /*--------------------------Initialize Values-----------------------------*/
    if (collapseOptions) {
        this.container = collapseOptions.container ? collapseOptions.container : "body";
        this.data = collapseOptions.data ? collapseOptions.data : [];
        this.height = collapseOptions.height ? collapseOptions.height : 600;
        this.uri = collapseOptions.uri;
        this.collapseHeader = collapseOptions.header ? collapseOptions.header : "FORCE COLLAPSE CHART";

        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.headerOptions = collapseOptions.headerOptions == false ? collapseOptions.headerOptions : true;
    } else {

        return false;
    }
    var header = collapseOptions.header;
    var actualOptions = jQuery.extend(true, {}, collapseOptions);
    var randomSubstring = this.randomIdString;
    var hl = this.height;
    var h = parseInt(hl) + 50;
    var _this = this;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';
    var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="collapse_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    /* var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-style: inherit;"> <div class="dataBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>' */
    $(this.container).html(chartContainerdiv);
    $(this.container).append(modal);
    var chart_container = "#collapse_chart_div" + randomSubstring;
    this.width = collapseOptions.width ? collapseOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }

    this.diameter = this.height > this.width ? this.width - 50 : this.height - 50;

    if (!this.headerOptions) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);

    if (!this.headerOptions) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }

    $(".force_tooltip").remove();
    var tool_tip = $('body').append('<div class="force_tooltip" style="visibility:none;display:none"><span class="forced_tootip_next"><span class="tool_tip_x_val"></span><table><tbody><tr><td> </td><td><b>216.4 mm</b></td></tr><tr><td class="city-color-one">New York: </td><td><b>91.2 mm</b></td></tr><tr><td class="city-color-two">London: </td><td><b>52.4 mm</b></td></tr><tr><td class="city-color-three">Berlin: </td><td><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    var data = this.data;
    var curretn_uri = this.Uri;
    var collapse_header = this.collapseHeader;
    var containerid = this.container;

    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(collapseConst.colors);
    var width = this.width,
        height = this.height,
        diameter = this.diameter,
        node,
        root,
        radius = Math.min(width, height) / 2;

    var svg = d3.select(chart_container).append("svg:svg").attr("width", this.width).attr("height", this.height).append("svg:g").attr("transform", "translate(" + width / 6 + "," + height / 6 + ")");

    var simulation = d3.forceSimulation().force("link", d3.forceLink().id(function (d) {
        return d.id;
    })).force("charge", d3.forceManyBody()).force("center", d3.forceCenter(width / 3, height / 3));

    var link = svg.append("g").attr("class", "links").selectAll("line").data(data.links).enter().append("line").attr("stroke-width", function (d) {
        return Math.sqrt(d.value);
    }).style("stroke", "steelblue").style("stroke-opacity", "0.6");

    var node = svg.append("g").attr("class", "nodes").selectAll("circle").data(data.nodes).enter().append("circle").attr("r", 5).attr("fill", function (d) {
        return colorScale(d.group);
    }).style("stroke", "#fff").style("stroke-width", "1.5px").call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended)).on("mouseover", function (d) {

        $(".force_tooltip").html('<span> ' + d.id + '</span>');
        $(".force_tooltip").css("display", "block");
        return $(".force_tooltip").css("visibility", "visible");
    }).on("mousemove", function () {
        $(".force_tooltip").css("top", d3.event.pageY - 10 + "px");
        return $(".force_tooltip").css("left", d3.event.pageX + 10 + "px");
    }).on("mouseout", function () {
        $(".force_tooltip").css("display", "none");
        return $(".force_tooltip").css("visibility", "hidden");
    });
    simulation.nodes(data.nodes).on("tick", ticked);

    simulation.force("link").links(data.links);

    function ticked() {
        link.attr("x1", function (d) {
            return d.source.x;
        }).attr("y1", function (d) {
            return d.source.y;
        }).attr("x2", function (d) {
            return d.target.x;
        }).attr("y2", function (d) {
            return d.target.y;
        });

        node.attr("cx", function (d) {
            return d.x;
        }).attr("cy", function (d) {
            return d.y;
        });
    }

    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
    }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {

        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            new collapseChart(actualOptions);
        }
    });

    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {

        var a = parseInt(hl / 55);

        $(chart_container).empty();
        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");

        var tbl = "<div id ='collapseChart_table_" + randomSubstring + "'   style='overflow:hidden;background-color:#374C59;padding:5px;width:100%;height:" + _this.height + "px'><table id ='collapse_table_" + randomSubstring + "'class='table-striped table-condensed' style='width:100%;padding:5px;background-color:#283C45;color:#5A676E;'><thead><tr><th>Label</th><th>Group</th></tr></thead><tbody>";

        $.each(data.nodes, function (i, v) {

            tbl = tbl + "<tr><td>" + v.id.toUpperCase() + "</td><td>" + v.group + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $("#collapse_table_" + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });
        $("#collapseChart_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });
        $("#collapse_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

        var id1 = $("#collapse_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#collapse_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#collapse_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
        $(".dataTables_wrapper").css("background-color", "#374C59");
    });
    /**
     * Function to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new collapseChart(actualOptions);
        }
    });
    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;

            options.headerOptions = false;
            options.height = 450;
            new collapseChart(options);
        }, collapseConst.fullScreenDuration);
    });
}
'use strict';
var sankConst = { nodeWidth: 24, nodePadding: 8, titleX: -6, titleDY: '.35em', colorDomain: ['1MDB', 'Petrosaudi', 'Good Star', 'Totality LTD', 'Jasmine LOO Ai Swan'], colors: ['#368FCE', '#8C3F8E', '#F48D27', '#69CA6B', '#95AF0D'] };function sankey_chart(c) {
  var f;c.container && $(c.container).empty(), c && (c.container = c.container ? c.container : 'body', c.data = c.data ? c.data : [], c.header = c.header ? c.header : 'SANKEY CHART', c.randomIdString = Math.floor(1e10 * Math.random()), c.height = c.height ? c.height : 600, c.margin = c.margin ? { top: c.margin.top ? c.margin.top : 20, right: c.margin.right ? c.margin.right : 20, bottom: c.margin.bottom ? c.margin.bottom : 30, left: c.margin.left ? c.margin.left : 40 } : { top: 20, right: 20, bottom: 50, left: 50 }, c.headerOptions = !1 != c.headerOptions || c.headerOptions, c.isHeaer = !1 != c.isHeaer || c.isHeaer);var g = jQuery.extend(!0, {}, c),
      j = [];$.each(c.data.nodes, function (M, N) {
    j.push(N.name);
  });var k = c.container,
      l = c.randomIdString,
      m = c.header;d3.sankey = function () {
    function M() {
      aa.forEach(function (ca) {
        ca.sourceLinks = [], ca.targetLinks = [];
      }), ba.forEach(function (ca) {
        var da = ca.source,
            ea = ca.target;'number' == typeof da && (da = ca.source = aa[ca.source]), 'number' == typeof ea && (ea = ca.target = aa[ca.target]), da.sourceLinks.push(ca), ea.targetLinks.push(ca);
      });
    }function N() {
      aa.forEach(function (ca) {
        ca.value = Math.max(d3.sum(ca.sourceLinks, V), d3.sum(ca.targetLinks, V));
      });
    }function O() {
      for (var da, ca = aa, ea = 0; ca.length;) {
        da = [], ca.forEach(function (fa) {
          fa.x = ea, fa.dx = X, fa.sourceLinks.forEach(function (ga) {
            da.push(ga.target);
          });
        }), ca = da, ++ea;
      }Q(ea), R((C - X) / (ea - 1));
    }function Q(ca) {
      aa.forEach(function (da) {
        da.sourceLinks.length || (da.x = ca - 1);
      });
    }function R(ca) {
      aa.forEach(function (da) {
        da.x *= ca;
      });
    }function S(ca) {
      function ea(ka) {
        function la(ma) {
          return U(ma.source) * ma.value;
        }ia.forEach(function (ma) {
          ma.forEach(function (oa) {
            if (oa.targetLinks.length) {
              var pa = d3.sum(oa.targetLinks, la) / d3.sum(oa.targetLinks, V);oa.y += (pa - U(oa)) * ka;
            }
          });
        });
      }function fa(ka) {
        function la(ma) {
          return U(ma.target) * ma.value;
        }ia.slice().reverse().forEach(function (ma) {
          ma.forEach(function (na) {
            if (na.sourceLinks.length) {
              var oa = d3.sum(na.sourceLinks, la) / d3.sum(na.sourceLinks, V);na.y += (oa - U(na)) * ka;
            }
          });
        });
      }function ga() {
        ia.forEach(function (ka) {
          var la,
              ma,
              pa,
              na = 0,
              oa = ka.length;for (ka.sort(ha), pa = 0; pa < oa; ++pa) {
            la = ka[pa], ma = na - la.y, 0 < ma && (la.y += ma), na = la.y + la.dy + Y;
          }if (ma = na - Y - Z[1], 0 < ma) for (na = la.y -= ma, pa = oa - 2; 0 <= pa; --pa) {
            la = ka[pa], ma = la.y + la.dy + Y - na, 0 < ma && (la.y -= ma), na = la.y;
          }
        });
      }function ha(ka, la) {
        return ka.y - la.y;
      }var ia = d3.nest().key(function (ka) {
        return ka.x;
      }).sortKeys(d3.ascending).entries(aa).map(function (ka) {
        return ka.values;
      });(function () {
        var ka = d3.min(ia, function (la) {
          return (Z[1] - (la.length - 1) * Y) / d3.sum(la, V);
        });ia.forEach(function (la) {
          la.forEach(function (ma, na) {
            ma.y = na, ma.dy = ma.value * ka;
          });
        }), ba.forEach(function (la) {
          la.dy = la.value * ka;
        });
      })(), ga();for (var ja = 1; 0 < ca; --ca) {
        fa(ja *= .99), ga(), ea(ja), ga();
      }
    }function T() {
      function ca(ea, fa) {
        return ea.source.y - fa.source.y;
      }function da(ea, fa) {
        return ea.target.y - fa.target.y;
      }aa.forEach(function (ea) {
        ea.sourceLinks.sort(da), ea.targetLinks.sort(ca);
      }), aa.forEach(function (ea) {
        var fa = 0,
            ga = 0;ea.sourceLinks.forEach(function (ha) {
          ha.sy = fa, fa += ha.dy;
        }), ea.targetLinks.forEach(function (ha) {
          ha.ty = ga, ga += ha.dy;
        });
      });
    }function U(ca) {
      return ca.y + ca.dy / 2;
    }function V(ca) {
      return ca.value;
    }var W = {},
        X = sankConst.nodeWidth,
        Y = sankConst.nodePadding,
        Z = [1, 1],
        aa = [],
        ba = [];return W.nodeWidth = function (ca) {
      return arguments.length ? (X = +ca, W) : X;
    }, W.nodePadding = function (ca) {
      return arguments.length ? (Y = +ca, W) : Y;
    }, W.nodes = function (ca) {
      return arguments.length ? (aa = ca, W) : aa;
    }, W.links = function (ca) {
      return arguments.length ? (ba = ca, W) : ba;
    }, W.size = function (ca) {
      return arguments.length ? (Z = ca, W) : Z;
    }, W.layout = function (ca) {
      return M(), N(), O(), S(ca), T(), W;
    }, W.relayout = function () {
      return T(), W;
    }, W.link = function () {
      function ca(ea) {
        var fa = ea.source.x + ea.source.dx,
            ga = ea.target.x,
            ha = d3.interpolateNumber(fa, ga),
            ia = ha(da),
            ja = ha(1 - da),
            ka = ea.source.y + ea.sy + ea.dy / 2,
            la = ea.target.y + ea.ty + ea.dy / 2;return 'M-10,-10M' + fa + ',' + ka + 'C' + ia + ',' + ka + ' ' + ja + ',' + la + ' ' + ga + ',' + la;
      }var da = .5;return ca.curvature = function (ea) {
        return arguments.length ? (da = +ea, ca) : da;
      }, ca;
    }, W;
  };var l = Math.floor(1e10 * Math.random()),
      o = c.height + 50,
      q = $(window).width() - 200;$(c.container).html('<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 12px;font-style: inherit;"> <div class="graphBox" style="height:' + o + 'px;max-height: ' + o + 'px;min-height: ' + o + 'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + m + '</div><div id="sankey_chart_div' + l + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'), $(c.container).append(' <div id="modal_' + l + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + q + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + l + '"></div></div></form></div></div>');var t = '#sankey_chart_div' + l;if (!c.headerOptions) {
    $(t).siblings('.headerDiv').append('<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>');
  }if (0 == $(t).siblings('.headerDiv').find('.bstheme_menu_button').length) var w = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + l + '" data-toggle="collapse" data-target="#opt_' + l + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none; min-width: 120px; margin-top: 2px; background: rgb(27, 39, 53) none repeat scroll 0% 0%; border: 1px solid rgb(51, 51, 51); border-radius: 4px;" id="opt_' + l + '" class="collapse"><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_fullscreen_chart' + l + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_refresh_' + l + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span style="display: inline-block;float: left;text-align: center;width: 33.33%;" class="header_table_' + l + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span style="display: none;float: left;text-align: center;width: 33.33%;" class="header_chart_' + l + '" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';$(t).siblings('.headerDiv').append(w), c.headerOptions ? $(t).siblings('.headerDiv').find('.bstheme_options').css('right', '0') : ($(t).siblings('.headerDiv').find('.bstheme_options').css('right', '28px'), $('.header_fullscreen_chart' + l).css('display', 'none')), $('.graphBox').mCustomScrollbar({ axis: 'y' }), $('.sank_tooltip').remove();$('body').append('<div class="sank_tooltip text-uppercase" style="visibility:visible;display:none"><span class="sank_tooltip_next"><span class="tool_tip_x_val"></span><table><tbody><tr><td> </td><td><b>216.4 mm</b></td></tr><tr><td class="city-color-one">New York: </td><td><b>91.2 mm</b></td></tr><tr><td class="city-color-two">London: </td><td><b>52.4 mm</b></td></tr><tr><td class="city-color-three">Berlin: </td><td><b>47.6 mm</b></td></tr></tbody></table></span></div>');c.isHeaer || $(t).siblings('.headerDiv').remove();c.width = c.width ? c.width : $(t).width() - 20;var B = c.margin,
      C = c.width - B.left - B.right,
      D = c.height - B.top - B.bottom,
      G = d3.format(',.0f'),
      F = d3.scaleOrdinal().domain(j).range(sankConst.colors);d3.select(t).style('visibility', 'visible');var I = d3.select(t).append('svg').attr('width', C + B.left + B.right).attr('height', D + B.top + B.bottom).append('g').attr('transform', 'translate(' + B.left + ',' + B.top + ')'),
      J = d3.sankey().nodeWidth(12).nodePadding(10).size([C, D]),
      K = J.link(),
      L = I.append('defs');(function (M) {
    J.nodes(M.nodes).links(M.links).layout(14);var O = I.append('g').selectAll('.link').data(M.links).enter().append('path').attr('class', 'link').attr('d', K).style('stroke-width', function (Q) {
      return Math.max(1, Q.dy);
    }).style('fill', 'none').style('stroke-opacity', 1.4).sort(function (Q, R) {
      return R.dy - Q.dy;
    }).on('mouseover', function (Q) {
      return Q.txt ? $('.sank_tooltip').html(Q.txt) : $('.sank_tooltip').html('<div>' + Q.label + '</div><span> Type: ' + Q.source.name + '</span><br><span> Value: ' + G(Q.value) + '</span>'), $('.sank_tooltip').css('display', 'block');
    }).on('mousemove', function () {
      var Q = $(t),
          R = Q.offset(),
          S = window.innerWidth,
          T = $('.sank_tooltip').width() + 50,
          U = d3.event.x;if (console.log(U, T, R.left < d3.event.pageX, U > T, R.left < d3.event.pageX && U < T), R.left < d3.event.pageX && U > T) {
            console.log('moveleft');var V = document.getElementsByClassName('sank_tooltip');V[0].classList.add('tooltip-right'), $('.sank_tooltip').css('left', d3.event.pageX - 15 - $('.sank_tooltip').width() + 'px');
      } else {
        console.log('moveright');var V = document.getElementsByClassName('sank_tooltip');V[0].classList.remove('tooltip-right'), $('.sank_tooltip').css('left', d3.event.pageX + 10 + 'px');
      }return $('.sank_tooltip').css('top', d3.event.pageY + 'px');
    }).on('mouseout', function () {
      return $('.sank_tooltip').css('display', 'none');
    }),
        P = I.append('g').selectAll('.node').data(M.nodes).enter().append('g').attr('class', 'node').attr('transform', function (Q) {
      return 'translate(' + Q.x + ',' + Q.y + ')';
    }).call(d3.drag().subject(function (Q) {
      return Q;
    }).on('start', function () {
      this.parentNode.appendChild(this);
    }).on('drag', function (Q) {
      d3.select(this).attr('transform', 'translate(' + (Q.x = Math.max(0, Math.min(C - Q.dx, d3.event.x))) + ',' + (Q.y = Math.max(0, Math.min(D - Q.dy, d3.event.y))) + ')'), J.relayout(), O.attr('d', K);
    }));P.append('rect').attr('height', function (Q) {
      return 0 > Q.dy ? (f || (f = Q.dy), f > Q.dy && (f = Q.dy), 0) : Q.dy;
    }).attr('width', J.nodeWidth()).style('fill', function (Q) {
      return -1 < F.domain().indexOf(Q.name) ? Q.color = F(Q.name) : Q.color = '#ccc';
    }), f && setTimeout(function () {
      $(k).empty(), g.height = parseFloat(g.height) + parseFloat(Math.abs(f)), new sankey_chart(g);
    }, 1e3), P.append('text').style('text-transform', 'uppercase').attr('x', sankConst.titleX).attr('y', function (Q) {
      return Q.dy / 2;
    }).attr('dy', sankConst.titleDY).attr('text-anchor', 'end').attr('transform', null).text(function (Q) {
      return Q.name;
    }).filter(function (Q) {
      return Q.x < C / 2;
    }).attr('x', 6 + J.nodeWidth()).attr('text-anchor', 'start'), O.style('stroke', function (Q, R) {
      var S = 'gradient' + R,
          T = Q.source.color,
          U = Q.target.color,
          V = L.append('linearGradient').attr('id', S);return V.selectAll('stop').data([{ offset: '10%', color: T }, { offset: '90%', color: U }]).enter().append('stop').attr('offset', function (W) {
        return W.offset;
      }).attr('stop-color', function (W) {
        return W.color;
      }), 'url(#' + S + ')';
    });
  })(c.data), $('body').on('click', '.bstheme_menu_button_' + l, function () {
    var M = $(this).attr('data-target');'none' == $(M).css('display') ? $(M).css('display', 'inline-block') : $(M).css('display', 'none');
  }), $('body').on('click', '.header_refresh_' + l, function () {
    var M = $(this).parent().parent().parent().parent().siblings('div').attr('id');'#' + M == t && ($(k).empty(), new sankey_chart(g));
  }), $('body').on('click', '.header_table_' + l, function () {
    parseInt(o / 55);$(t).empty(), $(t).css('overflow', 'auto'), $(this).css('display', 'none'), $('.header_chart_' + l).css('display', 'inline-block');var N = c.data,
        O = '<div id =\'sankey_table_' + l + '\' style=\'padding:5px;background-color: #425661;overflow:hidden;height:' + c.height + 'px\'><table id =\'sankey_table1_' + l + '\'class=\' table-striped table-condensed\' style=\'width:100%;background-color:#283C45;padding:5px;color:#5A676E; \' ><thead><tr><th>TYPE</th><th>VALUE</th></tr></thead><tbody>';$.each(N.nodes, function (V, W) {
      O = O + '<tr><td>' + W.name.toUpperCase() + '</td><td>' + W.value + '</td></tr>';
    }), O += '</tbody></table></div>', $(t).append(O), $('#sankey_table1_' + l).DataTable({ bLengthChange: !1, paging: !1, fnRowCallback: function fnRowCallback(V, W, X) {
        1 == X % 2 ? $('td', V).css('background-color', '#32464F') : $('td', V).css('background-color', '#283C45');
      } }), $('#sankey_table_' + l).mCustomScrollbar({ axis: 'y' }), $('#sankey_table_' + l + ' tr:first').css('background-color', '#0CB29A');var P = $('#sankey_table_' + l).children('div').find('div').eq(0),
        Q = $('#sankey_table_' + l).children('div').find('div').eq(1),
        R = $('#sankey_table_' + l).children('div').find('div').eq(2),
        S = P.attr('id'),
        T = Q.attr('id'),
        U = R.attr('id');$('#' + S + ' label').css('color', '#666666'), $('#' + T + ' label').css('color', '#666666'), $('#' + U).css('color', '#666666'), $(' .dataTables_filter input').css({ 'margin-left': '0.5em', position: 'relative', border: '0', 'min-width': '240px', background: 'transparent', 'border-bottom': '1px solid #666666', ' border-radius': ' 0', padding: ' 5px 25px', color: '#ccc', height: ' 30px', '-webkit-box-shadow': ' none', 'box-shadow': ' none' }), $('.dataTables_wrapper').css('background-color', '#374C59');
  }), $('body').on('click', '.header_chart_' + l, function () {
    $(t).css('overflow', 'hidden');var M = $(this).parent().parent().parent().parent().siblings('div').attr('id');'#' + M == t && ($(this).css('display', 'none'), $('.header_table_' + l).css('display', 'inline-block'), $(k).empty(), new sankey_chart(g));
  }), $('body').on('click', '.header_fullscreen_chart' + l, function () {
    $('#modal_' + l).modal('show');var M = jQuery.extend(!0, {}, g);setTimeout(function () {
      $('#modal_chart_container' + l).css('width', '100%'), M.container = '#modal_chart_container' + l, M.headerOptions = !1, M.height = 450, new sankey_chart(M);
    }, 500);
  });
}
"use strict";

//var Pietooltipdiv = d3.select("body").append("div").attr("class", "toolTip_piehorizontal").style("text-transform", "uppercase").style("visibility", "visible").style("position", "absolute").style("z-index", 1000).style("background","rgb(27, 39, 53)").style("padding","5px 10px").style("border-radius","10px").style("font-size","11px").style("display","none");
var Pietooltipdiv = d3.select("body").append("div").attr("class", "line_chart_tool").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("visibility", "visible").style("border-radius", "10px").style("font-size", "10px").style("display", "none");
Number.prototype.formatAmt = function (decPlaces, thouSeparator, decSeparator) {
    var n = this,
        decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
        decSeparator = decSeparator == undefined ? "." : decSeparator,
        thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
        sign = n < 0 ? "-" : "",
        i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
        j = (j = i.length) > 3 ? j % 3 : 0;
    return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
};
function reusablePie(pieOptions) {
    //code for number formatting
    //	$(".toolTip_piehorizontal").remove();
    var asIndex = 0;
    if (pieOptions.container) {
        $(pieOptions.container).empty();
    }
    if (location.hash == "#!/alertDashboard" && (!pieOptions.data || pieOptions.data.length == 0)) {
        d3.select(pieOptions.container).append("div").attr("class", "alertsDashErrorDiv").html("<span>Data Not Found</span>");
        return false;
    }
    if (location.hash == "#!/alertDashboard") {
        var extnts = d3.extent(pieOptions.data, function (d) {
            return d.value;
        });
        if (extnts[0] == 0 && extnts[1] == 0) {
            d3.select(pieOptions.container).append("div").attr("class", "alertsDashErrorDiv").html("<span>Data Not Found</span>");
            return false;
        }
    }
    // --------------------------Initialize
    // Values-----------------------------
    if (pieOptions) {
        this.container = pieOptions.container ? pieOptions.container : "body";

        this.data = pieOptions.data ? pieOptions.data : [];

        this.radius = pieOptions.radius ? {
            innerRadius: pieOptions.radius.innerRadius ? pieOptions.radius.innerRadius : 0,
            outerRadius: pieOptions.radius.outerRadius ? pieOptions.radius.outerRadius : 100
        } : {
            innerRadius: 0,
            outerRadius: 100
        };
        this.height = pieOptions.height ? pieOptions.height : 600;
        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.legendwidth = pieOptions.legendwidth ? pieOptions.legendwidth : 50;
        this.contentWidth = pieOptions.islegends ? pieOptions.legendwidth ? 100 - pieOptions.legendwidth : 50 : 100;
        this.txtColor = pieOptions.txtColor ? pieOptions.txtColor : '#2473B5';
        this.txtSize = pieOptions.txtSize ? pieOptions.txtSize : '21px';
    } else {
        return false;
    }
    var containerid = this.container;
    var _this = this;
    var randomSubstring = this.randomIdString;
    // var chartContainerdiv = '<div class="chartContainer"
    // align="center" style="width: 80%; margin: auto;
    // margin-top: 30px; font-size: 14px;font-family:
    // roboto-regular;"> <div class="graphBox"
    // style="margin: auto; background-color: #374c59;
    // width: 100%;left: 0px;top: 0px;overflow:
    // hidden;position: relative;"> <div class="headerDiv"
    // style="font-weight:bold;background-color:
    // #425661;text-align: left;color: #239185;
    // border-bottom: 1px solid rgba(192, 192, 192,
    // 0.47);width: 100%; line-height: 2.5;font-size: 16px
    // ;padding-left: 5px;">' + pieOptions.header +
    // '</div><div id="pie_chart_div' + randomSubstring + '"
    // class="chartContentDiv" style="width: 100%;"></div>
    // </div></div>'
    var chartContainerdiv = '<div id="pie_chart_div' + randomSubstring + '" class="" style="width: 100%;"></div>';
    $(this.container).html(chartContainerdiv);
    var chart_container = "#pie_chart_div" + randomSubstring;
    var _this = this;
    var data = this.data;
    if (_this.pieOptions) {
        var sumTotal = sum;
    }
    // $(chart_container).append("<div id='streamContainer-" + (randomSubstring) +
    // "'style='width:100%' ></div>")

    // var div = d3.select("body").append("div").attr("class",
    // "toolTip_horizontal").style("position", "absolute").style("z-index",
    // 1000).style("background","rgb(27, 39, 53)").style("padding","5px
    // 10px").style("border-radius","10px").style("font-size","10px").style("display","none");

    var pieLegendData = [];
    if (pieOptions.islegendleft) {
        $(chart_container).append("<div class='pielegendContainer' style ='text-transform:uppercase;text-align: left;float:left;width:" + this.legendwidth + "%' id='legendContainer-" + randomSubstring + "'></div>");

        $(chart_container).append("<div id='streamContainer-" + randomSubstring + "' style ='float:left;width:" + this.contentWidth + "%'></div>");
    } else {
        $(chart_container).append("<div id='streamContainer-" + randomSubstring + "' style ='float:left;width:" + this.contentWidth + "%'></div>");
        $(chart_container).append("<div class='pielegendContainer' style ='text-transform:uppercase;text-align: left;float:left;width:" + this.legendwidth + "%' id='legendContainer-" + randomSubstring + "'></div>");
    }
    var colorScale = d3.scaleOrdinal().range(pieOptions.colors ? pieOptions.colors : ["#5d96c8", "#b753cd", "#69ca6b", "#69ca6b", "#c1bd4f", "#db3f8d", "#669900"]);

    this.width = pieOptions.width ? pieOptions.width : $('#streamContainer-' + randomSubstring).width() - 10;
    var width = this.width,
        height = this.height;

    //	        if (height > width) {
    //	            height = width;
    //	        }


    // define scales
    var radius = Math.min(width, height) / 2;
    // define main grounp
    var arc = d3.arc().outerRadius(radius - 10).innerRadius(radius - radius / 2);
    var labelArc = d3.arc().outerRadius(radius - 40).innerRadius(radius - 40);
    var pie = d3.pie().padAngle(pieOptions.ispadding ? 0.2 : 0).sort(null).value(function (d) {
        return d.value;
    });
    var svg = d3.select('#streamContainer-' + randomSubstring).append("svg").attr('id', 'mainSvg-' + randomSubstring).attr("width", width).attr("height", height).append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    var g = svg.selectAll(".arc").data(pie(data)).enter().append("g").attr("class", "arc");
    g.append("path").style("fill", function (d, i) {

        if (pieOptions.colorsObj) {
            pieLegendData.push({
                name: d.data.key,
                color: pieOptions.colorsObj[d.data.key],
                value: d.data.value,
                formattedVal: Number(d.data.value).formatAmt().split('.')[0],
                piedata: data,
                arcData: d,
                container: pieOptions.container

            });
            return pieOptions.colorsObj[d.data.key];
            pieLegendData.push({
                name: d.data.key,
                color: colorScale(d.data.key),
                value: d.data.value,
                formattedVal: Number(d.data.value).formatAmt().split('.')[0],
                piedata: data,
                arcData: d,
                container: pieOptions.container
            });
        } else if (pieOptions.container == '#as_score' || pieOptions.container == '#bs_score' && location.hash.indexOf('generalCardHolderDetails') >= 0) {
            pieLegendData.push({
                name: d.data.key,
                color: colorScale(d.data.key),
                value: d.data.value,
                formattedVal: Number(d.data.value).formatAmt().split('.')[0],
                piedata: data,
                arcData: d,
                container: pieOptions.container
            });
            return data[i]['color'];
        } else if (pieOptions.fixedColorWithKey != undefined) {
            var index, selectedLegendColor;
            if (pieOptions.fixedColorWithKey.length > pieOptions.data.length) {
                index = pieOptions.fixedColorWithKey.map(function (d1) {
                    return d1.key;
                }).indexOf(d.data.key);

                pieOptions.fixedColorWithKey.map(function (d1) {
                    if (d.data.key == d1.key) {
                        selectedLegendColor = d1.color;
                    }
                });
            }
            if (index == -1 || pieOptions.fixedColorWithKey.length <= pieOptions.data.length) {
                asIndex = asIndex + 1;
                index = asIndex - 1;
                selectedLegendColor = pieOptions.colors[index];
            }
            pieLegendData.push({
                name: d.data.key,
                color: selectedLegendColor,
                value: d.data.value,
                formattedVal: Number(d.data.value).formatAmt().split('.')[0],
                piedata: data,
                arcData: d,
                container: pieOptions.container
            });
            return selectedLegendColor;
        } else {
            pieLegendData.push({
                name: d.data.key,
                color: colorScale(d.data.key),
                value: d.data.value,
                formattedVal: Number(d.data.value).formatAmt().split('.')[0],
                piedata: data,
                arcData: d,
                container: pieOptions.container
            });
            return colorScale(d.data.key);
        }
    }).style('stroke', function (d) {
        if (pieOptions.sum) {
            if (d.data.value > pieOptions.sum || pieOptions.data.length == 1) {
                return 'white';
            }
        }
    }).style("cursor", function () {
        if (pieOptions.cursor == 'default') {
            return "default";
        } else {
            return "pointer";
        }
    }).on("contextmenu", function (d) {
        if (location.hash == "#!/alertDashboard") {
            window.transSelectedFilter.data = d;
            window.transSelectedFilter.id = pieOptions.container;
            window.transSelectedFilter.chartType = "pie";
            //           		 aplyAlertDasboardFilters(d,pieOptions.container,"pie");
        }
    }).on("click", function (d) {
        if (pieOptions.showValue == 'noValue') {
            $(containerid + ' ' + 'text').html('');
            var txtY = parseFloat(_this.txtSize.toLowerCase().split("px")[0]) / 2.5;
            g.append("text").attr("y", txtY).text(d.data.piePercentage + '%').style('text-anchor', "middle").style('font-size', _this.txtSize).style("fill", _this.txtColor).style("stroke", "none");
        } else if (pieOptions.page && pieOptions.page == "mip") {
            refresh(d.data.key, $(this).parent().parent().parent().parent().parent().parent().attr("id"));
        } else if (location.hash.indexOf('generalCardHolderDetails') >= 0 || location.hash.indexOf('dualCardHolderDetails') >= 0 || location.hash.indexOf('earlyAdopters') >= 0) {
            window.pieAndWorldOnClick(pieOptions.container, pieOptions.data, d);
        }
    }).on("mouseover", function (d) {
        Pietooltipdiv.style("visibility", "visible");
        Pietooltipdiv.style("display", "inline-block");
        if (d.data.txt) {
            Pietooltipdiv.html(d.data.txt);
        } else if (pieOptions.format) {
            if (pieOptions.container == "#dataPart" || pieOptions.container == "#dayWeek") {
                Pietooltipdiv.html(d.data.key + ": <span class='fa fa-ils f-10'></span> " + Number(d.value).formatAmt().split('.')[0]);
            } else {
                Pietooltipdiv.html(d.data.key + ": " + Number(d.value).formatAmt().split('.')[0]);
            }
        } else {
            Pietooltipdiv.html(d.data.key + ": " + (d.actualValue ? d.actualValue : d.value));
        }
    }).on("mousemove", function (d) {
        var p = $(chart_container);
        var position = p.offset();
        var elmen = document.getElementsByClassName('line_chart_tool');
        var tooltipWidth = elmen[0].clientWidth;
        var cursor = d3.event.x;
        if (position.left < d3.event.pageX && cursor > tooltipWidth) {
            for (i = 0; i < elmen.length; i++) {
                elmen[i].classList.remove("tooltip-left");
                elmen[i].classList.add("tooltip-right");
            }
            Pietooltipdiv.style("left", d3.event.pageX - tooltipWidth + "px");
            Pietooltipdiv.style("top", d3.event.pageY - 25 + "px");
        } else {
            for (i = 0; i < elmen.length; i++) {
                elmen[i].classList.remove("tooltip-right");
                elmen[i].classList.add("tooltip-left");
            }
            Pietooltipdiv.style("left", d3.event.pageX + 10 + "px");
            Pietooltipdiv.style("top", d3.event.pageY - 25 + "px");
        }
    }).on("mouseout", function (d) {
        Pietooltipdiv.style("visibility", "hidden");
        Pietooltipdiv.style("display", "none");
    }).transition().delay(function (d, i) {
        return i * 10;
    }).duration(500).attrTween('d', function (d) {
        var i = d3.interpolate(d.startAngle + 0.1, d.endAngle);
        return function (t) {
            d.endAngle = i(t);
            return arc(d);
        };
    });
    if (pieOptions.istxt) {
        var txtY = parseFloat(this.txtSize.toLowerCase().split("px")[0]) / 2.5;
        if (typeof pieOptions.istxt != "boolean" && pieOptions.istxt != "true" && pieOptions.istxt != "false" && pieOptions.showValue != 'noValue') {
            g.append("text").attr("y", txtY).text(pieOptions.istxt).style('text-anchor', "middle").style('font-size', this.txtSize).style("fill", this.txtColor).style("stroke", "none");
        } else if (pieOptions.showValue != 'noValue') {
            g.append("text").attr("y", txtY).text(pieOptions.maxval.toFixed(2) + "%").style('text-anchor', "middle").style('font-size', this.txtSize).style("fill", this.txtColor).style("stroke", "none");
        }
    }
    if (pieOptions.islegends) {
        var pieLegendArray = [];
        angular.forEach(data, function (d, i) {
            pieLegendArray.push(d.key);
        });
        renderPieLegend(pieLegendArray);
    }

    /**
     * Function to store legend Data
     *
     * @param {array}
     */
    if (location.hash == "#!/alertDashboard" || location.hash.split('/')[1] == "generalCardHolderDetails" || location.hash.split('/')[1] == "dualCardHolderDetails" || location.hash.split('/')[1] == "earlyAdopters") {
        window.reusablePieLegendData(pieLegendData, containerid);
    }
    // --------------------------------------------------------------------------
    /**
     * Function to render Pie chart legends
     *
     * @param {array}
     *            data
     *
     */
    function renderPieLegend(data) {
        if (pieOptions.legendmargintop) {
            $("#legendContainer-" + randomSubstring).css("margin-top", pieOptions.legendmargintop);
        }
        angular.forEach(data, function (d, i) {
            $("#legendContainer-" + randomSubstring).append('<div class="pieLegendDiv" style = "color: #778c96;" ><div class="bar_legend_circles" style="background-color:' + (pieOptions.colorsObj ? pieOptions.colorsObj[d] : colorScale(d)) + ';height: 12px;width: 12px;border-radius: 6px;display: inline-block"></div><span style="padding:10px;margin:0 2px;font-size:10px">' + d + '</span></div>');
            $("#legendContainer-" + randomSubstring).find(".pieLegendDiv").css("font-family", "'Roboto Medium'");
        });
    }
    //code for number formatting
    Number.prototype.formatAmt = function (decPlaces, thouSeparator, decSeparator) {
        var n = this,
            decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
            decSeparator = decSeparator == undefined ? "." : decSeparator,
            thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
            sign = n < 0 ? "-" : "",
            i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
            j = (j = i.length) > 3 ? j % 3 : 0;
        return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
    };
}
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Function to load network chart
 */
function loadEntityNetworkChart(data, options, currentSearch, layout) {
    var availableIcons = ['person', 'website', 'company', 'company_number', 'officer_id', 'location', 'skill', 'article', 'root-company', 'root', 'sentence', 'transaction', 'organization', 'industry', 'alert', 'user', 'account', 'follows', 'investment', 'returns', 'stock', 'stock_change', 'text', 'product', 'vulnerability', 'date', 'user', 'tweet', 'usermention', 'follower_following_count', 'product', 'trade', 'founder', 'follower', 'open_port', 'gps', 'service', 'metadata', 'cyber_info', 'share-changes', 'photo', 'assets_chart', 'video', 'profile_chart', 'cover', 'revanue_chart', 'comment', 'post', 'stock', 'filling', 'compensation', 'board_member', 'membership', 'profit_chart'];
    var vladata = data;
    $(".qtip").remove();
    var colorScale = d3.scaleOrdinal().range(["#669802", "#D894B6", "#335C81", "#CF9700", "#E58B19"]);
    var defaultColor = "#62747E";
    var layoutOption;
    if (layout) {
        layoutOption = layout;
    } else {
        layoutOption = 'cola';
    }
    var cy = window.cy = cytoscape({
        container: document.getElementById(options.id),
        boxSelectionEnabled: false,
        autounselectify: true,

        style: cytoscape.stylesheet().selector('node').css({
            "width": function width(e) {
                //                    var max_scale = 1, min_scale = 0, scale_span = max_scale - min_scale;
                //                    if (e.data().risks == void 0) {
                //                        if (e.data('riskScore')) {
                //                            var w = e.data('weight') * 1;
                //                            var r = e.data('riskScore') == 0 ? 1 : e.data('riskScore');
                //                            var risk = r * 1;
                //                            if (!w || isNaN(w))
                //                                w = 1;
                //                            var risk_weight = risk * w;
                //                            var wf = (risk_weight < 3) ? 3 : (risk_weight > 6 ? 6 : risk_weight);
                //                            return wf * 20;
                //                        } else {
                return "80";
                //                        }
                //                    }
            },
            "height": function height(e) {
                //                    var max_scale = 1, min_scale = 0, scale_span = max_scale - min_scale;
                //                    if (e.data().risks == void 0) {
                //                        if (e.data('riskScore')) {
                //                            var w = e.data('weight') * 1;
                //                            var r = e.data('riskScore') == 0 ? 1 : e.data('riskScore');
                //                            var risk = r * 1;
                //                            if (!w || isNaN(w))
                //                                w = 1;
                //                            var risk_weight = risk * w;
                //                            var wf = (risk_weight < 3) ? 3 : (risk_weight > 6 ? 6 : risk_weight);
                //                            return wf * 20;
                //                        } else {
                return "80";
                //                        }
                //                    }
            },
            'background-color': function backgroundColor(e) {
                if (e.data().evt_color) {
                    return e.data().evt_color;
                }
                if (e.data().labelV == "Company" && e.data().name == currentSearch) {
                    return "#4192b7";
                }
                if (e.data().labelV == "Person" && e.data().name == currentSearch) {
                    return "#4192b7";
                }

                if (e.data().riskScore > 60) {
                    return "#e04033";
                }
                return defaultColor;
            },
            'background-image': function backgroundImage(n) {
                if (window.location.hash.indexOf("#!/") < 0) {
                    if (n.data().labelV == "Company") {
                        return 'url(scripts/VLA/KeylineICONS/company.svg)';
                    }
                    if (n.data().labelV == "share_holder" || n.data().labelV == "Board of Managment") {
                        return 'url(scripts/VLA/KeylineICONS/user.svg)';
                    }
                    if (n.data().labelV == "location") {
                        return 'url(scripts/VLA/KeylineICONS/map_marker.svg)';
                    }
                    if (n.data().labelV == "audit_committee" || n.data().labelV == "board of Management" || n.data().labelV == "Cooperations_memberships_and_committee_work" || n.data().labelV == "board_of_directors" || n.data().labelV == "top_investers") {
                        return 'url(scripts/VLA/KeylineICONS/gang.svg)';
                    }
                    if (n.data().labelV == "Contact") {
                        return 'url(scripts/VLA/KeylineICONS/phone.png)';
                    }
                    if (n.data().labelV == "Article") {
                        return 'url(scripts/VLA/KeylineICONS/article.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "technology") {
                        return 'url(scripts/VLA/KeylineICONS/technology' + count + '.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "event") {
                        return 'url(scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "club") {
                        return 'url(scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                    }
                    return 'url(scripts/VLA/KeylineICONS/user.svg)';
                } else {
                    if (n.data().risks == void 0) {
                        var w = n.data('weight') * 1;
                        var count = '';
                        if (n.data('riskScore')) {
                            var r = n.data('riskScore');
                            var risk = r * 1;
                            if (!w || isNaN(w)) w = 1;
                            var risk_weight = risk * w;
                            var wf = risk_weight < 3 ? 3 : risk_weight > 6 ? 6 : Math.floor(risk_weight);
                            wf = parseInt(wf * 20);
                            count = "_" + wf;
                        } else {
                            count = "_80";
                        }

                        if (n.data()['labelV'] == 'Location') {
                            return 'url(../scripts/VLA/KeylineICONS/map-marker' + count + '.svg)';
                        }
                        if (n.data().labelV == "Organization") {
                            return 'url(../scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                        }
                        if (n.data().labelV == "Company") {
                            return 'url(../scripts/VLA/KeylineICONS/company' + count + '.svg)';
                        }
                        if (n.data().labelV == "share_holder" || n.data().labelV == "Board of Managment") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "location") {
                            return 'url(../scripts/VLA/KeylineICONS/map_marker' + count + '.svg)';
                        }
                        if (n.data().labelV == "audit_committee" || n.data().labelV == "board of Management" || n.data().labelV == "Cooperations_memberships_and_committee_work" || n.data().labelV == "board_of_directors" || n.data().labelV == "top_investers") {
                            return 'url(../scripts/VLA/KeylineICONS/gang' + count + '.svg)';
                        }
                        if (n.data().labelV == "Contact") {
                            return 'url(../scripts/VLA/KeylineICONS/phone' + count + '.png)';
                        }
                        if (n.data().labelV == "Article") {
                            return 'url(../scripts/VLA/KeylineICONS/article' + count + '.svg)';
                        }
                        if (n.data().labelV == "Date") {
                            return 'url(../scripts/VLA/KeylineICONS/date' + count + '.svg)';
                        }
                        if (n.data().labelV == "Person") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "Tweet") {
                            return 'url(../scripts/VLA/KeylineICONS/tweet' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follower_Following_Count") {
                            return 'url(../scripts/VLA/KeylineICONS/follower_following_count' + count + '.svg)';
                        }
                        if (n.data().labelV == "Product") {
                            return 'url(../scripts/VLA/KeylineICONS/product' + count + '.svg)';
                        }
                        if (n.data().labelV == "Industry") {
                            return 'url(../scripts/VLA/KeylineICONS/industry' + count + '.svg)';
                        }
                        if (n.data().labelV == "FOUNDER") {
                            return 'url(../scripts/VLA/KeylineICONS/founder' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follows") {
                            return 'url(../scripts/VLA/KeylineICONS/follows' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follower") {
                            return 'url(../scripts/VLA/KeylineICONS/follower' + count + '.svg)';
                        }
                        if (n.data().labelV == "Skill") {
                            return 'url(../scripts/VLA/KeylineICONS/skill' + count + '.svg)';
                        }
                        if (n.data().labelV == "Sentence") {
                            return 'url(../scripts/VLA/KeylineICONS/sentence' + count + '.svg)';
                        }
                        if (n.data().labelV == "UserMention") {
                            return 'url(../scripts/VLA/KeylineICONS/usermention' + count + '.svg)';
                        }
                        if (n.data().labelV == "TRADE_NAME") {
                            return 'url(../scripts/VLA/KeylineICONS/trade' + count + '.svg)';
                        }
                        if (n.data().labelV.toLowerCase() == "share_change") {
                            return 'url(../scripts/VLA/KeylineICONS/share-changes' + count + '.svg)';
                        }
                        if (n.data().labelV == "Cyber_info") {
                            return 'url(../scripts/VLA/KeylineICONS/cyber_info' + count + '.svg)';
                        }
                        if (n.data().labelV == "Metadata") {
                            return 'url(../scripts/VLA/KeylineICONS/metadata' + count + '.svg)';
                        }
                        if (n.data().labelV == "Service") {
                            return 'url(../scripts/VLA/KeylineICONS/service' + count + '.svg)';
                        }
                        if (n.data().labelV == "GPS") {
                            return 'url(../scripts/VLA/KeylineICONS/gps' + count + '.svg)';
                        }
                        if (n.data().labelV == "Open_Port") {
                            return 'url(../scripts/VLA/KeylineICONS/open_port' + count + '.svg)';
                        }
                        if (n.data().labelV == "website") {
                            return 'url(../scripts/VLA/KeylineICONS/internet-explorer' + count + '.svg)';
                        }
                        if (n.data().labelV == "company_number") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "officer_id") {
                            return 'url(../scripts/VLA/KeylineICONS/tag' + count + '.svg)';
                        }
                        if (n.data().labelV == "Root_Company") {
                            return 'url(../scripts/VLA/KeylineICONS/root-company' + count + '.svg)';
                        }
                        if (n.data().labelV == "Root") {
                            return 'url(../scripts/VLA/KeylineICONS/root' + count + '.svg)';
                        }
                        if (n.data().labelV == "Transaction") {
                            return 'url(../scripts/VLA/KeylineICONS/transaction' + count + '.svg)';
                        }
                        if (n.data().labelV == "alert") {
                            return 'url(../scripts/VLA/KeylineICONS/alert' + count + '.svg)';
                        }
                        if (n.data().labelV == "customer") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "account") {
                            return 'url(../scripts/VLA/KeylineICONS/account' + count + '.svg)';
                        }
                        if (n.data().labelV == "tx") {
                            return 'url(../scripts/VLA/KeylineICONS/transaction' + count + '.svg)';
                        }
                        if (n.data().labelV == "Accounts") {
                            return 'url(../scripts/VLA/KeylineICONS/account' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follows") {
                            return 'url(../scripts/VLA/KeylineICONS/follows' + count + '.svg)';
                        }
                        if (n.data().labelV == "Address") {
                            return 'url(../scripts/VLA/KeylineICONS/address' + count + '.svg)';
                        }
                        if (n.data().labelV == "Investment") {
                            return 'url(../scripts/VLA/KeylineICONS/investment' + count + '.svg)';
                        }
                        if (n.data().labelV == "Returns") {
                            return 'url(../scripts/VLA/KeylineICONS/returns' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock_Change") {
                            return 'url(../scripts/VLA/KeylineICONS/stock_change' + count + '.svg)';
                        }
                        if (n.data().labelV == "Text") {
                            return 'url(../scripts/VLA/KeylineICONS/text' + count + '.svg)';
                        }
                        if (n.data().labelV == "Vulnerability") {
                            return 'url(../scripts/VLA/KeylineICONS/vulnerability' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Photo") {
                            return 'url(../scripts/VLA/KeylineICONS/photo' + count + '.svg)';
                        }
                        if (n.data().labelV == "Assets_chart") {
                            return 'url(../scripts/VLA/KeylineICONS/assets_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Video") {
                            return 'url(../scripts/VLA/KeylineICONS/video' + count + '.svg)';
                        }
                        if (n.data().labelV == "Profile_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/profile_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Cover") {
                            return 'url(../scripts/VLA/KeylineICONS/cover' + count + '.svg)';
                        }
                        if (n.data().labelV == "Revanue_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/revanue_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Comment") {
                            return 'url(../scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                        }
                        if (n.data().labelV == "Post") {
                            return 'url(../scripts/VLA/KeylineICONS/post' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Filling") {
                            return 'url(../scripts/VLA/KeylineICONS/filling' + count + '.svg)';
                        }
                        if (n.data().labelV == "Compensation") {
                            return 'url(../scripts/VLA/KeylineICONS/compensation' + count + '.svg)';
                        }
                        if (n.data().labelV == "board_member") {
                            return 'url(../scripts/VLA/KeylineICONS/board_member' + count + '.svg)';
                        }
                        if (n.data().labelV == "membership") {
                            return 'url(../scripts/VLA/KeylineICONS/membership' + count + '.svg)';
                        }
                        if (n.data().labelV == "Profit_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/profit_chart' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "technology") {
                            return 'url(../scripts/VLA/KeylineICONS/technology' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "event") {
                            return 'url(../scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "club") {
                            return 'url(../scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                        }
                        return 'url(../scripts/VLA/KeylineICONS/default' + count + '.svg)';
                    }
                }
            },
            'text-valign': 'center',
            'color': "#fff",
            'font-size': '10px'
        }).selector('edge').css({
            'curve-style': 'bezier',
            'width': 2,
            'target-arrow-shape': 'none',
            'line-color': function lineColor(e) {
                return defaultColor;
            }
        }),

        elements: data,

        layout: {
            name: layoutOption,
            nodeSpacing: 50,
            edgeLengthVal: 45,
            animate: true,
            randomize: false,
            maxSimulationTime: 1500
        }
    }); // cy init

    var tool_tip = $('body').append('<div class="entity_vlatooltip tooltip-left" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; visibility: visible;display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    //		 cy.elements().qtip({
    //				content: function () {
    //                    var node = this;
    //                    if (!node.isEdge())
    //                        return qtip_nodeData(this);
    //                    else
    //                    	return qtip_edgeData(this);
    //                },
    //				position: {
    //					my: 'bottom center',
    //                    at: 'top center',
    //				},
    //				style: {
    //					classes: 'qtip-bootstrap',
    //					tip: {
    //						width: 16,
    //						height: 8
    //					}
    //				},
    //                show: {
    //                    event: 'mouseover'
    //                },
    //                hide: {
    //                    event: 'mouseout'
    //                }
    //			});
    //		 cy.on("mouseout", function (d) {
    //			 $(".qtip").hide();
    //          });


    cy.on("mouseover", 'edge', function (d) {
        var edge = this;
        var text = data_info(edge, 'edge');
        $(".entity_vlatooltip").html(text);

        return $(".entity_vlatooltip").css("display", "block");
    }).on("mousemove", function (evt) {
        $(".entity_vlatooltip").css({ "left": evt.originalEvent.pageX + 20 });
        $(".entity_vlatooltip").css("top", evt.originalEvent.pageY - 20);
    }).on("mouseout", function () {
        //hide tool-tip
        return $(".entity_vlatooltip").css("display", "none");
    });

    cy.on("mouseover", 'node', function (d) {
        var node = this;
        var text = data_info(node);
        $(".entity_vlatooltip").html(text);

        return $(".entity_vlatooltip").css("display", "block");
    }).on("mousemove", function (evt) {
        $(".entity_vlatooltip").css({ "left": evt.originalEvent.pageX + 20 });
        $(".entity_vlatooltip").css("top", evt.originalEvent.pageY - 20);
    }).on("mouseout", function () {
        // $(this).css("opacity", 0.4);
        //hide tool-tip
        return $(".entity_vlatooltip").css("display", "none");
    });

    cy.on("click", "node", function (d) {
        var url = window.location.href.split("/#/")[0] + "/#/linkAnalysis?q=" + this.data('name');
        window.open(url, "_blank");
    });

    function data_info(element, isedge) {
        var html = '<div class="row">',
            name_html = '',
            address_html = '';
        var data = element.data();
        for (var key in data) {
            if (!data.hasOwnProperty(key)) continue;
            if (key == 'risks') continue;
            if (data[key] != '' && data[key] != void 0) {
                if (isedge) {
                    var lable = key == "labelE" ? "Type" : key;
                    if (key != "spells" && key.indexOf("_") != 0 && key != 'to' && key != 'from' && key != 'id' && key != 'source' && key != 'target') {
                        if (_typeof(data[key]) === "object") {
                            var tI = data[key];
                            var chanel = tI.channel != undefined ? tI.toString().split("_").join(" ") : 'N/A';
                            var base = tI.base_amount != undefined ? tI.base_amount : 'N/A';
                            var direction = tI.direction != undefined ? tI.direction : '';
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + "channel" + ": </span><span class='vla-caption-body'>" + chanel + "</span></div>";
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + " Amount" + ": </span><span class='vla-caption-body'>" + base + direction + "</span></div>";
                        } else {
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + lable + " :</span><span class='vla-caption-body'> " + data[key].toString().split("_").join(" ") + "</span></div>";
                        }
                    }
                } else {
                    var lable = key == "labelV" ? "Type" : key;
                    if (key != "spells" && key.indexOf("_") != 0 && key != 'start' && key != 'createdBy' && key != 'id' && key != 'lat' && key != 'lon' && key != 'caseId') {
                        if (key != "labelV") {
                            lable = key.split("_").join(" ");
                        }
                        if (key == 'name') {
                            if (typeof vladata.nodes == 'undefined') return;
                            for (var i = 0; i < vladata.nodes.length; i++) {
                                var type = vladata.nodes[i];
                                if (type.data.name == data['labelV'].toLowerCase() || type.name == data['labelV']) {
                                    if (type.data.labelV == 'Location') {
                                        if (type.data.name != '') {
                                            html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-home' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                                        }
                                    } else {
                                        var newLabel = '';
                                        if (data['labelV'].toLowerCase() === "customer" || data['labelV'].toLowerCase() === "person" || data['labelV'].toLowerCase() === "share_holder" || data['labelV'].toLowerCase() === "board of managment") {
                                            newLabel = "user";
                                        } else if (data['labelV'].toLowerCase() === "news") {
                                            newLabel = "user";
                                        } else if (data['labelV'].toLowerCase() == 'location') {
                                            newLabel = 'map-marker';
                                        } else if (data.labelV == "audit_committee" || data.labelV == "board of Management" || data.labelV == "Cooperations_memberships_and_committee_work" || data.labelV == "board_of_directors" || data.labelV == "top_investers") {
                                            newLabel = 'gang';
                                        } else if (data.labelV.toLowerCase() == "contact") {
                                            newLabel = 'phone';
                                        } else if (data.labelV.toLowerCase() == "trade_name") {
                                            newLabel = 'trade';
                                        } else if (data.labelV == "website") {
                                            newLabel = 'internet-explorer';
                                        } else if (data.labelV == "company_number") {
                                            newLabel = 'user';
                                        } else if (data.labelV == "officer_id") {
                                            newLabel = 'tag';
                                        } else if (data.labelV == "tx") {
                                            newLabel = 'transaction';
                                        } else if (data.labelV == "Accounts") {
                                            newLabel = 'account';
                                        } else if (data.labelV.toLowerCase() == "share_change") {
                                            return 'share-changes';
                                        } else if (data.labelV && data.labelV.toLowerCase() == "technology") {
                                            newLabel = "technology";
                                        } else if (data.labelV && data.labelV.toLowerCase() == "event") {
                                            newLabel = "comment";
                                        } else if (data.labelV && data.labelV.toLowerCase() == "club") {
                                            newLabel = "organization";
                                        } else {
                                            newLabel = availableIcons.indexOf(data['labelV'].toLowerCase()) > -1 ? data['labelV'].toLowerCase() : 'default';
                                        }
                                        name_html = "<div class='row'><div class='col-sm-12'><div class='vla-caption-body custom-heading' title='" + data[key].toString().split("_").join(" ") + "'><img src='../scripts/VLA/KeylineICONS/" + newLabel + ".svg' alt='icon'>" + data[key].replace(/_/g, ' ') + "</div></div></div>";
                                    }
                                } else {
                                    var newLabel = '';
                                    if (data['labelV'].toLowerCase() === "customer" || data['labelV'].toLowerCase() === "person" || data['labelV'].toLowerCase() === "share_holder" || data['labelV'].toLowerCase() === "board of managment") {
                                        newLabel = "user";
                                    } else if (data['labelV'].toLowerCase() === "news") {
                                        newLabel = "user";
                                    } else if (data['labelV'].toLowerCase() == 'location') {
                                        newLabel = 'map-marker';
                                    } else if (data.labelV == "audit_committee" || data.labelV == "board of Management" || data.labelV == "Cooperations_memberships_and_committee_work" || data.labelV == "board_of_directors" || data.labelV == "top_investers") {
                                        newLabel = 'gang';
                                    } else if (data.labelV.toLowerCase() == "contact") {
                                        newLabel = 'phone';
                                    } else if (data.labelV.toLowerCase() == "trade_name") {
                                        newLabel = 'trade';
                                    } else if (data.labelV == "website") {
                                        newLabel = 'internet-explorer';
                                    } else if (data.labelV == "company_number") {
                                        newLabel = 'user';
                                    } else if (data.labelV == "officer_id") {
                                        newLabel = 'tag';
                                    } else if (data.labelV == "tx") {
                                        newLabel = 'transaction';
                                    } else if (data.labelV == "Accounts") {
                                        newLabel = 'account';
                                    } else if (data.labelV.toLowerCase() == "share_change") {
                                        return 'share-changes';
                                    } else if (data.labelV && data.labelV.toLowerCase() == "technology") {
                                        newLabel = "technology";
                                    } else if (data.labelV && data.labelV.toLowerCase() == "event") {
                                        newLabel = "comment";
                                    } else if (data.labelV && data.labelV.toLowerCase() == "club") {
                                        newLabel = "organization";
                                    } else {
                                        newLabel = availableIcons.indexOf(data['labelV'].toLowerCase()) > -1 ? data['labelV'].toLowerCase() : 'default';
                                    }

                                    name_html = "<div class='row'><div class='col-sm-12'><div class='vla-caption-body custom-heading' title='" + data[key].toString().split("_").join(" ") + "'><img src='../scripts/VLA/KeylineICONS/" + newLabel + ".svg' alt='icon'>" + data[key].replace(/_/g, ' ') + "</div></div></div>";
                                }
                            }
                        } else {
                            if (key == 'labelV') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-home' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'weight') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-balance-scale' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'role') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-star-o' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'Date_of_incorporation') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-calendar' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'address') {
                                address_html += "<div class='col-sm-12'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-envelope' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                        }
                    }
                }
            }
        }
        html = name_html + html;
        var riskReverScale = d3.scaleLinear().domain([0, 100]).range([1, 10]);
        if (data.riskScore) html += "<div class='col-sm-6' ><div class='custoom-tooltip-wrapper'><span class='vla-caption' style='color:#e04033;font-size:12px;' title='Risks'><i style='color:#e04033;' class='fa fa-exclamation-triangle' aria-hidden='true'></i> Risks :</span><span class='vla-caption-body' style='color:#e04033;font-size:12px;' title='" + data.riskScore.toFixed(2).toString() + '%' + "'> " + data.riskScore.toFixed(2).toString() + '%' + "</span></div></div>";

        if (data.risks) {
            for (var key in data.risks) {
                if (!data.risks.hasOwnProperty(key)) continue;
                if (key == 'description') continue;
                if (key == 'risks') html += "<div class='col-sm-6' ><div class='custoom-tooltip-wrapper'><span class='vla-caption' style='color:#e04033;font-size:12px;' title='" + key + "'><i style='color:#e04033;' class='fa fa-exclamation-triangle' aria-hidden='true'></i> " + key + " :</span><span class='vla-caption-body' style='color:#e04033;font-size:12px;' title='" + (data.risks[key] * 100).toFixed(2).toString() + '%' + "'> " + (data.risks[key] * 100).toFixed(2).toString() + '%' + "</span></div></div>";
            }
        }
        html = html + address_html;
        html += '</div>';
        return html;
    }
}
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Function to load network chart
 */
function loadEntityNetworkChart(data, options, currentSearch, layout) {
    var availableIcons = ['person', 'website', 'company', 'company_number', 'officer_id', 'location', 'skill', 'article', 'root-company', 'root', 'sentence', 'transaction', 'organization', 'industry', 'alert', 'user', 'account', 'follows', 'investment', 'returns', 'stock', 'stock_change', 'text', 'product', 'vulnerability', 'date', 'user', 'tweet', 'usermention', 'follower_following_count', 'product', 'trade', 'founder', 'follower', 'open_port', 'gps', 'service', 'metadata', 'cyber_info', 'share-changes', 'photo', 'assets_chart', 'video', 'profile_chart', 'cover', 'revanue_chart', 'comment', 'post', 'stock', 'filling', 'compensation', 'board_member', 'membership', 'profit_chart'];
    var vladata = data;
    $(".qtip").remove();
    var colorScale = d3.scaleOrdinal().range(["#669802", "#D894B6", "#335C81", "#CF9700", "#E58B19"]);
    var defaultColor = "#62747E";
    var layoutOption;
    if (layout) {
        layoutOption = layout;
    } else {
        layoutOption = 'cola';
    }
    var cy = window.cy = cytoscape({
        container: document.getElementById(options.id),
        boxSelectionEnabled: false,
        autounselectify: true,

        style: cytoscape.stylesheet().selector('node').css({
            "width": function width(e) {
                //                    var max_scale = 1, min_scale = 0, scale_span = max_scale - min_scale;
                //                    if (e.data().risks == void 0) {
                //                        if (e.data('riskScore')) {
                //                            var w = e.data('weight') * 1;
                //                            var r = e.data('riskScore') == 0 ? 1 : e.data('riskScore');
                //                            var risk = r * 1;
                //                            if (!w || isNaN(w))
                //                                w = 1;
                //                            var risk_weight = risk * w;
                //                            var wf = (risk_weight < 3) ? 3 : (risk_weight > 6 ? 6 : risk_weight);
                //                            return wf * 20;
                //                        } else {
                return "80";
                //                        }
                //                    }
            },
            "height": function height(e) {
                //                    var max_scale = 1, min_scale = 0, scale_span = max_scale - min_scale;
                //                    if (e.data().risks == void 0) {
                //                        if (e.data('riskScore')) {
                //                            var w = e.data('weight') * 1;
                //                            var r = e.data('riskScore') == 0 ? 1 : e.data('riskScore');
                //                            var risk = r * 1;
                //                            if (!w || isNaN(w))
                //                                w = 1;
                //                            var risk_weight = risk * w;
                //                            var wf = (risk_weight < 3) ? 3 : (risk_weight > 6 ? 6 : risk_weight);
                //                            return wf * 20;
                //                        } else {
                return "80";
                //                        }
                //                    }
            },
            'background-color': function backgroundColor(e) {
                if (e.data().evt_color) {
                    return e.data().evt_color;
                }
                if (e.data().labelV == "Company" && e.data().name == currentSearch) {
                    return "#4192b7";
                }
                if (e.data().labelV == "Person" && e.data().name == currentSearch) {
                    return "#4192b7";
                }

                if (e.data().riskScore > 60) {
                    return "#e04033";
                }
                return defaultColor;
            },
            'background-image': function backgroundImage(n) {
                if (window.location.hash.indexOf("#!/") < 0) {
                    if (n.data().labelV == "Company") {
                        return 'url(scripts/VLA/KeylineICONS/company.svg)';
                    }
                    if (n.data().labelV == "share_holder" || n.data().labelV == "Board of Managment") {
                        return 'url(scripts/VLA/KeylineICONS/user.svg)';
                    }
                    if (n.data().labelV == "location") {
                        return 'url(scripts/VLA/KeylineICONS/map_marker.svg)';
                    }
                    if (n.data().labelV == "audit_committee" || n.data().labelV == "board of Management" || n.data().labelV == "Cooperations_memberships_and_committee_work" || n.data().labelV == "board_of_directors" || n.data().labelV == "top_investers") {
                        return 'url(scripts/VLA/KeylineICONS/gang.svg)';
                    }
                    if (n.data().labelV == "Contact") {
                        return 'url(scripts/VLA/KeylineICONS/phone.png)';
                    }
                    if (n.data().labelV == "Article") {
                        return 'url(scripts/VLA/KeylineICONS/article.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "technology") {
                        return 'url(scripts/VLA/KeylineICONS/technology' + count + '.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "event") {
                        return 'url(scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                    }
                    if (n.data().labelV && n.data().labelV.toLowerCase() == "club") {
                        return 'url(scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                    }
                    return 'url(scripts/VLA/KeylineICONS/user.svg)';
                } else {
                    if (n.data().risks == void 0) {
                        var w = n.data('weight') * 1;
                        var count = '';
                        if (n.data('riskScore')) {
                            var r = n.data('riskScore');
                            var risk = r * 1;
                            if (!w || isNaN(w)) w = 1;
                            var risk_weight = risk * w;
                            var wf = risk_weight < 3 ? 3 : risk_weight > 6 ? 6 : Math.floor(risk_weight);
                            wf = parseInt(wf * 20);
                            count = "_" + wf;
                        } else {
                            count = "_80";
                        }

                        if (n.data()['labelV'] == 'Location') {
                            return 'url(../scripts/VLA/KeylineICONS/map-marker' + count + '.svg)';
                        }
                        if (n.data().labelV == "Organization") {
                            return 'url(../scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                        }
                        if (n.data().labelV == "Company") {
                            return 'url(../scripts/VLA/KeylineICONS/company' + count + '.svg)';
                        }
                        if (n.data().labelV == "share_holder" || n.data().labelV == "Board of Managment") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "location") {
                            return 'url(../scripts/VLA/KeylineICONS/map_marker' + count + '.svg)';
                        }
                        if (n.data().labelV == "audit_committee" || n.data().labelV == "board of Management" || n.data().labelV == "Cooperations_memberships_and_committee_work" || n.data().labelV == "board_of_directors" || n.data().labelV == "top_investers") {
                            return 'url(../scripts/VLA/KeylineICONS/gang' + count + '.svg)';
                        }
                        if (n.data().labelV == "Contact") {
                            return 'url(../scripts/VLA/KeylineICONS/phone' + count + '.png)';
                        }
                        if (n.data().labelV == "Article") {
                            return 'url(../scripts/VLA/KeylineICONS/article' + count + '.svg)';
                        }
                        if (n.data().labelV == "Date") {
                            return 'url(../scripts/VLA/KeylineICONS/date' + count + '.svg)';
                        }
                        if (n.data().labelV == "Person") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "Tweet") {
                            return 'url(../scripts/VLA/KeylineICONS/tweet' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follower_Following_Count") {
                            return 'url(../scripts/VLA/KeylineICONS/follower_following_count' + count + '.svg)';
                        }
                        if (n.data().labelV == "Product") {
                            return 'url(../scripts/VLA/KeylineICONS/product' + count + '.svg)';
                        }
                        if (n.data().labelV == "Industry") {
                            return 'url(../scripts/VLA/KeylineICONS/industry' + count + '.svg)';
                        }
                        if (n.data().labelV == "FOUNDER") {
                            return 'url(../scripts/VLA/KeylineICONS/founder' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follows") {
                            return 'url(../scripts/VLA/KeylineICONS/follows' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follower") {
                            return 'url(../scripts/VLA/KeylineICONS/follower' + count + '.svg)';
                        }
                        if (n.data().labelV == "Skill") {
                            return 'url(../scripts/VLA/KeylineICONS/skill' + count + '.svg)';
                        }
                        if (n.data().labelV == "Sentence") {
                            return 'url(../scripts/VLA/KeylineICONS/sentence' + count + '.svg)';
                        }
                        if (n.data().labelV == "UserMention") {
                            return 'url(../scripts/VLA/KeylineICONS/usermention' + count + '.svg)';
                        }
                        if (n.data().labelV == "TRADE_NAME") {
                            return 'url(../scripts/VLA/KeylineICONS/trade' + count + '.svg)';
                        }
                        if (n.data().labelV.toLowerCase() == "share_change") {
                            return 'url(../scripts/VLA/KeylineICONS/share-changes' + count + '.svg)';
                        }
                        if (n.data().labelV == "Cyber_info") {
                            return 'url(../scripts/VLA/KeylineICONS/cyber_info' + count + '.svg)';
                        }
                        if (n.data().labelV == "Metadata") {
                            return 'url(../scripts/VLA/KeylineICONS/metadata' + count + '.svg)';
                        }
                        if (n.data().labelV == "Service") {
                            return 'url(../scripts/VLA/KeylineICONS/service' + count + '.svg)';
                        }
                        if (n.data().labelV == "GPS") {
                            return 'url(../scripts/VLA/KeylineICONS/gps' + count + '.svg)';
                        }
                        if (n.data().labelV == "Open_Port") {
                            return 'url(../scripts/VLA/KeylineICONS/open_port' + count + '.svg)';
                        }
                        if (n.data().labelV == "website") {
                            return 'url(../scripts/VLA/KeylineICONS/internet-explorer' + count + '.svg)';
                        }
                        if (n.data().labelV == "company_number") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "officer_id") {
                            return 'url(../scripts/VLA/KeylineICONS/tag' + count + '.svg)';
                        }
                        if (n.data().labelV == "Root_Company") {
                            return 'url(../scripts/VLA/KeylineICONS/root-company' + count + '.svg)';
                        }
                        if (n.data().labelV == "Root") {
                            return 'url(../scripts/VLA/KeylineICONS/root' + count + '.svg)';
                        }
                        if (n.data().labelV == "Transaction") {
                            return 'url(../scripts/VLA/KeylineICONS/transaction' + count + '.svg)';
                        }
                        if (n.data().labelV == "alert") {
                            return 'url(../scripts/VLA/KeylineICONS/alert' + count + '.svg)';
                        }
                        if (n.data().labelV == "customer") {
                            return 'url(../scripts/VLA/KeylineICONS/user' + count + '.svg)';
                        }
                        if (n.data().labelV == "account") {
                            return 'url(../scripts/VLA/KeylineICONS/account' + count + '.svg)';
                        }
                        if (n.data().labelV == "tx") {
                            return 'url(../scripts/VLA/KeylineICONS/transaction' + count + '.svg)';
                        }
                        if (n.data().labelV == "Accounts") {
                            return 'url(../scripts/VLA/KeylineICONS/account' + count + '.svg)';
                        }
                        if (n.data().labelV == "Follows") {
                            return 'url(../scripts/VLA/KeylineICONS/follows' + count + '.svg)';
                        }
                        if (n.data().labelV == "Address") {
                            return 'url(../scripts/VLA/KeylineICONS/address' + count + '.svg)';
                        }
                        if (n.data().labelV == "Investment") {
                            return 'url(../scripts/VLA/KeylineICONS/investment' + count + '.svg)';
                        }
                        if (n.data().labelV == "Returns") {
                            return 'url(../scripts/VLA/KeylineICONS/returns' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock_Change") {
                            return 'url(../scripts/VLA/KeylineICONS/stock_change' + count + '.svg)';
                        }
                        if (n.data().labelV == "Text") {
                            return 'url(../scripts/VLA/KeylineICONS/text' + count + '.svg)';
                        }
                        if (n.data().labelV == "Vulnerability") {
                            return 'url(../scripts/VLA/KeylineICONS/vulnerability' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Photo") {
                            return 'url(../scripts/VLA/KeylineICONS/photo' + count + '.svg)';
                        }
                        if (n.data().labelV == "Assets_chart") {
                            return 'url(../scripts/VLA/KeylineICONS/assets_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Video") {
                            return 'url(../scripts/VLA/KeylineICONS/video' + count + '.svg)';
                        }
                        if (n.data().labelV == "Profile_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/profile_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Cover") {
                            return 'url(../scripts/VLA/KeylineICONS/cover' + count + '.svg)';
                        }
                        if (n.data().labelV == "Revanue_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/revanue_chart' + count + '.svg)';
                        }
                        if (n.data().labelV == "Comment") {
                            return 'url(../scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                        }
                        if (n.data().labelV == "Post") {
                            return 'url(../scripts/VLA/KeylineICONS/post' + count + '.svg)';
                        }
                        if (n.data().labelV == "Stock") {
                            return 'url(../scripts/VLA/KeylineICONS/stock' + count + '.svg)';
                        }
                        if (n.data().labelV == "Filling") {
                            return 'url(../scripts/VLA/KeylineICONS/filling' + count + '.svg)';
                        }
                        if (n.data().labelV == "Compensation") {
                            return 'url(../scripts/VLA/KeylineICONS/compensation' + count + '.svg)';
                        }
                        if (n.data().labelV == "board_member") {
                            return 'url(../scripts/VLA/KeylineICONS/board_member' + count + '.svg)';
                        }
                        if (n.data().labelV == "membership") {
                            return 'url(../scripts/VLA/KeylineICONS/membership' + count + '.svg)';
                        }
                        if (n.data().labelV == "Profit_Chart") {
                            return 'url(../scripts/VLA/KeylineICONS/profit_chart' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "technology") {
                            return 'url(../scripts/VLA/KeylineICONS/technology' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "event") {
                            return 'url(../scripts/VLA/KeylineICONS/comment' + count + '.svg)';
                        }
                        if (n.data().labelV && n.data().labelV.toLowerCase() == "club") {
                            return 'url(../scripts/VLA/KeylineICONS/organization' + count + '.svg)';
                        }
                        return 'url(../scripts/VLA/KeylineICONS/default' + count + '.svg)';
                    }
                }
            },
            'text-valign': 'center',
            'color': "#fff",
            'font-size': '10px'
        }).selector('edge').css({
            'curve-style': 'bezier',
            'width': 2,
            'target-arrow-shape': 'none',
            'line-color': function lineColor(e) {
                return defaultColor;
            }
        }),

        elements: data,

        layout: {
            name: layoutOption,
            nodeSpacing: 50,
            edgeLengthVal: 45,
            animate: true,
            randomize: false,
            maxSimulationTime: 1500
        }
    }); // cy init

    var tool_tip = $('body').append('<div class="entity_vlatooltip tooltip-left" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; visibility: visible;display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    //		 cy.elements().qtip({
    //				content: function () {
    //                    var node = this;
    //                    if (!node.isEdge())
    //                        return qtip_nodeData(this);
    //                    else
    //                    	return qtip_edgeData(this);
    //                },
    //				position: {
    //					my: 'bottom center',
    //                    at: 'top center',
    //				},
    //				style: {
    //					classes: 'qtip-bootstrap',
    //					tip: {
    //						width: 16,
    //						height: 8
    //					}
    //				},
    //                show: {
    //                    event: 'mouseover'
    //                },
    //                hide: {
    //                    event: 'mouseout'
    //                }
    //			});
    //		 cy.on("mouseout", function (d) {
    //			 $(".qtip").hide();
    //          });


    cy.on("mouseover", 'edge', function (d) {
        var edge = this;
        var text = data_info(edge, 'edge');
        $(".entity_vlatooltip").html(text);

        return $(".entity_vlatooltip").css("display", "block");
    }).on("mousemove", function (evt) {
        $(".entity_vlatooltip").css({ "left": evt.originalEvent.pageX + 20 });
        $(".entity_vlatooltip").css("top", evt.originalEvent.pageY - 20);
    }).on("mouseout", function () {
        //hide tool-tip
        return $(".entity_vlatooltip").css("display", "none");
    });

    cy.on("mouseover", 'node', function (d) {
        var node = this;
        var text = data_info(node);
        $(".entity_vlatooltip").html(text);

        return $(".entity_vlatooltip").css("display", "block");
    }).on("mousemove", function (evt) {
        $(".entity_vlatooltip").css({ "left": evt.originalEvent.pageX + 20 });
        $(".entity_vlatooltip").css("top", evt.originalEvent.pageY - 20);
    }).on("mouseout", function () {
        // $(this).css("opacity", 0.4);
        //hide tool-tip
        return $(".entity_vlatooltip").css("display", "none");
    });

    cy.on("click", "node", function (d) {
        var url = window.location.href.split("/#/")[0] + "/#/linkAnalysis?q=" + this.data('name');
        window.open(url, "_blank");
    });

    function data_info(element, isedge) {
        var html = '<div class="row">',
            name_html = '',
            address_html = '';
        var data = element.data();
        for (var key in data) {
            if (!data.hasOwnProperty(key)) continue;
            if (key == 'risks') continue;
            if (data[key] != '' && data[key] != void 0) {
                if (isedge) {
                    var lable = key == "labelE" ? "Type" : key;
                    if (key != "spells" && key.indexOf("_") != 0 && key != 'to' && key != 'from' && key != 'id' && key != 'source' && key != 'target') {
                        if (_typeof(data[key]) === "object") {
                            var tI = data[key];
                            var chanel = tI.channel != undefined ? tI.toString().split("_").join(" ") : 'N/A';
                            var base = tI.base_amount != undefined ? tI.base_amount : 'N/A';
                            var direction = tI.direction != undefined ? tI.direction : '';
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + "channel" + ": </span><span class='vla-caption-body'>" + chanel + "</span></div>";
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + " Amount" + ": </span><span class='vla-caption-body'>" + base + direction + "</span></div>";
                        } else {
                            html += "<div class='col-sm-12'><span class='vla-caption'>" + lable + " :</span><span class='vla-caption-body'> " + data[key].toString().split("_").join(" ") + "</span></div>";
                        }
                    }
                } else {
                    var lable = key == "labelV" ? "Type" : key;
                    if (key != "spells" && key.indexOf("_") != 0 && key != 'start' && key != 'createdBy' && key != 'id' && key != 'lat' && key != 'lon' && key != 'caseId') {
                        if (key != "labelV") {
                            lable = key.split("_").join(" ");
                        }
                        if (key == 'name') {
                            if (typeof vladata.nodes == 'undefined') return;
                            for (var i = 0; i < vladata.nodes.length; i++) {
                                var type = vladata.nodes[i];
                                if (type.data.name == data['labelV'].toLowerCase() || type.name == data['labelV']) {
                                    if (type.data.labelV == 'Location') {
                                        if (type.data.name != '') {
                                            html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-home' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                                        }
                                    } else {
                                        var newLabel = '';
                                        if (data['labelV'].toLowerCase() === "customer" || data['labelV'].toLowerCase() === "person" || data['labelV'].toLowerCase() === "share_holder" || data['labelV'].toLowerCase() === "board of managment") {
                                            newLabel = "user";
                                        } else if (data['labelV'].toLowerCase() === "news") {
                                            newLabel = "user";
                                        } else if (data['labelV'].toLowerCase() == 'location') {
                                            newLabel = 'map-marker';
                                        } else if (data.labelV == "audit_committee" || data.labelV == "board of Management" || data.labelV == "Cooperations_memberships_and_committee_work" || data.labelV == "board_of_directors" || data.labelV == "top_investers") {
                                            newLabel = 'gang';
                                        } else if (data.labelV.toLowerCase() == "contact") {
                                            newLabel = 'phone';
                                        } else if (data.labelV.toLowerCase() == "trade_name") {
                                            newLabel = 'trade';
                                        } else if (data.labelV == "website") {
                                            newLabel = 'internet-explorer';
                                        } else if (data.labelV == "company_number") {
                                            newLabel = 'user';
                                        } else if (data.labelV == "officer_id") {
                                            newLabel = 'tag';
                                        } else if (data.labelV == "tx") {
                                            newLabel = 'transaction';
                                        } else if (data.labelV == "Accounts") {
                                            newLabel = 'account';
                                        } else if (data.labelV.toLowerCase() == "share_change") {
                                            return 'share-changes';
                                        } else if (data.labelV && data.labelV.toLowerCase() == "technology") {
                                            newLabel = "technology";
                                        } else if (data.labelV && data.labelV.toLowerCase() == "event") {
                                            newLabel = "comment";
                                        } else if (data.labelV && data.labelV.toLowerCase() == "club") {
                                            newLabel = "organization";
                                        } else {
                                            newLabel = availableIcons.indexOf(data['labelV'].toLowerCase()) > -1 ? data['labelV'].toLowerCase() : 'default';
                                        }
                                        name_html = "<div class='row'><div class='col-sm-12'><div class='vla-caption-body custom-heading' title='" + data[key].toString().split("_").join(" ") + "'><img src='../scripts/VLA/KeylineICONS/" + newLabel + ".svg' alt='icon'>" + data[key].replace(/_/g, ' ') + "</div></div></div>";
                                    }
                                } else {
                                    var newLabel = '';
                                    if (data['labelV'].toLowerCase() === "customer" || data['labelV'].toLowerCase() === "person" || data['labelV'].toLowerCase() === "share_holder" || data['labelV'].toLowerCase() === "board of managment") {
                                        newLabel = "user";
                                    } else if (data['labelV'].toLowerCase() === "news") {
                                        newLabel = "user";
                                    } else if (data['labelV'].toLowerCase() == 'location') {
                                        newLabel = 'map-marker';
                                    } else if (data.labelV == "audit_committee" || data.labelV == "board of Management" || data.labelV == "Cooperations_memberships_and_committee_work" || data.labelV == "board_of_directors" || data.labelV == "top_investers") {
                                        newLabel = 'gang';
                                    } else if (data.labelV.toLowerCase() == "contact") {
                                        newLabel = 'phone';
                                    } else if (data.labelV.toLowerCase() == "trade_name") {
                                        newLabel = 'trade';
                                    } else if (data.labelV == "website") {
                                        newLabel = 'internet-explorer';
                                    } else if (data.labelV == "company_number") {
                                        newLabel = 'user';
                                    } else if (data.labelV == "officer_id") {
                                        newLabel = 'tag';
                                    } else if (data.labelV == "tx") {
                                        newLabel = 'transaction';
                                    } else if (data.labelV == "Accounts") {
                                        newLabel = 'account';
                                    } else if (data.labelV.toLowerCase() == "share_change") {
                                        return 'share-changes';
                                    } else if (data.labelV && data.labelV.toLowerCase() == "technology") {
                                        newLabel = "technology";
                                    } else if (data.labelV && data.labelV.toLowerCase() == "event") {
                                        newLabel = "comment";
                                    } else if (data.labelV && data.labelV.toLowerCase() == "club") {
                                        newLabel = "organization";
                                    } else {
                                        newLabel = availableIcons.indexOf(data['labelV'].toLowerCase()) > -1 ? data['labelV'].toLowerCase() : 'default';
                                    }

                                    name_html = "<div class='row'><div class='col-sm-12'><div class='vla-caption-body custom-heading' title='" + data[key].toString().split("_").join(" ") + "'><img src='../scripts/VLA/KeylineICONS/" + newLabel + ".svg' alt='icon'>" + data[key].replace(/_/g, ' ') + "</div></div></div>";
                                }
                            }
                        } else {
                            if (key == 'labelV') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-home' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'weight') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-balance-scale' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'role') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-star-o' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'Date_of_incorporation') {
                                html += "<div class='col-sm-6'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-calendar' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                            if (key == 'address') {
                                address_html += "<div class='col-sm-12'><div class='custoom-tooltip-wrapper'><span class='vla-caption' title='" + (lable.charAt(0).toUpperCase() + lable.slice(1)) + "'><i class='fa fa-envelope' aria-hidden='true'></i> " + (lable.charAt(0).toUpperCase() + lable.slice(1)) + " :</span><span class='vla-caption-body' title='" + data[key] + "'> " + data[key] + "</span></div></div>";
                            }
                        }
                    }
                }
            }
        }
        html = name_html + html;
        var riskReverScale = d3.scaleLinear().domain([0, 100]).range([1, 10]);
        if (data.riskScore) html += "<div class='col-sm-6' ><div class='custoom-tooltip-wrapper'><span class='vla-caption' style='color:#e04033;font-size:12px;' title='Risks'><i style='color:#e04033;' class='fa fa-exclamation-triangle' aria-hidden='true'></i> Risks :</span><span class='vla-caption-body' style='color:#e04033;font-size:12px;' title='" + data.riskScore.toFixed(2).toString() + '%' + "'> " + data.riskScore.toFixed(2).toString() + '%' + "</span></div></div>";

        if (data.risks) {
            for (var key in data.risks) {
                if (!data.risks.hasOwnProperty(key)) continue;
                if (key == 'description') continue;
                if (key == 'risks') html += "<div class='col-sm-6' ><div class='custoom-tooltip-wrapper'><span class='vla-caption' style='color:#e04033;font-size:12px;' title='" + key + "'><i style='color:#e04033;' class='fa fa-exclamation-triangle' aria-hidden='true'></i> " + key + " :</span><span class='vla-caption-body' style='color:#e04033;font-size:12px;' title='" + (data.risks[key] * 100).toFixed(2).toString() + '%' + "'> " + (data.risks[key] * 100).toFixed(2).toString() + '%' + "</span></div></div>";
            }
        }
        html = html + address_html;
        html += '</div>';
        return html;
    }
}
"use strict";

/**
 * Function to plot line chart
 */
var default_line_color = "#4294D9";
var default_grid_color = "#1c2d34";
var default_line_stroke_width = "2px";
var div = d3.select("body").append("div").attr("class", "line_chart_new_tooltip").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("border-radius", "10px").style("font-size", "10px").style("display", "none");

function InitializeandPlotLine(options) {
	if (location.hash == "#!/alertDashboard" && (!options.data || (!options.data[0].values || options.data[0].values.length == 0) && (!options.data[1].values || options.data[1].values.length == 0))) {
		d3.select(options.container).append("div").attr("class", "alertsDashErrorDiv").html("<span>Data Not Found</span>");

		return false;
	}
	if (location.hash == "#!/alertDashboard") {
		options.currency = '$';
	}
	$(options.container).empty();
	if (options) {
		options.container = options.container ? options.container : "body";
		options.width = options.width ? options.width : $(options.container).width() - 10;
		options.height = options.height ? options.height : 300;
		options.marginTop = options.marginTop ? options.marginTop : 10;
		options.marginBottom = options.marginBottom ? options.marginBottom : 30;
		options.marginRight = options.marginRight ? options.marginRight : 10;
		options.marginLeft = options.marginLeft ? options.marginLeft : 50;
		options.xParam = options.xParam ? options.xParam : $('#errormsg').html('Please check ... May be Data,x-Parameter or y-Parameter is missing.. ');
		options.yParam = options.yParam ? options.yParam : $('#errormsg').html('Please check ... May be Data,x-Parameter or y-Parameter is missing.. ');
		options.gridx = options.gridx ? options.gridx : false;
		options.gridy = options.gridy ? options.gridy : false;
		options.axisX = options.axisX ? options.axisX : false;
		options.axisY = options.axisY ? options.axisY : false;
		options.showxYaxis = options.showxYaxis ? options.showxYaxis : false;
		options.labelRotate = options.labelRotate ? options.labelRotate : 0;
		options.noXyAxis = options.noXyAxis ? options.noXyAxis : false;
		options.currency = options.currency ? options.currency : "";
	}
	if (!options.axisX) {
		options.marginBottom = 5;
	}
	if (!options.axisY) {
		options.marginLeft = 5;
	}
	if (options.labelRotate != 0) {
		var svg = d3.select(options.container).append("svg").attr("width", options.width).attr("height", parseInt(options.height) + 15);
	} else {
		var svg = d3.select(options.container).append("svg").attr("width", options.width).attr("height", options.height);
	}
	var margin = {
		top: options.marginTop,
		right: options.marginRight,
		bottom: options.marginBottom,
		left: options.marginLeft
	},
	    width = options.width - margin.left - margin.right,
	    height = options.height - margin.top - margin.bottom;

	var parseTime = d3.timeParse("%Y");
	bisectDate = d3.bisector(function (d) {
		return d.x;
	}).left;

	var formatMillisecond = d3.timeFormat(".%L"),
	    formatSecond = d3.timeFormat(":%S"),
	    formatMinute = d3.timeFormat("%I:%M"),
	    formatHour = d3.timeFormat("%I %p"),
	    formatDay = d3.timeFormat("%a %d"),
	    formatWeek = d3.timeFormat("%b %d"),
	    formatMonth = d3.timeFormat("%B"),
	    formatYear = d3.timeFormat("%Y");

	function multiFormat(date) {
		return (d3.timeSecond(date) < date ? formatMillisecond : d3.timeMinute(date) < date ? formatSecond : d3.timeHour(date) < date ? formatMinute : d3.timeDay(date) < date ? formatHour : d3.timeMonth(date) < date ? d3.timeWeek(date) < date ? formatDay : formatWeek : d3.timeYear(date) < date ? formatMonth : formatYear)(date);
	}

	var x = d3.scaleTime().range([0, width]);
	var y = d3.scaleLinear().range([height, 0]);

	function make_x_axis() {
		return d3.axisBottom(x).ticks(3).style("stroke", "red");
	}
	function make_y_axis() {
		return d3.axisLeft(y).ticks(5);
	}

	function extractNumber(num) {
		return num.toString().replace(/\D+$/g, "");
	}
	var line = d3.line().x(function (d) {
		return x(d.x);
	}).y(function (d) {
		return y(extractNumber(d.value));
	});
	// .curve(d3.curveCardinal);

	var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	var linedata = options.data;
	var data = options.actualData;
	var tool_tip_data = [];

	$.each(linedata, function (i, d) {

		formatdata(d.values);
	});
	function formatdata(data) {
		data.map(function (d) {

			return d.x = new Date(d.time);
		});
	}

	var yext = [];
	var xext = [];
	var yd3Min;
	$.each(linedata, function (i, d) {
		$.each(d.values, function (i1, d1) {
			tool_tip_data.push(d1);
		});
		yd3Min = d3.min(d.values, function (d1) {
			return parseFloat(extractNumber(d1.value));
		});
		yext.push(yd3Min);
		yext.push(d3.max(d.values, function (d1) {
			return parseFloat(extractNumber(d1.value));
		}));
		xext.push(d3.min(d.values, function (d1) {

			return d1.x;
		}));
		xext.push(d3.max(d.values, function (d1) {
			return d1.x;
		}));
	});

	x.domain(d3.extent(xext, function (d) {
		return d;
	}));
	if (options.xDomain) {
		x.domain(options.xDomain);
	}
	y.domain(d3.extent(yext, function (d) {
		return d;
	}));

	if (options.ystartsFromZero && yd3Min >= 0) {
		var ydomain = y.domain();
		y.domain([0, ydomain[1]]);
	}

	// .text("Population)");

	if (options.gridx == true) {
		var x_g = g.append("g").attr("class", "bs_linegrid").attr("transform", "translate(0," + height + ")")
		// .attr("class","gridx").style("fill","red")
		.call(make_x_axis().tickSize(-height, 0, 0)
		// .tickFormat("%Y")
		);
		x_g.selectAll("line").style("shape-rendering", "crispEdges").style("fill", "none").style("stroke", function () {
			if (options.gridcolor) {
				return options.gridcolor;
			} else {
				return default_grid_color;
			}
		});
	}
	if (options.gridy == true) {
		var y_g = g.append("g").attr("class", "bs_linegrid").call(make_y_axis().tickSize(-width, 0, 0).tickFormat(""));
		y_g.selectAll("path").style("stroke", options.gridStroke_Y).style("shape-rendering", "crispEdges").style("fill", "none").style("opacity", 0);
		y_g.selectAll("line").style("shape-rendering", "crispEdges").style("fill", "none").style("stroke", function () {
			if (options.gridcolor) {
				return options.gridcolor;
			} else {
				return default_grid_color;
			}
		});
	}

	if (options.axisX) {
		if (options.labelRotate != 0) {
			var h = parseInt(height) + 20;
		} else {
			h = height;
		}
		var x_g = g.append("g").attr("class", "bs_axisX").attr("transform", "translate(0," + h + ")").call(d3.axisBottom(x).ticks(3).tickFormat(function (date) {
			return multiFormat(date);
		}));
		x_g.selectAll('text').attr("transform", "rotate(" + options.labelRotate + ")").style("fill", "#778c96").style("font-family", "'Roboto Medium'").style("stroke", "none");
		x_g.selectAll('line').remove();
	}
	if (options.axisY) {
		if (options.yTickFormat) {
			var y_g = g.append("g").attr("class", "bs_axisY").call(d3.axisLeft(y).ticks(5).tickFormat(d3.format("")));
		} else {
			var y_g = g.append("g").attr("class", "bs_axisY").call(d3.axisLeft(y).ticks(5).tickFormat(d3.format(".0s")));
		}

		// .append("text")
		// .attr("class", "axis-title")
		// .attr("transform", "rotate(-90)")
		// .attr("y", 6)
		// .attr("dy", ".71em")
		// .style("text-anchor", "end")
		// .attr("fill", "#5D6971")
		// .style("font-size","20px")
		y_g.selectAll('text').style("fill", "#778c96").style("font-family", "'Roboto Medium'").style("stroke", "none");
		y_g.selectAll('line').remove();
	}
	if (!options.showxYaxis) {
		svg.selectAll('.domain').style('opacity', 0);
	}
	// var focus = g.append("g")
	// .attr("class", "focus")
	// .style("display", "none");
	//
	// focus.append("line")
	// .attr("class", "x-hover-line hover-line")
	// .attr("y1", 0)
	// .attr("y2", height);
	//
	// focus.append("line")
	// .attr("class", "y-hover-line hover-line")
	// .attr("x1", width)
	// .attr("x2", width);
	//
	// focus.append("circle")
	// .attr("class", "bs_circle")
	// .attr("r", 3.5);
	//
	// focus.append("text")
	// .attr("class", "bs_tooltip")
	// .attr("y", -25)
	// .attr("dy", ".21em");

	svg.append("rect").attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr("class", "bs_overlay").attr("width", width).attr("height", height).on("mouseover", function () {

		// focus.style("display", null);
	}).on("mouseout", function () {
		div.style("visibility", "hidden");
		div.style("display", "none");
		// focus.style("display", "none");
	}).on("contextmenu", function () {
		if (location.hash == "#!/alertDashboard") {
			window.transSelectedFilter.data = options.type;
			window.transSelectedFilter.id = options.container;
			window.transSelectedFilter.chartType = "line";
			// aplyAlertDasboardFilters(d,pieOptions.container,"pie");
		}
	}).on("mousemove", mousemove);

	if (options.plotLineValue) {
		g.append("line").attr("x1", 0).attr("x2", width).attr("y1", y(options.plotLineValue)).attr("y2", y(options.plotLineValue)).attr("stroke", options.plotLineColor).attr("fill", "none").style("stroke-width", options.strokeWidth ? options.strokeWidth : default_line_stroke_width);
		g.append("text").attr("x", 5).attr("y", y(options.plotLineValue) - 5).attr("stroke", "none").attr("fill", "#617f8d").text("Average Amount: " + getFormattedAmount(options.plotLineValue)).style("font-size", "10px");
	}
	function mousemove() {
		// code for multi
		var txt = '';
		var x0 = x.invert(d3.mouse(this)[0]);
		$.each(linedata, function (key, d) {
			d.values.sort(function (a, b) {
				return a.time - b.time;
			});
			var i = bisectDate(d.values, x0, 1),
			    d0 = d.values[i - 1],
			    d1 = d.values[i];

			if (d0) {
				div.style("visibility", "visible");
				div.style("display", "inline-block");
				if (d1) {
					var d = x0 - d0.x > d1.x - x0 ? d1 : d0;
				} else {
					var d = d0;
				}
				if (d.value || d.value == 0) {
					if (options.colorsObj) {
						txt = txt + "<div style='color:" + options.colorsObj[key] + "!important'>" + d.time + ": <span >" + options.currency + Number(d.value).formatAmt() + "</span></div>";
					} else {
						txt = txt + "<div>" + d.time + ": <span>" + options.currency + ' ' + Number(d.value).formatAmt() + "</span></div>";
					}
				}
			} else {
				div.style("display", "none");
			}
		});
		if (!txt || txt == '') {
			div.style("display", "none");
		}
		div.html(txt);
		var p = $(options.container);
		var position = p.offset();
		var elmen = document.getElementsByClassName('line_chart_new_tooltip');
		for (i = 0; i < elmen.length; i++) {
			var tooltipWidth = elmen[i].clientWidth;
		}

		var cursor = d3.event.x;
		if (position.left < d3.event.pageX && cursor > tooltipWidth && cursor > 150) {
			for (i = 0; i < elmen.length; i++) {
				elmen[i].classList.remove("tooltip-left");
				elmen[i].classList.add("tooltip-right");
			}
			if (tooltipWidth > 0) {
				div.style("left", d3.event.pageX - tooltipWidth + "px");
			} else {
				div.style("left", d3.event.pageX - width / 2 + "px");
			}
			div.style("top", d3.event.pageY - 25 + "px");
		} else {
			for (i = 0; i < elmen.length; i++) {
				elmen[i].classList.remove("tooltip-right");
				elmen[i].classList.add("tooltip-left");
			}
			div.style("left", d3.event.pageX + 10 + "px");
			div.style("top", d3.event.pageY - 25 + "px");
		}

		if (txt) {
			div.style("visibility", "visible");
			div.style("display", "inline-block");
		} else {
			div.style("display", "none");
		}
		if (txt == '') {
			div.style("display", "none");
		}
	}
	function numberWithCommas(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}

	if (linedata) {
		if (linedata.length) {
			angular.forEach(linedata, function (d, i) {
				drawline(d.values, i);
			});
		}
	} else {}
	function drawline(data, no) {
		data.sort(function (a, b) {
			return a.x.getTime() - b.x.getTime();
		});
		path = g.append("path").data([data]).attr("class", "bs_line").attr("d", line).style("stroke", function (d) {
			if (options.colorsObj) {
				if (location.hash == "#/adverseTransactions" && d[0].values != undefined && d[0].values[0].risk) {
					return options.colorsObj[d[0].values[0].risk];
				} else if (d.risk) {
					return options.colorsObj[d.risk];
				} else {
					return options.colorsObj[no];
				}
			} else {
				return default_line_color;
			}
		}).style("fill", "none").style("stroke-width", options.strokeWidth ? options.strokeWidth : default_line_stroke_width);
	}
	if (options.noXyAxis == true) {
		$(options.container + ' ' + '.bs_axisX').css('display', 'none');
		$(options.container + ' ' + '.bs_axisY').css('display', 'none');
	}
	// code for number formatting
	Number.prototype.formatAmt = function (decPlaces, thouSeparator, decSeparator) {
		var n = this,
		    decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
		    decSeparator = decSeparator == undefined ? "." : decSeparator,
		    thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
		    sign = n < 0 ? "-" : "",
		    i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
		    j = (j = i.length) > 3 ? j % 3 : 0;
		return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
	};

	function getFormattedAmount(amt) {
		var formattedAmt = amt;
		return formattedAmt ? Number(formattedAmt).formatAmt() : "";
	}
	// code for number formatting ends here
}
"use strict";

var barcolorScale = d3.scaleOrdinal().range(["#5d96c8", "#b753cd", "#69ca6b", "#69ca6b", "#c1bd4f", "#db3f8d", "#669900"]);
function barChart(chartData, id, index) {
	var div = d3.select("body").append("div").attr("class", "toolTip_barhorizontal text-uppercase").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("font-size", "10px").style("display", "none").style("min-width", "200px").style("max-width", "300px");
	$("#" + id).empty();
	var titleText;
	if (id == "persons-bar-chart-container") titleText = "Persons";else if (id == "orgs-bar-chart-container") titleText = "Organizations";else if (id == "doughnut-chart-container") titleText = "Locations";
	// format the data
	var data = chartData;
	data = data.sort(function (a, b) {
		return d3.ascending(a.count, b.count);
	});
	data.forEach(function (d) {
		d.count = +d.count;
	}); // set the dimensions and margins of the graph
	var margin = { top: 5, right: 30, bottom: 5, left: 100 },
	    width = $("#" + id).width() - margin.left - margin.right,
	    height = 182 - margin.top - margin.bottom;
	var bar_min_height = 12;
	var barheightwithpadding = 24;
	var datalength = data.length;
	if (datalength * barheightwithpadding > height) {
		height = datalength * barheightwithpadding;
	}
	// set the ranges
	var y = d3.scaleBand().range([height, 0]).padding(0.5);
	var x = d3.scaleLinear().range([0, width]);

	// append the svg object to the body of the page
	// append a 'group' element to 'svg'
	// moves the 'group' element to the top left margin
	var svg = d3.select("#" + id).append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	// Scale the range of the data in the domains
	x.domain([0, d3.max(data, function (d) {
		return d.count;
	})]);
	y.domain(data.map(function (d) {
		return d.key;
	}));
	//	      // append the rectangles for the bar chart
	var bar = svg.selectAll(".bar").data(data).enter().append("rect").attr("class", "bar").style("cursor", "pointer").attr("width", 0).attr("rx", 4).attr("ry", 4).attr("y", function (d) {
		return y(d.key);
	}).style("fill", function (d) {
		return barcolorScale(index);
	}).attr("height", y.bandwidth());
	bar.transition().duration(500).attr("width", function (d) {
		return x(d.count);
	});
	svg.selectAll(".txt").data(data).enter().append("text").attr("class", "txt").attr("x", function (d) {
		return x(d.count) + 2;
	}).attr("y", function (d) {
		return y(d.key) + 3 * (y.bandwidth() / 4);
	}).text(function (d) {
		return d.txtToShow;
	}).style("font-size", "10px").style("fill", "#4a6570").style("stroke", "none");

	//	          Tooltips onto Bar on mousemove and off on mouseout
	bar.on("mousemove", function (d) {
		div.style("left", d3.event.pageX + 10 + "px");
		div.style("top", d3.event.pageY - 25 + "px");
		div.style("display", "inline-block");
		div.html(d.key + ":" + d.count);
	});
	bar.on("mouseout", function (d) {
		div.style("display", "none");
	});
	bar.on("click", function (d) {
		refresh(d.key, $(this).parent().parent().parent().attr("id"));
	});
	// add the x Axis
	var x_g = svg.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom);

	// add the y Axis
	var y_g = svg.append("g").call(d3.axisLeft(y)).attr("class", "y_axis");
	y_g.selectAll("path").style("display", "none");
	y_g.selectAll("line").style("display", "none");
	y_g.selectAll("text").each(function (d) {
		var txt = d;
		txt = txt.split(" ").join("*");
		if (d.length > 13) {
			txt = d.slice(0, 11) + "..";
		}
		d3.select(this).text(txt.split("*").join(" ").toUpperCase());
	}).style("fill", "#778c96").style("font-family", "'Roboto Medium'");
}
"use strict";

$(".toolTip_barhorizontal").remove();
var div = d3.select("body").append("div").attr("class", "toolTip_barhorizontal text-uppercase").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("font-size", "10px").style("display", "none").style("visibility", "hidden").style("min-width", "200px").style("max-width", "300px");

function verticalBarGraph(data, options) {
	$(options.id).empty();
	var margin = { top: 20, right: 20, bottom: 30, left: 40 };
	var width = (options.width ? options.width : $(options.id).width()) - margin.left - margin.right;
	var height = (options.height ? options.height : 500) - margin.top - margin.bottom;

	// set the ranges
	var x = d3.scaleBand().range([0, width]).padding(0.1);
	var y = d3.scaleLinear().range([height, 0]);
	var svg = d3.select(options.id).append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	plotBarGraph();
	function plotBarGraph() {
		// append the svg object to the body of the page
		// append a 'group' element to 'svg'
		// moves the 'group' element to the top left margin

		// Scale the range of the data in the domains
		x.domain(data.map(function (d) {
			return d.x;
		}));
		y.domain([0, d3.max(data, function (d) {
			return d.y;
		})]);
		// gridlines in y axis function
		function make_y_gridlines() {
			return d3.axisLeft(y).ticks(8);
		}
		var y_grid = svg.append("g").attr("class", "grid").call(make_y_gridlines().tickSize(-width).tickFormat(""));
		y_grid.selectAll("line").style("stroke", "rgb(46, 66, 75)").style("shape-rendering", "crispEdges").style("stroke-width", "1px");
		y_grid.selectAll("path").style("display", "none");
		// append the rectangles for the bar chart
		svg.selectAll(".mipbar").data(data).enter().append("rect").attr("class", "mipbar")
		//	        .attr("rx", (x.bandwidth() / 4))
		//            .attr("ry", (x.bandwidth() / 4))
		.attr("x", function (d) {
			return x(d.x);
		}).attr("width", x.bandwidth()).attr("y", function (d) {
			return y(d.y);
		}).attr("height", function (d) {
			return height - y(d.y);
		}).style("fill", function (d) {
			if (options.color) {
				return options.color;
			} else {
				return "#C39446";
			}
		}).on("mouseover", function (d) {
			d3.select(this).style("opacity", "0.7");;
			div.style("visibility", "visible");
			div.style("display", "inline-block");
			if (options.id == '#priceEarningRatioBarChart') div.html("<div style='color:white;margin-bottom:15px;min-width:120px;'><span style='color:#657F8B'>Year: " + d.x.split('"').join("") + "</span></br><span style='color:#657F8B'>p/e ratio: " + d.y + "</span></div>");else if (options.id.indexOf('bar_') > 0) div.html("<div style='color:white;margin-bottom:15px;min-width:120px;'><span style='color:#657F8B'>Year: " + d.x.split('"').join("") + "</span></br><span style='color:#657F8B'>Number of incidents: " + nFormatter(d.y, 2) + "</span></div>");else div.html("<div style='color:white;margin-bottom:15px'><h5>" + d.x.split('"').join("") + "</h5></div><div style='margin-bottom:15px'>Funding Received <h4 style='color:#3372A8;margin-top:0'>" + d.y + "BN</h4></div><div style='margin-bottom:15px'>Type <h6 style='color:#3372A8;margin-top:0'>" + d.type + "</h6></div>");
		}).on("mousemove", function (d) {
			/*var svgWidth = $(options.id).width();
   if(d3.event.pageX + 10+( $(".toolTip_barhorizontal").width()) >svgWidth){
   	div.style("left", d3.event.pageX + 10-( $(".toolTip_barhorizontal").width()+35) + "px");
   }else{
   	div.style("left", d3.event.pageX + 10 + "px");
   }
   div.style("top", d3.event.pageY - 25 + "px");*/
			var p = $(options.id);
			var position = p.offset();
			var windowWidth = window.innerWidth;
			var tooltipWidth = $(".toolTip_barhorizontal").width() + 50;
			var cursor = d3.event.x;
			if (position.left < d3.event.pageX && cursor > tooltipWidth) {
				var element = document.getElementsByClassName("toolTip_barhorizontal");
				for (var i = 0; i < element.length; i++) {
					element[i].classList.remove("tooltip-left");
					element[i].classList.add("tooltip-right");
				}
				$(".toolTip_barhorizontal").css("left", d3.event.pageX - 30 - $(".toolTip_barhorizontal").width() + "px");
			} else {
				var element = document.getElementsByClassName("toolTip_barhorizontal");
				for (var i = 0; i < element.length; i++) {
					element[i].classList.remove("tooltip-right");
					element[i].classList.add("tooltip-left");
				}
				$(".toolTip_barhorizontal").css("left", d3.event.pageX + 20 + "px");
			}
			return $(".toolTip_barhorizontal").css("top", d3.event.pageY - 20 + "px");
		}).on("mouseout", function (d) {
			//            	if(options.id == '#priceEarningRatioBarChart'){
			//            		d3.select(this).style("fill","#50c9e2");
			//            	}else{
			//            		d3.select(this).style("fill","#C39446");
			//            	}
			d3.select(this).style("opacity", 1);;
			div.style("visibility", "hidden");
			div.style("display", "none");
		});

		// add the x Axis
		//						    var x_g = svg.append("g")
		//						        .attr("transform", "translate(0," + height + ")")
		//						        .call(d3.axisBottom(x));


		// add the y Axis
		if (options.id.indexOf('bar_') > 0) {} else {
			var y_g = svg.append("g").call(d3.axisLeft(y).ticks(8).tickFormat(d3.format(".0s")));
			y_g.selectAll("path").style("display", "none");
			y_g.selectAll("line").style("display", "none");
			y_g.selectAll("text").style("stroke", "none").style("fill", "#6D6F65").style("font-weight", "bold");
		}
	}
}

function nFormatter(num, digits) {
	var si = [{ value: 1E18, symbol: "E" }, { value: 1E15, symbol: "P" }, { value: 1E12, symbol: "T" }, { value: 1E9, symbol: "G" }, { value: 1E6, symbol: "M" }, { value: 1E3, symbol: "k" }],
	    rx = /\.0+$|(\.[0-9]*[1-9])0+$/,
	    i;
	for (i = 0; i < si.length; i++) {
		if (num >= si[i].value) {
			return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
		}
	}
	return num.toFixed(digits).replace(rx, "$1");
}
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*!
Copyright (c) The Cytoscape Consortium

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the Software), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
(function () {
  'use strict';

  // registers the extension on a cytoscape lib ref

  var register = function register(cytoscape, cola) {
    if (!cytoscape || !cola) {
      return;
    } // can't register if cytoscape unspecified

    var raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame;
    var isString = function isString(o) {
      return (typeof o === 'undefined' ? 'undefined' : _typeof(o)) === _typeof('');
    };
    var isNumber = function isNumber(o) {
      return (typeof o === 'undefined' ? 'undefined' : _typeof(o)) === _typeof(0);
    };
    var isObject = function isObject(o) {
      return o != null && (typeof o === 'undefined' ? 'undefined' : _typeof(o)) === _typeof({});
    };

    // default layout options
    var defaults = {
      animate: true, // whether to show the layout as it's running
      refresh: 1, // number of ticks per frame; higher is faster but more jerky
      maxSimulationTime: 4000, // max length in ms to run the layout
      ungrabifyWhileSimulating: false, // so you can't drag nodes during layout
      fit: true, // on every layout reposition of nodes, fit the viewport
      padding: 30, // padding around the simulation
      boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }

      // layout event callbacks
      ready: function ready() {}, // on layoutready
      stop: function stop() {}, // on layoutstop

      // positioning options
      randomize: false, // use random node positions at beginning of layout
      avoidOverlap: true, // if true, prevents overlap of node bounding boxes
      handleDisconnected: true, // if true, avoids disconnected components from overlapping
      nodeSpacing: function nodeSpacing(node) {
        return 10;
      }, // extra spacing around nodes
      flow: undefined, // use DAG/tree flow layout if specified, e.g. { axis: 'y', minSeparation: 30 }
      alignment: undefined, // relative alignment constraints on nodes, e.g. function( node ){ return { x: 0, y: 1 } }

      // different methods of specifying edge length
      // each can be a constant numerical value or a function like `function( edge ){ return 2; }`
      edgeLength: undefined, // sets edge length directly in simulation
      edgeSymDiffLength: undefined, // symmetric diff edge length in simulation
      edgeJaccardLength: undefined, // jaccard edge length in simulation

      // iterations of cola algorithm; uses default values on undefined
      unconstrIter: undefined, // unconstrained initial layout iterations
      userConstIter: undefined, // initial layout iterations with user-specified constraints
      allConstIter: undefined, // initial layout iterations with all constraints including non-overlap

      // infinite layout options
      infinite: false // overrides all other options for a forces-all-the-time mode
    };

    // constructor
    // options : object containing layout options
    function ColaLayout(options) {
      var opts = this.options = {};
      for (var i in defaults) {
        opts[i] = defaults[i];
      }
      for (var i in options) {
        opts[i] = options[i];
      }
    }

    // runs the layout
    ColaLayout.prototype.run = function () {
      var layout = this;
      var options = this.options;

      layout.manuallyStopped = false;

      var cy = options.cy; // cy is automatically populated for us in the constructor
      var eles = options.eles;
      var nodes = eles.nodes();
      var edges = eles.edges();
      var ready = false;

      var bb = options.boundingBox || { x1: 0, y1: 0, w: cy.width(), h: cy.height() };
      if (bb.x2 === undefined) {
        bb.x2 = bb.x1 + bb.w;
      }
      if (bb.w === undefined) {
        bb.w = bb.x2 - bb.x1;
      }
      if (bb.y2 === undefined) {
        bb.y2 = bb.y1 + bb.h;
      }
      if (bb.h === undefined) {
        bb.h = bb.y2 - bb.y1;
      }

      var typeoffn = _typeof(function () {});
      var getOptVal = function getOptVal(val, ele) {
        if ((typeof val === 'undefined' ? 'undefined' : _typeof(val)) === typeoffn) {
          var fn = val;
          return fn.apply(ele, [ele]);
        } else {
          return val;
        }
      };

      var updateNodePositions = function updateNodePositions() {
        for (var i = 0; i < nodes.length; i++) {
          var node = nodes[i];
          var scratch = node.scratch('cola');

          // update node dims
          if (!scratch.updatedDims) {
            var padding = getOptVal(options.nodeSpacing, node);

            scratch.width = node.outerWidth() + 2 * padding;
            scratch.height = node.outerHeight() + 2 * padding;
          }
        }

        nodes.positions(function (node, i) {
          // Perform 2.x and 1.x backwards compatibility check
          if (isNumber(node)) {
            node = i;
          }
          var scratch = node.scratch().cola;
          var retPos;

          if (!node.grabbed() && !node.isParent()) {
            retPos = {
              x: bb.x1 + scratch.x,
              y: bb.y1 + scratch.y
            };

            if (!isNumber(retPos.x) || !isNumber(retPos.y)) {
              retPos = undefined;
            }
          }

          return retPos;
        });

        nodes.updateCompoundBounds(); // because the way this layout sets positions is buggy for some reason; ref #878

        if (!ready) {
          onReady();
          ready = true;
        }

        if (options.fit) {
          cy.fit(options.padding);
        }
      };

      var onDone = function onDone() {
        if (options.ungrabifyWhileSimulating) {
          grabbableNodes.grabify();
        }

        cy.off('destroy', destroyHandler);

        nodes.off('grab free position', grabHandler);
        nodes.off('lock unlock', lockHandler);

        // trigger layoutstop when the layout stops (e.g. finishes)
        layout.one('layoutstop', options.stop);
        layout.trigger({ type: 'layoutstop', layout: layout });
      };

      var onReady = function onReady() {
        // trigger layoutready when each node has had its position set at least once
        layout.one('layoutready', options.ready);
        layout.trigger({ type: 'layoutready', layout: layout });
      };

      var ticksPerFrame = options.refresh;
      var tickSkip = 1; // frames until a tick; used to slow down sim for debugging

      if (options.refresh < 0) {
        tickSkip = Math.abs(options.refresh);
        ticksPerFrame = 1;
      } else {
        ticksPerFrame = Math.max(1, ticksPerFrame); // at least 1
      }

      var adaptor = layout.adaptor = cola.adaptor({
        trigger: function trigger(e) {
          // on sim event
          var TICK = cola.EventType ? cola.EventType.tick : null;
          var END = cola.EventType ? cola.EventType.end : null;

          switch (e.type) {
            case 'tick':
            case TICK:
              if (options.animate) {
                updateNodePositions();
              }
              break;

            case 'end':
            case END:
              updateNodePositions();
              if (!options.infinite) {
                onDone();
              }
              break;
          }
        },

        kick: function kick() {
          // kick off the simulation
          //var skip = 0;

          var inftick = function inftick() {
            if (layout.manuallyStopped) {
              onDone();

              return true;
            }

            var ret = adaptor.tick();

            if (ret && options.infinite) {
              // resume layout if done
              adaptor.resume(); // resume => new kick
            }

            return ret; // allow regular finish b/c of new kick
          };

          var multitick = function multitick() {
            // multiple ticks in a row
            var ret;

            // skip ticks to slow down layout for debugging
            // var thisSkip = skip;
            // skip = (skip + 1) % tickSkip;
            // if( thisSkip !== 0 ){
            //   return false;
            // }

            for (var i = 0; i < ticksPerFrame && !ret; i++) {
              ret = ret || inftick(); // pick up true ret vals => sim done
            }

            return ret;
          };

          if (options.animate) {
            var frame = function frame() {
              if (multitick()) {
                return;
              }

              raf(frame);
            };

            raf(frame);
          } else {
            while (!inftick()) {}
          }
        },

        on: function on(type, listener) {}, // dummy; not needed

        drag: function drag() {} // not needed for our case
      });
      layout.adaptor = adaptor;

      // if set no grabbing during layout
      var grabbableNodes = nodes.filter(':grabbable');
      if (options.ungrabifyWhileSimulating) {
        grabbableNodes.ungrabify();
      }

      var destroyHandler;
      cy.one('destroy', destroyHandler = function destroyHandler(e) {
        layout.stop();
      });

      // handle node dragging
      var grabHandler;
      nodes.on('grab free position', grabHandler = function grabHandler(e) {
        var node = this;
        var scrCola = node.scratch().cola;
        var pos = node.position();
        var nodeIsTarget = e.cyTarget === node || e.target === node;

        if (!nodeIsTarget) {
          return;
        }

        switch (e.type) {
          case 'grab':
            adaptor.dragstart(scrCola);
            adaptor.resume();
            break;
          case 'free':
            adaptor.dragend(scrCola);
            break;
          case 'position':
            // only update when different (i.e. manual .position() call or drag) so we don't loop needlessly
            if (scrCola.px !== pos.x - bb.x1 || scrCola.py !== pos.y - bb.y1) {
              scrCola.px = pos.x - bb.x1;
              scrCola.py = pos.y - bb.y1;
              adaptor.resume();
            }
            break;
        }
      });

      var lockHandler;
      nodes.on('lock unlock', lockHandler = function lockHandler(e) {
        var node = this;
        var scrCola = node.scratch().cola;

        scrCola.fixed = node.locked();

        if (node.locked()) {
          adaptor.dragstart(scrCola);
        } else {
          adaptor.dragend(scrCola);
        }
      });

      var nonparentNodes = nodes.stdFilter(function (node) {
        return !node.isParent();
      });

      // add nodes to cola
      adaptor.nodes(nonparentNodes.map(function (node, i) {
        var padding = getOptVal(options.nodeSpacing, node);
        var pos = node.position();
        var nbb = node.boundingBox();

        var struct = node.scratch().cola = {
          x: options.randomize || pos.x === undefined ? Math.round(Math.random() * bb.w) : pos.x,
          y: options.randomize || pos.y === undefined ? Math.round(Math.random() * bb.h) : pos.y,
          width: nbb.w + 2 * padding,
          height: nbb.h + 2 * padding,
          index: i,
          fixed: node.locked()
        };

        return struct;
      }));

      if (options.alignment) {
        // then set alignment constraints

        var offsetsX = [];
        var offsetsY = [];

        nonparentNodes.forEach(function (node) {
          var align = getOptVal(options.alignment, node);
          var scrCola = node.scratch().cola;
          var index = scrCola.index;

          if (!align) {
            return;
          }

          if (align.x != null) {
            offsetsX.push({
              node: index,
              offset: align.x
            });
          }

          if (align.y != null) {
            offsetsY.push({
              node: index,
              offset: align.y
            });
          }
        });

        // add alignment constraints on nodes
        var constraints = [];

        if (offsetsX.length > 0) {
          constraints.push({
            type: 'alignment',
            axis: 'x',
            offsets: offsetsX
          });
        }

        if (offsetsY.length > 0) {
          constraints.push({
            type: 'alignment',
            axis: 'y',
            offsets: offsetsY
          });
        }

        adaptor.constraints(constraints);
      }

      // add compound nodes to cola
      adaptor.groups(nodes.stdFilter(function (node) {
        return node.isParent();
      }).map(function (node, i) {
        // add basic group incl leaf nodes
        var optPadding = getOptVal(options.nodeSpacing, node);
        var getPadding = function getPadding(d) {
          return parseFloat(node.style('padding-' + d));
        };

        var pleft = getPadding('left') + optPadding;
        var pright = getPadding('right') + optPadding;
        var ptop = getPadding('top') + optPadding;
        var pbottom = getPadding('bottom') + optPadding;

        node.scratch().cola = {
          index: i,

          padding: Math.max(pleft, pright, ptop, pbottom),

          // leaves should only contain direct descendants (children),
          // not the leaves of nested compound nodes or any nodes that are compounds themselves
          leaves: node.children().stdFilter(function (child) {
            return !child.isParent();
          }).map(function (child) {
            return child[0].scratch().cola.index;
          }),

          fixed: node.locked()
        };

        return node;
      }).map(function (node) {
        // add subgroups
        node.scratch().cola.groups = node.children().stdFilter(function (child) {
          return child.isParent();
        }).map(function (child) {
          return child.scratch().cola.index;
        });

        return node.scratch().cola;
      }));

      // get the edge length setting mechanism
      var length;
      var lengthFnName;
      if (options.edgeLength != null) {
        length = options.edgeLength;
        lengthFnName = 'linkDistance';
      } else if (options.edgeSymDiffLength != null) {
        length = options.edgeSymDiffLength;
        lengthFnName = 'symmetricDiffLinkLengths';
      } else if (options.edgeJaccardLength != null) {
        length = options.edgeJaccardLength;
        lengthFnName = 'jaccardLinkLengths';
      } else {
        length = 100;
        lengthFnName = 'linkDistance';
      }

      var lengthGetter = function lengthGetter(link) {
        return link.calcLength;
      };

      // add the edges to cola
      adaptor.links(edges.stdFilter(function (edge) {
        return !edge.source().isParent() && !edge.target().isParent();
      }).map(function (edge, i) {
        var c = edge.scratch().cola = {
          source: edge.source()[0].scratch().cola.index,
          target: edge.target()[0].scratch().cola.index
        };

        if (length != null) {
          c.calcLength = getOptVal(length, edge);
        }

        return c;
      }));

      adaptor.size([bb.w, bb.h]);

      if (length != null) {
        adaptor[lengthFnName](lengthGetter);
      }

      // set the flow of cola
      if (options.flow) {
        var flow;
        var defAxis = 'y';
        var defMinSep = 50;

        if (isString(options.flow)) {
          flow = {
            axis: options.flow,
            minSeparation: defMinSep
          };
        } else if (isNumber(options.flow)) {
          flow = {
            axis: defAxis,
            minSeparation: options.flow
          };
        } else if (isObject(options.flow)) {
          flow = options.flow;

          flow.axis = flow.axis || defAxis;
          flow.minSeparation = flow.minSeparation != null ? flow.minSeparation : defMinSep;
        } else {
          // e.g. options.flow: true
          flow = {
            axis: defAxis,
            minSeparation: defMinSep
          };
        }

        adaptor.flowLayout(flow.axis, flow.minSeparation);
      }

      layout.trigger({ type: 'layoutstart', layout: layout });

      adaptor.avoidOverlaps(options.avoidOverlap).handleDisconnected(options.handleDisconnected).start(options.unconstrIter, options.userConstIter, options.allConstIter);

      if (!options.infinite) {
        setTimeout(function () {
          if (!layout.manuallyStopped) {
            adaptor.stop();
          }
        }, options.maxSimulationTime);
      }

      return this; // chaining
    };

    // called on continuous layouts to stop them before they finish
    ColaLayout.prototype.stop = function () {
      if (this.adaptor) {
        this.manuallyStopped = true;
        this.adaptor.stop();
      }

      return this; // chaining
    };

    cytoscape('layout', 'cola', ColaLayout);
  };

  if (typeof module !== 'undefined' && module.exports) {
    // expose as a commonjs module
    module.exports = function (cytoscape, cola) {
      register(cytoscape, cola || require('webcola'));
    };
  } else if (typeof define !== 'undefined' && define.amd) {
    // expose as an amd/requirejs module
    define('cytoscape-cola', function () {
      return register;
    });
  }

  if (typeof cytoscape !== 'undefined' && typeof cola !== 'undefined') {
    // expose to global cytoscape (i.e. window.cytoscape)
    register(cytoscape, cola);
  }
})();
"use strict";

/**
* Function to load brush
*/
function loadBrush(data, options, finalData, bombMap, mapid) {
    //load time line brush
    var container_id = "#" + options.timelineid;
    var xdomain = d3.extent(data, function (d) {
        return new Date(d.time);
    });
    var ydomain = d3.extent(data, function (d) {
        return new Date(d.weight);
    });
    var height = 50;
    var Svgwidth = $(container_id).width(); //400-> width of side menu and spaces
    $(container_id).empty();

    var margin = { top: 20, bottom: 20, left: 20, right: 20 };
    var width = Svgwidth - margin.left - margin.right;
    var svg = d3.select(container_id).append("svg").attr("width", Svgwidth).attr("height", height + margin.top + margin.bottom);
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    g.append("defs").append("svg:clipPath").attr("id", "brushClip").append("svg:rect").attr("id", "clip_rect_brush").attr("x", "0").attr("y", "10").attr("width", width).attr("height", height);

    var x = d3.scaleTime().domain(xdomain).rangeRound([0, width]);

    var y = d3.scaleLinear().domain(ydomain).range([height, 0]);
    var _this = this;
    var brush = d3.brushX().extent([[0, 0], [width, height]]).on("end", function () {
        var s = d3.event.selection;
        if (s != null && finalData) {
            updateNetworkChart(s, x, finalData, options);
        } else if (s != null) {
            updateMapChart(s, x, data, options, bombMap, mapid);
        }
    });

    g.append("g").attr("class", "axis axis--x-brush").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x)).style("stroke", "#838F99");

    var gBrush = g.append("g").attr("class", "brush").call(brush).call(brush.move, x.range());
    gBrush.selectAll('.selection').style("fill", "#47667F").style("stroke", "none");
    gBrush.selectAll('.handle').attr("width", 3).style("fill", "#578BBA").style("stroke", "none");
    gBrush.selectAll('.overlay').style("fill", "transparent").style("stroke", "#374B56");

    svg.select(".axis--x-brush").selectAll('text').attr("fill", "none").attr("stroke", "#3B4E5B");
    svg.select(".axis--x-brush").selectAll('line').attr("fill", "none").attr("stroke", "#3B4E5B");
    svg.select(".axis--x-brush").selectAll('path').attr("fill", "none").attr("stroke", "none");
    //			    gBrush.call(brush.move, [0, 1].map(x));
    var rects = g.append("g").attr("clip-path", "url(#brushClip)").attr("class", "rect").selectAll("rect").data(data).enter().append("rect").style("fill", function (d) {
        return "#3D5F78";
    }).attr("x", function (d) {
        if (d.time) {
            return x(new Date(d.time)) - 2.5;
        }
    }).attr("y", function (d) {
        return height - y(d.weight);
    }).attr("width", 5).attr("height", function (d) {
        if (d.time) {
            return y(d.weight);
        }
    });
}
"use strict";

/*------ Store brush Values ----*/
var timeLineColumnValues = {
    colors: ["#46a2de", "#5888C8", "#31d99c", "#de5942"],
    radius: 5
    /*----- Function to render brush ----*/
};function loadtimeLineColumnChart(timeLineColumnChartoptions) {

    var container = timeLineColumnChartoptions.container ? timeLineColumnChartoptions.container : 'body';
    var svg_backgroundcolor = timeLineColumnChartoptions.svg_backgroundcolor ? timeLineColumnChartoptions.svg_backgroundcolor : "transparent";

    var height = timeLineColumnChartoptions.height ? timeLineColumnChartoptions.height : 50;
    var Svgwidth = timeLineColumnChartoptions.width ? timeLineColumnChartoptions.width : $(container).width();

    var margin = timeLineColumnChartoptions.margin ? timeLineColumnChartoptions.margin : { top: 20, bottom: 20, left: 20, right: 20 };
    var data = timeLineColumnChartoptions.data ? timeLineColumnChartoptions.data : d3.range(width).map(Math.random);
    var xdomain = d3.extent(data, function (d) {
        return new Date(d.time);
    });
    var format = d3.format(",d");
    var tool_tip = $('body').append('<div class="timeLineColumn_tooltip text-uppercase" style="word-break:break-all;padding:10px;position: absolute; opacity: 1; pointer-events: none; display: none; z-index: 1000"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    var ydomain = d3.extent(data, function (d) {
        return d.amount;
    });
    $(container).empty();
    var width = Svgwidth - margin.left - margin.right;

    var x = d3.scaleTime().domain(xdomain).rangeRound([0, width]),
        y = d3.scaleLinear().domain(ydomain).range([height, 0]);
    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(timeLineColumnValues.colors);
    if (timeLineColumnChartoptions.colors) {
        colorScale = d3.scaleOrdinal().range(timeLineColumnChartoptions.colors);
    }
    var svg = d3.select(container).append("svg").attr("width", Svgwidth).attr("height", height + margin.top + margin.bottom).style("background-color", svg_backgroundcolor);
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var x_g = g.append("g").attr("class", "axis axis--x-brush").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x)).style("stroke", "#556B76");
    x_g.selectAll('text').style("fill", "#556B76").style("font-family", "'Roboto Medium'").style("stroke", "none");
    x_g.select("path").style("stroke", "#2e424b");
    x_g.selectAll("line").style("stroke", "#2e424b");

    var circle = g.append("g").attr("clip-path", "url(#brushClip)").attr("class", "circle").selectAll("circle").data(data).enter().append("circle").attr('cursor', 'pointer').style("fill", function (d) {

        if (d.type) {
            if (timeLineColumnChartoptions.colorsObj) {
                return timeLineColumnChartoptions.colorsObj[d.type];
            }
            return colorScale(d.type);
        }
        return colorScale(d);
    }).attr("transform", function (d, i) {

        return "translate(" + x(new Date(d.time)) + "," + y(d.amount) + ")";
    }).attr("r", timeLineColumnValues.radius).on("click", function (d) {
        window.popUpdata(d);
    }).on("mouseover", function (d) {
        //	            	if(d.txt){
        //	            		 $(".timeLineColumn_tooltip").html('<div class="custom-tooltip right text-uppercase" style="top:'+(d3.event.pageY - 10)+'"px";left:'+(d3.event.pageX + 10)+'"px";"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left;">'+d.txt+'</div></div>');
        //
        //	            	}

        //	            	 if( d.type){
        //	            		var txt = '<span>' + d.time + '</span>'
        //	            		 $(".timeLineColumn_tooltip").html('<div class="custom-tooltip right text-uppercase" style="top:'+(d3.event.pageY - 10)+'"px";left:'+(d3.event.pageX + 10)+'"px";"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left;">'+txt+'</div></div>');
        //					}else
        if (d.name) {
            var txt = '<span>' + "Name: " + d.name + '</span><br><span>' + "Date: " + d.time + '</span>';
            $(".timeLineColumn_tooltip").html('<div class="custom-tooltip right text-uppercase" style="top:' + (d3.event.pageY - 10) + '"px";left:' + (d3.event.pageX + 10) + '"px";"><div class="tooltip-arrow"></div><div class="tooltip-inner clearfix" style="text-align:left;">' + txt + '<a class="pull-right" style="color: #337ab7;">Click For More Information</a></div></div>');
        } else {
            var txt = '<span> ' + "Date Published: " + d.time + '</span><br><span>' + "Value: " + format(d.amount) + '</span>';
            $(".timeLineColumn_tooltip").html('<div class="custom-tooltip right text-uppercase" style="top:' + (d3.event.pageY - 10) + '"px";left:' + (d3.event.pageX + 10) + '"px";"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left;">' + txt + '<a class="pull-right" style="color: #337ab7;">Click For More Information</a></div></div>');
        }
        $(".timeLineColumn_tooltip").css("visibility", "visible");
        return $(".timeLineColumn_tooltip").css("display", "block");
    }).on("mousemove", function () {
        $(".timeLineColumn_tooltip").css("top", d3.event.pageY - 10 + "px");
        return $(".timeLineColumn_tooltip").css("left", d3.event.pageX + 10 + "px");
    }).on("mouseout", function () {
        $(".timeLineColumn_tooltip").css("visibility", "hidden");

        return $(".timeLineColumn_tooltip").css("display", "none");
    });;
}
"use strict";

var tool_tip;
function BubbleHierarchyChart(bubbleHierarchyOptions) {
    if (bubbleHierarchyOptions.container) {
        $(bubbleHierarchyOptions.container).empty();
    }
    if (location.hash == "#!/alertDashboard" && (!bubbleHierarchyOptions.data || !bubbleHierarchyOptions.data.children || bubbleHierarchyOptions.data.children.length == 0)) {
        d3.select(bubbleHierarchyOptions.container).append("div").attr("class", "alertsDashErrorDiv").html("<span>Data Not Found</span>");
        return false;
    }
    //--------------------------Initialize Values-----------------------------
    if (bubbleHierarchyOptions) {
        this.container = bubbleHierarchyOptions.container ? bubbleHierarchyOptions.container : "body";
        this.data = bubbleHierarchyOptions.data ? bubbleHierarchyOptions.data : [];
        this.height = bubbleHierarchyOptions.height ? bubbleHierarchyOptions.height : 600;
        this.uri = bubbleHierarchyOptions.uri;
        this.bubbleHierarchyHeader = bubbleHierarchyOptions.header ? bubbleHierarchyOptions.header : "BUBBLE HIERARCHY";

        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.bubbleColorScale = bubbleHierarchyOptions.bubbleColorScale ? bubbleHierarchyOptions.bubbleColorScale : false;
        this.bubbleSizeScale = bubbleHierarchyOptions.bubbleSizeScale ? bubbleHierarchyOptions.bubbleSizeScale : false;
        this.headerOptions = bubbleHierarchyOptions.headerOptions == false ? bubbleHierarchyOptions.headerOptions : true;
        this.bubbleColor = bubbleHierarchyOptions.bubbleColor ? bubbleHierarchyOptions.bubbleColor : ["#38719E", "#9C6AED", "#198A78", "#4393D8", "#BD65E4"];
        bubbleHierarchyOptions.specialToolTip = bubbleHierarchyOptions.specialToolTip ? bubbleHierarchyOptions.specialToolTip : false;
        this.detailPage = bubbleHierarchyOptions.detailPage;
    } else {

        return false;
    }
    //   var colorList2 =   ['#ce3939','#ce6839','#ce9c39','#bace39','#45ce39','#39ce79','#39cece','#3997ce','#3965ce','#6539ce','#ce39bf','#ce3979','#bc7676','#63552c','#39632c','#632c49']
    var colorList2 = ['#ce3939', '#ce6839', '#ce9c39', '#bace39', '#45ce39', '#39ce79', '#39cece', '#3997ce', '#3965ce', '#6539ce', '#ce39bf', '#ce3979', '#bc7676', '#63552c', '#39632c', '#632c49', '#8e446b', '#a88a99', '#ba7195', '#6d5b64', '#4c2b3c', '#dba2bf'];

    var uc2Baroptions = {
        axisX: false,
        axisY: false,
        barText: true,
        color: colorList2,
        gridColor: "#273B44",
        gridx: false,
        gridy: false,
        height: 250,
        marginBottom: 1,
        marginLeft: 40,
        marginRight: 5,
        marginTop: 50,
        showxYaxis: false,
        width: 450,
        movinglineStroke: "blue",
        movingtextColor: "#FFFFFF",
        container: "#uc2Bar",
        label: true
    };

    var color = ['#ce3939', '#ce6839', '#ce9c39', '#bace39', '#45ce39', '#39ce79', '#39cece', '#3997ce', '#3965ce', '#6539ce', '#ce39bf', '#ce3979', '#bc7676', '#63552c', '#39632c', '#632c49', '#66525c', '#e0c7d4', '#9e9398', '#c1608c', '#436a84'];
    var baroptions = {
        container: '#barChart_tooltip',
        height: 160,
        width: 400,
        marginRight: 5,
        marginLeft: 40,
        marginBottom: 1,
        marginTop: 30,
        color: colorList2,
        barText: true,
        label: true,
        gridColor: '#273B44'
    };

    var actualOptions = jQuery.extend(true, {}, bubbleHierarchyOptions);
    var randomSubstring = this.randomIdString;
    var h = this.height;
    var header = this.bubbleHierarchyHeader;
    // var bubblehierarchyChartId = this.container;
    var containerid = this.container;

    var _this = this;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';

    var bcolor = this.bubbleColor[0];
    //    var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubblehierarchy_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'
    var chartContainerdiv = '<div id="bubblehierarchy_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> ';
    $(containerid).html(chartContainerdiv);
    $(containerid).append(modal);
    var chart_container = "#bubblehierarchy_chart_div" + randomSubstring;

    this.width = bubbleHierarchyOptions.width ? bubbleHierarchyOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }

    this.diameter = this.height > this.width ? this.width : this.height;
    //    if (!this.headerOptions) {
    //        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>'
    //        $(chart_container).siblings(".headerDiv").append(closebtn);
    //    }
    //
    //    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0)
    //        var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none; min-width: 120px; margin-top: 2px; background: rgb(27, 39, 53) none repeat scroll 0% 0%; border: 1px solid rgb(51, 51, 51); border-radius: 4px;" id="opt_' + randomSubstring + '" class="collapse"><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span style="display: inline-block;float: left;text-align: center;width: 33.33%; border-right: 1px solid #000;" class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span style="display: inline-block;float: left;text-align: center;width: 33.33%;" class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span style="display: none;float: left;text-align: center;width: 33.33%;" class="header_chart_' + randomSubstring + '" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    //    $(chart_container).siblings(".headerDiv").append(header_options);
    //
    //    if (!this.headerOptions) {
    //        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
    //        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    //    } else {
    //        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    //    }
    root = this.data;
    //  $(".graphBox").mCustomScrollbar({
    //     axis: "y",
    //    //theme: "3d"
    // });
    //
    var data = this.data;
    var formatSi = d3.format(".3s");
    function formatAbbreviation(x) {
        var s = formatSi(x);
        switch (s[s.length - 1]) {
            case "G":
                return s.slice(0, -1) + "B";
        }
        return s;
    }

    //    var curretn_uri = this.Uri;
    //    var bubble_header = this.bubbleHierarchyHeader;
    //  var tool_tip = $('body').append('<div class="bubblehierarchy_tooltip text-uppercase" style="position: absolute; opacity: 1; pointer-events: none; visibility: visible;display:none;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    if (_this.container == "israClusterBubbleChart") {
        tool_tip = $('body').append('<div class="Bubble_Chart_tooltip bubble-chart-cluster" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; visibility: visible;display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span> </div>');
    } else {
        tool_tip = $('body').append('<div class="Bubble_Chart_tooltip" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; visibility: visible;display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');
    }
    var width = this.width,
        height = this.height,
        diameter = this.diameter,
        node,
        root;

    // var diameter = 400,
    var format = d3.format(",d");

    var color = d3.scaleOrdinal().range(_this.bubbleColor);
    var colorScale = d3.scaleOrdinal().range(["#F160AB", "#62ABDE", "#F6D584", "#60F3BD", "#9C6AED", "#198A78"]);
    if (_this.bubbleColorScale) {
        colorScale = _this.bubbleColorScale;
    }

    var bubble = d3.pack().size([diameter, diameter]).padding(10);

    var svg;
    if (width == height) {
        svg = d3.select(chart_container).append("svg").attr("width", diameter).attr("height", diameter).attr("class", "bubble");
    } else if (width > height) {
        svg = d3.select(chart_container).append("svg").attr("width", width).attr("height", height).attr("class", "bubble").append("g").attr("transform", "translate(" + (width - height) / 2 + "," + 0 + ")");
    } else {
        svg = d3.select(chart_container).append("svg").attr("width", width).attr("height", height).attr("class", "bubble").append("g").attr("transform", "translate(" + 0 + "," + (height - width) / 2 + ")");
    }

    // d3.json("flare.json", function(error, data) {
    //   if (error) throw error;

    var root = d3.hierarchy(classes(data)).sum(function (d) {
        return d.value;
    }).sort(function (a, b) {
        return b.value - a.value;
    });

    bubble(root);
    var node = svg.selectAll(".node").data(root.children).enter().append("g").attr("class", "node").attr("transform", function (d) {
        return "translate(" + d.x + "," + d.y + ")";
    }).style("cursor", function () {
        if (containerid == '#israClusterBubbleChart' && (location.hash == "#!/cluster" || location.hash == "#!/dualCardClusterPage")) {
            return "pointer";
        } else {
            return "default";
        }
    });
    var radius = [];
    node.append("circle").attr("r", function (d) {
        radius.push(d.r);
    });
    radius.sort(function (x, y) {
        return d3.ascending(x, y);
    });
    var bubbleSizeScale2 = d3.scaleLinear().domain([0, radius[radius.length - 1] + 80]).range([5, 30]);
    node.append("circle").attr("r", function (d) {
        radius.push(d.r);
        if (containerid == '#israClusterBubbleChart' && location.hash == "#!/cluster") {
            return 0;
        } else {
            return d.r;
        }
    }).style("stroke", "none").style("stroke-width", 5).style("stroke-opacity", 2.5).style("fill", function (d) {
        if (_this.bubbleColorScale) {
            return _this.bubbleColorScale(parseFloat(d.data.allData.avgExp));
        }
        if (d.data.allData.colorRange) {
            return d.data.allData.colorRange;
        } else {
            return color(d.data.className);
        }
    }).transition().duration(2000).attr("r", function (d) {
        return d.r;
    });
    if (bubbleHierarchyOptions.specialToolTip) {
        node.append("text").attr("dy", "0.8em").style("text-anchor", "middle").style("font-size", function (d) {
            if (_this.bubbleSizeScale) {

                return bubbleSizeScale2(d.r) - 5;
            }
        }).style("fill", 'white').style("font-weight", 'bold').style("stroke", function (d) {
            if (_this.bubbleColorScale) {
                return '';
            }
            if (d.data.allData.colorRange) {
                return d.data.allData.colorRange;
            } else {
                return color(d.data.className);
            }
        }).style("opacity", 0.4).text(function (d) {
            if (bubbleSizeScale2(d.r) > 8) {
                return "CUSTOMERS";
            }
        });

        node.append("text").attr("dy", "2em").style("text-anchor", "middle").style("font-weight", 'bold').style("font-size", function (d) {
            if (_this.bubbleSizeScale) {
                return bubbleSizeScale2(d.r);
            }
        }).style("stroke", function (d) {
            if (_this.bubbleColorScale) {
                return '';
            }
            if (d.data.allData.colorRange) {
                return d.data.allData.colorRange;
            } else {
                return color(d.data.className);
            }
        }).style("fill", 'white').style("opacity", 0.4).text(function (d) {
            return parseInt(d.data.allData.size);
        });

        node.append("text").attr("dy", "-2em").style("text-anchor", "middle").style("font-weight", 'bold').style("font-size", function (d) {
            if (_this.bubbleSizeScale) {
                return bubbleSizeScale2(d.r);
            }
        }).style("stroke", function (d) {
            if (_this.bubbleColorScale) {
                return '';
            }
            if (d.data.allData.colorRange) {
                return d.data.allData.colorRange;
            } else {
                return color(d.data.className);
            }
        }).style("fill", 'white').style("opacity", 0.4).text(function (d) {
            if (bubbleSizeScale2(d.r) > 8) {
                return d.data.allData.name.toUpperCase();
            }
        });
    }
    node.on("click", function (d) {
        if (containerid != '#	' && containerid != '#riskAlertModalCountries' && location.hash == "#!/alertDashboard") {
            window.openSideModal(d, containerid, bcolor);
        }
        if (containerid == '#israClusterBubbleChart' && location.hash == "#!/cluster") {
            window.detailsPage(_this.detailPage, d.data.allData.clusterID);
        } else if (containerid == '#israClusterBubbleChart' && location.hash == "#!/dualCardClusterPage") {
            window.detailsPage('Dual Card Holders', d.data.allData.clusterID);
        }

        location.hash == "#!/dualCardClusterPage";
    }).on("contextmenu", function (d) {
        if (location.hash == "#!/alertDashboard") {
            window.transSelectedFilter.data = d;
            window.transSelectedFilter.id = containerid;
            window.transSelectedFilter.chartType = "bubble";
            //      		 aplyAlertDasboardFilters(d,pieOptions.container,"pie");
        }
    }).on("mouseover", function (d) {
        $(this).css("opacity", 0.8);
        if (bubbleHierarchyOptions.specialToolTip) {
            $(".Bubble_Chart_tooltip").remove();
            tool_tip = $('body').append('<div class="Bubble_Chart_tooltip bubble-chart-cluster" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; visibility: visible;display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span> </div>');
            var pieValue = parseInt(d.data.allData.customersOutOfIsracardPopulation);
            if (d.data.allData.hasOwnProperty("attributes")) {
                var totalCustomer = Number(Math.round(d.data.allData.size)).formatAmt();
                totalCustomer = totalCustomer.split('.')[0];
                $(".Bubble_Chart_tooltip").html('<div class="row" style="margin:0"><div class="col-sm-3"> <div class="c100 p' + pieValue + ' pink radial" style="left:0!important"><span>' + pieValue + '%</span> <div class="slice"> <div class="bar"></div> <div class="fill"></div> </div></div><p style="font-size:9px;"><span style="margin-top:5px;">' + totalCustomer + ' CUSTOMERS</span></p></div> <div class="col-sm-9 chart-tooltip-right pad-x0"> <h3>' + d.data.allData.name + '</h3><p style= "margin:0 0 10px"><span>Total Amount</span>: <span> <span class="fa fa-ils f-10"></span> ' + formatTotalAmount(d.data.allData.totalAmount) + '</span></p> <p style= "margin:0 0 7px"><span>AVERAGE EXPENDITURE</span></p><ul class="list-unstyled progressbar-list"><li class="progressbar-list-item"><div class="left-col">CLUSTER</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress1 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress1 + '%"><span class="sr-only">' + d.data.allData.avgExpenditure + ' Complete</span></div></div><div class="right-col"> <span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExpenditure) + '</div></li><li class="progressbar-list-item"><div class="left-col">GENERAL POPULATION</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress2 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress2 + '%"><span class="sr-only">' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + ' Complete</span></div></div><div class="right-col"> <span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + '</div></li></ul></div></div><div class="bar-chart-wrapper"><div id="barChart_tooltip"></div><div style="width:100%" id="legendsDiv"></div></div>');
                baroptions.width = 450;
                baroptions.domainArray = [d3.min(d.data.allData.attributes, function (d) {
                    if (d.is_found) {
                        return d.attribute_sd_value;
                    }
                }), d3.max(d.data.allData.attributes, function (d) {
                    if (d.is_found) {
                        return d.attribute_sd_value;
                    }
                })];
                var barDta = [];
                if (d.data.allData.attributes) {
                    d.data.allData.attributes.forEach(function (d) {
                        if (d.is_found) {
                            var index = bubbleHierarchyOptions.localTableData.map(function (d) {
                                return d.key;
                            }).indexOf(d.attribute_name.toUpperCase());
                            if (index == -1) {
                                barDta.push({
                                    'name': d.attribute_name,
                                    'value': d.attribute_sd_value
                                });
                            } else if (index != -1) {
                                barDta.push({
                                    'name': bubbleHierarchyOptions.localTableData[index]['UIname'],
                                    'value': d.attribute_sd_value
                                });
                            }
                        }
                    });
                    baroptions.data = barDta;
                    baroptions.data.sort(function (x, y) {
                        return d3.ascending(x.name, y.name);
                    });

                    verticalBarChart(baroptions);
                }
            } else if (d.data.allData.hasOwnProperty("cluser_attributes")) {
                var totalCustomer = Number(Math.round(d.data.allData.size)).formatAmt();
                totalCustomer = totalCustomer.split('.')[0];
                $(".Bubble_Chart_tooltip").html('<div class="row" style="margin:0"><div class="col-sm-3"> <div class="c100 p' + pieValue + ' pink radial" style="left:0!important"><span>' + pieValue + '%</span> <div class="slice"> <div class="bar"></div> <div class="fill"></div> </div></div><p style="font-size:9px;"><span style="margin-top:5px;">' + totalCustomer + ' CUSTOMERS</span></p></div> <div class="col-sm-9 chart-tooltip-right pad-x0"> <h3>' + d.data.allData.name + '</h3><p style= "margin:0 0 10px"><span>Total Amount</span>: <span class="fa fa-ils f-10"></span> ' + formatTotalAmount(d.data.allData.totalAmount) + '</span></p> <p style= "margin:0 0 7px"><span>AVERAGE EXPENDITURE</span></p><ul class="list-unstyled progressbar-list"><li class="progressbar-list-item"><div class="left-col">CLUSTER</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress1 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress1 + '%"><span class="sr-only"> ' + d.data.allData.avgExp + ' Complete</span></div></div><div class="right-col"><span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExp) + '</div></li><li class="progressbar-list-item"><div class="left-col">GENERAL POPULATION</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress2 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress2 + '%"><span class="sr-only">' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + ' Complete</span></div></div><div class="right-col"> <span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + '</div></li></ul></div></div><div class="bar-chart-wrapper"><div id="uc2Bar"></div><div style="width:100%" id="legendsDiv"></div></div>');
                uc2Baroptions.container = "#uc2Bar";
                uc2Baroptions.height = 400;
                if (d.data.allData.cluser_attributes) {
                    var data1 = [];
                    d.data.allData.cluser_attributes['primary_attributes'].forEach(function (d) {
                        data1.push({
                            'name': d.attribute_name,
                            'value': d.attribute_sd_value
                        });
                    });

                    var data2 = [];
                    d.data.allData.cluser_attributes['secondary_attributes'].forEach(function (d) {
                        data2.push({
                            'name': d.attribute_name,
                            'value': d.attribute_sd_value
                        });
                    });
                    uc2Baroptions.data = [data1, data2];
                    var min1 = d3.min(d.data.allData.cluser_attributes['primary_attributes'], function (d) {
                        return d.attribute_sd_value;
                    });
                    var max1 = d3.max(d.data.allData.cluser_attributes['primary_attributes'], function (d) {
                        return d.attribute_sd_value;
                    });
                    var min2 = d3.min(d.data.allData.cluser_attributes['secondary_attributes'], function (d) {
                        return d.attribute_sd_value;
                    });
                    var max2 = d3.max(d.data.allData.cluser_attributes['secondary_attributes'], function (d) {
                        return d.attribute_sd_value;
                    });
                    var datasort = [min1, max2, min2, max2];
                    datasort.sort(function (x, y) {
                        return d3.ascending(x.name, y.name);
                    });
                    //	 uc2Baroptions.domainArray=[[d3.min( d.data.allData.cluser_attributes['primary_attributes'], function(d) { return d.attribute_sd_value; }),d3.max( d.data.allData.cluser_attributes['primary_attributes'], function(d) { return d.attribute_sd_value; })],[d3.min(d.data.allData.cluser_attributes['secondary_attributes'], function(d) { return d.attribute_sd_value; }),d3.max(d.data.allData.cluser_attributes['secondary_attributes'], function(d) { return d.attribute_sd_value; })]]
                    uc2Baroptions.domainArray = [[datasort[0], datasort[datasort.length - 1]], [datasort[0], datasort[datasort.length - 1]]];
                    //uc2Baroptions.domainArray= bubbleHierarchyOptions.domainArray
                    uc2Baroptions.container2 = 'mainsvg' + d.data.allData.clusterID;
                    NegativeBarWithTooltipChart(uc2Baroptions);
                }

                uc2Baroptions.container = "#uc2Bar";
                NegativeBarWithTooltipChart(uc2Baroptions);
            } else {
                $(".Bubble_Chart_tooltip").html('<div class="row" style="margin:0"><div class="col-sm-3"> <div class="c100 p' + pieValue + ' pink radial" style="left:0!important"><span>' + pieValue + '%</span> <div class="slice"> <div class="bar"></div> <div class="fill"></div> </div></div><p style="font-size:9px; text-align:center"><span style="margin-top:5px;">CUSTOMERS</span></p></div> <div class="col-sm-9 chart-tooltip-right pad-x0"> <h3>' + d.data.allData.name + '</h3><p style= "margin:0 0 10px"><span>Total Amount</span>: <span> <span class="fa fa-ils f-10"></span> ' + format(d.data.allData.avgExp) + '</span></p> <p style= "margin:0 0 7px"><span>AVERAGE EXPENDITURE</span></p><ul class="list-unstyled progressbar-list"><li class="progressbar-list-item"><div class="left-col">CLUSTER</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress1 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress1 + '%"><span class="sr-only">' + d.data.allData.avgExpenditure + ' Complete</span></div></div><div class="right-col"><span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExpenditure) + '</div></li><li class="progressbar-list-item"><div class="left-col">GENERAL POPULATION</div><div class="progress"><div  class="progress-bar progress-dark-red" role="progressbar" aria-valuenow="' + d.data.allData.progress2 + '" aria-valuemin="0" aria-valuemax="100" style="width:' + d.data.allData.progress2 + '%"><span class="sr-only">' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + ' Complete</span></div></div><div class="right-col"> <span class="fa fa-ils f-8"></span> ' + formatAbbreviation(d.data.allData.avgExpPerCustomerAmongGP) + '</div></li></ul></div></div><div class="bar-chart-wrapper"><div id="barChart_tooltip"></div><div style="width:100%" id="legendsDiv"></div></div>');
            }
        } else {
            if (location.hash == "#!/alertDashboard") {
                $(".Bubble_Chart_tooltip").html('<span>' + d.data.className + ":$" + format(d.value) + '</span>');
            } else {
                $(".Bubble_Chart_tooltip").html('<span>' + d.data.className + ":" + format(d.value) + '</span>');
            }
        }
        return $(".Bubble_Chart_tooltip").css("display", "block");
    }).on("mousemove", function () {
        var p = $(chart_container);
        var position = p.offset();
        var windowWidth = window.innerWidth;
        var tooltipWidth = $(".Bubble_Chart_tooltip").width() + 50;
        var cursor = d3.event.x;
        if (position.left < d3.event.pageX && cursor > tooltipWidth) {
            var element = document.getElementsByClassName("Bubble_Chart_tooltip");
            for (i = 0; i < element.length; i++) {
                element[i].classList.remove("tooltip-left");
                element[i].classList.add("tooltip-right");
                if (bubbleHierarchyOptions.specialToolTip) {
                    element[i].classList.add("cluster-chart-tooltip");
                }
            }
            $(".Bubble_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Bubble_Chart_tooltip").width() + "px");
        } else {
            var element = document.getElementsByClassName("Bubble_Chart_tooltip");
            for (i = 0; i < element.length; i++) {
                element[i].classList.remove("tooltip-right");
                element[i].classList.add("tooltip-left");
                if (bubbleHierarchyOptions.specialToolTip) {
                    element[i].classList.add("cluster-chart-tooltip");
                }
            }
            if (bubbleHierarchyOptions.specialToolTip) {
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX + 50 + "px");
            } else {
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
        }
        if (bubbleHierarchyOptions.specialToolTip && (location.hash.indexOf('cluster') >= 0 || location.hash.indexOf('dualCardClusterPage') >= 0)) {
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY - 200 + "px");
        } else if (bubbleHierarchyOptions.specialToolTip) {
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY - 100 + "px");
        } else {
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY + "px");
        }
    }).on("mouseout", function () {
        $(".Bubble_Chart_tooltip").css("display", "none");
        $(this).css("opacity", 1);
        //hide tool-tip
        return $(".Bubble_Chart_tooltip").css("display", "none");
    });

    // node.append("text")
    //     .attr("dy", ".3em")
    //     .style("text-anchor", "middle")
    //     .text(function(d) { return d.data.className.substring(0, d.r / 3); });
    // });

    // Returns a flattened hierarchy containing all leaf nodes under the root.
    function classes(root) {
        var classes = [];

        function recurse(name, node) {
            if (node.children) node.children.forEach(function (child) {
                recurse(node.name, child);
            });else classes.push({ packageName: name, className: node.name, value: node.size, allData: node });
        }

        recurse(null, root);
        return { children: classes };
    }

    //    d3.select(self.frameElement).style("height", diameter + "px");

    var newdata = [];
    function datahandle(data, parentName) {

        if (data.children) {
            $.each(data.children, function (i, v) {

                datahandle(v, data.name);
            });
        } else {
            newdata.push({
                "name": data.name,
                "size": data.size,
                "group": parentName
            });
        }
    }

    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {

        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });

    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            chartBubbleHierarchy(actualOptions);
        }
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        // var h = $(chartContainerdiv).height()

        $(chart_container).empty();
        //        $(chart_container).css("overflow","auto");
        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");

        var tbl = "<div id ='bubblehierarchy_table_" + randomSubstring + "'  style='padding:5px;background-color: #425661;overflow:overflow:hidden;height:" + _this.height + "px'><table id ='bubblehierarchy_table1_" + randomSubstring + "' class=' table-striped ' style='width:100%;background-color:#283C45;padding:5px;color:#5A676E; ' ><thead><tr><th>NAME</th><th>VALUE</th><th>GROUP</th></tr></thead><tbody>";

        datahandle(data, data.name);

        $.each(newdata, function (i2, v2) {
            tbl = tbl + "<tr><td>" + v2.name.toUpperCase() + "</td><td>" + v2.size + "</td><td>" + v2.group.toUpperCase() + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $("#bubblehierarchy_table1_" + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    //even color
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });
        $("#bubblehierarchy_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#bubblehierarchy_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");
        var id1 = $("#bubblehierarchy_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#bubblehierarchy_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#bubblehierarchy_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
    });

    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        $(chart_container).css("overflow", "hidden");
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new BubbleHierarchyChart(actualOptions);
        }
    });
    //------------------------------------------------------------------------------------------------

    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        //       $("#modal_"+randomSubstring).modal("show");
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;
            options.headerOptions = false;
            options.height = 450;
            new BubbleHierarchyChart(options);
        }, 500);

        //"modal_chart_container"+randomSubstring
    });

    //code for number formatting
    Number.prototype.formatAmt = function (decPlaces, thouSeparator, decSeparator) {
        var n = this,
            decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
            decSeparator = decSeparator == undefined ? "." : decSeparator,
            thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
            sign = n < 0 ? "-" : "",
            i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
            j = (j = i.length) > 3 ? j % 3 : 0;
        return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
    };

    function formatTotalAmount(amount) {
        if (amount != undefined) {
            var amountVal = amount.toString().split('.');
            var finalAmount;
            if (amountVal[0].length <= 6) {
                finalAmount = formatNummerWithComma(amount);
            } else if (amountVal[0].length <= 8 && amountVal[0].length > 6) {
                finalAmount = (amount / 1000000).toFixed(2) + 'M';
            } else if (amountVal[0].length >= 9) {
                finalAmount = (amount / 1000000000).toFixed(2) + 'B';
            }
            return finalAmount;
        }
    }

    function formatNummerWithComma(amount) {
        var formatAmount;
        formatAmount = Number(Math.round(amount)).formatAmt();
        return formatAmount;
    }
}
"use strict";

var stackedtimelinediv = d3.select("body").append("div").attr("class", "toolTip_piehorizontal tooltip_stackedTime").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("border-radius", "10px").style("font-size", "10px").style("display", "none");
function stackedbarTimelinechart(options) {
  $(options.container).empty();
  if (options) {
    options.container = options.container ? options.container : "body";
    options.width = options.width ? options.width : $(options.container).width() - 10;
    options.height = options.height ? options.height : 300;
    options.marginTop = options.marginTop ? options.marginTop : 10;
    options.marginBottom = options.marginBottom ? options.marginBottom : 30;
    options.marginRight = options.marginRight ? options.marginRight : 10;
    options.marginLeft = options.marginLeft ? options.marginLeft : 50;
    options.xParam = options.xParam ? options.xParam : $('#errormsg').html('Please check ... May be Data,x-Parameter or y-Parameter is missing.. ');
    options.yParam = options.yParam ? options.yParam : $('#errormsg').html('Please check ... May be Data,x-Parameter or y-Parameter is missing.. ');
    options.gridx = options.gridx ? options.gridx : false;
    options.gridy = options.gridy ? options.gridy : false;
    options.axisX = options.axisX ? options.axisX : false;
    options.axisY = options.axisY ? options.axisY : false;
    options.showxYaxis = options.showxYaxis ? options.showxYaxis : false;
    options.color_hash = options.color_hash ? options.color_hash : {
      0: ["Invite", "#3132FE"],
      1: ["Accept", "#E81F0F"],
      2: ["Decline", "#B2CCE7"]

    };
  }
  var padding = { top: options.marginTop, right: options.marginRight, bottom: options.marginBottom, left: options.marginLeft };
  var w = options.width - padding.left - padding.right,
      h = options.height - padding.top - padding.bottom;
  var dataset;
  //Set up stack method
  var stack = d3_v3.layout.stack();

  dataset = options.data;

  //Data, stacked
  stack(dataset);

  //var color_hash =
  if (options.colors) var colorScale = d3.scaleOrdinal().range(options.colors);
  //Set up scales
  var x = d3.scale.ordinal().domain(dataset[0].map(function (d) {
    return d.time;
  })).rangeRoundBands([0, w], 0.2);

  var y = d3.scale.linear().domain([0, d3.max(dataset, function (d) {
    return d3.max(d, function (d) {
      return d.y0 + d.y;
    });
  })]).range([h, 0]);
  var xAxis = d3_v3.svg.axis().scale(x);
  if (x.domain().length > 3) {

    xAxis.tickValues(x.domain().filter(function (d, i) {
      return !(i % 3);
    })).orient("bottom")
    //         .ticks(d3_v3.time.days,1)
    .ticks(5);
  } else if (x.domain().length > 2) {
    xAxis.tickValues(x.domain().filter(function (d, i) {
      return !(i % 2);
    })).orient("bottom").ticks(5);
  } else {
    xAxis.orient("bottom").ticks(5);
  }

  var yAxis = d3_v3.svg.axis().scale(y).orient("left").ticks(10);

  //Easy colors accessible via a 10-step ordinal scale
  var colors = d3_v3.scale.category10();

  //Create SVG element
  var svg = d3_v3.select(options.container).append("svg").attr("width", options.width).attr("height", options.height);

  // Add a group for each row of data
  var groups = svg.selectAll("g").data(dataset).enter().append("g").attr("class", "rgroups")
  //    .attr("transform","translate("+ padding.left + "," + (h-padding.bottom-padding.top ) +")")
  .style("fill", function (d, i) {
    if (options.colors) {
      return colorScale(d.type);
    }
    return options.color_hash[dataset.indexOf(d)][1];
  });

  // Add a rect for each data value
  var rects = groups.selectAll("rect").data(function (d) {
    return d;
  }).enter().append("rect").attr("x", function (d) {
    return x(d.time);
  }).attr("y", function (d) {
    return y(d.y0 + d.y);
  }).attr("height", function (d) {
    return y(d.y0) - y(d.y0 + d.y);
  }).attr("width", x.rangeBand()).style("fill", function (d, i) {

    if (options.colorObj) {
      return options.colorObj[d.time];
    }
  })
  //	 .attr("rx", (15 / 4))
  //	 .attr("ry", (15 / 4))
  .style("fill-opacity", 1);

  rects.on("click", function (d) {
    window.openSideModal(d);
  }).on("mouseover", function (d) {
    stackedtimelinediv.style("visibility", "visible");
    stackedtimelinediv.style("display", "inline-block");
    if (d.txt) {
      stackedtimelinediv.html(d.txt);
    } else stackedtimelinediv.html('<div class="text-uppercase"><div>year: ' + d.time + '</div><div>Amount:' + d.y + '</div><div>type:' + d.type + '</div></div>');
  }).on("mousemove", function (d) {
    if ($(".tooltip_stackedTime").width() + d3_v3.event.pageX + 10 < $(window).width()) {
      $(".tooltip_stackedTime").css("left", d3_v3.event.pageX + 10 + "px");
    } else {
      $(".tooltip_stackedTime").css("left", d3_v3.event.pageX - 25 - $(".tooltip_stackedTime").width() + "px");
    }
    return stackedtimelinediv.style("top", d3_v3.event.pageY - 25 + "px");
  }).on("mouseout", function (d) {
    stackedtimelinediv.style("visibility", "hidden");
    stackedtimelinediv.style("display", "none");
  });
  if (options.axisX) {
    var x_g = svg.append("g").attr("class", "x axis").attr("transform", "translate(" + padding.left + "," + (h - padding.bottom) + ")").call(xAxis);
    if (options.tickColor) {
      x_g.selectAll("line").style("stroke", options.tickColor);
      x_g.selectAll("text").style("fill", options.tickColor).style("stroke", "none").style("font-size", "10px");
      x_g.select("path").style("display", "none");
    }
  }

  //
  //
  //    svg.append("g")
  //     .attr("class","y axis")
  //     .attr("transform","translate(" + padding.left + "," + padding.top + ")")
  //     .call(yAxis);

  // adding legend

  //    var legend = svg.append("g")
  //        .attr("class","legend")
  //        .attr("x", w - padding.right - 65)
  //        .attr("y", 25)
  //        .attr("height", 100)
  //        .attr("width",100);
  //
  //    legend.selectAll("g").data(dataset)
  //       .enter()
  //       .append('g')
  //       .each(function(d,i){
  //        var g = d3_v3.select(this);
  //        g.append("rect")
  //         .attr("x", w - padding.right - 65)
  //         .attr("y", i*25 + 10)
  //         .attr("width", 10)
  //         .attr("height",10)
  //         .style("fill",color_hash[String(i)][1]);
  //
  //        g.append("text")
  //         .attr("x", w - padding.right - 50)
  //         .attr("y", i*25 + 20)
  //         .attr("height",30)
  //         .attr("width",100)
  //         .style("fill",color_hash[String(i)][1])
  //         .text(color_hash[String(i)][0]);
  //       });

  //    svg.append("text")
  //    .attr("transform","rotate(-90)")
  //    .attr("y", 0 - 5)
  //    .attr("x", 0-(h/2))
  //    .attr("dy","1em")
  //    .text("Number of Messages");
  //
  //   svg.append("text")
  //      .attr("class","xtext")
  //      .attr("x",w/2 - padding.left)
  //      .attr("y",h - 5)
  //      .attr("text-anchor","middle")
  //      .text("Days");
  //
  //   svg.append("text")
  //         .attr("class","title")
  //         .attr("x", (w / 2))
  //         .attr("y", 20)
  //         .attr("text-anchor", "middle")
  //         .style("font-size", "16px")
  //         .style("text-decoration", "underline")
  //         .text("Number of messages per day.");

}
"use strict";

function temporalChart(temporalOptions) {
    if (temporalOptions.container) {
        $(temporalOptions.container).empty();
    }
    //--------------------------Initialize Values-----------------------------
    if (temporalOptions) {
        this.container = temporalOptions.container ? temporalOptions.container : "body";
        this.data = temporalOptions.data ? temporalOptions.data : [];
        this.height = temporalOptions.height ? temporalOptions.height : 600;
        this.uri = temporalOptions.uri;
        this.collapseHeader = temporalOptions.header ? temporalOptions.header : "FORCE COLLAPSE CHART";

        this.randomIdString = Math.floor(Math.random() * 10000000000);
        this.headerOptions = temporalOptions.headerOptions == false ? temporalOptions.headerOptions : true;
        this.ticks = temporalOptions.ticks ? temporalOptions.ticks : 5;
        this.isHeaer = temporalOptions.isHeaer == false ? temporalOptions.isHeaer : true;
    } else {
        console.error('temporal Chart Initialization Error : temporal Chart Params Not Defined');
        return false;
    }
    var header = temporalOptions.header;
    var actualOptions = jQuery.extend(true, {}, temporalOptions);
    var randomSubstring = this.randomIdString;
    var hl = this.height;
    var h = parseInt(hl) + 50;
    var _this = this;
    var modalwidth = $(window).width() - 200;
    var modal = ' <div id="modal_' + randomSubstring + '"class="modal fade " tabindex="-1" role="dialog"> <div class="modal-dialog modal-lg" style="width:' + modalwidth + 'px"> <form ><div class="modal-content"><div class="modal-body"  style="padding:0;background-color:#334d59" id="modal_chart_container' + randomSubstring + '"></div></div></form></div></div>';
    var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 100%; margin: auto; margin-top: 0px; font-size: 14px;font-style: inherit;"> <div class="graphBox" style="height:' + h + 'px;max-height: ' + h + 'px;min-height: ' + h + 'px;margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="collapse_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>';
    // var chartContainerdiv = '<div class="chartContainer"  align="center" style="width: 80%; margin: auto; margin-top: 30px; font-size: 14px;font-style: inherit;"> <div class="dataBox" style="margin: auto; background-color: #374c59; width: 100%;left: 0px;top: 0px;overflow: hidden;position: relative;"> <div class="headerDiv" style="font-weight:bold;background-color: #425661;text-align: left;color: #239185; border-bottom: 1px solid rgba(192, 192, 192, 0.47);width: 100%; line-height: 2.5;font-size: 16px ;padding-left: 5px;">' + header + '</div><div id="bubble_chart_div' + randomSubstring + '" class="chartContentDiv" style="width: 100%;"></div> </div></div>'
    $(this.container).html(chartContainerdiv);
    $(this.container).append(modal);
    var chart_container = "#collapse_chart_div" + randomSubstring;
    this.width = temporalOptions.width ? temporalOptions.width : $(chart_container).width() - 10;
    if (this.height > this.width) {
        this.height = this.width;
    }
    var mapGlyphMargin = { top: 30, right: 10, bottom: 10, left: 10 };
    var fullMareyMargin = { top: 30, right: 20, bottom: 10, left: 60 };
    this.diameter = this.height > this.width ? this.width - 50 : this.height - 50;
    if (!this.headerOptions) {
        var closebtn = '<button type="button" class="cancel" style="float: right;padding:0 8px;border:0;opacity: 1;background-color: transparent;float:right" data-dismiss="modal" aria-label="Close"> <span class="fa fa-remove"></span></button>';
        $(chart_container).siblings(".headerDiv").append(closebtn);
    }
    if ($(chart_container).siblings(".headerDiv").find(".bstheme_menu_button").length == 0) var header_options = '<div style="float: right; padding: 0 10px; cursor: pointer;" class="bstheme_menu_button bstheme_menu_button_' + randomSubstring + '" data-toggle="collapse" data-target="#opt_' + randomSubstring + '"><i class="fa fa-ellipsis-v" aria-hidden="true"></i><div class="bstheme_options" style="position:absolute;right:10px;z-index:2000"> <div style="display:none;" id="opt_' + randomSubstring + '" class="collapse"><span class="header_fullscreen_chart' + randomSubstring + '"><i class="fa fa-expand" aria-hidden="true"></i></span><span class="header_refresh_' + randomSubstring + '"><i class="fa fa-refresh" aria-hidden="true"></i></span> <span class="header_table_' + randomSubstring + '"> <i class="fa fa-table" aria-hidden="true"></i></span> <span class="header_chart_' + randomSubstring + '" style="display:none" ><i class="fa fa-bar-chart" aria-hidden="true"></i></span></div></div> </div>';
    $(chart_container).siblings(".headerDiv").append(header_options);

    if (!this.headerOptions) {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "28px");
        $('.header_fullscreen_chart' + randomSubstring).css("display", "none");
    } else {
        $(chart_container).siblings(".headerDiv").find(".bstheme_options").css("right", "0");
    }
    if (!this.isHeaer) {
        $(chart_container).siblings(".headerDiv").remove();
    }

    $(".force_tooltip").remove();
    var tool_tip = $('body').append('<div class="temporal_tooltip" style="z-index:2000;position: absolute; opacity: 1; pointer-events: none; visibility: hidden;background-color:#0cae96; padding: 10px;border-radius: 5px;border: 1px solid gray;font-size: 10px;color:#000;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    var data = this.data;
    var curretn_uri = this.Uri;
    var collapse_header = this.collapseHeader;
    var containerid = this.container;

    //    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    var colorScale = d3.scaleOrdinal().range(["#B55664", "#3D79A5", "#15AD66"]);
    var width = this.width,
        height = this.height,
        diameter = this.diameter;

    var chartdivs = '<div class="full-width section-trains"> <div class="full-width marey-container_' + randomSubstring + '" loading"> <div class="row"><div class=" col-xs-4 fixed-left_' + randomSubstring + '" style=""> <div class="side-map_' + randomSubstring + '"></div><div class="side-caption_' + randomSubstring + '"></div> </div><div class="col-xs-8  fixed-right_' + randomSubstring + '" style=""> <div class="inner"><div class="marey_' + randomSubstring + '"></div> </div>  </div> </div> </div> </div>';
    $(chart_container).append(chartdivs);
    //add "appendOnce" method to d3 selections which can be called many times but ensures that
    // the dom element is only added once.  It always returns the dom element, and adds a "firstTime"
    // attribute to it that is a length-1 selection the first time its added, and an empty selection
    // all subsequent times
    //    d3.selection.prototype.appendOnce = function (type, clazz) {
    //        var result = this.selectAll('.' + clazz.replace(/ /g, '.')).data([1]);
    //        result.firstTime = result.enter().append(type).attr('class', clazz);
    //        return result;
    //    };

    // add "onOnce" method to d3 selections - adds a single listener to the selection that filters on sub-selections
    // when there are too many events that each have a listener and it becomes a performance problem, switch over
    // to using this listener on a parent dom element to reduce total number of listeners
    //    d3.selection.prototype.onOnce = function (eventType, subSelector, func) {
    //        this.each(function () {
    //            $(this).on(eventType, subSelector, function (evt) {
    //                var d = d3.select(this).datum();
    //                try {
    //                    d3.event = evt.originalEvent;
    //                    return func.call(this, d);
    //                } finally {
    //                    d3.event = null;
    //                }
    //            });
    //        });
    //        return this;
    //    };
    // add "off" method to d3 selections - clears events types from a space separated list from the
    // selection that were added using D3 or jQuery.
    // For example: selection.off('mouseover mouseout')
    d3.selection.prototype.off = function (eventTypes) {
        var self = this;
        eventTypes.split(/\s+/g).forEach(function (eventType) {
            self.each(function () {
                $(self).off(eventType);
            }).on(eventType, null);
        });
        return self;
    };

    // add utility to move an SVG selection to the front
    d3.selection.prototype.moveToFront = function () {
        return this.each(function () {
            this.parentNode.appendChild(this);
        });
    };

    function wrap(text, width) {
        text.each(function () {
            var text = d3.select(this),
                words = text.text().split(/\s+/).reverse(),
                word,
                line = [],
                lineNumber = 0,
                lineHeight = 1.1,
                // ems
            y = text.attr("y") || 0,
                x = text.attr("x") || 0,
                dy = parseFloat(text.attr("dy") || 0),
                tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");
            while (!!(word = words.pop())) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width || word === '<br>') {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = word !== '<br>' ? [word] : [];
                    tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                }
            }
        });
    }
    temporal(temporalOptions.data);
    //--------------------------------------------------------------------------
    /**
     * Function to plot chart
     */
    function temporal(data) {
        var network = data["station-network"];
        var spider = data.spider;
        var trips = data["marey-trips"];
        var header = data["marey-header"];

        // The annotations displayed along the right side of the Marey diagram
        var sideAnnotationData = [
            // At the minimum you need time and text which positions the annotation...
            //    {
            //      time: '2014/02/03 05:00',
            //      text: 'Service starts at 5AM on Monday morning. Each line represents the path of one train. Time continues downward, so steeper lines indicate slower trains. <br> \u25BE'
            //    },
            //    {
            //      time: '2014/02/03 05:55',
            //      text: 'Since the red line splits, we show the Ashmont branch first then the Braintree branch.  Trains on the Braintree branch "jump over" the Ashmont branch.',
            //      // But additionally you can have a line connecting the annotation to a point in the marey diagram
            ////      connections: [{
            ////        time: '2014/02/03 05:40',
            ////        station: 'ashmont',
            ////        line: 'red'
            ////      }]
            //    }

        ];
        var idToNode = {};
        network.nodes.forEach(function (data) {
            data.x = spider[data.id][0];
            data.y = spider[data.id][1];
            idToNode[data.id] = data;
        });
        network.links.forEach(function (link) {
            link.source = network.nodes[link.source];
            link.target = network.nodes[link.target];
            link.source.links = link.source.links || [];
            link.target.links = link.target.links || [];
            link.target.links.splice(0, 0, link);
            link.source.links.splice(0, 0, link);
        });
        trips.forEach(function (d) {
            d.stops = d.stops || [];
            var m = moment(d.begin * 1000).zone(5);
            d.secs = m.diff(m.clone().startOf('day')) / 1000;
        });
        var stationToName = {};
        var end = {};
        var startandendlables = {};
        var nodesPerLine = network.nodes.map(function (d) {
            return d.links.map(function (link) {
                var key = d.id + '|' + link.line;
                if (d.links.length === 1) {
                    end[key] = true;
                }
                stationToName[key] = d.name;
                return key;
            });
        });

        var mapGlyphTrainCircleRadius = 2.5;
        nodesPerLine = _.uniqWith(_.flatten(nodesPerLine));
        var xExtent = d3.extent(d3.values(header), function (d) {
            return d[0];
        });
        var minUnixSeconds = d3.min(d3.values(trips), function (d) {
            return d.begin;
        });
        var maxUnixSeconds = d3.max(d3.values(trips), function (d) {
            return d.end;
        });

        /* 2. Render the side map glyph that shows locations of trains
         *    at a point in time
         *************************************************************/
        var fixedLeft = d3.select(".fixed-left_" + randomSubstring);
        var mapGlyphSvg = fixedLeft.select('.side-map_' + randomSubstring).append('svg').attr("id", "mapGlyphSvg_" + randomSubstring).style("width", "100%").style("height", _this.height);
        //                .style("margin-top", "100");

        function renderSideMap(mapGlyphContainer, outerWidth, outerHeight) {

            var xRange = d3.extent(network.nodes, function (d) {
                return d.x;
            });
            var yRange = d3.extent(network.nodes, function (d) {
                return d.y;
            });
            var width = outerWidth - mapGlyphMargin.left - mapGlyphMargin.right,
                height = Math.max(outerHeight - mapGlyphMargin.top - mapGlyphMargin.bottom - $('.side-caption_' + randomSubstring).height() - 40, 150);
            var xScale = width / (xRange[1] - xRange[0]);
            var yScale = height / (yRange[1] - yRange[0]);
            var scale = Math.min(xScale, yScale);
            network.nodes.forEach(function (data) {
                data.pos = [data.x * scale, data.y * scale];
            });
            var endDotRadius = 0.2 * scale;
            var mapGlyph = mapGlyphContainer.attr('width', scale * (xRange[1] - xRange[0]) + mapGlyphMargin.left + mapGlyphMargin.right).attr('height', scale * (yRange[1] - yRange[0]) + mapGlyphMargin.top + mapGlyphMargin.bottom).append('g').attr("class", 'map-container').attr('transform', 'translate(' + mapGlyphMargin.left + ',' + mapGlyphMargin.top + ')');
            // mapGlyphContainer.append("circle")
            //         .attr("cx", mapGlyphContainer.attr("width") / 2)
            //         .attr("cy", mapGlyphContainer.attr("height") / 2)
            //         .attr("r", Math.max(mapGlyphContainer.attr("width")/2, mapGlyphContainer.attr("height")) / 2)
            //         .style("fill", "transparent")
            //         .style("stroke", "#536573")
            //         .style("stroke-width","2px")
            //         .style("stroke-opacity","0.3");


            var stations = mapGlyph.selectAll('.station').data(network.nodes, function (d) {
                return d.name;
            });

            var connections = mapGlyph.selectAll('.connect').data(network.links, function (d) {
                return (d.source && d.source.id) + '-' + (d.target && d.target.id);
            });

            connections.enter().append('line').attr('class', function (d) {
                return 'connect ' + d.line + '-dimmable';
            }).attr('x1', function (d) {
                return d.source.pos[0];
            }).attr('y1', function (d) {
                return d.source.pos[1];
            }).attr('x2', function (d) {
                return d.target.pos[0];
            }).attr('y2', function (d) {
                return d.target.pos[1];
            }).style("fill", "none").style("stroke", function (d) {
                return colorScale(d.line);
            });

            connections.attr('x1', function (d) {
                return d.source.pos[0];
            }).attr('y1', function (d) {
                return d.source.pos[1];
            }).attr('x2', function (d) {
                return d.target.pos[0];
            }).attr('y2', function (d) {
                return d.target.pos[1];
            });

            stations.enter().append('circle').attr('class', function (d) {
                return 'station middle station-label ' + d.id;
            }).style("fill", function (d) {
                return "#B7B7B7";
                //                        return colorScale(d.links[0].color)
            }).style("opacity", 0.3).on('mouseover', function (d) {

                highlightMareyTitle(d.id, _.unique(d.links.map(function (link) {
                    return link.line;
                })));
                $(".temporal_tooltip").html('<span style="color:#000;"> ' + d.name + '</span>');
                return $(".temporal_tooltip").css("visibility", "visible");
            }).on("mousemove", function () {
                $(".temporal_tooltip").css("top", d3.event.pageY - 10 + "px");
                return $(".temporal_tooltip").css("left", d3.event.pageX + 10 + "px");
            }).on('mouseout', function (d) {
                highlightMareyTitle(null);
                return $(".temporal_tooltip").css("visibility", "hidden");
            }).attr('cx', function (d) {
                return d.pos[0];
            }).attr('cy', function (d) {
                return d.pos[1];
            }).attr('r', 3);

            stations.attr('cx', function (d) {
                return d.pos[0];
            }).attr('cy', function (d) {
                return d.pos[1];
            }).attr('r', 3);

            // line color circles
            function dot(id, clazz) {
                mapGlyph.selectAll('circle.' + id).classed(clazz, true).classed('end', true).classed('middle', false).attr('r', Math.max(endDotRadius, 3));
            }
            dot('place-asmnl', "red");
            dot('place-alfcl', "red");
            dot('place-brntn', "red");
            dot('place-wondl', "High");
            dot('place-bomnl', "High");
            dot('place-forhl', "Low");
            dot('place-ogmnl', "Low");
        }

        // Render train dots onto the map glyph at a particular point in time
        var lastTime = minUnixSeconds;
        function renderTrainsAtTime(unixSeconds) {
            if (!unixSeconds) {
                unixSeconds = lastTime;
            }
            lastTime = unixSeconds;
            if (!showingMap) {
                return;
            }
            var active = trips.filter(function (d) {
                return d.begin < unixSeconds && d.end > unixSeconds;
            });
            var positions = active.map(function (d) {
                // get prev, next stop and mix
                for (var i = 0; i < d.stops.length - 1; i++) {
                    if (d.stops[i + 1].time > unixSeconds) {
                        break;
                    }
                }

                // find the datapoint before and after this time and interpolate
                var from = d.stops[i];
                var to = d.stops[i + 1];
                var ratio = (unixSeconds - from.time) / (to.time - from.time);
                return { trip: d.trip, pos: placeWithOffset(from, to, ratio), line: d.line };
            });

            var trains = mapGlyphSvg.select('.map-container').selectAll('.train').data(positions, function (d) {
                return d.trip;
            });
            trains.enter().append('circle').attr('class', function (d) {
                return 'train highlightable hoverable dimmable ' + d.line;
            }).classed('active', function (d) {
                return d.trip === highlightedTrip;
            }).classed('hover', function (d) {
                return d.trip === hoveredTrip;
            }).attr('r', mapGlyphTrainCircleRadius).on('click', function (d) {
                highlightTrain(d);
            }).on('mouseover', hoverTrain).on('mouseout', unHoverTrain).style("fill", function (d) {
                return colorScale(d.line);
            }).style("stroke", function (d) {
                return colorScale(d.line);
            }).style("stroke-width", "25px").style("stroke-opacity", 0);
            trains.attr('cx', function (d) {
                return d.pos[0];
            }).attr('cy', function (d) {
                return d.pos[1];
            });
            trains.exit().remove();
            timeDisplay.text(moment(unixSeconds * 1000).zone(5).format('h:mm a'));
        }

        /* 3. Set up the scaffolding for lined-up and full Marey diagrams
         *************************************************************/
        var marey = d3.select(".marey_" + randomSubstring).text('').style('text-align', 'left').append('svg').attr("id", "marey_" + randomSubstring).style("width", "100%").style("height", "100%");
        var mareyContainer = d3.select('.marey-container_' + randomSubstring).classed('loading', false);
        d3.select(".lined-up-marey").text('');
        var timeDisplay = mareyContainer.selectAll('.marey-time');

        d3.select('body').on('click.highlightoff', function () {
            highlightedTrip = null;
            highlight();
        });

        /* 4. On load and when the screen width changes
         *
         * This section makes heavy use of a utility defined in
         * common.js 'appendOnce' that when called adds a new element
         * or returns the existing element if it already exists.
         *************************************************************/
        // first some state shared across re-renderings
        //        var frozen = false;
        var showingMap = false;
        //        var highlightedLinedUpMarey = null;
        var highlightedTrip = null;
        var hoveredTrip = null;
        var lastWidth = null;

        // the method that actually gets called on screen size chages
        function renderMarey(outerSvg, fullMareyOuterWidth) {

            if (fullMareyOuterWidth === lastWidth) {
                return;
            }
            lastWidth = fullMareyOuterWidth;

            /* 4a. Render the full Marey
             *************************************************************/

            var fullMareyOuterHeight = _this.height;
            var fullMareyWidth = fullMareyOuterWidth - fullMareyMargin.left - fullMareyMargin.right,
                fullMareyHeight = fullMareyOuterHeight - fullMareyMargin.top - fullMareyMargin.bottom;
            outerSvg.attr('width', fullMareyOuterWidth).attr('height', fullMareyOuterHeight);

            var fullMareyHeader = outerSvg.append('g').attr("class", 'header').attr('transform', 'translate(' + fullMareyMargin.left + ',0)');
            var fullMareyBodyContainer = outerSvg.append('g').attr('class', 'main').attr('transform', 'translate(' + fullMareyMargin.left + ', ' + fullMareyMargin.top + ')');
            var fullMareyBackground = fullMareyBodyContainer.append('g').attr('class', 'background');
            var fullMareyForeground = fullMareyBodyContainer.append('g').attr('class', 'foreground');

            var xScale = d3.scaleLinear().domain(xExtent).range([0, fullMareyWidth]);
            var yScale = d3.scaleLinear().domain([minUnixSeconds, maxUnixSeconds]).range([15, fullMareyHeight]).clamp(true);

            var timeScale = d3.scaleTime().domain([new Date(minUnixSeconds * 1000), new Date(maxUnixSeconds * 1000)]).range([15, fullMareyHeight]);

            // draw the station label header aross the top
            var keys = d3.keys(header);
            var stationXScale = d3.scaleOrdinal().domain(keys).range(keys.map(function (d) {
                return xScale(header[d][0]);
            }));
            var stationXScaleInvert = {};
            keys.forEach(function (key) {
                stationXScaleInvert[header[key][0]] = key;
            });

            var stationLabels = fullMareyHeader.selectAll('.station-label').data(nodesPerLine);
            startandendlables = [];
            $.each(end, function (d, i) {
                startandendlables.push({
                    "val": d,
                    "pos": stationXScale(d)
                });
            });
            startandendlables.sort(function (a, b) {
                return a.pos - b.pos;
            });
            $.each(startandendlables, function (i, d) {
                startandendlables[d.val] = [];
                startandendlables[d.val].endstart = "start";
                if (startandendlables[d.val.split("|")[1]]) {
                    startandendlables[d.val].endstart = "end";
                }
                startandendlables[d.val.split("|")[1]] = true;
            });
            stationLabels.enter().append('text').attr('class', 'station-label').style('display', function (d) {
                return end[d] ? null : 'none';
            }).style('text-anchor', function (d) {
                if (end[d]) {
                    if (startandendlables[d].endstart == "start") {
                        return "start";
                    } else {
                        return "end";
                    }
                } else {
                    return "start";
                }
            }).attr("y", function (d) {
                if (!end[d]) {
                    return "-15px";
                }
            }).style('font-size', "11px").text(function (d) {
                return stationToName[d];
            }).style("fill", function (d) {
                return colorScale(d.split("|")[1]);
            }).attr('transform', function (d) {
                return 'translate(' + (stationXScale(d) - 2) + ',' + (fullMareyMargin.top - 3) + ')';
            });

            var stations = fullMareyForeground.selectAll('.station').data(nodesPerLine, function (d) {
                return d;
            });

            stations.enter().append('line').attr('class', function (d) {
                return 'station ' + d.replace('|', '-');
            }).attr('x1', function (d) {
                return xScale(header[d][0]);
            }).attr('x2', function (d) {
                return xScale(header[d][0]);
            }).attr('y1', 0).attr('y2', fullMareyHeight);

            // draw the tall time axis down the side
            var y_g = fullMareyForeground.append('g').attr('class', 'y axis').call(d3.axisLeft(timeScale).tickFormat(function (d) {
                return moment(d).zone(5).format("h:mm A");
            }).ticks(_this.ticks)).attr("class", "axis").style("stroke", "#6c7e88");

            //            var yAxis = d3.svg.axis()
            //                    .tickFormat(function (d) {
            //                        return moment(d).zone(5).format("h:mm A");
            //                    })
            //                    .ticks(d3.time.minute, 15)
            //                    .scale(timeScale)
            //                    .orient("left");
            //            var y_g = fullMareyForeground.appendOnce('g', 'y axis').call(yAxis);
            y_g.selectAll("text").style("fill", "#6c7e88").style("font-size", "10px").style("stroke", "none");
            y_g.selectAll("path").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
            y_g.selectAll("line").style("stroke", "#6c7e88").style("shape-rendering", "crispEdges").style("fill", "none");
            var lineMapping = d3.line().x(function (d) {
                return d[0];
            }).y(function (d) {
                return d[1];
            }).defined(function (d) {
                return d !== null;
            }).curve(d3.curveLinear);
            var mareyLines = fullMareyForeground.selectAll('.mareyline').data(trips, function (d) {
                return d.trip;
            });

            fullMareyForeground;

            mareyLines.enter().append('path').on('mouseover', hoverTrain).on('mouseout', unHoverTrain).on('click', highlightTrain).attr('class', function (d) {
                return 'mareyline hoverable highlightable dimmable ' + d.line;
            }).style("fill", "none").style("stroke", function (d) {
                return colorScale(d.line);
            }).attr('transform', function (d) {
                if (!d.origY) {
                    d.origY = yScale(d.stops[0].time);
                }
                return 'translate(0,' + d.origY + ')';
            }).attr('d', draw(xScale, yScale));
            mareyContainer.select('.fixed-right_' + randomSubstring).on('mousemove', selectTime);
            mareyContainer.select('.fixed-right_' + randomSubstring).on('mousemove.titles', updateTitle);
            var barBackground = fullMareyBackground.append('g').attr('class', 'g-bar hide-on-ios');
            var barForeground = fullMareyForeground.append('g').attr('class', 'g-bar hide-on-ios');
            barBackground.append('line').attr('class', 'bar').attr('x1', 1).attr('x2', fullMareyWidth).attr('y1', 0).attr('y2', 0).style("fill", "none").style("stroke", "gray");
            barForeground.append('rect').attr('class', 'text-background').attr('x', 1).attr('y', -17).attr('width', 48).attr('height', 16);
            //                    .style("fill","#374D5A");
            barForeground.append('text').attr('class', 'marey-time').attr('dx', 2).attr('dy', -4);
            timeDisplay = mareyContainer.selectAll('.marey-time').style("fill", "#6c7e88").style("font-size", "12px").style("stroke", "none");
            ;
            var bar = mareyContainer.selectAll("g.g-bar");

            // If a previous time was selected, then select that time again now
            if (!lastTime) {
                select(minUnixSeconds);
            }

            // on hover, show the station you are hovered on
            function updateTitle() {
                var pos = d3.mouse(fullMareyForeground.node());
                var x = pos[0];
                var station = stationXScaleInvert[Math.round(xScale.invert(x))];
                if (station) {
                    highlightMareyTitle(station);
                }
            }

            // on hover, set the time that is displayed in the map glyph on the side
            function selectTime() {

                var pos = d3.mouse(fullMareyForeground.node());
                var y = pos[1];
                var x = pos[0];
                if (x > 0 && x < fullMareyWidth) {
                    var time = yScale.invert(y);
                    select(time);
                }
            }

            // actually set the time for the map glyph once the time is determined
            function select(time) {
                var y = yScale(time);
                bar.attr('transform', 'translate(0,' + y + ')');
                timeDisplay.text(moment(time * 1000).zone(5).format('h:mm a'));
                renderTrainsAtTime(time);
            }

            // Get a list of [x, y] coordinates for all train trips for
            // both the full Marey and the lined-up Marey
            function getPointsFromStop(xScale, yScale, d, relative) {
                var last = null;
                var stops = d.stops.map(function (stop) {
                    // special case: place-jfk, place-nqncy -> place-jfk, place-asmnl (at same time), place-nqncy
                    // special case: place-nqncy, place-jfk -> place-nqncy, place-asmnl (at same time), place-jfk
                    var result;
                    if (last && last.stop === 'place-jfk' && stop.stop === 'place-nqncy') {
                        result = [null, { stop: 'place-asmnl', time: last.time }, stop];
                    } else if (last && last.stop === 'place-nqncy' && stop.stop === 'place-jfk') {
                        result = [{ stop: 'place-asmnl', time: stop.time }, null, stop];
                    } else {
                        result = [stop];
                    }
                    last = stop;
                    return result;
                });
                var flattenedStops = _.flatten(stops);
                var startX = xScale(header[d.stops[0].stop + '|' + d.line][0]);
                var points = flattenedStops.map(function (stop) {
                    if (!stop) {
                        return null;
                    }
                    var y = yScale(stop.time) - yScale(flattenedStops[0].time);
                    var x = xScale(header[stop.stop + '|' + d.line][0]);
                    if (relative) {
                        x -= startX;
                    }
                    return [x, y];
                });
                return points;
            }
            function draw(xScale, yScale, relative) {
                return function (d) {
                    var points = getPointsFromStop(xScale, yScale, d, relative);
                    return lineMapping(points);
                };
            }
        }

        /* 5. Add interaction behavior with surrounding text
         *************************************************************/
        // Setup the links in text that scroll to a position in the marey diagram
        // <a href="#" data-dest="id of dist dom element to scroll to" class="scrollto">...
        fixedLeft.selectAll('.scrollto').on('click', function () {
            var id = d3.select(this).attr('data-dest');
            var $element = $("#" + id);
            $('body, html').animate({ scrollTop: $element.position().top }, '300', 'swing');
            d3.event.preventDefault();
        });

        // Setup the links in text that highlight a particular line
        // <a href="#" data-line="color of line to highlight" class="highlight">...
        fixedLeft.selectAll('.highlight').on('click', function () {
            d3.event.preventDefault();
        }).on('mouseover', function () {
            var line = d3.select(this).attr('data-line');
            var others = _.without(['red', 'Low', 'High'], line);
            others.forEach(function (other) {
                mareyContainer.selectAll('.' + other + ', .' + other + '-dimmable, circle.middle').classed('line-dimmed', true);
            });
        }).on('mouseout', function () {
            mareyContainer.selectAll('.line-dimmed').classed('line-dimmed', false);
        });

        /* Bootstrap the Visualization - and re-render on width changes
         *************************************************************/

        showingMap = true;
        renderMarey(marey, $("#marey_" + randomSubstring).width());
        renderTrainsAtTime();

        renderSideMap(mapGlyphSvg, $("#mapGlyphSvg_" + randomSubstring).width(), $("#mapGlyphSvg_" + randomSubstring).height());

        /* Miscellaneous Utilities
         *************************************************************/
        function highlight() {
            mareyContainer.selectAll('.highlightable').style("opacity", 0.2);
            mareyContainer.classed('highlight-active', !!highlightedTrip);
            mareyContainer.selectAll('.highlightable').classed('active', function (d) {
                return d.trip === highlightedTrip;
            });
            mareyContainer.selectAll('.highlightable.active')._groups[0].length;
            if (mareyContainer.selectAll('.highlightable.active') && mareyContainer.selectAll('.highlightable.active')._groups && mareyContainer.selectAll('.highlightable.active')._groups[0] && mareyContainer.selectAll('.highlightable.active')._groups[0].length) {
                mareyContainer.selectAll('.highlightable.active').style("opacity", 1);
                mareyContainer.selectAll('circle.highlightable.active').style("stroke-width", "25px").style("stroke-opacity", 0.5);
            } else {
                mareyContainer.selectAll('.highlightable').style("opacity", 1);
                mareyContainer.selectAll('circle.highlightable').style("stroke-opacity", 0);
            }
        }
        function highlightTrain(d) {
            if (d === null) {
                highlightedTrip = null;
            } else {
                highlightedTrip = d.trip;
            }
            highlight();
            d3.event.stopPropagation();
        }
        function unHoverTrain() {
            hoveredTrip = null;
            hover();
        }
        function hoverTrain(d) {
            hoveredTrip = d.trip;
            hover();
        }

        function hover() {
            if (mareyContainer.selectAll('.hoverable.highlightable.active') && mareyContainer.selectAll('.hoverable.highlightable.active')._groups && mareyContainer.selectAll('.hoverable.highlightable.active')._groups[0] && mareyContainer.selectAll('.hoverable.highlightable.active')._groups[0].length) {

                return false;
            }
            marey.selectAll('.hoverable.highlightable').style("stroke-width", "1px");
            mareyContainer.selectAll('circle.highlightable').style("stroke-opacity", 0);
            mareyContainer.selectAll('.hoverable').classed('hover', function (d) {
                return d.trip === hoveredTrip;
            });
            marey.selectAll('.hoverable.hover').style("stroke-width", "3px");
            mareyContainer.selectAll('circle.highlightable.hover').style("stroke-width", "25px").style("stroke-opacity", 0.5);
        }
        function highlightMareyTitle(title, lines) {
            var titles = {};
            titles[title] = true;
            if (lines) {
                lines.forEach(function (line) {
                    titles[title + "|" + line] = true;
                });
            } else if (title) {
                titles[title] = true;
                titles[title.replace(/\|.*/, '')] = true;
            }
            var stationLabels = marey.selectAll('text.station-label');
            stationLabels.style('display', function (d) {
                var display = end[d] || titles[d];
                return display ? null : 'none';
            });
            stationLabels.classed('active', function (d) {
                return titles[d.id ? d.id : d];
            });
        }

        function placeWithOffset(from, to, ratio) {
            var fromPos = idToNode[from.stop].pos;
            var toPos = idToNode[to.stop].pos;
            var midpoint = d3.interpolate(fromPos, toPos)(ratio);
            var angle = Math.atan2(toPos[1] - fromPos[1], toPos[0] - fromPos[0]) + Math.PI / 2;
            return [midpoint[0] + Math.cos(angle) * mapGlyphTrainCircleRadius, midpoint[1] + Math.sin(angle) * mapGlyphTrainCircleRadius];
        }
    }
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".bstheme_menu_button_" + randomSubstring, function () {
        var id = $(this).attr("data-target");
        if ($(id).css("display") == "none") {
            $(id).css("display", "inline-block");
        } else {
            $(id).css("display", "none");
        }
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_refresh_" + randomSubstring, function () {
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(containerid).empty();
            chartTemporal(actualOptions); //calling World function
        }
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_table_" + randomSubstring, function () {
        var a = parseInt(h / 55);

        $(chart_container).empty();

        $(this).css("display", "none");
        $(".header_chart_" + randomSubstring).css("display", "inline-block");
        var tbl = "<div id ='temporalChart_table_" + randomSubstring + "' style='padding:5px;background-color: #425661;overflow:overflow:hidden;height:" + _this.height + "px'><table id ='temporalChart_table1_" + randomSubstring + "' class='table table-striped' style='width:100%;background-color:#425661;padding:5px;color:#5A676E;' ><thead><tr><th>Transaction ID</th><th>From</th><th>To</th><th>Risk Level</th></tr></thead><tbody>";
        $.each(data['marey-trips'], function (index, value) {
            tbl = tbl + "<tr><td>" + value.trip.toUpperCase() + "</td><td>" + new Date(value.begin) + "</td><td>" + new Date(value.end) + "</td><td>" + new Date(value.line) + "</td></tr>";
        });
        tbl = tbl + "</tbody></table></div>";
        $(chart_container).append(tbl);
        $('#temporalChart_table1_' + randomSubstring).DataTable({ "bLengthChange": false, "paging": false, "fnRowCallback": function fnRowCallback(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (iDisplayIndex % 2 == 1) {
                    //even color
                    $('td', nRow).css('background-color', '#32464F');
                } else {
                    $('td', nRow).css('background-color', '#283C45');
                }
            } });
        $("#temporalChart_table_" + randomSubstring).mCustomScrollbar({
            axis: "y"
        });

        $("#temporalChart_table_" + randomSubstring + " tr:first").css("background-color", "#0CB29A");

        var id1 = $("#temporalChart_table_" + randomSubstring).children('div').find('div').eq(0);
        var id2 = $("#temporalChart_table_" + randomSubstring).children('div').find('div').eq(1);
        var id3 = $("#temporalChart_table_" + randomSubstring).children('div').find('div').eq(2);
        var id1attr = id1.attr("id");
        var id2attr = id2.attr("id");
        var id3attr = id3.attr("id");

        $("#" + id1attr + " " + "label").css("color", "#666666");
        $("#" + id2attr + " " + "label").css("color", "#666666");
        $("#" + id3attr).css("color", "#666666");

        $(" .dataTables_filter input").css({ "margin-left": "0.5em", "position": "relative", "border": "0", "min-width": "240px",
            "background": "transparent",
            "border-bottom": "1px solid #666666",
            " border-radius": " 0",
            "padding": " 5px 25px",
            "color": "#ccc",
            "height": " 30px",
            "-webkit-box-shadow": " none",
            "box-shadow": " none"
        });
        $(".dataTables_wrapper").css("background-color", "#374C59");
    });
    //------------------------------------------------------------------------------
    /**
     * Fuction to handle show hide of header options
     */
    $("body").on("click", ".header_chart_" + randomSubstring, function () {
        $(chart_container).css("overflow", "hidden");
        var chartId = $(this).parent().parent().parent().parent().siblings("div").attr("id");
        if ("#" + chartId == chart_container) {
            $(this).css("display", "none");
            $(".header_table_" + randomSubstring).css("display", "inline-block");
            $(containerid).empty();
            new temporalChart(actualOptions);
        }
    });
    $("body").on("click", ".header_fullscreen_chart" + randomSubstring, function () {
        //       $("#modal_"+randomSubstring).modal("show");
        $("#modal_" + randomSubstring).modal('show');
        var options = jQuery.extend(true, {}, actualOptions);
        setTimeout(function () {
            $("#modal_chart_container" + randomSubstring).css("width", "100%");
            options.container = "#modal_chart_container" + randomSubstring;

            options.headerOptions = false;
            options.height = 450;
            options.ticks = 15;
            new temporalChart(options);
        }, 500);

        //"modal_chart_container"+randomSubstring
    });
}
'use strict';
//---------------------------------------------------------------------------------------------
/**
 *
 *Function to load chart
 *@param  Object options
 */

var fo;

function sankey_chart_risk_score(options) {
    var tool_tip = $('body').append('<div class="Bubble_Chart_tooltip" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');

    //empty the container before appending the chart
    if (options.container) {
        $(options.container).empty();
    }
    //--------------------------Initialize Values-----------------------------
    if (options) {
        options.container = options.container ? options.container : "body";
        options.data = options.data ? options.data : [];
        options.edge_labels = options.edge_labels ? options.edge_labels : [];

        options.randomIdString = Math.floor(Math.random() * 10000000000);
        options.height = options.height ? options.height : 600;
        options.rectColor = options.rectColor ? options.rectColor : "transparent";
        options.margin = options.margin ? {
            top: options.margin.top ? options.margin.top : 20,
            right: options.margin.right ? options.margin.right : 20,
            bottom: options.margin.bottom ? options.margin.bottom : 30,
            left: options.margin.left ? options.margin.left : 60
        } : {
            top: 20,
            right: 20,
            bottom: 50,
            left: 60
        };
        options.translateX = options.translateX !== undefined ? options.translateX : '100';
        options.translateY = options.translateY !== undefined ? options.translateY : '100';
    }
    var actualOptions = jQuery.extend(true, {}, options);
    var randomSubstring = Math.floor(Math.random() * 10000000000);
    //define width from the parent width
    options.width = options.width ? options.width : $(options.container).width() - 20;
    //define rect wisth based on chart width and number of nodes
    // options.rectWidth = options.rectWidth ? options.rectWidth : ((options.width) / (options.data.nodes.length + 2))
    options.rectWidth = options.rectWidth ? options.rectWidth : options.width / (options.data.nodes.length * 3);

    //const data

    var dataSource = [];
    var uniqSource = [];

    //define margins and dynamic width/height
    var margin = {
        top: options.margin.top ? options.margin.top : 20,
        right: options.margin.right ? options.margin.right : 20,
        bottom: options.margin.bottom ? options.margin.bottom : 20,
        left: options.margin.left ? options.margin.left : 20
    };
    _.forEach(options.data.links, function (v, k) {

        dataSource[k] = v.source;
        if (dataSource[k] != dataSource[k - 1]) {
            uniqSource[k] = dataSource[k];
        }
    });
    var width = options.width;
    var height = options.height;

    //const data
    var MIN_RECT_WIDTH = 150;
    var MIN_RECT_HEIGHT = 100;
    var isnegativeValue;
    var isZeroValue;
    var imageY = 25;
    if (width > $(options.container).width()) {
        if (!options.isReport) {
            width = $(options.container).width();
        }
    }
    width = width - (margin.left + margin.right);
    width = width - MIN_RECT_WIDTH;
    height = height - MIN_RECT_HEIGHT;
    var bankTxtY = 80;
    if (options.edge_labels.length <= 3) {
        MIN_RECT_WIDTH = 400;
        width = MIN_RECT_WIDTH;
        height = MIN_RECT_HEIGHT;
    }
    if (options.edge_labels.length <= 4) {
        bankTxtY = 100;
        imageY = 50;
    }
    options.img_x_pos = options.img_x_pos ? options.img_x_pos : -60;
    options.text_x_pos = options.text_x_pos ? options.text_x_pos : -35;

    var _this = options;

    //define color scales
    var color = d3.scaleOrdinal().domain(options.edge_labels).range(['#368FCE', '#8C3F8E', '#F48D27', '#95AF0D', '#4C475F']);
    var sankeyChartId = options.container;

    // var randomSubstring = options.r
    //define sankey
    d3.sankey = function () {
        var sankey = {},
            nodeWidth = 164,
            nodePadding = 8,
            size = [width, height],
            nodes = [],
            links = [];
        //define sankey node width
        sankey.nodeWidth = function (_) {
            if (!arguments.length) return nodeWidth;
            nodeWidth = +_;
            return sankey;
        };
        //define sankey node padding
        sankey.nodePadding = function (_) {
            if (!arguments.length) return nodePadding;
            nodePadding = +_;
            return sankey;
        };
        //define sankey nodes
        sankey.nodes = function (_) {
            if (!arguments.length) return nodes;
            nodes = _;
            return sankey;
        };
        //define sankey links
        sankey.links = function (_) {
            if (!arguments.length) return links;
            links = _;
            return sankey;
        };
        //define sankey size
        sankey.size = function (_) {
            if (!arguments.length) return size;
            size = _;
            return sankey;
        };
        //define sankey layout
        sankey.layout = function (iterations) {
            computeNodeLinks();
            computeNodeValues();
            computeNodeBreadths();
            computeNodeDepths(iterations);
            computeLinkDepths();
            return sankey;
        };
        //define sankey re-layout
        sankey.relayout = function () {
            computeLinkDepths();
            return sankey;
        };
        //Function to compute path for links
        sankey.link = function () {
            var curvature = .5;

            function link(d) {
                var x0 = d.source.x + d.source.dx,
                    x1 = d.target.x,
                    xi = d3.interpolateNumber(x0, x1),
                    x2 = xi(curvature),
                    x3 = xi(1 - curvature),
                    y0 = d.source.y + d.sy + d.dy / 2,
                    y1 = d.target.y + d.ty + d.dy / 2;
                return "M" + -10 + "," + -10 + "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1;
            }

            link.curvature = function (_) {
                if (!arguments.length) return curvature;
                curvature = +_;
                return link;
            };

            return link;
        };

        // Populate the sourceLinks and targetLinks for each node.
        // Also, if the source and target are not objects, assume they are indices.
        function computeNodeLinks() {
            nodes.forEach(function (node) {
                node.sourceLinks = [];
                node.targetLinks = [];
            });
            links.forEach(function (link) {
                var source = link.source,
                    target = link.target;
                if (typeof source === "number" || typeof source === "string") source = link.source = nodes[link.source]; //Object.assign({}, nodes.filter(function(d,i){ return d.id == link.source})[0])  ;
                if (typeof target === "number" || typeof target === "string") target = link.target = nodes[link.target]; //Object.assign({}, nodes.filter(function(d,i){ return d.id == link.target})[0])  ;//
                source.sourceLinks.push(link);
                target.targetLinks.push(link);
            });
        }

        // Compute the value (size) of each node by summing the associated links.
        function computeNodeValues() {
            nodes.forEach(function (node) {
                node.value = Math.max(d3.sum(node.sourceLinks, value), d3.sum(node.targetLinks, value));
            });
        }

        // Iteratively assign the breadth (x-position) for each node.
        // Nodes are assigned the maximum breadth of incoming neighbors plus one;
        // nodes with no incoming links are assigned breadth zero, while
        // nodes with no outgoing links are assigned the maximum breadth.
        function computeNodeBreadths() {
            var remainingNodes = nodes,
                nextNodes,
                x = 0;

            while (remainingNodes.length) {
                nextNodes = [];
                remainingNodes.forEach(function (node) {
                    node.x = x;
                    node.dx = nodeWidth;
                    node.sourceLinks.forEach(function (link) {
                        nextNodes.push(link.target);
                    });
                });
                remainingNodes = nextNodes;
                ++x;
            }

            //
            moveSinksRight(x);
            scaleNodeBreadths((width - nodeWidth) / (x - 1));
        }

        function moveSourcesRight() {
            nodes.forEach(function (node) {
                if (!node.targetLinks.length) {
                    node.x = d3.min(node.sourceLinks, function (d) {
                        return d.target.x;
                    }) - 1;
                }
            });
        }

        function moveSinksRight(x) {
            nodes.forEach(function (node) {
                if (!node.sourceLinks.length) {
                    node.x = x - 1;
                }
            });
        }

        function scaleNodeBreadths(kx) {
            nodes.forEach(function (node) {
                node.x *= kx;
            });
        }

        function computeNodeDepths(iterations) {
            var nodesByBreadth = d3.nest().key(function (d) {
                return d.x;
            }).sortKeys(d3.ascending).entries(nodes).map(function (d) {
                return d.values;
            });

            //
            initializeNodeDepth();
            resolveCollisions();
            for (var alpha = 1; iterations > 0; --iterations) {
                relaxRightToLeft(alpha *= .99);
                resolveCollisions();
                relaxLeftToRight(alpha);
                resolveCollisions();
            }

            function initializeNodeDepth() {
                var ky = d3.min(nodesByBreadth, function (nodes) {
                    return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);
                });

                nodesByBreadth.forEach(function (nodes) {
                    nodes.forEach(function (node, i) {
                        node.y = i;
                        node.dy = node.value * ky;
                    });
                });

                links.forEach(function (link) {
                    link.dy = link.value * ky;
                });
            }

            function relaxLeftToRight(alpha) {
                nodesByBreadth.forEach(function (nodes, breadth) {
                    nodes.forEach(function (node) {
                        if (node.targetLinks.length) {
                            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);
                            node.y += (y - center(node)) * alpha;
                        }
                    });
                });

                function weightedSource(link) {
                    return center(link.source) * link.value;
                }
            }

            function relaxRightToLeft(alpha) {
                nodesByBreadth.slice().reverse().forEach(function (nodes) {
                    nodes.forEach(function (node) {
                        if (node.sourceLinks.length) {
                            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);
                            node.y += (y - center(node)) * alpha;
                        }
                    });
                });

                function weightedTarget(link) {
                    return center(link.target) * link.value;
                }
            }

            function resolveCollisions() {
                nodesByBreadth.forEach(function (nodes) {
                    var node,
                        dy,
                        y0 = 0,
                        n = nodes.length,
                        i;

                    // Push any overlapping nodes down.
                    nodes.sort(ascendingDepth);
                    for (i = 0; i < n; ++i) {
                        node = nodes[i];
                        dy = y0 - node.y;
                        if (dy > 0) node.y += dy;
                        y0 = node.y + node.dy + nodePadding;
                    }

                    // If the bottommost node goes outside the bounds, push it back up.
                    dy = y0 - nodePadding - size[1];
                    if (dy > 0) {
                        y0 = node.y -= dy;

                        // Push any overlapping nodes back up.
                        for (i = n - 2; i >= 0; --i) {
                            node = nodes[i];
                            dy = node.y + node.dy + nodePadding - y0;
                            if (dy > 0) node.y -= dy;
                            y0 = node.y;
                        }
                    }
                });
            }

            function ascendingDepth(a, b) {
                return a.y - b.y;
            }
        }

        function computeLinkDepths() {
            nodes.forEach(function (node) {
                node.sourceLinks.sort(ascendingTargetDepth);
                node.targetLinks.sort(ascendingSourceDepth);
            });
            nodes.forEach(function (node) {
                var sy = 0,
                    ty = 0;
                node.sourceLinks.forEach(function (link) {
                    link.sy = sy;
                    sy += link.dy;
                });
                node.targetLinks.forEach(function (link) {
                    link.ty = ty;
                    ty += link.dy;
                });
            });

            function ascendingSourceDepth(a, b) {
                return a.source.y - b.source.y;
            }

            function ascendingTargetDepth(a, b) {
                return a.target.y - b.target.y;
            }
        }

        function center(node) {
            return node.y + node.dy / 2;
        }

        function value(link) {
            return link.value;
        }
        return sankey;
    };

    // append the svg  to the page
    var svg = d3.select(options.container).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).attr('class', 'mainSvg').append('g');
    // .attr("transform",
    //       "translate(" + margin.left + "," + margin.top + ")");

    d3.select('.mainSvg').select('g').attr('transform', 'translate(' + options.translateX + ',' + options.translateY + ')');
    // set the sankey diagram properties
    var sankey = d3.sankey().nodeWidth(36)
    // .nodeWidth(options.rectWidth ? options.rectWidth : 20)
    .nodePadding(100).size([width, height]);

    var path = sankey.link();

    // append a defs (for definition) element to your SVG
    var defs = svg.append('defs');

    //call function to load the chart
    loadsank(options.data);

    // load the data
    function loadsank(graph) {
        sankey.nodes(graph.nodes).links(graph.links).layout(32); // any value > 13 breaks the link gradient

        // add in the links
        var link = svg.append('g').selectAll('.link').data(graph.links).enter().append('path').attr('class', 'link').attr('d', path).attr("stroke", '#4294D9').style('stroke-width', function (d) {
            return Math.max(1, d.dy);
        }).style('fill', 'none').style('stroke-opacity', 0.2).sort(function (a, b) {
            return b.dy - a.dy;
        });
        var clickedEleId;

        // add in the nodes
        var node = svg.append('g').selectAll('.node').data(graph.nodes).enter().append('g').attr('class', 'node').style("cursor", "pointer").attr('transform', function (d, i) {
            if (i == 0) {
                return 'translate(' + (d.x + 30) + ' ,' + d.y + ')';
            } else {
                return 'translate(' + d.x + ' ,' + d.y + ')';
            }
        });

        // add the rectangles for the nodes
        var node_width = MIN_RECT_WIDTH;
        node.append('rect').attr('height', function (d) {
            if (d.dy < 0) {
                if (!isnegativeValue) {
                    isnegativeValue = d.dy;
                }
                if (isnegativeValue > d.dy) {
                    isnegativeValue = d.dy;
                }
                return 0;
            } else if (d.dy == 0) {
                if (!isZeroValue) {
                    isZeroValue = 50;
                }
                if (isZeroValue > d.dy) {
                    isZeroValue = 50;
                }
                return 0;
            } else {
                return d.dy;
            }
        }).attr('width', sankey.nodeWidth()).style('fill', function (d) {
            return options.rectColor;
        });

        link.on("mouseover", function (d) {
            $(this).css("opacity", 1);
            $(".Bubble_Chart_tooltip").html(d.txt.split('_').join(' '));
            $(".Bubble_Chart_tooltip").css("visibility", "visible");
            return $(".Bubble_Chart_tooltip").css("display", "block");
        }).on("mousemove", function () {
            var p = $(options.container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".Bubble_Chart_tooltip").width() + 50;
            var cursor = d3.event.x;
            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Bubble_Chart_tooltip").width() + "px");
            } else {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY + "px");

            //   $(".Bubble_Chart_tooltip").css("top", (d3.event.pageY - 10) + "px")
            //return  $(".Bubble_Chart_tooltip").css("left", (d3.event.pageX + 10) + "px");
        }).on("mouseout", function () {
            //hide tool-tip
            $(".Bubble_Chart_tooltip").css("visibility", "hidden");
            return $(".Bubble_Chart_tooltip").css("display", "none");
        });

        node.on("mouseover", function (d) {
            $(this).css("opacity", 1);
            if ($(this).attr("id") && $(this).attr("id") == 'firstnode') {
                return $(".Bubble_Chart_tooltip").css("display", "none");
            }
            if (d.name != "") {
                $(".Bubble_Chart_tooltip").html('<span style = "color:"#FFFFFF">' + d.name + ' : ' + (d.value * 100).toFixed(2) + '%</span> ');
                $(".Bubble_Chart_tooltip").css("visibility", "visible");
                return $(".Bubble_Chart_tooltip").css("display", "block");
            }
        }).on("mousemove", function () {
            var p = $(options.container);
            var position = p.offset();
            var windowWidth = window.innerWidth;
            var tooltipWidth = $(".Bubble_Chart_tooltip").width() + 50;
            var cursor = d3.event.x;
            if (position.left < d3.event.pageX && cursor > tooltipWidth) {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-left");
                element[0].classList.add("tooltip-right");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX - 15 - $(".Bubble_Chart_tooltip").width() + "px");
            } else {
                var element = document.getElementsByClassName("Bubble_Chart_tooltip");
                element[0].classList.remove("tooltip-right");
                element[0].classList.add("tooltip-left");
                $(".Bubble_Chart_tooltip").css("left", d3.event.pageX + 10 + "px");
            }
            return $(".Bubble_Chart_tooltip").css("top", d3.event.pageY + "px");

            //   $(".Bubble_Chart_tooltip").css("top", (d3.event.pageY - 10) + "px")
            //return  $(".Bubble_Chart_tooltip").css("left", (d3.event.pageX + 10) + "px");
        }).on("mouseout", function () {
            //hide tool-tip
            $(".Bubble_Chart_tooltip").css("visibility", "hidden");
            return $(".Bubble_Chart_tooltip").css("display", "none");
        });

        $('svg')[0].width.baseVal.value = $('svg')[0].width.baseVal.value + MIN_RECT_WIDTH;
        $('svg')[0].height.baseVal.value = $('svg')[0].height.baseVal.value + MIN_RECT_HEIGHT;

        if (isnegativeValue) {
            setTimeout(function () {
                actualOptions.height = parseFloat(actualOptions.height) + parseFloat(Math.abs(isnegativeValue));
                if (parseFloat(Math.abs(isnegativeValue)) < 0) {
                    actualOptions.width = parseFloat(actualOptions.width) - parseFloat(Math.abs(isnegativeValue));
                } else {
                    actualOptions.width = parseFloat(actualOptions.width) + parseFloat(Math.abs(isnegativeValue));
                }
                var sankey = sankey_chart_risk_score(actualOptions);

                window.loadRiskpieChart(true, actualOptions);
                //                var wd = parseInt(d3.select('.mainSvg').attr('width'));
                //                d3.select('.mainSvg').attr('width', (parseInt(d3.select('.sankPie').attr('width')) * 2) + wd);
            }, 1000);
        }
        if (isZeroValue) {
            setTimeout(function () {

                actualOptions.height = parseFloat(actualOptions.height) + isZeroValue;
                actualOptions.width = parseFloat(actualOptions.width) - isZeroValue;
                var sankey = sankey_chart_risk_score(actualOptions);
                setTimeout(function () {
                    window.loadRiskpieChart(true, actualOptions);
                }, 100);

                //                var wd = parseInt(d3.select('.mainSvg').attr('width'));
                //                d3.select('.mainSvg').attr('width', (parseInt(d3.select('.sankPie').attr('width')) * 2) + wd);
            }, 1000);
        }

        fo = node.append("foreignObject").attr("class", "foreign div").attr("x", 0).attr("y", function (d) {
            return 0;
        }).attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        $(options.container).find('.node').each(function (i, d) {
            if (i == 1) {
                $(this).find('foreignObject').attr('id', 'finalDiv').attr('x', '-10').attr('y', '-10').attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');
                $(this).find('rect').attr('class', 'lastRect');
                $(this).find('rect').attr('width', 5);
                $(this).find('text').remove();
            } else {
                if (i != 0) {
                    $(this).find('rect').attr('class', 'rect-mid');
                } else {
                    $(this).find('text').remove();
                    $(this).find('rect').attr('class', 'firstRect');
                    $(this).find('rect').attr('width', 5);
                    $(this).attr('id', 'firstnode');
                }
                $(this).find('foreignObject').remove();
            }
        });
        //$('.rect-mid').attr('height') ? $('.rect-mid').attr('height') /9 :
        // // add in the title for the nodes
        node.append('text').attr('x', sankey.nodeWidth() / 5).attr('y', -10).attr('dy', '.35em').attr('text-anchor', 'middle').attr('transform', null).style('text-transform', 'capitalize').text(function (d) {
            var riskname = d.name;
            if (d.name && d.id !== 0) {
                riskname = riskname + " (" + ((d.value * 100).toFixed(2) + '%)');
            }
            return riskname;
        }).attr("stroke", 'none').attr("fill", '#9B9FA2').filter(function (d) {
            return d.x < width / 2;
        }).attr('x', sankey.nodeWidth() / 3).attr('text-anchor', 'middle').style("fill", "#9B9FA2").style("stroke", "none").style("font-weight", "bolder");

        if (!options.isReport) {
            $('.node').each(function (i, d) {
                if ($('.node').length - 1 == i) {
                    $(this).find('text').remove();
                }
            });
        }
        var ht = $('.lastRect').attr('height');

        var pathImg;
        if (options.isfromOtherModules) {
            pathImg = "../assets/images/Building1.webp";
        } else {
            pathImg = "assets/images/Building1.webp";
        }
        if (options.isReport) {
            pathImg = options.companyLogo ? options.companyLogo : pathImg;
        }

        d3.select('#firstnode').append("svg:image").attr('x', options.img_x_pos).attr('y', -40).attr('width', 50).attr('height', 80).attr("xlink:href", pathImg).attr('transform', 'translate(0, ' + imageY + ')');
        d3.select('#firstnode').append("text").attr('x', options.text_x_pos).attr('y', bankTxtY).attr('width', 50).attr('height', 80).attr("text-anchor", "middle").attr("stroke", 'none').attr("font-weight", 'normal').attr("fill", '#9B9FA2').style("font-size", options.labelSize)
        //  .style("text-decoration", "underline")
        .text(options.entityName ? options.entityName : '');

        //code to remove first text from first node.
        var element = $('#firstnode').find('text');
        $(element[0]).text(' ');
        // the function for moving the nodes
        function dragmove(d) {
            d3.select(this).attr('transform', 'translate(' + (d.x = Math.max(0, Math.min(width - d.dx, d3.event.x))) + ',' + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ')');
            sankey.relayout();
            link.attr('d', path);
        }
    }
}
"use strict";

var div_radar = d3.select("body").append("div").attr("class", "radar_tooltip").style("position", "absolute").style("z-index", 1000).style("background", "rgb(27, 39, 53)").style("padding", "5px 10px").style("border-radius", "10px").style("font-size", "10px").style("display", "none");

function RadarChart(id, data, options) {
	$(options.container).empty();
	if (options) {
		options.container = options.container ? options.container : "body";
		options.width = options.width ? options.width : $(options.container).width();
		options.height = options.height ? options.height : 300;
		options.circleRadius = options.circleRadius ? options.circleRadius : 5;
		options.radians = options.radians ? options.radians : 2 * Math.PI;
		options.levels = options.levels ? options.levels : 5;
		options.maxValue = options.maxValue ? options.maxValue : 0;
		options.opacityArea = options.opacityArea ? options.opacityArea : 0.35;
		options.transformToRight = options.transformToRight ? options.transformToRight : 5;
		options.TranslateX = options.TranslateX ? options.TranslateX : 80;
		options.TranslateY = options.TranslateY ? options.TranslateY : 30;
		options.ExtraWidthX = options.ExtraWidthX ? options.ExtraWidthX : 300;
		options.ExtraWidthY = options.ExtraWidthY ? options.ExtraWidthY : 100;
		options.factor = options.factor ? options.factor : 1.25;
		options.factorLegend = options.factorLegend ? options.factorLegend : 0.85;
		options.color = options.color ? options.color : d3_v3.scale.category10();
		options.roundStrokes = options.roundStrokes ? options.roundStrokes : true;
		options.marginTop = options.marginTop ? options.marginTop : 20;
		options.marginBottom = options.marginBottom ? options.marginBottom : 20;
		options.marginRight = options.marginRight ? options.marginRight : 20;
		options.marginLeft = options.marginLeft ? options.marginLeft : 20;
		options.wrapWidth = options.wrapWidth ? options.wrapWidth : 60;
		options.opacityCircles = options.opacityCircles ? options.opacityCircles : 0.1;
		options.strokeWidth = options.strokeWidth ? options.strokeWidth : 2;
	}

	//If the supplied maxValue is smaller than the actual one, replace by the max in the data
	var maxValue = Math.max(options.maxValue, d3_v3.max(data, function (i) {
		return d3_v3.max(i.map(function (o) {
			return o.value;
		}));
	}));

	var allAxis = data[0].map(function (i, j) {
		return i.axis;
	}),
	    //Names of each axis
	total = allAxis.length,
	    //The number of different axes
	radius = Math.min(options.width / 3, options.height / 2),
	    //Radius of the outermost circle
	Format = d3_v3.format('%'),
	    //Percentage formatting
	angleSlice = Math.PI * 2 / total; //The width in radians of each "slice"

	//Scale for the radius
	var rScale = d3_v3.scale.linear().range([0, radius]).domain([0, maxValue]);

	/////////////////////////////////////////////////////////
	//////////// Create the container SVG and g /////////////
	/////////////////////////////////////////////////////////

	//Remove whatever chart with the same id/class was present before
	d3_v3.select(id).select("svg").remove();
	var width = options.width + options.marginLeft + options.marginRight,
	    height = options.height + options.marginTop + options.marginBottom;
	//Initiate the radar chart SVG
	var svg = d3_v3.select(id)
	//	         .append("svg")
	//			.attr("width",  options.width + options.marginLeft + options.marginRight)
	//			.attr("height", options.height + options.marginTop + options.marginBottom)
	.append("div").classed("svg-container", true) //container class to make it responsive
	.append("svg")
	//responsive SVG needs these 2 attributes and no width and height attr
	.attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", [0, 0, width, height].join(" "))
	//class to make it responsive
	.classed("svg-content-responsive", true).attr("class", "radar" + id);
	//Append a g element
	var g = svg.append("g").attr("transform", "translate(" + (options.width / 3 + options.marginLeft + 10) + "," + (options.height / 3 + options.marginTop + 5) + ")");

	/////////////////////////////////////////////////////////
	////////// Glow filter for some extra pizzazz ///////////
	/////////////////////////////////////////////////////////

	//Filter for the outside glow
	var filter = g.append('defs').append('filter').attr('id', 'glow'),
	    feGaussianBlur = filter.append('feGaussianBlur').attr('stdDeviation', '2.5').attr('result', 'coloredBlur'),
	    feMerge = filter.append('feMerge'),
	    feMergeNode_1 = feMerge.append('feMergeNode').attr('in', 'coloredBlur'),
	    feMergeNode_2 = feMerge.append('feMergeNode').attr('in', 'SourceGraphic');

	/////////////////////////////////////////////////////////
	/////////////// Draw the Circular grid //////////////////
	/////////////////////////////////////////////////////////

	//Wrapper for the grid & axes
	var axisGrid = g.append("g").attr("class", "axisWrapper");

	//Draw the background circles
	axisGrid.selectAll(".levels").data(d3_v3.range(1, options.levels + 1).reverse()).enter().append("circle").attr("class", "gridCircle").attr("r", function (d, i) {
		return radius / options.levels * d;
	}).style("fill", "transparent").style("stroke", "#2E424B").style("fill-opacity", options.opacityCircles).style("filter", "url(#glow)");

	//Text indicating at what % each level is
	//	axisGrid.selectAll(".axisLabel")
	//	   .data(d3_v3.range(1,(options.levels+1)).reverse())
	//	   .enter().append("text")
	//	   .attr("class", "axisLabel")
	//	   .attr("x", 4)
	//	   .attr("y", function(d){return -d*radius/options.levels;})
	//	   .attr("dy", "0.4em")
	//	   .style("font-size", "10px")
	//	   .attr("fill", "#6d858f")
	//	   .text(function(d,i) { return Format(maxValue * d/options.levels); });

	/////////////////////////////////////////////////////////
	//////////////////// Draw the axes //////////////////////
	/////////////////////////////////////////////////////////

	//Create the straight lines radiating outward from the center
	var axis = axisGrid.selectAll(".axis").data(allAxis).enter().append("g").attr("class", "axis");
	//Append the lines
	axis.append("line").attr("x1", 0).attr("y1", 0).attr("x2", function (d, i) {
		return rScale(maxValue * 1.1) * Math.cos(angleSlice * i - Math.PI / 2);
	}).attr("y2", function (d, i) {
		return rScale(maxValue * 1.1) * Math.sin(angleSlice * i - Math.PI / 2);
	}).attr("class", "line").style("stroke", "#2E424B").style("stroke-width", "1px");

	//Append the labels at each axis
	axis.append("text").attr("class", "legend").style("font-size", "11px").style("fill", "#6d858f").style("cursor", "pointer").attr("text-anchor", "middle").attr("dy", "0.35em").attr("x", function (d, i) {
		return rScale(maxValue * options.factor) * Math.cos(angleSlice * i - Math.PI / 2);
	}).attr("y", function (d, i) {
		return rScale(maxValue * options.factor) * Math.sin(angleSlice * i - Math.PI / 2);
	}).text(function (d) {
		return d;
	})

	//		.call(wrap, options.wrapWidth);

	.on('click', function (d) {
		window.pushFilters(d, false, 'attackType', d, 'selectedAttackType', 'locationMultipleEnd');
		$(".radar_tooltip").css("display", "none");
	});

	/////////////////////////////////////////////////////////
	///////////// Draw the radar chart blobs ////////////////
	/////////////////////////////////////////////////////////

	//The radial line function
	var radarLine = d3_v3.svg.line.radial().interpolate("linear-closed").radius(function (d) {
		return rScale(d.value);
	}).angle(function (d, i) {
		return i * angleSlice;
	});

	if (options.roundStrokes) {
		radarLine.interpolate("cardinal-closed");
	}

	//Create a wrapper for the blobs
	var blobWrapper = g.selectAll(".radarWrapper").data(data).enter().append("g").attr("class", "radarWrapper");

	//Append the backgrounds
	blobWrapper.append("path").attr("class", "radarArea").attr("d", function (d, i) {
		return radarLine(d);
	}).style("fill", function (d, i) {
		if (options.colorObj && d[0].group) {
			return options.colorObj[d[0].group];
		}
		return options.color(i);
	}).style("fill-opacity", options.opacityArea).on('mouseover', function (d, i) {
		//Dim all blobs
		d3_v3.selectAll(".radarArea").transition().duration(200).style("fill-opacity", 0.1);
		//Bring back the hovered over blob
		d3_v3.select(this).transition().duration(200).style("fill-opacity", 0.7);
	}).on('mouseout', function () {
		//Bring back all blobs
		d3_v3.selectAll(".radarArea").transition().duration(200).style("fill-opacity", options.opacityArea);
	});

	//Create the outlines
	blobWrapper.append("path").attr("class", "radarStroke").attr("d", function (d, i) {
		return radarLine(d);
	}).style("stroke-width", options.strokeWidth + "px").style("stroke", function (d, i) {
		if (options.colorObj && d[0].group) {
			return options.colorObj[d[0].group];
		}
		return options.color(i);
	}).style("fill", "none").style("filter", "url(#glow)");

	//Append the circles
	blobWrapper.selectAll(".radarCircle").data(function (d, i) {
		return d;
	}).enter().append("circle").attr("class", "radarCircle").attr("r", options.circleRadius).attr("cx", function (d, i) {
		return rScale(d.value) * Math.cos(angleSlice * i - Math.PI / 2);
	}).attr("cy", function (d, i) {
		return rScale(d.value) * Math.sin(angleSlice * i - Math.PI / 2);
	}).style("fill", function (d, i, j) {
		if (options.colorObj && d.group) {
			return options.colorObj[d.group];
		}
		return options.color(j);
	}).style("fill-opacity", 0.8);

	/////////////////////////////////////////////////////////
	//////// Append invisible circles for tooltip ///////////
	/////////////////////////////////////////////////////////

	//Wrapper for the invisible circles on top
	var blobCircleWrapper = g.selectAll(".radarCircleWrapper").data(data).enter().append("g").attr("class", "radarCircleWrapper");

	//Append a set of invisible circles on top for the mouseover pop-up
	blobCircleWrapper.selectAll(".radarInvisibleCircle").data(function (d, i) {
		return d;
	}).enter().append("circle").attr("class", "radarInvisibleCircle").attr("r", options.circleRadius * 1.5).attr("cx", function (d, i) {
		return rScale(d.value) * Math.cos(angleSlice * i - Math.PI / 2);
	}).attr("cy", function (d, i) {
		return rScale(d.value) * Math.sin(angleSlice * i - Math.PI / 2);
	}).style("fill", "none").style("pointer-events", "all").on("mouseover", function (d, i) {

		$(".radar_tooltip").css("display", "block");

		$(".radar_tooltip").html('<div><span class="text-gray-ta" style="text-transform: uppercase">' + d.axis + '</span></div><div><span>' + d.actualValue + ' of ' + d.totIncidentsCount + ' (' + d.incidentsValPercentage + '%)</span></div>');
	}).on("mousemove", function (d) {
		var p = $(options.container);
		var position = p.offset();
		var windowWidth = window.innerWidth;
		var tooltipWidth = $(".radar_tooltip").width() + 50;
		var cursor = d3_v3.event.x;
		if (position.left < d3_v3.event.pageX && cursor > tooltipWidth) {
			var element = document.getElementsByClassName("radar_tooltip");
			for (var i = 0; i < element.length; i++) {
				element[i].classList.remove("tooltip-left");
				element[i].classList.add("tooltip-right");
			}
			$(".radar_tooltip").css("left", d3_v3.event.pageX - 30 - $(".radar_tooltip").width() + "px");
		} else {
			var element = document.getElementsByClassName("radar_tooltip");
			for (var i = 0; i < element.length; i++) {
				element[i].classList.remove("tooltip-right");
				element[i].classList.add("tooltip-left");
			}
			$(".radar_tooltip").css("left", d3_v3.event.pageX + 20 + "px");
		}
		return $(".radar_tooltip").css("top", d3_v3.event.pageY - 20 + "px");
	}).on("mouseout", function (d) {
		$(".radar_tooltip").css("display", "none");
	});

	/////////////////////////////////////////////////////////
	/////////////////// Helper Function /////////////////////
	/////////////////////////////////////////////////////////

	//Taken from http://bl.ocks.org/mbostock/7555321
	//Wraps SVG text
	function wrap(text, width) {
		text.each(function () {
			var text = d3_v3.select(this),
			    words = text.text().split(/\s+/).reverse(),
			    word,
			    line = [],
			    lineNumber = 0,
			    lineHeight = 1.4,
			    // ems
			y = text.attr("y"),
			    x = text.attr("x"),
			    dy = parseFloat(text.attr("dy")),
			    tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");

			while (word = words.pop()) {
				line.push(word);
				tspan.text(line.join(" "));
				if (tspan.node().getComputedTextLength() > width) {
					line.pop();
					tspan.text(line.join(" "));
					line = [word];
					tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
				}
			}
		});
	} //wrap
} //RadarChart


function nFormatter(num, digits) {
	var si = [{ value: 1E18, symbol: "E" }, { value: 1E15, symbol: "P" }, { value: 1E12, symbol: "T" }, { value: 1E9, symbol: "G" }, { value: 1E6, symbol: "M" }, { value: 1E3, symbol: "k" }],
	    rx = /\.0+$|(\.[0-9]*[1-9])0+$/,
	    i;
	for (i = 0; i < si.length; i++) {
		if (num >= si[i].value) {
			return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
		}
	}
	return num.toFixed(digits).replace(rx, "$1");
}
'use strict';

/*
 * L.TileLayer.Grayscale is a regular tilelayer with grayscale makeover.
 */

L.TileLayer.Grayscale = L.TileLayer.extend({
	options: {
		quotaRed: 21,
		quotaGreen: 71,
		quotaBlue: 8,
		quotaDividerTune: 0,
		quotaDivider: function quotaDivider() {
			return this.quotaRed + this.quotaGreen + this.quotaBlue + this.quotaDividerTune;
		}
	},

	initialize: function initialize(url, options) {
		options = options || {};
		options.crossOrigin = true;
		L.TileLayer.prototype.initialize.call(this, url, options);

		this.on('tileload', function (e) {
			this._makeGrayscale(e.tile);
		});
	},

	_createTile: function _createTile() {
		var tile = L.TileLayer.prototype._createTile.call(this);
		tile.crossOrigin = "Anonymous";
		return tile;
	},

	_makeGrayscale: function _makeGrayscale(img) {
		if (img.getAttribute('data-grayscaled')) return;

		img.crossOrigin = '';
		var canvas = document.createElement("canvas");
		canvas.width = img.width;
		canvas.height = img.height;
		var ctx = canvas.getContext("2d");
		ctx.drawImage(img, 0, 0);

		var imgd = ctx.getImageData(0, 0, canvas.width, canvas.height);
		var pix = imgd.data;
		for (var i = 0, n = pix.length; i < n; i += 4) {
			pix[i] = pix[i + 1] = pix[i + 2] = (this.options.quotaRed * pix[i] + this.options.quotaGreen * pix[i + 1] + this.options.quotaBlue * pix[i + 2]) / this.options.quotaDivider();
		}
		ctx.putImageData(imgd, 0, 0);
		img.setAttribute('data-grayscaled', true);
		img.src = canvas.toDataURL();
	}
});

L.tileLayer.grayscale = function (url, options) {
	return new L.TileLayer.Grayscale(url, options);
};
