'use strict';var fo;function sankey_chart_risk_score(c){$('body').append('<div class="Bubble_Chart_tooltip" style="position: absolute;z-index: 99999;opacity: 1; pointer-events: none; display:none;text-transform:uppercase;background-color:#0cae96;  padding: 10px;border-radius: 5px; border: 1px solid gray;font-size: 10px;color:black;"><span style=" font-size: 12px; position: absolute; white-space: nowrap;  margin-left: 0px; margin-top: 0px; left: 8px; top: 8px;"><span style="font-size:10px" class="tool_tip_x_val"></span><table><tbody><tr><td style="padding:0"> </td><td style="padding:0"><b>216.4 mm</b></td></tr><tr><td style="color:#434348;padding:0">New York: </td><td style="padding:0"><b>91.2 mm</b></td></tr><tr><td style="color:#90ed7d;padding:0">London: </td><td style="padding:0"><b>52.4 mm</b></td></tr><tr><td style="color:#f7a35c;padding:0">Berlin: </td><td style="padding:0"><b>47.6 mm</b></td></tr></tbody></table></span></div>');c.container&&$(c.container).empty(),c&&(c.container=c.container?c.container:'body',c.data=c.data?c.data:[],c.edge_labels=c.edge_labels?c.edge_labels:[],c.randomIdString=Math.floor(1e10*Math.random()),c.height=c.height?c.height:600,c.rectColor=c.rectColor?c.rectColor:'transparent',c.margin=c.margin?{top:c.margin.top?c.margin.top:20,right:c.margin.right?c.margin.right:20,bottom:c.margin.bottom?c.margin.bottom:30,left:c.margin.left?c.margin.left:40}:{top:20,right:20,bottom:50,left:50});var g=jQuery.extend(!0,{},c),h=Math.floor(1e10*Math.random());c.width=c.width?c.width:$(c.container).width()-20,c.rectWidth=c.rectWidth?c.rectWidth:c.width/(3*c.data.nodes.length);var j=[],l=[],m={top:20,right:20,bottom:20,left:20};_.forEach(c.data.links,function(F,G){j[G]=F.source,j[G]!=j[G-1]&&(l[G]=j[G])}),width=c.width,height=c.height;var o=150,q=100,r,s,t=25;width>$(c.container).width()&&(width=$(c.container).width()),width-=m.left+m.right,width-=o,height-=q;var u=80;3>=c.edge_labels.length&&(o=400,width=o,height=q),4>=c.edge_labels.length&&(u=100,t=50);var z=d3.scaleOrdinal().domain(c.edge_labels).range(['#368FCE','#8C3F8E','#F48D27','#95AF0D','#4C475F']),A=c.container;d3.sankey=function(){function F(){T.forEach(function(V){V.sourceLinks=[],V.targetLinks=[]}),U.forEach(function(V){var W=V.source,X=V.target;('number'==typeof W||'string'==typeof W)&&(W=V.source=T[V.source]),('number'==typeof X||'string'==typeof X)&&(X=V.target=T[V.target]),W.sourceLinks.push(V),X.targetLinks.push(V)})}function G(){T.forEach(function(V){V.value=Math.max(d3.sum(V.sourceLinks,O),d3.sum(V.targetLinks,O))})}function H(){for(var W,V=T,X=0;V.length;)W=[],V.forEach(function(Y){Y.x=X,Y.dx=Q,Y.sourceLinks.forEach(function(Z){W.push(Z.target)})}),V=W,++X;J(X),K((width-Q)/(X-1))}function J(V){T.forEach(function(W){W.sourceLinks.length||(W.x=V-1)})}function K(V){T.forEach(function(W){W.x*=V})}function L(V){function X(da){function ea(fa){return N(fa.source)*fa.value}ba.forEach(function(fa){fa.forEach(function(ha){if(ha.targetLinks.length){var ia=d3.sum(ha.targetLinks,ea)/d3.sum(ha.targetLinks,O);ha.y+=(ia-N(ha))*da}})})}function Y(da){function ea(fa){return N(fa.target)*fa.value}ba.slice().reverse().forEach(function(fa){fa.forEach(function(ga){if(ga.sourceLinks.length){var ha=d3.sum(ga.sourceLinks,ea)/d3.sum(ga.sourceLinks,O);ga.y+=(ha-N(ga))*da}})})}function Z(){ba.forEach(function(da){var ea,fa,ia,ga=0,ha=da.length;for(da.sort(aa),ia=0;ia<ha;++ia)ea=da[ia],fa=ga-ea.y,0<fa&&(ea.y+=fa),ga=ea.y+ea.dy+R;if(fa=ga-R-S[1],0<fa)for(ga=ea.y-=fa,ia=ha-2;0<=ia;--ia)ea=da[ia],fa=ea.y+ea.dy+R-ga,0<fa&&(ea.y-=fa),ga=ea.y})}function aa(da,ea){return da.y-ea.y}var ba=d3.nest().key(function(da){return da.x}).sortKeys(d3.ascending).entries(T).map(function(da){return da.values});(function(){var da=d3.min(ba,function(ea){return(S[1]-(ea.length-1)*R)/d3.sum(ea,O)});ba.forEach(function(ea){ea.forEach(function(fa,ga){fa.y=ga,fa.dy=fa.value*da})}),U.forEach(function(ea){ea.dy=ea.value*da})})(),Z();for(var ca=1;0<V;--V)Y(ca*=.99),Z(),X(ca),Z()}function M(){function V(X,Y){return X.source.y-Y.source.y}function W(X,Y){return X.target.y-Y.target.y}T.forEach(function(X){X.sourceLinks.sort(W),X.targetLinks.sort(V)}),T.forEach(function(X){var Y=0,Z=0;X.sourceLinks.forEach(function(aa){aa.sy=Y,Y+=aa.dy}),X.targetLinks.forEach(function(aa){aa.ty=Z,Z+=aa.dy})})}function N(V){return V.y+V.dy/2}function O(V){return V.value}var P={},Q=164,R=8,S=[width,height],T=[],U=[];return P.nodeWidth=function(V){return arguments.length?(Q=+V,P):Q},P.nodePadding=function(V){return arguments.length?(R=+V,P):R},P.nodes=function(V){return arguments.length?(T=V,P):T},P.links=function(V){return arguments.length?(U=V,P):U},P.size=function(V){return arguments.length?(S=V,P):S},P.layout=function(V){return F(),G(),H(),L(V),M(),P},P.relayout=function(){return M(),P},P.link=function(){function V(X){var Y=X.source.x+X.source.dx,Z=X.target.x,aa=d3.interpolateNumber(Y,Z),ba=aa(W),ca=aa(1-W),da=X.source.y+X.sy+X.dy/2,ea=X.target.y+X.ty+X.dy/2;return'M-10,-10M'+Y+','+da+'C'+ba+','+da+' '+ca+','+ea+' '+Z+','+ea}var W=.5;return V.curvature=function(X){return arguments.length?(W=+X,V):W},V},P};var B=d3.select(c.container).append('svg').attr('width',width+m.left+m.right).attr('height',height+m.top+m.bottom).attr('class','mainSvg').append('g');d3.select('.mainSvg').select('g').attr('transform','translate(100, 100)');var C=d3.sankey().nodeWidth(36).nodePadding(100).size([width,height]),D=C.link(),E=B.append('defs');(function(F){C.nodes(F.nodes).links(F.links).layout(32);var H=B.append('g').selectAll('.link').data(F.links).enter().append('path').attr('class','link').attr('d',D).attr('stroke','#4294D9').style('stroke-width',function(O){return Math.max(1,O.dy)}).style('fill','none').style('stroke-opacity',0.2).sort(function(O,P){return P.dy-O.dy}),J=B.append('g').selectAll('.node').data(F.nodes).enter().append('g').attr('class','node').style('cursor','pointer').attr('transform',function(O,P){return 0==P?'translate('+(O.x+30)+' ,'+O.y+')':'translate('+O.x+' ,'+O.y+')'});J.append('rect').attr('height',function(O){return 0>O.dy?(r||(r=O.dy),r>O.dy&&(r=O.dy),0):0==O.dy?(s||(s=50),s>O.dy&&(s=50),0):O.dy}).attr('width',C.nodeWidth()).style('fill',function(){return c.rectColor}),H.on('mouseover',function(O){return $(this).css('opacity',1),$('.Bubble_Chart_tooltip').html(O.txt.split('_').join(' ')),$('.Bubble_Chart_tooltip').css('visibility','visible'),$('.Bubble_Chart_tooltip').css('display','block')}).on('mousemove',function(){var O=$(c.container),P=O.offset(),Q=window.innerWidth,R=$('.Bubble_Chart_tooltip').width()+50,S=d3.event.x;if(P.left<d3.event.pageX&&S>R){var T=document.getElementsByClassName('Bubble_Chart_tooltip');T[0].classList.remove('tooltip-left'),T[0].classList.add('tooltip-right'),$('.Bubble_Chart_tooltip').css('left',d3.event.pageX-15-$('.Bubble_Chart_tooltip').width()+'px')}else{var T=document.getElementsByClassName('Bubble_Chart_tooltip');T[0].classList.remove('tooltip-right'),T[0].classList.add('tooltip-left'),$('.Bubble_Chart_tooltip').css('left',d3.event.pageX+10+'px')}return $('.Bubble_Chart_tooltip').css('top',d3.event.pageY+'px')}).on('mouseout',function(){return $('.Bubble_Chart_tooltip').css('visibility','hidden'),$('.Bubble_Chart_tooltip').css('display','none')}),J.on('mouseover',function(O){return $(this).css('opacity',1),$(this).attr('id')&&'firstnode'==$(this).attr('id')?$('.Bubble_Chart_tooltip').css('display','none'):''==O.name?void 0:($('.Bubble_Chart_tooltip').html('<span style = "color:"#FFFFFF">'+O.name+' : '+(100*O.value).toFixed(2)+'%</span> '),$('.Bubble_Chart_tooltip').css('visibility','visible'),$('.Bubble_Chart_tooltip').css('display','block'))}).on('mousemove',function(){var O=$(c.container),P=O.offset(),Q=window.innerWidth,R=$('.Bubble_Chart_tooltip').width()+50,S=d3.event.x;if(P.left<d3.event.pageX&&S>R){var T=document.getElementsByClassName('Bubble_Chart_tooltip');T[0].classList.remove('tooltip-left'),T[0].classList.add('tooltip-right'),$('.Bubble_Chart_tooltip').css('left',d3.event.pageX-15-$('.Bubble_Chart_tooltip').width()+'px')}else{var T=document.getElementsByClassName('Bubble_Chart_tooltip');T[0].classList.remove('tooltip-right'),T[0].classList.add('tooltip-left'),$('.Bubble_Chart_tooltip').css('left',d3.event.pageX+10+'px')}return $('.Bubble_Chart_tooltip').css('top',d3.event.pageY+'px')}).on('mouseout',function(){return $('.Bubble_Chart_tooltip').css('visibility','hidden'),$('.Bubble_Chart_tooltip').css('display','none')}),$('svg')[0].width.baseVal.value=$('svg')[0].width.baseVal.value+o,$('svg')[0].height.baseVal.value=$('svg')[0].height.baseVal.value+q,r&&setTimeout(function(){g.height=parseFloat(g.height)+parseFloat(Math.abs(r)),g.width=0>parseFloat(Math.abs(r))?parseFloat(g.width)-parseFloat(Math.abs(r)):parseFloat(g.width)+parseFloat(Math.abs(r));sankey_chart_risk_score(g);window.loadRiskpieChart(!0,g)},1e3),s&&setTimeout(function(){g.height=parseFloat(g.height)+s,g.width=parseFloat(g.width)-s;sankey_chart_risk_score(g);setTimeout(function(){window.loadRiskpieChart(!0,g)},100)},1e3),fo=J.append('foreignObject').attr('class','foreign div').attr('x',0).attr('y',function(){return 0}).attr('transform','translate('+m.left+','+m.top+')'),$(c.container).find('.node').each(function(O){1==O?($(this).find('foreignObject').attr('id','finalDiv').attr('x','-10').attr('y','-10').attr('transform','translate('+width/2+','+height/2+')'),$(this).find('rect').attr('class','lastRect'),$(this).find('rect').attr('width',5),$(this).find('text').remove()):(0==O?($(this).find('text').remove(),$(this).find('rect').attr('class','firstRect'),$(this).find('rect').attr('width',5),$(this).attr('id','firstnode')):$(this).find('rect').attr('class','rect-mid'),$(this).find('foreignObject').remove())}),J.append('text').attr('x',C.nodeWidth()/5).attr('y',-10).attr('dy','.35em').attr('text-anchor','middle').attr('transform',null).style('text-transform','capitalize').text(function(O){return O.name}).attr('stroke','none').attr('fill','#9B9FA2').filter(function(O){return O.x<width/2}).attr('x',C.nodeWidth()/3).attr('text-anchor','middle').style('fill','#9B9FA2').style('stroke','none').style('font-weight','bolder'),$('.node').each(function(O){$('.node').length-1==O&&$(this).find('text').remove()});var L=$('.lastRect').attr('height'),M;M=c.isfromOtherModules?'../assets/images/Building1.webp':'assets/images/Building1.webp',d3.select('#firstnode').append('svg:image').attr('x',-60).attr('y',-40).attr('width',50).attr('height',80).attr('xlink:href',M).attr('transform','translate(0, '+t+')'),d3.select('#firstnode').append('text').attr('x',-35).attr('y',u).attr('width',50).attr('height',80).attr('text-anchor','middle').attr('stroke','none').attr('font-weight','normal').attr('fill','#9B9FA2').style('font-size',c.labelSize).text(c.entityName?c.entityName:'');var N=$('#firstnode').find('text');$(N[0]).text(' ')})(c.data)}
